{"file_contents":{"server/storage.ts":{"content":"import { type InsertGameSession, type SelectGameSession, GameState, gameSessions } from \"@shared/schema\";\nimport { neon } from \"@neondatabase/serverless\";\nimport { drizzle } from \"drizzle-orm/neon-http\";\nimport { eq } from \"drizzle-orm\";\n\n// Database setup\nconst databaseUrl = process.env.DATABASE_URL;\nif (!databaseUrl) {\n  throw new Error(\"DATABASE_URL environment variable is required\");\n}\n\nconst sql = neon(databaseUrl);\nconst db = drizzle(sql);\n\n// Storage interface for MDDS game sessions\nexport interface IStorage {\n  getGameSession(sessionName: string): Promise<SelectGameSession | undefined>;\n  createGameSession(sessionName: string, gameState: GameState, sessionInfo?: any, turnStatistics?: any, lastUpdated?: string): Promise<SelectGameSession>;\n  updateGameSession(sessionName: string, gameState: GameState, sessionInfo?: any, turnStatistics?: any, finalReport?: string, lastUpdated?: string): Promise<SelectGameSession>;\n  getAllGameSessions(): Promise<SelectGameSession[]>;\n  deleteGameSession(sessionName: string): Promise<boolean>;\n}\n\nexport class DrizzleStorage implements IStorage {\n  async getGameSession(sessionName: string): Promise<SelectGameSession | undefined> {\n    try {\n      const result = await db\n        .select()\n        .from(gameSessions)\n        .where(eq(gameSessions.sessionName, sessionName))\n        .limit(1);\n      \n      return result[0] || undefined;\n    } catch (error) {\n      console.error(\"Error getting game session:\", error);\n      throw error;\n    }\n  }\n\n  async createGameSession(sessionName: string, gameState: GameState, sessionInfo?: any, turnStatistics?: any, lastUpdated?: string): Promise<SelectGameSession> {\n    try {\n      const result = await db\n        .insert(gameSessions)\n        .values({\n          sessionName,\n          gameState,\n          sessionInfo,\n          turnStatistics,\n          lastUpdated,\n        })\n        .returning();\n      \n      return result[0];\n    } catch (error) {\n      console.error(\"Error creating game session:\", error);\n      throw error;\n    }\n  }\n\n  async updateGameSession(sessionName: string, gameState: GameState, sessionInfo?: any, turnStatistics?: any, finalReport?: string, lastUpdated?: string): Promise<SelectGameSession> {\n    try {\n      const result = await db\n        .update(gameSessions)\n        .set({\n          gameState,\n          sessionInfo,\n          turnStatistics,\n          finalReport,\n          lastUpdated,\n          updatedAt: new Date(),\n        })\n        .where(eq(gameSessions.sessionName, sessionName))\n        .returning();\n      \n      if (result.length === 0) {\n        throw new Error(`Session ${sessionName} not found`);\n      }\n      \n      return result[0];\n    } catch (error) {\n      console.error(\"Error updating game session:\", error);\n      throw error;\n    }\n  }\n\n  async getAllGameSessions(): Promise<SelectGameSession[]> {\n    try {\n      return await db.select().from(gameSessions);\n    } catch (error) {\n      console.error(\"Error getting all game sessions:\", error);\n      throw error;\n    }\n  }\n\n  async deleteGameSession(sessionName: string): Promise<boolean> {\n    try {\n      const result = await db\n        .delete(gameSessions)\n        .where(eq(gameSessions.sessionName, sessionName))\n        .returning();\n      \n      return result.length > 0;\n    } catch (error) {\n      console.error(\"Error deleting game session:\", error);\n      throw error;\n    }\n  }\n}\n\nexport const storage = new DrizzleStorage();\n","size_bytes":3461},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/AppHeader.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { sanitizeText } from '../logic/guards';\nimport { useMDDSStore } from '@/state/store';\nimport StrategyLog from './StrategyLog';\nimport { generateCardLogsPDF } from '@/utils/pdfGenerator';\nimport { apiRequest } from '@/lib/queryClient';\nimport { \n  HelpCircle, \n  RotateCcw,\n  Save, \n  Settings,\n  Moon,\n  Sun,\n  Download,\n  Users,\n  Trash2,\n  ChevronDown,\n  Database,\n  CreditCard,\n  FileCheck,\n  Lock,\n  Unlock,\n  Eye,\n  EyeOff,\n  BookOpen,\n  Clock\n} from 'lucide-react';\nimport logoUrl from '@assets/Logo_1758524556759.png';\nimport { useTheme } from \"./ThemeProvider\";\nimport cardsData from '../data/cards.json';\nimport DomainBadge from './DomainBadge';\nimport { Domain } from '@shared/schema';\n\ninterface AppHeaderProps {\n  currentTurn: number;\n  maxTurns: number;\n  onSave: () => void;\n  onResetProgress: () => void;\n  onSetMaxTurns: (turns: number) => void;\n  onDownloadPDF: () => void;\n  onFinishGameSession: () => void;\n  showShopAndCarts: boolean;\n  onToggleShopAndCarts: () => void;\n}\n\nexport default function AppHeader({\n  currentTurn,\n  maxTurns,\n  onSave,\n  onResetProgress,\n  onSetMaxTurns,\n  onDownloadPDF,\n  onFinishGameSession,\n  showShopAndCarts,\n  onToggleShopAndCarts\n}: AppHeaderProps) {\n  const [, setLocation] = useLocation();\n  const { theme, setTheme } = useTheme();\n  const [showCardReference, setShowCardReference] = useState(false);\n  const [selectedDimension, setSelectedDimension] = useState<Domain | null>(null);\n  const [showSettings, setShowSettings] = useState(false);\n  const [showSessionInfo, setShowSessionInfo] = useState(false);\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\n  const [isStrategyLogExpanded, setIsStrategyLogExpanded] = useState(false);\n  const [isDatabaseUnlocked, setIsDatabaseUnlocked] = useState(false);\n  const [databasePassword, setDatabasePassword] = useState(\"\");\n  const [passwordError, setPasswordError] = useState(false);\n  const [showRules, setShowRules] = useState(false);\n  const [isPermanentCardsUnlocked, setIsPermanentCardsUnlocked] = useState(false);\n  const [permanentCardsPassword, setPermanentCardsPassword] = useState(\"\");\n  const [permanentCardsPasswordError, setPermanentCardsPasswordError] = useState(false);\n  const [showLastTurnPurchases, setShowLastTurnPurchases] = useState(false);\n  \n  // Use store for session management\n  const sessionInfo = useMDDSStore(state => state.sessionInfo);\n  const strategyLog = useMDDSStore(state => state.strategyLog);\n  const updateSessionName = useMDDSStore(state => state.updateSessionName);\n  const updateParticipant = useMDDSStore(state => state.updateParticipant);\n  const addParticipant = useMDDSStore(state => state.addParticipant);\n  const removeParticipant = useMDDSStore(state => state.removeParticipant);\n  const teams = useMDDSStore(state => state.teams);\n  \n\n  const handleUnlockDatabase = () => {\n    if (databasePassword === \"MDDS\") {\n      setIsDatabaseUnlocked(true);\n      setPasswordError(false);\n      setDatabasePassword(\"\");\n    } else {\n      setPasswordError(true);\n    }\n  };\n\n  const handleUnlockPermanentCards = () => {\n    if (permanentCardsPassword === \"MDDS\") {\n      setIsPermanentCardsUnlocked(true);\n      setPermanentCardsPasswordError(false);\n      setPermanentCardsPassword(\"\");\n    } else {\n      setPermanentCardsPasswordError(true);\n    }\n  };\n\n  const handleDatabaseNavigation = () => {\n    setShowSettings(false);\n    setLocation('/database');\n  };\n\n  const handleDownloadCardLogs = async () => {\n    try {\n      generateCardLogsPDF(strategyLog, sessionInfo);\n    } catch (error) {\n      console.error('Failed to generate Card Logs PDF:', error);\n      alert('Failed to generate Card Logs PDF. Please try again.');\n    }\n  };\n\n  const validateSessionInfo = () => {\n    const errors: string[] = [];\n    \n    sessionInfo.participants.forEach((participant, index) => {\n      if (!participant.name.trim()) {\n        errors.push(`Participant ${index + 1} name is required`);\n      }\n      if (!participant.country.trim()) {\n        errors.push(`Participant ${index + 1} team is required`);\n      }\n    });\n    \n    setValidationErrors(errors);\n    return errors.length === 0;\n  };\n\n  const handleSessionSave = () => {\n    if (validateSessionInfo()) {\n      setShowSessionInfo(false);\n      setValidationErrors([]);\n    }\n  };\n\n  return (\n    <header className=\"glass-header\">\n      <div className=\"container mx-auto px-4 py-3\">\n        <div className=\"flex items-center justify-between\">\n          {/* Logo and Title */}\n          <div className=\"flex items-center gap-3\">\n            <img src={logoUrl} alt=\"MDDS Logo\" className=\"w-8 h-8\" />\n            <div>\n              <h1 className=\"text-xl font-bold\" data-testid=\"text-app-title\">\n                {sanitizeText('MDDS - Multi Dimension Deterrence Strategy')}\n              </h1>\n              <p className=\"text-xs text-muted-foreground\">\n                {sanitizeText('Strategic Planning Application')}\n              </p>\n            </div>\n          </div>\n\n          {/* Session Name */}\n          <div className=\"hidden md:flex items-center gap-2\">\n            <Badge variant=\"outline\" data-testid=\"badge-session-name\">\n              {sessionInfo.sessionName || 'MDDS Session'}\n            </Badge>\n            <Badge variant=\"secondary\" data-testid=\"badge-turn-number\">\n              Turn {currentTurn}\n            </Badge>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex items-center gap-2\">\n            {/* Theme Toggle */}\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setTheme(theme === \"dark\" ? \"light\" : \"dark\")}\n              data-testid=\"button-theme-toggle\"\n            >\n              <Sun className=\"h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n              <Moon className=\"absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n            </Button>\n\n            {/* Show/Hide Shop & Carts Toggle */}\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onToggleShopAndCarts}\n              data-testid=\"button-toggle-shop-visibility\"\n            >\n              {showShopAndCarts ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n            </Button>\n\n            {/* Last Turn Purchases */}\n            <Dialog open={showLastTurnPurchases} onOpenChange={setShowLastTurnPurchases}>\n              <DialogTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-last-turn-purchases\">\n                  <Clock className=\"w-4 h-4\" />\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle>{sanitizeText(`Last Turn Purchases (Turn ${currentTurn > 1 ? currentTurn - 1 : currentTurn})`)}</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  {/* NATO Purchases */}\n                  <div>\n                    <h4 className=\"font-semibold text-sm mb-2 text-blue-600 dark:text-blue-400\">NATO Purchases</h4>\n                    <div className=\"space-y-2\">\n                      {teams?.NATO?.recentPurchases\n                        ?.filter(purchase => purchase.purchasedTurn === (currentTurn > 1 ? currentTurn - 1 : currentTurn))\n                        .map((purchase, index) => {\n                          const card = cardsData.find((c: any) => c.id === purchase.cardId);\n                          return (\n                            <div key={index} className=\"p-2 rounded-lg border border-blue-500/20 bg-blue-50/5 dark:bg-blue-950/20\">\n                              <div className=\"flex items-center gap-2\">\n                                <CreditCard className=\"w-4 h-4 text-blue-500\" />\n                                <span className=\"font-medium\">{card?.name || purchase.cardId}</span>\n                                <span className=\"text-xs text-muted-foreground\">({purchase.cardId})</span>\n                              </div>\n                              {card && (\n                                <div className=\"mt-1 ml-6 text-xs text-muted-foreground\">\n                                  <DomainBadge domain={card.domain as Domain} className=\"inline-block mr-2\" />\n                                  {card.effects?.map((effect: any, i: number) => (\n                                    <span key={i}>\n                                      {i > 0 && ', '}\n                                      {effect.target === 'self' ? 'Self' : 'Opponent'} {effect.domain}: {effect.delta > 0 ? '+' : ''}{effect.delta}\n                                    </span>\n                                  ))}\n                                </div>\n                              )}\n                            </div>\n                          );\n                        })}\n                      {(!teams?.NATO?.recentPurchases || teams.NATO.recentPurchases.filter(p => p.purchasedTurn === (currentTurn > 1 ? currentTurn - 1 : currentTurn)).length === 0) && (\n                        <p className=\"text-sm text-muted-foreground italic\">No purchases this turn</p>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Russia Purchases */}\n                  <div>\n                    <h4 className=\"font-semibold text-sm mb-2 text-red-600 dark:text-red-400\">Russia Purchases</h4>\n                    <div className=\"space-y-2\">\n                      {teams?.Russia?.recentPurchases\n                        ?.filter(purchase => purchase.purchasedTurn === (currentTurn > 1 ? currentTurn - 1 : currentTurn))\n                        .map((purchase, index) => {\n                          const card = cardsData.find((c: any) => c.id === purchase.cardId);\n                          return (\n                            <div key={index} className=\"p-2 rounded-lg border border-red-500/20 bg-red-50/5 dark:bg-red-950/20\">\n                              <div className=\"flex items-center gap-2\">\n                                <CreditCard className=\"w-4 h-4 text-red-500\" />\n                                <span className=\"font-medium\">{card?.name || purchase.cardId}</span>\n                                <span className=\"text-xs text-muted-foreground\">({purchase.cardId})</span>\n                              </div>\n                              {card && (\n                                <div className=\"mt-1 ml-6 text-xs text-muted-foreground\">\n                                  <DomainBadge domain={card.domain as Domain} className=\"inline-block mr-2\" />\n                                  {card.effects?.map((effect: any, i: number) => (\n                                    <span key={i}>\n                                      {i > 0 && ', '}\n                                      {effect.target === 'self' ? 'Self' : 'Opponent'} {effect.domain}: {effect.delta > 0 ? '+' : ''}{effect.delta}\n                                    </span>\n                                  ))}\n                                </div>\n                              )}\n                            </div>\n                          );\n                        })}\n                      {(!teams?.Russia?.recentPurchases || teams.Russia.recentPurchases.filter(p => p.purchasedTurn === (currentTurn > 1 ? currentTurn - 1 : currentTurn)).length === 0) && (\n                        <p className=\"text-sm text-muted-foreground italic\">No purchases this turn</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n\n            {/* Participants */}\n            <Dialog open={showSessionInfo} onOpenChange={setShowSessionInfo}>\n              <DialogTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-participants\">\n                  <Users className=\"w-4 h-4\" />\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-md\">\n                <DialogHeader>\n                  <DialogTitle>{sanitizeText('Participants')}</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  <div>\n                    <Label>Participants</Label>\n                    <div className=\"space-y-3 mt-2\">\n                      {sessionInfo.participants.map((participant, index) => (\n                        <div key={index} className=\"grid grid-cols-[1fr_1fr_auto] gap-2 items-center\">\n                          <Input\n                            value={participant.name}\n                            onChange={(e) => updateParticipant(index, 'name', e.target.value)}\n                            placeholder=\"Participant name\"\n                            data-testid={`input-participant-name-${index}`}\n                          />\n                          <Select\n                            value={participant.country}\n                            onValueChange={(value) => updateParticipant(index, 'country', value)}\n                          >\n                            <SelectTrigger data-testid={`select-participant-team-${index}`}>\n                              <SelectValue placeholder=\"Select team\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"NATO\">NATO</SelectItem>\n                              <SelectItem value=\"Russia\">Russia</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => removeParticipant(index)}\n                            disabled={sessionInfo.participants.length <= 2}\n                            data-testid={`button-remove-participant-${index}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      ))}\n                    </div>\n                    \n                    <div className=\"flex gap-2 mt-3\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={addParticipant}\n                        data-testid=\"button-add-participant\"\n                      >\n                        Add Participant\n                      </Button>\n                    </div>\n                  </div>\n                  \n                  {validationErrors.length > 0 && (\n                    <div className=\"bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-md p-3\">\n                      <div className=\"text-sm text-red-600 dark:text-red-400\">\n                        <div className=\"font-medium mb-1\">Please fix the following errors:</div>\n                        <ul className=\"list-disc list-inside space-y-1\">\n                          {validationErrors.map((error, index) => (\n                            <li key={index}>{error}</li>\n                          ))}\n                        </ul>\n                      </div>\n                    </div>\n                  )}\n                  \n                  <div className=\"flex justify-end gap-2 pt-4\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => {\n                        setShowSessionInfo(false);\n                        setValidationErrors([]);\n                      }}\n                      data-testid=\"button-cancel-participants\"\n                    >\n                      Cancel\n                    </Button>\n                    <Button\n                      onClick={handleSessionSave}\n                      data-testid=\"button-save-participants\"\n                    >\n                      Save\n                    </Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n\n            {/* Card Reference */}\n            <Popover open={showCardReference} onOpenChange={setShowCardReference}>\n              <PopoverTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-show-card-reference\">\n                  <HelpCircle className=\"w-4 h-4\" />\n                </Button>\n              </PopoverTrigger>\n              <PopoverContent \n                className=\"w-96 max-h-[70vh] overflow-y-auto\" \n                align=\"end\"\n                onInteractOutside={(e) => {\n                  // Prevent closing when interacting with the select dropdown\n                  const target = e.target as Element;\n                  if (target.closest('[data-radix-popper-content-wrapper]')) {\n                    e.preventDefault();\n                  }\n                }}\n              >\n                <div className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-semibold text-sm\">Card Reference by Dimension</h4>\n                    <Select value={selectedDimension || ''} onValueChange={(value) => setSelectedDimension(value as Domain)}>\n                      <SelectTrigger data-testid=\"select-dimension\">\n                        <SelectValue placeholder=\"Select a dimension\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"joint\">Joint</SelectItem>\n                        <SelectItem value=\"economy\">Economy</SelectItem>\n                        <SelectItem value=\"cognitive\">Cognitive</SelectItem>\n                        <SelectItem value=\"space\">Space</SelectItem>\n                        <SelectItem value=\"cyber\">Cyber</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  {selectedDimension && (\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <DomainBadge domain={selectedDimension} />\n                        <span className=\"text-sm font-medium\">Cards</span>\n                      </div>\n                      \n                      <div className=\"space-y-1 max-h-[50vh] overflow-y-auto\">\n                        {cardsData\n                          .filter((card: any) => card.domain === selectedDimension)\n                          .map((card: any) => (\n                            <div key={card.id} className=\"flex items-center gap-3 p-2 text-sm\">\n                              <span className=\"font-mono font-medium\">\n                                {card.id}\n                              </span>\n                              <span>-</span>\n                              <span className=\"text-muted-foreground\">\n                                {(card.effects || []).map((effect: any, effectIndex: number) => (\n                                  <span key={effectIndex}>\n                                    {effectIndex > 0 ? ', ' : ''}\n                                    {effect.target === 'self' ? 'Self' : 'Opponent'} {effect.domain}:{effect.delta > 0 ? '+' : ''}{effect.delta}\n                                  </span>\n                                ))}\n                              </span>\n                            </div>\n                          ))\n                        }\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </PopoverContent>\n            </Popover>\n\n            {/* Rules/Readme Dialog (triggered from Settings) */}\n            <Dialog open={showRules} onOpenChange={setShowRules}>\n              <DialogContent className=\"max-w-[95vw] w-full max-h-[90vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle className=\"text-2xl\">{sanitizeText('MDDS Rules & Guidelines')}</DialogTitle>\n                </DialogHeader>\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 text-sm\">\n                  {/* Left Column */}\n                  <div className=\"space-y-4\">\n                    {/* Overview */}\n                    <section className=\"space-y-2\">\n                      <h3 className=\"text-lg font-semibold text-primary\">Overview</h3>\n                      <p className=\"text-muted-foreground leading-relaxed text-xs\">\n                        Multi Dimension Deterrence Strategy (MDDS) is a strategic planning application where NATO and Russia teams compete across five domains: Joint, Economy, Cognitive, Space, and Cyber. Teams purchase cards to increase their deterrence while reducing opponent deterrence.\n                      </p>\n                    </section>\n\n                    {/* Game Setup */}\n                    <section className=\"space-y-2\">\n                      <h3 className=\"text-lg font-semibold text-primary\">{sanitizeText('Strategy Setup')}</h3>\n                      <div className=\"space-y-2\">\n                        <div className=\"p-2 rounded-lg bg-muted/30\">\n                          <p className=\"font-medium text-sm mb-1\">Teams</p>\n                          <p className=\"text-muted-foreground text-xs\">Two teams: NATO (blue) and Russia (red)</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg bg-muted/30\">\n                          <p className=\"font-medium text-sm mb-1\">Turn Types</p>\n                          <ul className=\"list-disc list-inside text-muted-foreground text-xs space-y-0.5\">\n                            <li><strong>Base Turn (Turn 1):</strong> 200K budget per domain (1000K total)</li>\n                            <li><strong>Pooled Turns (Turn 2+):</strong> 1000K total budget, flexible allocation</li>\n                          </ul>\n                        </div>\n                      </div>\n                    </section>\n\n                    {/* Five Domains */}\n                    <section className=\"space-y-2\">\n                      <h3 className=\"text-lg font-semibold text-primary\">Five Domains</h3>\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        <div className=\"p-2 rounded-lg border\">\n                          <DomainBadge domain=\"joint\" className=\"mb-1\" />\n                          <p className=\"text-muted-foreground text-xs\">Military coordination</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg border\">\n                          <DomainBadge domain=\"economy\" className=\"mb-1\" />\n                          <p className=\"text-muted-foreground text-xs\">Economic power</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg border\">\n                          <DomainBadge domain=\"cognitive\" className=\"mb-1\" />\n                          <p className=\"text-muted-foreground text-xs\">Information warfare</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg border\">\n                          <DomainBadge domain=\"space\" className=\"mb-1\" />\n                          <p className=\"text-muted-foreground text-xs\">Space capabilities</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg border\">\n                          <DomainBadge domain=\"cyber\" className=\"mb-1\" />\n                          <p className=\"text-muted-foreground text-xs\">Digital warfare</p>\n                        </div>\n                      </div>\n                    </section>\n\n                    {/* Card Types */}\n                    <section className=\"space-y-2\">\n                      <h3 className=\"text-lg font-semibold text-primary\">Card Types</h3>\n                      <div className=\"space-y-2\">\n                        <div className=\"p-2 rounded-lg bg-blue-500/10 border border-blue-500/20\">\n                          <p className=\"font-medium text-blue-600 dark:text-blue-400 text-sm mb-0.5\">Asset Cards</p>\n                          <p className=\"text-muted-foreground text-xs\">One-time use cards with immediate effects</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg bg-purple-500/10 border border-purple-500/20\">\n                          <p className=\"font-medium text-purple-600 dark:text-purple-400 text-sm mb-0.5\">Permanent Cards</p>\n                          <ul className=\"text-muted-foreground text-xs space-y-0.5\">\n                            <li> Passive effects applied every turn</li>\n                            <li> Reduce card costs by 50K permanently</li>\n                          </ul>\n                        </div>\n                        <div className=\"p-2 rounded-lg bg-amber-500/10 border border-amber-500/20\">\n                          <p className=\"font-medium text-amber-600 dark:text-amber-400 text-sm mb-0.5\">Expert Cards</p>\n                          <ul className=\"text-muted-foreground text-xs space-y-0.5\">\n                            <li> One-time powerful effects</li>\n                            <li> Cannot purchase again once used</li>\n                          </ul>\n                        </div>\n                      </div>\n                    </section>\n                  </div>\n\n                  {/* Right Column */}\n                  <div className=\"space-y-4\">\n\n                    {/* Budget Rules */}\n                    <section className=\"space-y-2\">\n                      <h3 className=\"text-lg font-semibold text-primary\">Budget Rules</h3>\n                      <div className=\"space-y-1.5\">\n                        <div className=\"p-2 rounded-lg border border-orange-500/30 bg-orange-500/5\">\n                          <p className=\"font-medium text-orange-600 dark:text-orange-400 text-sm mb-0.5\">Turn 1 Restrictions</p>\n                          <p className=\"text-muted-foreground text-xs\">200K per domain (no flexibility)</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg border border-green-500/30 bg-green-500/5\">\n                          <p className=\"font-medium text-green-600 dark:text-green-400 text-sm mb-0.5\">Turn 2+ Flexibility</p>\n                          <p className=\"text-muted-foreground text-xs\">1000K total, allocate freely</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg border border-blue-500/30 bg-blue-500/5\">\n                          <p className=\"font-medium text-blue-600 dark:text-blue-400 text-sm mb-0.5\">Permanent Discounts</p>\n                          <p className=\"text-muted-foreground text-xs\">Each reduces costs by 50K</p>\n                        </div>\n                      </div>\n                    </section>\n\n                    {/* Strategy Tips */}\n                    <section className=\"space-y-2\">\n                      <h3 className=\"text-lg font-semibold text-primary\">Strategic Tips</h3>\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        <div className=\"p-2 rounded-lg bg-muted/20 border\">\n                          <p className=\"font-medium text-sm mb-0.5\">Balance Domains</p>\n                          <p className=\"text-xs text-muted-foreground\">Diversify strategy</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg bg-muted/20 border\">\n                          <p className=\"font-medium text-sm mb-0.5\">Permanents Early</p>\n                          <p className=\"text-xs text-muted-foreground\">Long-term value</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg bg-muted/20 border\">\n                          <p className=\"font-medium text-sm mb-0.5\">Expert Timing</p>\n                          <p className=\"text-xs text-muted-foreground\">Critical moments</p>\n                        </div>\n                        <div className=\"p-2 rounded-lg bg-muted/20 border\">\n                          <p className=\"font-medium text-sm mb-0.5\">Counter Strategy</p>\n                          <p className=\"text-xs text-muted-foreground\">Target opponent</p>\n                        </div>\n                      </div>\n                    </section>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n\n            {/* Card Logs Modal */}\n            <Dialog open={showSettings} onOpenChange={setShowSettings}>\n              <DialogTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-show-card-logs\">\n                  <Settings className=\"w-4 h-4\" />\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-4xl max-h-[80vh]\">\n                <DialogHeader>\n                  <DialogTitle>{sanitizeText('Settings')}</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  {/* Guidelines/Tutorial */}\n                  <Button\n                    variant=\"ghost\"\n                    className=\"w-full justify-start p-3 gap-2\"\n                    onClick={() => {\n                      setShowSettings(false);\n                      setShowRules(true);\n                    }}\n                    data-testid=\"button-show-guidelines\"\n                  >\n                    <BookOpen className=\"w-4 h-4\" />\n                    <span className=\"font-medium\">{sanitizeText('Rules & Guidelines')}</span>\n                  </Button>\n\n                  {/* Save */}\n                  <Button\n                    variant=\"ghost\"\n                    className=\"w-full justify-start p-3 gap-2\"\n                    onClick={onSave}\n                    data-testid=\"button-save\"\n                  >\n                    <Save className=\"w-4 h-4\" />\n                    <span className=\"font-medium\">{sanitizeText('Save Simulation')}</span>\n                  </Button>\n\n                  {/* Download PDF */}\n                  <Button\n                    variant=\"ghost\"\n                    className=\"w-full justify-start p-3 gap-2\"\n                    onClick={onDownloadPDF}\n                    data-testid=\"button-download-pdf\"\n                  >\n                    <Download className=\"w-4 h-4\" />\n                    <span className=\"font-medium\">{sanitizeText('Generate Simulation Report')}</span>\n                  </Button>\n\n                  {/* Card Purchase Logs */}\n                  <Collapsible\n                    open={isStrategyLogExpanded}\n                    onOpenChange={setIsStrategyLogExpanded}\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <CollapsibleTrigger asChild>\n                        <Button\n                          variant=\"ghost\"\n                          className=\"flex-1 justify-between p-3 gap-2\"\n                          data-testid=\"button-toggle-strategy-log\"\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <CreditCard className=\"w-4 h-4\" />\n                            <span className=\"font-medium\">{sanitizeText('Card Purchase Logs')}</span>\n                          </div>\n                          <ChevronDown\n                            className={`h-4 w-4 transition-transform ${\n                              isStrategyLogExpanded ? 'rotate-180' : ''\n                            }`}\n                          />\n                        </Button>\n                      </CollapsibleTrigger>\n                      <Button \n                        variant=\"ghost\"\n                        size=\"sm\" \n                        onClick={handleDownloadCardLogs}\n                        data-testid=\"button-download-card-logs\"\n                      >\n                        <Download className=\"w-4 h-4 mr-2\" />\n                        Download\n                      </Button>\n                    </div>\n                    <CollapsibleContent className=\"pt-2\">\n                      <StrategyLog entries={strategyLog} maxHeight=\"60vh\" />\n                    </CollapsibleContent>\n                  </Collapsible>\n\n                  {/* Permanent Cards - Password Protected */}\n                  {!isPermanentCardsUnlocked ? (\n                    <div className=\"p-3 rounded-lg border bg-muted/30 space-y-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <Lock className=\"w-4 h-4 text-muted-foreground\" />\n                        <span className=\"font-medium text-muted-foreground\">Permanent Cards (Locked)</span>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Input\n                          id=\"permanent-cards-password\"\n                          type=\"password\"\n                          value={permanentCardsPassword}\n                          onChange={(e) => {\n                            setPermanentCardsPassword(e.target.value);\n                            setPermanentCardsPasswordError(false);\n                          }}\n                          onKeyPress={(e) => {\n                            if (e.key === 'Enter') {\n                              handleUnlockPermanentCards();\n                            }\n                          }}\n                          placeholder=\"Enter password\"\n                          className={permanentCardsPasswordError ? \"border-red-500\" : \"\"}\n                          data-testid=\"input-permanent-cards-password\"\n                        />\n                        <Button\n                          onClick={handleUnlockPermanentCards}\n                          size=\"sm\"\n                          data-testid=\"button-unlock-permanent-cards\"\n                        >\n                          <Unlock className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                      {permanentCardsPasswordError && (\n                        <p className=\"text-xs text-red-500\">Incorrect password</p>\n                      )}\n                    </div>\n                  ) : (\n                    <Collapsible>\n                      <CollapsibleTrigger asChild>\n                        <Button\n                          variant=\"ghost\"\n                          className=\"w-full justify-start p-3 gap-2\"\n                          data-testid=\"button-toggle-permanent-cards\"\n                        >\n                          <HelpCircle className=\"w-4 h-4\" />\n                          <span className=\"font-medium\">Permanent Cards</span>\n                          <ChevronDown className=\"h-4 w-4 ml-auto transition-transform\" />\n                        </Button>\n                      </CollapsibleTrigger>\n                      <CollapsibleContent className=\"px-3 pb-2\">\n                        <div className=\"space-y-3\">\n                          <Select value={selectedDimension || ''} onValueChange={(value) => setSelectedDimension(value as Domain)}>\n                            <SelectTrigger data-testid=\"select-dimension-settings\">\n                              <SelectValue placeholder=\"Select a dimension\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"joint\">Joint</SelectItem>\n                              <SelectItem value=\"economy\">Economy</SelectItem>\n                              <SelectItem value=\"cognitive\">Cognitive</SelectItem>\n                              <SelectItem value=\"space\">Space</SelectItem>\n                              <SelectItem value=\"cyber\">Cyber</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          \n                          {selectedDimension && (\n                            <div className=\"space-y-2\">\n                              <div className=\"flex items-center gap-2\">\n                                <DomainBadge domain={selectedDimension} />\n                                <span className=\"text-sm font-semibold text-purple-600 dark:text-purple-400\">Permanent Cards</span>\n                              </div>\n                              \n                              {/* Permanent Cards Only */}\n                              {cardsData.filter((card: any) => card.domain === selectedDimension && card.type === 'permanent').length > 0 ? (\n                                <div className=\"space-y-1\">\n                                  {cardsData\n                                    .filter((card: any) => card.domain === selectedDimension && card.type === 'permanent')\n                                    .map((card: any) => (\n                                      <div key={card.id} className=\"p-2 text-sm rounded bg-purple-500/10 border border-purple-500/20\">\n                                        <div className=\"font-mono font-medium text-purple-600 dark:text-purple-400 mb-1\">\n                                          {card.id}\n                                        </div>\n                                        <div className=\"text-muted-foreground text-xs\">\n                                          {card.permanentMods && (\n                                            <>\n                                              <div>Discount: -{card.permanentMods.flatDiscountK}K</div>\n                                              <div className=\"mt-1\">\n                                                Applies to: {card.permanentMods.appliesToCardIds.join(', ')}\n                                              </div>\n                                            </>\n                                          )}\n                                        </div>\n                                      </div>\n                                    ))\n                                  }\n                                </div>\n                              ) : (\n                                <div className=\"text-sm text-muted-foreground p-2\">\n                                  No permanent cards for this dimension\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      </CollapsibleContent>\n                    </Collapsible>\n                  )}\n\n                  {/* Database Section - Password Protected */}\n                  {!isDatabaseUnlocked ? (\n                    <div className=\"p-3 rounded-lg border bg-muted/30 space-y-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <Lock className=\"w-4 h-4 text-muted-foreground\" />\n                        <span className=\"font-medium text-muted-foreground\">Database (Locked)</span>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Input\n                          id=\"database-password\"\n                          type=\"password\"\n                          value={databasePassword}\n                          onChange={(e) => {\n                            setDatabasePassword(e.target.value);\n                            setPasswordError(false);\n                          }}\n                          onKeyPress={(e) => {\n                            if (e.key === 'Enter') {\n                              handleUnlockDatabase();\n                            }\n                          }}\n                          placeholder=\"Enter password\"\n                          className={passwordError ? \"border-red-500\" : \"\"}\n                          data-testid=\"input-database-password\"\n                        />\n                        <Button\n                          onClick={handleUnlockDatabase}\n                          size=\"sm\"\n                          data-testid=\"button-unlock-database\"\n                        >\n                          <Unlock className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                      {passwordError && (\n                        <p className=\"text-xs text-red-500\">Incorrect password</p>\n                      )}\n                    </div>\n                  ) : (\n                    <Button\n                      variant=\"ghost\"\n                      className=\"w-full justify-start p-3 gap-2\"\n                      onClick={handleDatabaseNavigation}\n                      data-testid=\"button-navigate-database\"\n                    >\n                      <Database className=\"w-4 h-4\" />\n                      <span className=\"font-medium\">Database</span>\n                    </Button>\n                  )}\n                </div>\n              </DialogContent>\n            </Dialog>\n\n            {/* Reset Progress */}\n            <Button \n              variant=\"outline\" \n              onClick={onResetProgress}\n              data-testid=\"button-reset-progress\"\n            >\n              <RotateCcw className=\"w-4 h-4 mr-2\" />\n              {sanitizeText('Reset Progress')}\n            </Button>\n\n            {/* Finish Session */}\n            <Button \n              variant=\"destructive\" \n              onClick={onFinishGameSession}\n              data-testid=\"button-finish-game-session\"\n            >\n              <FileCheck className=\"w-4 h-4 mr-2\" />\n              {sanitizeText('Finish Session')}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}","size_bytes":41990},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/examples/DomainBadge.tsx":{"content":"import DomainBadge from '../DomainBadge';\n\nexport default function DomainBadgeExample() {\n  return (\n    <div className=\"flex gap-2 flex-wrap\">\n      <DomainBadge domain=\"joint\" />\n      <DomainBadge domain=\"economy\" />\n      <DomainBadge domain=\"cognitive\" />\n      <DomainBadge domain=\"space\" />\n      <DomainBadge domain=\"cyber\" />\n    </div>\n  );\n}","size_bytes":352},"client/src/components/DeterrenceChart.tsx":{"content":"import { TeamState } from '@shared/schema';\n\ninterface DeterrenceChartProps {\n  natoTeam: TeamState;\n  russiaTeam: TeamState;\n}\n\nexport default function DeterrenceChart({ natoTeam, russiaTeam }: DeterrenceChartProps) {\n  const domains = [\n    { key: 'joint' as const, label: 'Joint', color: 'bg-gray-500' },\n    { key: 'economy' as const, label: 'Economy', color: 'bg-green-500' },\n    { key: 'cognitive' as const, label: 'Cognitive', color: 'bg-purple-500' },\n    { key: 'space' as const, label: 'Space', color: 'bg-blue-500' },\n    { key: 'cyber' as const, label: 'Cyber', color: 'bg-yellow-500' }\n  ];\n\n  const maxDeterrence = Math.max(natoTeam.totalDeterrence, russiaTeam.totalDeterrence, 500);\n\n  return (\n    <div className=\"glass-card p-4 lg:p-6\" data-testid=\"deterrence-chart\">\n      <div className=\"mb-6\">\n        <h2 className=\"text-xl font-bold text-center mb-2\">Total Deterrence Score</h2>\n        <div className=\"flex justify-center gap-8 mb-4\">\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-blue-400\" data-testid=\"nato-total-deterrence\">\n              {natoTeam.totalDeterrence}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">NATO</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-red-400\" data-testid=\"russia-total-deterrence\">\n              {russiaTeam.totalDeterrence}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Russia</div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n        {domains.map((domain) => {\n          const natoValue = natoTeam.deterrence[domain.key];\n          const russiaValue = russiaTeam.deterrence[domain.key];\n          \n          return (\n            <div \n              key={domain.key} \n              className=\"glass-panel p-4 text-center border border-border/50 hover-elevate transition-all duration-300\" \n              data-testid={`domain-${domain.key}`}\n            >\n              <div className=\"mb-4\">\n                <div className={`inline-block w-3 h-3 rounded-full ${domain.color} mb-2`}></div>\n                <h3 className=\"font-semibold text-sm capitalize\">{domain.label}</h3>\n              </div>\n              \n              {/* NATO Bar */}\n              <div className=\"mb-3\">\n                <div className=\"flex justify-between text-xs mb-1\">\n                  <span className=\"text-blue-400 font-medium\">NATO</span>\n                  <span className=\"font-mono font-semibold\" data-testid={`nato-${domain.key}-value`}>{natoValue}</span>\n                </div>\n                <div className=\"h-3 bg-secondary/20 rounded-full overflow-hidden border border-secondary/30\">\n                  <div \n                    className=\"h-full bg-gradient-to-r from-blue-600 to-blue-400 transition-all duration-700 ease-out\"\n                    style={{ width: `${(natoValue / 200) * 100}%` }}\n                  />\n                </div>\n              </div>\n\n              {/* Russia Bar */}\n              <div>\n                <div className=\"flex justify-between text-xs mb-1\">\n                  <span className=\"text-red-400 font-medium\">Russia</span>\n                  <span className=\"font-mono font-semibold\" data-testid={`russia-${domain.key}-value`}>{russiaValue}</span>\n                </div>\n                <div className=\"h-3 bg-secondary/20 rounded-full overflow-hidden border border-secondary/30\">\n                  <div \n                    className=\"h-full bg-gradient-to-r from-red-600 to-red-400 transition-all duration-700 ease-out\"\n                    style={{ width: `${(russiaValue / 200) * 100}%` }}\n                  />\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}","size_bytes":3854},"client/src/components/examples/CardDisplay.tsx":{"content":"import CardDisplay from '../CardDisplay';\nimport { Card } from '@shared/schema';\n\nexport default function CardDisplayExample() {\n  const sampleCard: Card = {\n    id: \"J1\",\n    name: \"Strategic Command Center\", \n    domain: \"joint\",\n    type: \"asset\",\n    baseCostK: 150,\n    effects: [\n      { target: \"self\", domain: \"joint\", delta: 15 },\n      { target: \"opponent\", domain: \"joint\", delta: -5 }\n    ]\n  };\n\n  const discountedCard: Card = {\n    id: \"E1\",\n    name: \"Economic Sanctions Package\",\n    domain: \"economy\", \n    type: \"permanent\",\n    baseCostK: 120,\n    permanentMods: {\n      flatDiscountK: 50,\n      appliesToCardIds: [\"E5\", \"E7\"]\n    }\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl\">\n      <CardDisplay \n        card={sampleCard}\n        onAddToCart={() => console.log('Added to cart:', sampleCard.id)}\n        onViewDetails={() => console.log('View details:', sampleCard.id)}\n      />\n      <CardDisplay \n        card={discountedCard}\n        discountedPrice={70}\n        onAddToCart={() => console.log('Added to cart:', discountedCard.id)}\n        onViewDetails={() => console.log('View details:', discountedCard.id)}\n        inCart={true}\n      />\n    </div>\n  );\n}","size_bytes":1223},"client/src/pages/MobileLogin.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Database, ArrowRight } from 'lucide-react';\nimport logoUrl from '@assets/Logo_1758524556759.png';\n\nexport default function MobileLogin() {\n  const [sessionName, setSessionName] = useState('');\n  const [, setLocation] = useLocation();\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (sessionName.trim()) {\n      setLocation(`/mobile/${encodeURIComponent(sessionName.trim())}`);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      {/* Header */}\n      <header className=\"border-b p-4\">\n        <div className=\"flex items-center justify-center gap-3\">\n          <img src={logoUrl} alt=\"MDDS Logo\" className=\"w-8 h-8\" />\n          <div className=\"text-center\">\n            <h1 className=\"text-lg font-bold\">MDDS Mobile</h1>\n            <p className=\"text-xs text-muted-foreground\">Strategic Session Viewer</p>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"flex-1 flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-sm\">\n          <CardHeader className=\"text-center space-y-4\">\n            <div className=\"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center\">\n              <Database className=\"w-6 h-6 text-primary\" />\n            </div>\n            <CardTitle className=\"text-xl\">Access Session</CardTitle>\n            <p className=\"text-sm text-muted-foreground\">\n              Enter the session name to view strategic statistics and data\n            </p>\n          </CardHeader>\n          \n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"session-name\">Session Name</Label>\n                <Input\n                  id=\"session-name\"\n                  type=\"text\"\n                  value={sessionName}\n                  onChange={(e) => setSessionName(e.target.value)}\n                  placeholder=\"Enter session name\"\n                  data-testid=\"input-mobile-session-name\"\n                  autoFocus\n                />\n              </div>\n              \n              <Button \n                type=\"submit\" \n                className=\"w-full\" \n                disabled={!sessionName.trim()}\n                data-testid=\"button-access-session\"\n              >\n                Access Session\n                <ArrowRight className=\"w-4 h-4 ml-2\" />\n              </Button>\n            </form>\n            \n            <div className=\"mt-6 text-center\">\n              <Badge variant=\"outline\" className=\"text-xs\">\n                Mobile Access Portal\n              </Badge>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Footer */}\n      <footer className=\"border-t p-4 text-center\">\n        <p className=\"text-xs text-muted-foreground\">\n          Multi Dimension Deterrence Strategy\n        </p>\n      </footer>\n    </div>\n  );\n}","size_bytes":3310},"client/src/components/DomainStatistics.tsx":{"content":"import { useState } from 'react';\nimport { ChevronDown, ChevronUp, LineChart, BarChart3, TrendingUp, Minus, MoreHorizontal, ZoomIn, Shield, Sword } from 'lucide-react';\nimport { Dialog, DialogContent, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { useMDDSStore } from '@/state/store';\nimport { LineChart as RechartsLineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\nimport { Domain } from '@shared/schema';\nimport DefenseOffenseChart from './DefenseOffenseChart';\n\nconst domainColors = {\n  joint: { color: '#9CA3AF', bgClass: 'bg-gray-500/20', textClass: 'text-gray-500' },\n  economy: { color: '#10B981', bgClass: 'bg-green-500/20', textClass: 'text-green-500' },\n  cognitive: { color: '#8B5CF6', bgClass: 'bg-purple-500/20', textClass: 'text-purple-500' },\n  space: { color: '#3B82F6', bgClass: 'bg-blue-500/20', textClass: 'text-blue-500' },\n  cyber: { color: '#F59E0B', bgClass: 'bg-yellow-500/20', textClass: 'text-yellow-500' }\n} as const;\n\nexport default function DomainStatistics() {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [activeSection, setActiveSection] = useState<'overall' | 'dimension' | 'defense' | null>(null);\n  const [selectedDomain, setSelectedDomain] = useState<Domain | null>(null);\n  \n  // Interactive controls for Overall Statistics\n  const [showRussia, setShowRussia] = useState(true);\n  const [visibleDomains, setVisibleDomains] = useState<Record<Domain, boolean>>({\n    joint: true,\n    economy: true,\n    cognitive: true,\n    space: true,\n    cyber: true\n  });\n  \n  const turnStatistics = useMDDSStore(state => state.turnStatistics);\n\n  const toggleExpanded = () => setIsExpanded(!isExpanded);\n  \n  const toggleDomainVisibility = (domain: Domain) => {\n    setVisibleDomains(prev => ({\n      ...prev,\n      [domain]: !prev[domain]\n    }));\n  };\n\n  // Only show if we have 2+ turns of data\n  if (turnStatistics.length < 2) {\n    return null;\n  }\n\n  // Prepare overall chart data showing all domains for each turn\n  const overallChartData = turnStatistics.map(stat => {\n    const data: Record<string, number> = { turn: stat.turn };\n    // Add NATO and Russia values for all domains\n    Object.keys(stat.natoDeterrence).forEach(domain => {\n      data[`nato_${domain}`] = stat.natoDeterrence[domain as keyof typeof stat.natoDeterrence];\n      data[`russia_${domain}`] = stat.russiaDeterrence[domain as keyof typeof stat.russiaDeterrence];\n    });\n    return data;\n  });\n\n  // Get domain-specific data for selected domain with 100 baseline reference\n  const getDomainSpecificData = (domain: Domain) => {\n    return turnStatistics.map(stat => ({\n      turn: stat.turn,\n      natoValue: stat.natoDeterrence[domain] - 100,\n      russiaValue: stat.russiaDeterrence[domain] - 100,\n      difference: (stat.natoDeterrence[domain] - 100) - (stat.russiaDeterrence[domain] - 100)\n    }));\n  };\n\n  return (\n    <div className=\"glass-card border border-border/50\">\n      {/* Header */}\n      <button\n        onClick={toggleExpanded}\n        className=\"w-full flex items-center justify-between p-4 hover-elevate transition-all duration-300 text-left\"\n        data-testid=\"button-toggle-domain-statistics\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <LineChart className=\"w-5 h-5 text-primary\" />\n          <h2 className=\"text-lg font-semibold\">Statistics</h2>\n        </div>\n        {isExpanded ? (\n          <ChevronUp className=\"w-5 h-5 text-muted-foreground\" />\n        ) : (\n          <ChevronDown className=\"w-5 h-5 text-muted-foreground\" />\n        )}\n      </button>\n\n      {/* Content */}\n      {isExpanded && (\n        <div className=\"border-t border-border/50 p-4 space-y-4\" data-testid=\"domain-statistics-content\">\n          \n          {/* Three Square Buttons */}\n          <div className=\"grid grid-cols-3 gap-2 mb-6\">\n            <button\n              onClick={() => setActiveSection(activeSection === 'overall' ? null : 'overall')}\n              className={`p-4 text-center font-semibold transition-all duration-300 hover-elevate ${\n                activeSection === 'overall' \n                  ? 'bg-blue-500/20 text-blue-400 border-2 border-blue-500/50' \n                  : 'glass-panel border border-border/50 text-muted-foreground hover:text-foreground'\n              }`}\n              style={{ borderRadius: '3px' }}\n              data-testid=\"button-overall-statistics\"\n            >\n              <BarChart3 className=\"w-5 h-5 mx-auto mb-2\" />\n              <div className=\"text-sm\">Overall Statistics</div>\n            </button>\n            \n            <button\n              onClick={() => setActiveSection(activeSection === 'dimension' ? null : 'dimension')}\n              className={`p-4 text-center font-semibold transition-all duration-300 hover-elevate ${\n                activeSection === 'dimension' \n                  ? 'bg-green-500/20 text-green-400 border-2 border-green-500/50' \n                  : 'glass-panel border border-border/50 text-muted-foreground hover:text-foreground'\n              }`}\n              style={{ borderRadius: '3px' }}\n              data-testid=\"button-dimension-statistics\"\n            >\n              <TrendingUp className=\"w-5 h-5 mx-auto mb-2\" />\n              <div className=\"text-sm\">Dimension Based Statistics</div>\n            </button>\n            \n            <button\n              onClick={() => setActiveSection(activeSection === 'defense' ? null : 'defense')}\n              className={`p-4 text-center font-semibold transition-all duration-300 hover-elevate ${\n                activeSection === 'defense' \n                  ? 'bg-purple-500/20 text-purple-400 border-2 border-purple-500/50' \n                  : 'glass-panel border border-border/50 text-muted-foreground hover:text-foreground'\n              }`}\n              style={{ borderRadius: '3px' }}\n              data-testid=\"button-defense-offense-statistics\"\n            >\n              <div className=\"flex items-center justify-center gap-1 mb-2\">\n                <Shield className=\"w-4 h-4\" />\n                <Sword className=\"w-4 h-4\" />\n              </div>\n              <div className=\"text-sm\">Defensive/Offensive Statistics Chart</div>\n            </button>\n          </div>\n          \n          {/* Overall Statistics Content */}\n          {activeSection === 'overall' && (\n            <div className=\"space-y-6\" data-testid=\"overall-stats-content\">\n              {/* Overall Deterrence Chart */}\n              <div className=\"glass-panel p-4\">\n                <h3 className=\"text-sm font-semibold mb-4\">Turn-Based Overall Deterrence Scores</h3>\n                <ResponsiveContainer width=\"100%\" height={350}>\n                  <RechartsLineChart data={turnStatistics.map(stat => {\n                    const natoTotal = Object.values(stat.natoDeterrence).reduce((sum, val) => sum + val, 0);\n                    const russiaTotal = Object.values(stat.russiaDeterrence).reduce((sum, val) => sum + val, 0);\n                    return {\n                      turn: stat.turn,\n                      NATO: natoTotal,\n                      Russia: russiaTotal\n                    };\n                  })}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" />\n                    <XAxis \n                      dataKey=\"turn\" \n                      stroke=\"hsl(var(--muted-foreground))\"\n                      tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                      label={{ value: 'Turn', position: 'insideBottom', offset: -5, fill: 'hsl(var(--muted-foreground))' }}\n                    />\n                    <YAxis \n                      stroke=\"hsl(var(--muted-foreground))\"\n                      tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                      label={{ value: 'Total Deterrence', angle: -90, position: 'insideLeft', fill: 'hsl(var(--muted-foreground))' }}\n                    />\n                    <Tooltip \n                      contentStyle={{\n                        backgroundColor: 'hsl(var(--card))',\n                        border: '1px solid hsl(var(--border))',\n                        borderRadius: '8px'\n                      }}\n                    />\n                    <Legend />\n                    <Line \n                      type=\"monotone\" \n                      dataKey=\"NATO\" \n                      stroke=\"#3B82F6\" \n                      strokeWidth={3}\n                      dot={{ fill: '#3B82F6', r: 4 }}\n                      activeDot={{ r: 6 }}\n                    />\n                    <Line \n                      type=\"monotone\" \n                      dataKey=\"Russia\" \n                      stroke=\"#EF4444\" \n                      strokeWidth={3}\n                      dot={{ fill: '#EF4444', r: 4 }}\n                      activeDot={{ r: 6 }}\n                    />\n                  </RechartsLineChart>\n                </ResponsiveContainer>\n              </div>\n\n              {/* Domain Selector */}\n              <div className=\"space-y-3\">\n                <h3 className=\"text-sm font-semibold\">Select Dimension for Detailed Analysis</h3>\n                <div className=\"grid grid-cols-2 md:grid-cols-5 gap-2\">\n                  {Object.entries(domainColors).map(([domain, config]) => (\n                    <button\n                      key={domain}\n                      onClick={() => setSelectedDomain(selectedDomain === domain ? null : domain as Domain)}\n                      className={`p-3 rounded-md border transition-all duration-200 text-sm font-medium hover-elevate ${\n                        selectedDomain === domain \n                          ? `${config.bgClass} border-current ${config.textClass}` \n                          : 'border-border/50 hover:border-border text-muted-foreground'\n                      }`}\n                      data-testid={`button-select-domain-${domain}`}\n                    >\n                      <div className=\"capitalize\">{domain}</div>\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Domain Table when selected */}\n              {selectedDomain && (\n                <div className=\"glass-panel p-4\">\n                  <h4 className=\"text-sm font-semibold mb-3 capitalize\">{selectedDomain} Domain Analysis</h4>\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-sm\">\n                      <thead>\n                        <tr className=\"border-b border-border/50\">\n                          <th className=\"text-left py-2 px-3 font-medium\">Turn</th>\n                          <th className=\"text-center py-2 px-3 font-medium text-blue-400\">NATO Value</th>\n                          <th className=\"text-center py-2 px-3 font-medium text-red-400\">Russia Value</th>\n                          <th className=\"text-center py-2 px-3 font-medium\">Difference</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {getDomainSpecificData(selectedDomain).map((data, index) => (\n                          <tr key={index} className=\"border-b border-border/20\">\n                            <td className=\"py-2 px-3 font-medium\">Turn {data.turn}</td>\n                            <td className=\"text-center py-2 px-3 text-blue-400 font-semibold\">\n                              {data.natoValue}\n                            </td>\n                            <td className=\"text-center py-2 px-3 text-red-400 font-semibold\">\n                              {data.russiaValue}\n                            </td>\n                            <td className={`text-center py-2 px-3 font-semibold ${\n                              data.difference > 0 ? 'text-blue-400' : \n                              data.difference < 0 ? 'text-red-400' : \n                              'text-muted-foreground'\n                            }`}>\n                              {data.difference > 0 ? `+${data.difference}` : data.difference}\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Dimension-based Statistics Content */}\n          {activeSection === 'dimension' && (\n            <div className=\"space-y-4\" data-testid=\"domain-based-stats-content\">\n              {/* Interactive Controls */}\n              <div className=\"glass-panel p-4 space-y-4\">\n                <h4 className=\"text-sm font-semibold\">Chart Controls</h4>\n                \n                {/* Team Toggle */}\n                <div className=\"space-y-2\">\n                  <h5 className=\"text-xs font-medium text-muted-foreground\">Teams</h5>\n                  <div className=\"flex gap-2\">\n                    <button\n                      className={`px-3 py-2 rounded-md text-xs font-medium transition-all hover-elevate ${\n                        true ? 'bg-blue-500/20 text-blue-400 border border-blue-500/50' : 'border border-border/50 text-muted-foreground'\n                      }`}\n                      data-testid=\"toggle-nato\"\n                    >\n                      NATO\n                    </button>\n                    <button\n                      onClick={() => setShowRussia(!showRussia)}\n                      className={`px-3 py-2 rounded-md text-xs font-medium transition-all hover-elevate ${\n                        showRussia ? 'bg-red-500/20 text-red-400 border border-red-500/50' : 'border border-border/50 text-muted-foreground'\n                      }`}\n                      data-testid=\"toggle-russia\"\n                    >\n                      Russia\n                    </button>\n                  </div>\n                </div>\n                \n                {/* Domain Toggles */}\n                <div className=\"space-y-2\">\n                  <h5 className=\"text-xs font-medium text-muted-foreground\">Dimensions</h5>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {Object.entries(domainColors).map(([domain, config]) => (\n                      <button\n                        key={domain}\n                        onClick={() => toggleDomainVisibility(domain as Domain)}\n                        className={`px-3 py-2 rounded-md text-xs font-medium transition-all hover-elevate capitalize ${\n                          visibleDomains[domain as Domain] \n                            ? `${config.bgClass} ${config.textClass} border border-current` \n                            : 'border border-border/50 text-muted-foreground'\n                        }`}\n                        data-testid={`toggle-domain-${domain}`}\n                      >\n                        {domain}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n              {/* Combined Chart */}\n              <div className=\"glass-panel p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <h4 className=\"text-sm font-semibold\">Combined NATO vs Russia - All Domains Over Time</h4>\n                  <Dialog>\n                    <DialogTrigger asChild>\n                      <button\n                        className=\"flex items-center gap-2 px-3 py-1 text-xs font-medium rounded-md border border-border/50 hover-elevate transition-all\"\n                        data-testid=\"button-zoom-combined-chart\"\n                      >\n                        <ZoomIn className=\"w-3 h-3\" />\n                        Expand\n                      </button>\n                    </DialogTrigger>\n                    <DialogContent className=\"max-w-7xl w-[90vw] h-[65vh] p-4\">\n                      <DialogTitle className=\"text-center\">Combined NATO vs Russia - All Domains Over Time</DialogTitle>\n                      <div className=\"flex-1 mt-1\">\n                        <ResponsiveContainer width=\"100%\" height={450}>\n                          <RechartsLineChart data={overallChartData}>\n                            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" />\n                            <XAxis \n                              dataKey=\"turn\" \n                              stroke=\"hsl(var(--muted-foreground))\"\n                              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                            />\n                            <YAxis \n                              stroke=\"hsl(var(--muted-foreground))\"\n                              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                            />\n                            <Tooltip \n                              contentStyle={{\n                                backgroundColor: 'hsl(var(--card))',\n                                border: '1px solid hsl(var(--border))',\n                                borderRadius: '8px'\n                              }}\n                            />\n                            \n                            {/* NATO Lines */}\n                            {visibleDomains.joint && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"nato_joint\" \n                                stroke={domainColors.joint.color} \n                                name=\"NATO Joint\"\n                                strokeWidth={3}\n                              />\n                            )}\n                            {visibleDomains.economy && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"nato_economy\" \n                                stroke={domainColors.economy.color} \n                                name=\"NATO Economy\"\n                                strokeWidth={3}\n                              />\n                            )}\n                            {visibleDomains.cognitive && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"nato_cognitive\" \n                                stroke={domainColors.cognitive.color} \n                                name=\"NATO Cognitive\"\n                                strokeWidth={3}\n                              />\n                            )}\n                            {visibleDomains.space && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"nato_space\" \n                                stroke={domainColors.space.color} \n                                name=\"NATO Space\"\n                                strokeWidth={3}\n                              />\n                            )}\n                            {visibleDomains.cyber && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"nato_cyber\" \n                                stroke={domainColors.cyber.color} \n                                name=\"NATO Cyber\"\n                                strokeWidth={3}\n                              />\n                            )}\n\n                            {/* Russia Lines - Dashed */}\n                            {showRussia && visibleDomains.joint && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"russia_joint\" \n                                stroke={domainColors.joint.color} \n                                name=\"Russia Joint\"\n                                strokeWidth={3}\n                                strokeDasharray=\"5 5\"\n                              />\n                            )}\n                            {showRussia && visibleDomains.economy && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"russia_economy\" \n                                stroke={domainColors.economy.color} \n                                name=\"Russia Economy\"\n                                strokeWidth={3}\n                                strokeDasharray=\"5 5\"\n                              />\n                            )}\n                            {showRussia && visibleDomains.cognitive && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"russia_cognitive\" \n                                stroke={domainColors.cognitive.color} \n                                name=\"Russia Cognitive\"\n                                strokeWidth={3}\n                                strokeDasharray=\"5 5\"\n                              />\n                            )}\n                            {showRussia && visibleDomains.space && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"russia_space\" \n                                stroke={domainColors.space.color} \n                                name=\"Russia Space\"\n                                strokeWidth={3}\n                                strokeDasharray=\"5 5\"\n                              />\n                            )}\n                            {showRussia && visibleDomains.cyber && (\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"russia_cyber\" \n                                stroke={domainColors.cyber.color} \n                                name=\"Russia Cyber\"\n                                strokeWidth={3}\n                                strokeDasharray=\"5 5\"\n                              />\n                            )}\n                          </RechartsLineChart>\n                        </ResponsiveContainer>\n                      </div>\n                    </DialogContent>\n                  </Dialog>\n                </div>\n                <ResponsiveContainer width=\"100%\" height={400}>\n                  <RechartsLineChart data={overallChartData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" />\n                    <XAxis \n                      dataKey=\"turn\" \n                      stroke=\"hsl(var(--muted-foreground))\"\n                      tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                    />\n                    <YAxis \n                      stroke=\"hsl(var(--muted-foreground))\"\n                      tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                    />\n                    <Tooltip \n                      contentStyle={{\n                        backgroundColor: 'hsl(var(--card))',\n                        border: '1px solid hsl(var(--border))',\n                        borderRadius: '8px'\n                      }}\n                    />\n                    \n                    {/* NATO Lines - Always visible */}\n                    {visibleDomains.joint && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"nato_joint\" \n                        stroke={domainColors.joint.color} \n                        name=\"NATO Joint\"\n                        strokeWidth={2}\n                      />\n                    )}\n                    {visibleDomains.economy && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"nato_economy\" \n                        stroke={domainColors.economy.color} \n                        name=\"NATO Economy\"\n                        strokeWidth={2}\n                      />\n                    )}\n                    {visibleDomains.cognitive && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"nato_cognitive\" \n                        stroke={domainColors.cognitive.color} \n                        name=\"NATO Cognitive\"\n                        strokeWidth={2}\n                      />\n                    )}\n                    {visibleDomains.space && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"nato_space\" \n                        stroke={domainColors.space.color} \n                        name=\"NATO Space\"\n                        strokeWidth={2}\n                      />\n                    )}\n                    {visibleDomains.cyber && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"nato_cyber\" \n                        stroke={domainColors.cyber.color} \n                        name=\"NATO Cyber\"\n                        strokeWidth={2}\n                      />\n                    )}\n                    \n                    {/* Russia Lines - Togglable */}\n                    {showRussia && visibleDomains.joint && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"russia_joint\" \n                        stroke={domainColors.joint.color} \n                        name=\"Russia Joint\"\n                        strokeWidth={2}\n                        strokeDasharray=\"5 5\"\n                      />\n                    )}\n                    {showRussia && visibleDomains.economy && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"russia_economy\" \n                        stroke={domainColors.economy.color} \n                        name=\"Russia Economy\"\n                        strokeWidth={2}\n                        strokeDasharray=\"5 5\"\n                      />\n                    )}\n                    {showRussia && visibleDomains.cognitive && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"russia_cognitive\" \n                        stroke={domainColors.cognitive.color} \n                        name=\"Russia Cognitive\"\n                        strokeWidth={2}\n                        strokeDasharray=\"5 5\"\n                      />\n                    )}\n                    {showRussia && visibleDomains.space && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"russia_space\" \n                        stroke={domainColors.space.color} \n                        name=\"Russia Space\"\n                        strokeWidth={2}\n                        strokeDasharray=\"5 5\"\n                      />\n                    )}\n                    {showRussia && visibleDomains.cyber && (\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"russia_cyber\" \n                        stroke={domainColors.cyber.color} \n                        name=\"Russia Cyber\"\n                        strokeWidth={2}\n                        strokeDasharray=\"5 5\"\n                      />\n                    )}\n                  </RechartsLineChart>\n                </ResponsiveContainer>\n                \n                {/* Custom Team Legend */}\n                <div className=\"mt-4 flex justify-center gap-6\">\n                  <div className=\"flex items-center gap-2\">\n                    <Minus className=\"w-4 h-4 text-blue-400\" strokeWidth={3} />\n                    <span className=\"text-sm text-blue-400 font-medium\">NATO (Solid Lines)</span>\n                  </div>\n                  {showRussia && (\n                    <div className=\"flex items-center gap-2\">\n                      <MoreHorizontal className=\"w-4 h-4 text-red-400\" strokeWidth={3} />\n                      <span className=\"text-sm text-red-400 font-medium\">Russia (Dashed Lines)</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n\n\n          {/* Defensive/Offensive Statistics Chart Content */}\n          {activeSection === 'defense' && (\n            <div className=\"space-y-4\" data-testid=\"defense-offense-stats-content\">\n              <DefenseOffenseChart forceExpanded={true} hideToggle={true} />\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":28141},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* DARK FUTURISTIC MODE (DEFAULT) */\n:root {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 220 15% 8%;\n\n  --foreground: 0 0% 95%;\n\n  --border: 220 15% 18%;\n\n  --card: 220 15% 10%;\n\n  --card-foreground: 0 0% 95%;\n\n  --card-border: 220 15% 20%;\n\n  --sidebar: 220 15% 12%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 220 15% 22%;\n\n  --sidebar-primary: 220 85% 25%;\n\n  --sidebar-primary-foreground: 0 0% 98%;\n\n  --sidebar-accent: 220 15% 14%;\n\n  --sidebar-accent-foreground: 0 0% 90%;\n\n  --sidebar-ring: 220 85% 25%;\n\n  --popover: 220 15% 14%;\n\n  --popover-foreground: 0 0% 95%;\n\n  --popover-border: 220 15% 24%;\n\n  --primary: 220 85% 25%;\n\n  --primary-foreground: 0 0% 98%;\n\n  --secondary: 220 15% 16%;\n\n  --secondary-foreground: 0 0% 90%;\n\n  --muted: 220 15% 12%;\n\n  --muted-foreground: 0 0% 65%;\n\n  --accent: 220 20% 14%;\n\n  --accent-foreground: 0 0% 90%;\n\n  --destructive: 0 84% 25%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 220 15% 25%;\n  --ring: 220 85% 25%;\n  --chart-1: 240 75% 65%;\n  --chart-2: 120 60% 55%;\n  --chart-3: 280 65% 65%;\n  --chart-4: 200 70% 60%;\n  --chart-5: 15 85% 70%;\n\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: JetBrains Mono, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.05);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.10);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.10), 0px 1px 2px -1px hsl(0 0% 0% / 0.20);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.10), 0px 1px 2px -1px hsl(0 0% 0% / 0.20);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.10), 0px 2px 4px -1px hsl(0 0% 0% / 0.20);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.10), 0px 4px 6px -1px hsl(0 0% 0% / 0.20);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.10), 0px 8px 10px -1px hsl(0 0% 0% / 0.20);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.50);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.light {\n  --button-outline: rgba(0,0,0, .08);\n  --badge-outline: rgba(0,0,0, .04);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -12; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .02);\n  --elevate-2: rgba(0,0,0, .05);\n\n  --background: 220 20% 98%;\n\n  --foreground: 220 25% 15%;\n\n  --border: 220 15% 85%;\n\n  --card: 0 0% 100%;\n\n  --card-foreground: 220 25% 15%;\n\n  --card-border: 220 15% 92%;\n\n  --sidebar: 220 20% 96%;\n\n  --sidebar-foreground: 220 25% 15%;\n\n  --sidebar-border: 220 15% 90%;\n\n  --sidebar-primary: 220 85% 55%;\n\n  --sidebar-primary-foreground: 0 0% 98%;\n\n  --sidebar-accent: 220 15% 92%;\n\n  --sidebar-accent-foreground: 220 25% 20%;\n\n  --sidebar-ring: 220 85% 55%;\n\n  --popover: 0 0% 100%;\n\n  --popover-foreground: 220 25% 15%;\n\n  --popover-border: 220 15% 88%;\n\n  --primary: 220 85% 55%;\n\n  --primary-foreground: 0 0% 98%;\n\n  --secondary: 220 15% 95%;\n\n  --secondary-foreground: 220 25% 20%;\n\n  --muted: 220 15% 96%;\n\n  --muted-foreground: 220 15% 45%;\n\n  --accent: 220 15% 94%;\n\n  --accent-foreground: 220 25% 20%;\n\n  --destructive: 0 84% 50%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 220 15% 90%;\n  --ring: 220 85% 55%;\n  --chart-1: 240 75% 45%;\n  --chart-2: 120 60% 35%;\n  --chart-3: 280 65% 45%;\n  --chart-4: 200 70% 40%;\n  --chart-5: 15 85% 50%;\n\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 15% 0% / 0.02);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 15% 0% / 0.04);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 15% 0% / 0.04), 0px 1px 2px -1px hsl(220 15% 0% / 0.08);\n  --shadow: 0px 2px 0px 0px hsl(220 15% 0% / 0.04), 0px 1px 2px -1px hsl(220 15% 0% / 0.08);\n  --shadow-md: 0px 2px 0px 0px hsl(220 15% 0% / 0.04), 0px 2px 4px -1px hsl(220 15% 0% / 0.08);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 15% 0% / 0.04), 0px 4px 6px -1px hsl(220 15% 0% / 0.08);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 15% 0% / 0.04), 0px 8px 10px -1px hsl(220 15% 0% / 0.08);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 15% 0% / 0.15);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    background: \n      linear-gradient(135deg, rgba(0, 4, 15, 0.95) 0%, rgba(10, 15, 35, 0.98) 100%),\n      radial-gradient(circle at 20% 20%, rgba(30, 60, 120, 0.3) 0%, transparent 40%),\n      radial-gradient(circle at 80% 80%, rgba(120, 30, 60, 0.2) 0%, transparent 40%),\n      radial-gradient(circle at 50% 50%, rgba(60, 30, 120, 0.15) 0%, transparent 60%),\n      linear-gradient(90deg, rgba(0, 20, 40, 0.1) 0%, rgba(20, 0, 40, 0.1) 100%);\n    background-attachment: fixed;\n    min-height: 100vh;\n  }\n\n  .light body {\n    background: \n      linear-gradient(135deg, rgba(240, 248, 255, 0.95) 0%, rgba(248, 250, 255, 0.98) 100%),\n      radial-gradient(circle at 20% 20%, rgba(100, 180, 255, 0.15) 0%, transparent 50%),\n      radial-gradient(circle at 80% 80%, rgba(180, 120, 255, 0.1) 0%, transparent 50%),\n      radial-gradient(circle at 50% 50%, rgba(120, 160, 255, 0.08) 0%, transparent 70%),\n      linear-gradient(90deg, rgba(200, 220, 255, 0.05) 0%, rgba(220, 200, 255, 0.05) 100%);\n    background-attachment: fixed;\n    min-height: 100vh;\n  }\n}\n\n@layer utilities {\n  .glass-card {\n    @apply border border-border/30 rounded-xl;\n    background: \n      linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%),\n      rgba(15, 25, 45, 0.6);\n    backdrop-filter: blur(16px) saturate(120%);\n    box-shadow: \n      0 12px 40px 0 rgba(0, 0, 0, 0.35),\n      inset 0 1px 0 0 rgba(255, 255, 255, 0.08),\n      0 0 20px 0 rgba(100, 200, 255, 0.1);\n  }\n\n  .light .glass-card {\n    background: \n      linear-gradient(135deg, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.65) 100%),\n      rgba(240, 248, 255, 0.4);\n    backdrop-filter: blur(20px) saturate(130%);\n    box-shadow: \n      0 20px 50px 0 rgba(100, 150, 255, 0.15),\n      inset 0 1px 0 0 rgba(255, 255, 255, 0.9),\n      0 0 30px 0 rgba(120, 180, 255, 0.2);\n  }\n  \n  .glass-header {\n    @apply border-b border-border/30;\n    background: \n      linear-gradient(135deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%),\n      rgba(10, 20, 40, 0.8);\n    backdrop-filter: blur(20px) saturate(150%);\n    box-shadow: \n      0 2px 8px 0 rgba(0, 0, 0, 0.25),\n      inset 0 1px 0 0 rgba(255, 255, 255, 0.05);\n  }\n\n  .light .glass-header {\n    background: \n      linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.80) 100%),\n      rgba(240, 248, 255, 0.6);\n    backdrop-filter: blur(25px) saturate(140%);\n    box-shadow: \n      0 4px 12px 0 rgba(100, 150, 255, 0.12),\n      inset 0 1px 0 0 rgba(255, 255, 255, 0.95);\n  }\n  \n  .glass-panel {\n    @apply border border-border/25 rounded-lg;\n    background: \n      linear-gradient(135deg, rgba(255, 255, 255, 0.04) 0%, rgba(255, 255, 255, 0.01) 100%),\n      rgba(20, 30, 50, 0.5);\n    backdrop-filter: blur(12px) saturate(110%);\n    box-shadow: \n      0 8px 24px 0 rgba(0, 0, 0, 0.25),\n      inset 0 1px 0 0 rgba(255, 255, 255, 0.06),\n      0 0 12px 0 rgba(80, 160, 255, 0.08);\n  }\n\n  .light .glass-panel {\n    background: \n      linear-gradient(135deg, rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.55) 100%),\n      rgba(240, 248, 255, 0.3);\n    backdrop-filter: blur(16px) saturate(120%);\n    box-shadow: \n      0 12px 32px 0 rgba(100, 150, 255, 0.12),\n      inset 0 1px 0 0 rgba(255, 255, 255, 0.85),\n      0 0 20px 0 rgba(120, 180, 255, 0.15);\n  }\n\n  .frosted-bg {\n    @apply bg-background/90 backdrop-blur-md;\n  }\n\n  .gradient-border {\n    background: linear-gradient(var(--background), var(--background)) padding-box,\n                linear-gradient(135deg, hsl(var(--primary) / 0.3), hsl(var(--accent) / 0.3)) border-box;\n    border: 1px solid transparent;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","size_bytes":13422},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"shared/schema.ts":{"content":"// MDDS Application Schema\nimport { z } from \"zod\";\nimport { pgTable, varchar, jsonb, timestamp, serial } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\n\nexport type Domain = 'cyber' | 'economy' | 'cognitive' | 'space' | 'joint';\nexport type CardType = 'asset' | 'permanent' | 'expert';\nexport type Team = 'NATO' | 'Russia';\n\nexport interface CardEffect {\n  target: 'self' | 'opponent';   // A = self, B = opponent\n  domain: Domain;                // affected domain\n  delta: number;                 // signed change to deterrence\n}\n\nexport interface PermanentMods {\n  flatDiscountK: number;         // ALWAYS -50K for listed cards\n  appliesToCardIds: string[];    // exact card IDs this permanent discounts\n}\n\nexport interface Card {\n  id: string;                    // from Excel (e.g., J1, CY7, E3, ...)\n  name: string;\n  domain: Domain;                // inferred from ID prefix\n  type: CardType;                // asset | permanent | expert\n  baseCostK: number;             // integer K units from Excel\n  effects?: CardEffect[];        // only for asset\n  permanentMods?: PermanentMods; // only for permanent\n  expertInfo?: string;           // only for expert\n}\n\nexport interface TeamState {\n  deterrence: Record<Domain, number>;\n  totalDeterrence: number;\n  budget: number;\n  ownedPermanents: Card[];\n  permanentsQueue: Array<{ card: Card; availableTurn: number }>;\n  expertsQueue: Array<{ card: Card; availableTurn: number }>;\n  cart: Card[];\n  recentPurchases: Array<{ cardId: string; purchasedTurn: number }>;\n}\n\nexport interface GameState {\n  turn: number;\n  maxTurns: number;\n  currentTeam: Team;\n  teams: Record<Team, TeamState>;\n  phase: 'purchase' | 'commit' | 'advance';\n  strategyLog: Array<{\n    turn: number;\n    team: Team;\n    action: string;\n    timestamp: Date;\n  }>;\n}\n\n// Database Tables\nexport const gameSessions = pgTable(\"game_sessions\", {\n  sessionName: varchar(\"session_name\", { length: 255 }).primaryKey(),\n  gameState: jsonb(\"game_state\").$type<GameState>().notNull(),\n  sessionInfo: jsonb(\"session_info\"),\n  turnStatistics: jsonb(\"turn_statistics\"),\n  finalReport: varchar(\"final_report\"),\n  lastUpdated: varchar(\"last_updated\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Zod schemas for validation\nexport const cardEffectSchema = z.object({\n  target: z.enum(['self', 'opponent']),\n  domain: z.enum(['cyber', 'economy', 'cognitive', 'space', 'joint']),\n  delta: z.number()\n});\n\nexport const permanentModsSchema = z.object({\n  flatDiscountK: z.number(),\n  appliesToCardIds: z.array(z.string())\n});\n\nexport const cardSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  domain: z.enum(['cyber', 'economy', 'cognitive', 'space', 'joint']),\n  type: z.enum(['asset', 'permanent', 'expert']),\n  baseCostK: z.number(),\n  effects: z.array(cardEffectSchema).optional(),\n  permanentMods: permanentModsSchema.optional(),\n  expertInfo: z.string().optional()\n});\n\nexport type InsertCard = z.infer<typeof cardSchema>;\nexport type SelectCard = Card;\n\n// Game State validation schema\nexport const teamStateSchema = z.object({\n  deterrence: z.object({\n    joint: z.number(),\n    economy: z.number(), \n    cognitive: z.number(),\n    space: z.number(),\n    cyber: z.number()\n  }),\n  totalDeterrence: z.number(),\n  budget: z.number(),\n  ownedPermanents: z.array(cardSchema),\n  permanentsQueue: z.array(z.object({\n    card: cardSchema,\n    availableTurn: z.number()\n  })),\n  expertsQueue: z.array(z.object({\n    card: cardSchema,\n    availableTurn: z.number()\n  })),\n  cart: z.array(cardSchema),\n  recentPurchases: z.array(z.object({\n    cardId: z.string(),\n    purchasedTurn: z.number()\n  }))\n});\n\nexport const gameStateSchema = z.object({\n  turn: z.number(),\n  maxTurns: z.number(),\n  currentTeam: z.enum(['NATO', 'Russia']),\n  teams: z.object({\n    NATO: teamStateSchema,\n    Russia: teamStateSchema\n  }),\n  phase: z.enum(['purchase', 'commit', 'advance']),\n  strategyLog: z.array(z.object({\n    turn: z.number(),\n    team: z.enum(['NATO', 'Russia']),\n    action: z.string(),\n    timestamp: z.union([z.date(), z.string().transform((str) => new Date(str))])\n  }))\n});\n\n// Game Session schemas with proper validation\nexport const insertGameSessionSchema = createInsertSchema(gameSessions).extend({\n  gameState: gameStateSchema\n});\nexport const selectGameSessionSchema = z.object({\n  sessionName: z.string(),\n  gameState: gameStateSchema,\n  sessionInfo: z.any().nullable(),\n  turnStatistics: z.any().nullable(),\n  finalReport: z.string().nullable(),\n  lastUpdated: z.string().nullable(),\n  createdAt: z.date(),\n  updatedAt: z.date()\n});\n\nexport type InsertGameSession = z.infer<typeof insertGameSessionSchema>;\nexport type SelectGameSession = z.infer<typeof selectGameSessionSchema>;","size_bytes":4822},"server/wordDocumentGenerator.ts":{"content":"import {\n  Document,\n  Packer,\n  Paragraph,\n  TextRun,\n  Table,\n  TableCell,\n  TableRow,\n  AlignmentType,\n  WidthType,\n  ImageRun,\n  HeadingLevel,\n  PageBreak,\n  BorderStyle\n} from 'docx';\n\nexport interface StatisticsTable {\n  variable: string;\n  n: number;\n  mean: string;\n  sd: string;\n  min: string;\n  max: string;\n  range: string;\n  median?: string;\n  iqr?: string;\n}\n\nexport async function createScientificReport(\n  methodology: string,\n  descriptiveStats: StatisticsTable[],\n  inferentialData: any,\n  chartBuffers: { title: string; buffer: Buffer }[],\n  sessionCount: number,\n  variableNames: string[]\n): Promise<Buffer> {\n  \n  const children: (Paragraph | Table)[] = [];\n  \n  // TITLE PAGE\n  children.push(\n    new Paragraph({\n      text: '',\n      spacing: { before: 2000 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Statistical Analysis of Multi-Dimensional Deterrence Strategy Outcomes',\n      heading: HeadingLevel.TITLE,\n      alignment: AlignmentType.CENTER,\n      spacing: { after: 400 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `A ${methodology} Approach`,\n      alignment: AlignmentType.CENTER,\n      spacing: { after: 800 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'MDDS Research System',\n      alignment: AlignmentType.CENTER,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),\n      alignment: AlignmentType.CENTER,\n      spacing: { after: 400 }\n    })\n  );\n  \n  // Page break\n  children.push(new Paragraph({ children: [new PageBreak()] }));\n  \n  // ABSTRACT\n  children.push(\n    new Paragraph({\n      text: 'Abstract',\n      heading: HeadingLevel.HEADING_1,\n      alignment: AlignmentType.CENTER,\n      spacing: { before: 400, after: 300 }\n    })\n  );\n  \n  const abstractText = `This research examines strategic deterrence outcomes across ${sessionCount} multi-dimensional strategy session${sessionCount > 1 ? 's' : ''} using ${methodology.toLowerCase()}. The study analyzes ${variableNames.length} dependent variable${variableNames.length > 1 ? 's' : ''} representing deterrence capabilities across five strategic domains: Joint, Economy, Cognitive, Space, and Cyber. ${inferentialData && inferentialData.significant ? 'Results revealed statistically significant patterns' : 'Analysis explored patterns'} in how strategic card purchases and domain investments influence deterrence outcomes. Findings contribute to understanding the complex dynamics of multi-dimensional deterrence strategies and provide evidence-based insights for strategic planning in contested environments. Implications for strategic theory and practice are discussed.`;\n  \n  children.push(\n    new Paragraph({\n      text: abstractText,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 400 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      children: [\n        new TextRun({ text: 'Keywords: ', italics: true, bold: true }),\n        new TextRun({ text: 'deterrence strategy, statistical analysis, multi-dimensional conflict, strategic planning, quantitative methodology', italics: true })\n      ],\n      spacing: { after: 400 }\n    })\n  );\n  \n  // Page break\n  children.push(new Paragraph({ children: [new PageBreak()] }));\n  \n  // INTRODUCTION\n  children.push(\n    new Paragraph({\n      text: '1. Introduction',\n      heading: HeadingLevel.HEADING_1,\n      spacing: { before: 400, after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Strategic deterrence in modern conflict environments extends beyond traditional military domains to encompass economic, cognitive, space, and cyber dimensions. The Multi-Dimensional Deterrence Strategy (MDDS) framework provides a comprehensive approach to understanding how strategic actors build and deploy deterrence capabilities across these interconnected domains.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'This study employs quantitative methods to analyze patterns in strategic decision-making and their outcomes. By examining real strategy session data, we can identify which approaches correlate with successful deterrence outcomes and which strategic investments yield the greatest returns in terms of overall deterrence capability.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '1.1 Research Questions',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'This research addresses the following primary questions:',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 100 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '(1) What statistical patterns emerge in deterrence outcomes across multiple strategy sessions?',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 100 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '(2) How do different strategic approaches influence deterrence capabilities across the five domains?',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 100 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `(3) What evidence supports the effectiveness of specific strategic investments as measured through ${methodology.toLowerCase()}?`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '1.2 Theoretical Framework',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'The MDDS framework posits that effective deterrence requires balanced investment across five strategic domains. Traditional deterrence theory focused primarily on military capabilities, but contemporary strategic environments demand attention to economic resilience, cognitive influence, space assets, and cyber capabilities. Each domain contributes uniquely to overall deterrence posture while also exhibiting complex interdependencies.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  // Page break\n  children.push(new Paragraph({ children: [new PageBreak()] }));\n  \n  // LITERATURE REVIEW\n  children.push(\n    new Paragraph({\n      text: '2. Literature Review',\n      heading: HeadingLevel.HEADING_1,\n      spacing: { before: 400, after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '2.1 Multi-Dimensional Deterrence Theory',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Classical deterrence theory, rooted in game-theoretic models and rational actor assumptions, has evolved to address the complexity of modern strategic environments. Contemporary deterrence scholarship recognizes that credible deterrence requires capabilities spanning multiple domains. The MDDS framework builds on this foundation by explicitly modeling five distinct but interconnected strategic domains.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Recent research emphasizes the importance of domain specialization versus balanced investment strategies. Some strategic actors achieve success through concentrated investments in specific domains, while others benefit from diversified portfolios. This study contributes empirical evidence to this ongoing theoretical debate.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '2.2 Strategic Card Systems and Resource Allocation',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'The MDDS framework employs a card-based system representing strategic investments. Cards fall into three categories: assets (temporary capabilities), permanent capabilities (sustained advantages), and expert advisors (specialized knowledge). Understanding the differential impact of these card types on deterrence outcomes remains an active area of research.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Literature on timing effects suggests that early investments in permanent capabilities may yield compounding advantages over time. However, the optimal timing and sequence of strategic investments requires empirical investigation across multiple scenarios.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '2.3 Quantitative Methods in Strategic Analysis',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `The application of ${methodology.toLowerCase()} to strategic deterrence data allows researchers to move beyond case-study approaches toward robust quantitative assessment. This methodological approach enables systematic identification of patterns across multiple sessions while accounting for strategic variation and measurement uncertainty.`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  // Page break\n  children.push(new Paragraph({ children: [new PageBreak()] }));\n  \n  // METHODOLOGY\n  children.push(\n    new Paragraph({\n      text: '3. Methodology',\n      heading: HeadingLevel.HEADING_1,\n      spacing: { before: 400, after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '3.1 Data Collection and Sample',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `Data for this analysis were collected from ${sessionCount} completed MDDS strategy session${sessionCount > 1 ? 's' : ''}. Each session represents a complete strategic scenario in which two teams (NATO and Russia) make sequential decisions regarding card purchases and domain investments across multiple turns. Sessions varied in duration and strategic approaches employed.`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `The dataset includes comprehensive turn-by-turn metrics capturing deterrence scores across all five domains (Joint, Economy, Cognitive, Space, Cyber), budget expenditures, card purchases, and final outcomes. Quality control procedures ensured data completeness and verified the integrity of all statistical calculations.`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '3.2 Variables and Measures',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `This study examined ${variableNames.length} dependent variable${variableNames.length > 1 ? 's' : ''}: ${variableNames.join(', ')}. Each variable was measured on a continuous scale, with deterrence scores reflecting the cumulative effect of strategic investments within each domain.`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Domain deterrence scores are calculated based on card effects (defensive and offensive), permanent capability bonuses, and domain-specific modifiers. Total deterrence represents the sum of all five domain scores, providing an overall measure of strategic success.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '3.3 Statistical Analysis',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `Data analysis employed ${methodology.toLowerCase()} to examine relationships between the selected variables. All analyses were conducted using established statistical procedures with  = .05 as the threshold for statistical significance.`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Descriptive statistics (means, standard deviations, ranges) were calculated to characterize the distribution of each variable. Data were screened for outliers and assessed for assumptions underlying the chosen statistical method. Effect sizes are reported alongside significance tests to provide information about practical as well as statistical significance.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  // Page break\n  children.push(new Paragraph({ children: [new PageBreak()] }));\n  \n  // RESULTS\n  children.push(\n    new Paragraph({\n      text: '4. Results',\n      heading: HeadingLevel.HEADING_1,\n      spacing: { before: 400, after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '4.1 Descriptive Statistics',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `Table 1 presents descriptive statistics for all ${variableNames.length} variable${variableNames.length > 1 ? 's' : ''} examined in this study. The table includes sample sizes, means, standard deviations, minimum and maximum values, and ranges. ${descriptiveStats.length > 0 ? 'These statistics provide a comprehensive overview of the distribution and variability within the dataset.' : ''}`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Table 1',\n      alignment: AlignmentType.CENTER,\n      spacing: { before: 200, after: 100 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      children: [\n        new TextRun({ text: 'Descriptive Statistics for Study Variables', italics: true })\n      ],\n      alignment: AlignmentType.CENTER,\n      spacing: { after: 200 }\n    })\n  );\n  \n  const descriptiveTable = new Table({\n    rows: [\n      new TableRow({\n        children: [\n          new TableCell({\n            children: [new Paragraph({ children: [new TextRun({ text: 'Variable', bold: true })] })],\n            width: { size: 25, type: WidthType.PERCENTAGE },\n            shading: { fill: \"E0E0E0\" }\n          }),\n          new TableCell({\n            children: [new Paragraph({ children: [new TextRun({ text: 'N', bold: true })], alignment: AlignmentType.CENTER })],\n            width: { size: 10, type: WidthType.PERCENTAGE },\n            shading: { fill: \"E0E0E0\" }\n          }),\n          new TableCell({\n            children: [new Paragraph({ children: [new TextRun({ text: 'Mean', bold: true })], alignment: AlignmentType.CENTER })],\n            width: { size: 13, type: WidthType.PERCENTAGE },\n            shading: { fill: \"E0E0E0\" }\n          }),\n          new TableCell({\n            children: [new Paragraph({ children: [new TextRun({ text: 'SD', bold: true })], alignment: AlignmentType.CENTER })],\n            width: { size: 13, type: WidthType.PERCENTAGE },\n            shading: { fill: \"E0E0E0\" }\n          }),\n          new TableCell({\n            children: [new Paragraph({ children: [new TextRun({ text: 'Min', bold: true })], alignment: AlignmentType.CENTER })],\n            width: { size: 13, type: WidthType.PERCENTAGE },\n            shading: { fill: \"E0E0E0\" }\n          }),\n          new TableCell({\n            children: [new Paragraph({ children: [new TextRun({ text: 'Max', bold: true })], alignment: AlignmentType.CENTER })],\n            width: { size: 13, type: WidthType.PERCENTAGE },\n            shading: { fill: \"E0E0E0\" }\n          }),\n          new TableCell({\n            children: [new Paragraph({ children: [new TextRun({ text: 'Range', bold: true })], alignment: AlignmentType.CENTER })],\n            width: { size: 13, type: WidthType.PERCENTAGE },\n            shading: { fill: \"E0E0E0\" }\n          })\n        ],\n        tableHeader: true\n      }),\n      ...descriptiveStats.map((stat, index) =>\n        new TableRow({\n          children: [\n            new TableCell({ \n              children: [new Paragraph(stat.variable)],\n              shading: index % 2 === 0 ? { fill: \"F8F8F8\" } : undefined\n            }),\n            new TableCell({ \n              children: [new Paragraph({ text: String(stat.n), alignment: AlignmentType.CENTER })],\n              shading: index % 2 === 0 ? { fill: \"F8F8F8\" } : undefined\n            }),\n            new TableCell({ \n              children: [new Paragraph({ text: stat.mean, alignment: AlignmentType.CENTER })],\n              shading: index % 2 === 0 ? { fill: \"F8F8F8\" } : undefined\n            }),\n            new TableCell({ \n              children: [new Paragraph({ text: stat.sd, alignment: AlignmentType.CENTER })],\n              shading: index % 2 === 0 ? { fill: \"F8F8F8\" } : undefined\n            }),\n            new TableCell({ \n              children: [new Paragraph({ text: stat.min, alignment: AlignmentType.CENTER })],\n              shading: index % 2 === 0 ? { fill: \"F8F8F8\" } : undefined\n            }),\n            new TableCell({ \n              children: [new Paragraph({ text: stat.max, alignment: AlignmentType.CENTER })],\n              shading: index % 2 === 0 ? { fill: \"F8F8F8\" } : undefined\n            }),\n            new TableCell({ \n              children: [new Paragraph({ text: stat.range, alignment: AlignmentType.CENTER })],\n              shading: index % 2 === 0 ? { fill: \"F8F8F8\" } : undefined\n            })\n          ]\n        })\n      )\n    ],\n    width: { size: 100, type: WidthType.PERCENTAGE },\n    borders: {\n      top: { style: BorderStyle.SINGLE, size: 1 },\n      bottom: { style: BorderStyle.SINGLE, size: 1 },\n      left: { style: BorderStyle.SINGLE, size: 1 },\n      right: { style: BorderStyle.SINGLE, size: 1 },\n      insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },\n      insideVertical: { style: BorderStyle.SINGLE, size: 1 }\n    }\n  });\n  \n  children.push(descriptiveTable);\n  \n  children.push(\n    new Paragraph({\n      children: [\n        new TextRun({ text: 'Note. ', italics: true }),\n        new TextRun({ text: 'N = sample size; SD = standard deviation; Min = minimum value; Max = maximum value.', italics: true })\n      ],\n      spacing: { before: 100, after: 300 }\n    })\n  );\n  \n  // Narrative interpretation of descriptive statistics\n  if (descriptiveStats.length > 0) {\n    const natoStat = descriptiveStats.find(s => s.variable.includes('NATO Total'));\n    const russiaStat = descriptiveStats.find(s => s.variable.includes('Russia Total'));\n    \n    let narrative = 'Examination of the descriptive statistics reveals several notable patterns. ';\n    \n    if (natoStat) {\n      const cvNato = (parseFloat(natoStat.sd) / parseFloat(natoStat.mean)) * 100;\n      narrative += `NATO Total Deterrence scores exhibited ${cvNato > 30 ? 'substantial' : cvNato > 15 ? 'moderate' : 'limited'} variability (M = ${natoStat.mean}, SD = ${natoStat.sd}, Range = ${natoStat.range}), with a coefficient of variation of ${cvNato.toFixed(1)}%. `;\n    }\n    \n    if (russiaStat) {\n      const cvRussia = (parseFloat(russiaStat.sd) / parseFloat(russiaStat.mean)) * 100;\n      narrative += `Russia Total Deterrence demonstrated ${cvRussia > 30 ? 'substantial' : cvRussia > 15 ? 'moderate' : 'limited'} variability (M = ${russiaStat.mean}, SD = ${russiaStat.sd}, Range = ${russiaStat.range}), with a coefficient of variation of ${cvRussia.toFixed(1)}%. `;\n    }\n    \n    if (natoStat && russiaStat) {\n      const natoMean = parseFloat(natoStat.mean);\n      const russiaMean = parseFloat(russiaStat.mean);\n      const meanDiff = Math.abs(natoMean - russiaMean);\n      const percentDiff = (meanDiff / Math.min(natoMean, russiaMean)) * 100;\n      \n      narrative += `The mean difference between NATO and Russia total deterrence scores was ${meanDiff.toFixed(2)} points (${percentDiff.toFixed(1)}%), suggesting ${percentDiff > 20 ? 'substantial asymmetry' : percentDiff > 10 ? 'moderate differences' : 'relatively balanced outcomes'} in strategic effectiveness. `;\n    }\n    \n    narrative += 'These distributional characteristics provide context for interpreting the inferential analyses that follow.';\n    \n    children.push(\n      new Paragraph({\n        text: narrative,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  // INFERENTIAL ANALYSIS\n  children.push(\n    new Paragraph({\n      text: `4.2 Inferential Analysis: ${methodology}`,\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 400, after: 200 }\n    })\n  );\n  \n  children.push(...generateInferentialSection(methodology, inferentialData, chartBuffers, sessionCount, variableNames));\n  \n  // Page break before Discussion\n  children.push(new Paragraph({ children: [new PageBreak()] }));\n  \n  // DISCUSSION\n  children.push(\n    new Paragraph({\n      text: '5. Discussion',\n      heading: HeadingLevel.HEADING_1,\n      spacing: { before: 400, after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '5.1 Interpretation of Findings',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  const discussionText1 = inferentialData && inferentialData.significant\n    ? `The ${methodology.toLowerCase()} revealed statistically significant patterns in the data, supporting the hypothesis that strategic choices meaningfully influence deterrence outcomes. These findings align with theoretical expectations that deliberate domain investment strategies produce measurable effects on overall deterrence capabilities.`\n    : `While the ${methodology.toLowerCase()} did not reveal statistically significant effects at the conventional  = .05 level, the observed patterns suggest potential relationships worthy of further investigation with larger samples or refined measurement approaches. The absence of statistical significance should not be interpreted as absence of practical importance, particularly in strategic domains where even modest effect sizes may have substantial real-world implications.`;\n  \n  children.push(\n    new Paragraph({\n      text: discussionText1,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'The descriptive statistics revealed considerable variability in strategic approaches and outcomes across sessions. This heterogeneity reflects the complex, multi-faceted nature of multi-dimensional deterrence strategy. Different strategic contexts may favor different approaches, suggesting that successful deterrence requires adaptive strategies rather than one-size-fits-all solutions.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '5.2 Theoretical Implications',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'These findings contribute to evolving theories of multi-dimensional deterrence. The MDDS framework\\'s emphasis on five distinct but interconnected domains receives empirical support from the observed patterns. Strategic actors must consider not only domain-specific investments but also cross-domain synergies and trade-offs.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'The results also inform ongoing debates about specialization versus diversification in strategic resource allocation. Evidence from this study suggests that both approaches can yield success depending on contextual factors, opponent strategies, and timing of investments.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '5.3 Practical Applications',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'For strategic planners and decision-makers, these findings highlight the importance of evidence-based approaches to deterrence strategy. The quantitative assessment of strategic outcomes enables more informed resource allocation decisions and provides benchmarks for evaluating strategic effectiveness.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'The documented variability in outcomes across different strategic approaches underscores the value of scenario-based planning and adaptive strategies. Organizations should maintain flexibility to adjust domain investments based on evolving strategic contexts and opponent responses.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: '5.4 Limitations',\n      heading: HeadingLevel.HEADING_2,\n      spacing: { before: 300, after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Several limitations should be considered when interpreting these findings. First, the sample size, while adequate for the chosen statistical method, limits the ability to detect small effect sizes and constrains generalizability. Future research should replicate these analyses with larger, more diverse samples.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Second, the MDDS framework, while comprehensive, represents a simplified model of real-world strategic deterrence. Actual strategic environments involve additional complexities not captured in the current measurement system. The results should be interpreted as informing theoretical understanding rather than providing precise predictions for real-world scenarios.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `Third, the cross-sectional nature of this analysis limits causal inference. While ${methodology.toLowerCase()} can identify associations and patterns, establishing definitive causal relationships requires experimental or longitudinal research designs.`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  // CONCLUSION\n  children.push(\n    new Paragraph({\n      text: '6. Conclusion',\n      heading: HeadingLevel.HEADING_1,\n      spacing: { before: 400, after: 300 }\n    })\n  );\n  \n  const conclusionMain = inferentialData && inferentialData.significant\n    ? `This research provides statistically significant evidence that strategic choices in multi-dimensional deterrence scenarios produce measurable effects on deterrence outcomes. The ${methodology} successfully identified patterns that advance our understanding of effective deterrence strategy across the five key domains.`\n    : `This research provides valuable insights into patterns of multi-dimensional deterrence strategy, though statistical significance was not achieved at conventional levels. The ${methodology} illuminated important trends and relationships that warrant further investigation with larger samples and refined measures.`;\n  \n  children.push(\n    new Paragraph({\n      text: conclusionMain,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: `The descriptive analysis of ${sessionCount} strategy session${sessionCount > 1 ? 's' : ''} revealed substantial variability in strategic approaches and outcomes, underscoring the complex, context-dependent nature of deterrence effectiveness. This heterogeneity suggests that successful deterrence requires adaptive, evidence-informed strategies rather than rigid doctrinal approaches.`,\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'The MDDS framework\\'s multi-dimensional approach receives support from this analysis, demonstrating that effective deterrence extends beyond traditional military domains to encompass economic, cognitive, space, and cyber dimensions. Future research should continue to explore the interdependencies among these domains and identify optimal resource allocation strategies under varying strategic conditions.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'As strategic competition intensifies across multiple domains simultaneously, the need for rigorous, quantitative assessment of deterrence strategies becomes increasingly critical. This study contributes to the growing body of evidence-based strategic analysis and provides methodological foundations for continued research in this vital area.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 400 }\n    })\n  );\n  \n  // Page break before References\n  children.push(new Paragraph({ children: [new PageBreak()] }));\n  \n  // REFERENCES\n  children.push(\n    new Paragraph({\n      text: 'References',\n      heading: HeadingLevel.HEADING_1,\n      spacing: { before: 400, after: 300 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'American Psychological Association. (2020). Publication manual of the American Psychological Association (7th ed.). https://doi.org/10.1037/0000165-000',\n      spacing: { after: 200 },\n      indent: { left: 720, hanging: 720 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Cohen, J. (1988). Statistical power analysis for the behavioral sciences (2nd ed.). Lawrence Erlbaum Associates.',\n      spacing: { after: 200 },\n      indent: { left: 720, hanging: 720 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Field, A. (2018). Discovering statistics using IBM SPSS Statistics (5th ed.). SAGE Publications.',\n      spacing: { after: 200 },\n      indent: { left: 720, hanging: 720 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Morgan, P. M. (2003). Deterrence now. Cambridge University Press.',\n      spacing: { after: 200 },\n      indent: { left: 720, hanging: 720 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Schelling, T. C. (1966). Arms and influence. Yale University Press.',\n      spacing: { after: 200 },\n      indent: { left: 720, hanging: 720 }\n    })\n  );\n  \n  children.push(\n    new Paragraph({\n      text: 'Tabachnick, B. G., & Fidell, L. S. (2019). Using multivariate statistics (7th ed.). Pearson.',\n      spacing: { after: 200 },\n      indent: { left: 720, hanging: 720 }\n    })\n  );\n  \n  const doc = new Document({\n    creator: 'MDDS Research System',\n    title: `Multi-Dimensional Deterrence Strategy Analysis - ${methodology}`,\n    description: 'Comprehensive Scientific Research Report',\n    sections: [{\n      properties: {\n        page: {\n          margin: {\n            top: 1440,\n            right: 1440,\n            bottom: 1440,\n            left: 1440\n          }\n        }\n      },\n      children\n    }]\n  });\n  \n  return await Packer.toBuffer(doc);\n}\n\nfunction generateInferentialSection(\n  methodology: string,\n  data: any,\n  charts: { title: string; buffer: Buffer }[],\n  sessionCount: number,\n  variableNames: string[]\n): (Paragraph | Table)[] {\n  const items: (Paragraph | Table)[] = [];\n  \n  switch (methodology) {\n    case 'Independent Samples t-test':\n      items.push(...generateTTestSection(data, charts));\n      break;\n    case 'One-Way ANOVA':\n      items.push(...generateANOVASection(data, charts));\n      break;\n    case 'Correlation Analysis (Pearson/Spearman)':\n      items.push(...generateCorrelationSection(data, charts));\n      break;\n    case 'Multiple Regression':\n      items.push(...generateRegressionSection(data, charts));\n      break;\n    default:\n      items.push(\n        new Paragraph({\n          text: `A ${methodology} was conducted to analyze relationships among the selected variables. The analysis examined ${sessionCount} strategy sessions across ${variableNames.length} dependent variables. Detailed statistical results and interpretations are presented below.`,\n          alignment: AlignmentType.JUSTIFIED,\n          spacing: { after: 300 }\n        })\n      );\n  }\n  \n  return items;\n}\n\nfunction generateTTestSection(data: any, charts: { title: string; buffer: Buffer }[]): (Paragraph | Table)[] {\n  const items: (Paragraph | Table)[] = [];\n  \n  items.push(\n    new Paragraph({\n      text: 'An independent samples t-test was conducted to compare means between two independent groups on the dependent variable of interest. This parametric test assesses whether observed mean differences exceed what would be expected by sampling error alone.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 200 }\n    })\n  );\n  \n  if (data && data.tStatistic !== undefined && data.mean1 !== undefined && data.mean2 !== undefined && \n      data.sd1 !== undefined && data.sd2 !== undefined && data.n1 !== undefined && data.n2 !== undefined) {\n    // Add a comprehensive results table\n    items.push(\n      new Paragraph({\n        text: 'Table 2',\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 300, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Independent Samples t-Test Results', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 200 }\n      })\n    );\n    \n    const tTestTable = new Table({\n      rows: [\n        new TableRow({\n          children: [\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'Group', bold: true })] })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'N', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'Mean', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'SD', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'SE', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            })\n          ],\n          tableHeader: true\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Group 1')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: String(data.n1), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.mean1.toFixed(2), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.sd1.toFixed(2), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: (data.sd1 / Math.sqrt(data.n1)).toFixed(2), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Group 2')] }),\n            new TableCell({ children: [new Paragraph({ text: String(data.n2), alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: data.mean2.toFixed(2), alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: data.sd2.toFixed(2), alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: (data.sd2 / Math.sqrt(data.n2)).toFixed(2), alignment: AlignmentType.CENTER })] })\n          ]\n        })\n      ],\n      width: { size: 100, type: WidthType.PERCENTAGE },\n      borders: {\n        top: { style: BorderStyle.SINGLE, size: 1 },\n        bottom: { style: BorderStyle.SINGLE, size: 1 },\n        left: { style: BorderStyle.SINGLE, size: 1 },\n        right: { style: BorderStyle.SINGLE, size: 1 },\n        insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },\n        insideVertical: { style: BorderStyle.SINGLE, size: 1 }\n      }\n    });\n    \n    items.push(tTestTable);\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Note. ', italics: true }),\n          new TextRun({ text: 'N = sample size; SD = standard deviation; SE = standard error of the mean.', italics: true })\n        ],\n        spacing: { before: 100, after: 300 }\n      })\n    );\n    \n    // Detailed narrative results\n    const meanDiff = Math.abs(data.mean1 - data.mean2);\n    const percentDiff = (meanDiff / Math.min(data.mean1, data.mean2)) * 100;\n    \n    items.push(\n      new Paragraph({\n        text: `The independent samples t-test ${data.significant ? 'revealed a statistically significant difference' : 'did not reveal a statistically significant difference'} between the two groups, t(${data.degreesOfFreedom}) = ${data.tStatistic.toFixed(3)}, p ${data.significant ? '<' : '='} ${data.pValue < 0.001 ? '.001' : data.pValue.toFixed(3)}, two-tailed. Group 1 (M = ${data.mean1.toFixed(2)}, SD = ${data.sd1.toFixed(2)}, n = ${data.n1}) ${data.mean1 > data.mean2 ? 'scored higher than' : 'scored lower than'} Group 2 (M = ${data.mean2.toFixed(2)}, SD = ${data.sd2.toFixed(2)}, n = ${data.n2}) by ${meanDiff.toFixed(2)} points, representing a ${percentDiff.toFixed(1)}% difference.`,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 200 }\n      })\n    );\n    \n    const effectSize = Math.abs(data.cohensD);\n    const effectInterpretation = effectSize < 0.2 ? 'negligible' : effectSize < 0.5 ? 'small' : effectSize < 0.8 ? 'medium' : 'large';\n    \n    items.push(\n      new Paragraph({\n        text: `The effect size (Cohen's d = ${data.cohensD.toFixed(2)}) indicates a ${effectInterpretation} practical difference between groups. According to Cohen's (1988) benchmarks, d = 0.2 represents a small effect, d = 0.5 a medium effect, and d = 0.8 a large effect. The observed effect size ${data.significant ? 'confirms' : 'suggests'} ${effectInterpretation === 'large' || effectInterpretation === 'medium' ? 'meaningful' : 'limited'} practical significance ${data.significant ? 'in addition to statistical significance' : 'despite the lack of statistical significance'}.`,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 300 }\n      })\n    );\n    \n    // Add 95% Confidence Interval\n    const pooledSE = Math.sqrt((data.sd1 ** 2 / data.n1) + (data.sd2 ** 2 / data.n2));\n    const marginOfError = 1.96 * pooledSE;\n    const ciLower = meanDiff - marginOfError;\n    const ciUpper = meanDiff + marginOfError;\n    \n    items.push(\n      new Paragraph({\n        text: `The 95% confidence interval for the mean difference ranges from ${ciLower.toFixed(2)} to ${ciUpper.toFixed(2)}. This interval ${ciLower * ciUpper > 0 ? 'does not include zero, supporting' : 'includes zero, consistent with'} the ${data.significant ? 'significant' : 'non-significant'} hypothesis test result.`,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 400 }\n      })\n    );\n  } else {\n    // Fallback when data is incomplete\n    items.push(\n      new Paragraph({\n        text: 'The t-test analysis was conducted, but complete statistical details are not available for this comparison. Please ensure all required data (group means, standard deviations, and sample sizes) are provided for comprehensive reporting.',\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  if (charts.length > 0) {\n    items.push(\n      new Paragraph({\n        text: 'Figure 1',\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 300, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new ImageRun({\n            data: charts[0].buffer,\n            transformation: {\n              width: 600,\n              height: 375\n            },\n            type: 'png'\n          } as any)\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: `${charts[0].title}. `, italics: true }),\n          new TextRun({ text: 'Error bars represent 95% confidence intervals around the mean. Non-overlapping confidence intervals provide visual evidence of group differences.', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  return items;\n}\n\nfunction generateANOVASection(data: any, charts: { title: string; buffer: Buffer }[]): (Paragraph | Table)[] {\n  const items: (Paragraph | Table)[] = [];\n  \n  items.push(\n    new Paragraph({\n      text: 'A one-way analysis of variance (ANOVA) was performed to compare means across three or more independent groups. ANOVA partitions total variance into between-groups and within-groups components to test whether group means differ more than expected by chance alone.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  if (data && data.fStatistic !== undefined && data.betweenGroupsSS !== undefined && \n      data.withinGroupsSS !== undefined && data.totalSS !== undefined && \n      data.betweenGroupsDF !== undefined && data.withinGroupsDF !== undefined) {\n    items.push(\n      new Paragraph({\n        text: 'Table 2',\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 200, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'One-Way ANOVA Summary Table', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 200 }\n      })\n    );\n    \n    const anovaTable = new Table({\n      rows: [\n        new TableRow({\n          children: [\n            new TableCell({ \n              children: [new Paragraph({ children: [new TextRun({ text: 'Source', bold: true })] })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({ \n              children: [new Paragraph({ children: [new TextRun({ text: 'SS', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({ \n              children: [new Paragraph({ children: [new TextRun({ text: 'df', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({ \n              children: [new Paragraph({ children: [new TextRun({ text: 'MS', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({ \n              children: [new Paragraph({ children: [new TextRun({ text: 'F', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({ \n              children: [new Paragraph({ children: [new TextRun({ text: 'p', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({ \n              children: [new Paragraph({ children: [new TextRun({ text: '', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            })\n          ],\n          tableHeader: true\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Between Groups')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.betweenGroupsSS.toFixed(2), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: String(data.betweenGroupsDF), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: (data.betweenGroupsSS / data.betweenGroupsDF).toFixed(2), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.fStatistic.toFixed(3), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.pValue < 0.001 ? '< .001' : data.pValue.toFixed(3), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.etaSquared.toFixed(3), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Within Groups')] }),\n            new TableCell({ children: [new Paragraph({ text: data.withinGroupsSS.toFixed(2), alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: String(data.withinGroupsDF), alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: (data.withinGroupsSS / data.withinGroupsDF).toFixed(2), alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })] })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Total')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.totalSS.toFixed(2), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: String(data.betweenGroupsDF + data.withinGroupsDF), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        })\n      ],\n      width: { size: 100, type: WidthType.PERCENTAGE },\n      borders: {\n        top: { style: BorderStyle.SINGLE, size: 1 },\n        bottom: { style: BorderStyle.SINGLE, size: 1 },\n        left: { style: BorderStyle.SINGLE, size: 1 },\n        right: { style: BorderStyle.SINGLE, size: 1 },\n        insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },\n        insideVertical: { style: BorderStyle.SINGLE, size: 1 }\n      }\n    });\n    \n    items.push(anovaTable);\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Note. ', italics: true }),\n          new TextRun({ text: 'SS = sum of squares; df = degrees of freedom; MS = mean square (SS/df);  = eta squared (proportion of total variance explained by group membership).', italics: true })\n        ],\n        spacing: { before: 100, after: 300 }\n      })\n    );\n    \n    const etaInterpretation = data.etaSquared < 0.01 ? 'negligible' : data.etaSquared < 0.06 ? 'small' : data.etaSquared < 0.14 ? 'medium' : 'large';\n    \n    items.push(\n      new Paragraph({\n        text: `The omnibus F-test ${data.significant ? 'was statistically significant' : 'was not statistically significant'}, F(${data.betweenGroupsDF}, ${data.withinGroupsDF}) = ${data.fStatistic.toFixed(3)}, p ${data.significant ? '<' : '='} ${data.pValue < 0.001 ? '.001' : data.pValue.toFixed(3)}. The effect size ( = ${data.etaSquared.toFixed(3)}) indicates that ${(data.etaSquared * 100).toFixed(1)}% of the total variance in the dependent variable is attributable to group membership, representing a ${etaInterpretation} effect according to Cohen's (1988) guidelines.`,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 200 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        text: data.significant \n          ? 'The significant F-ratio indicates that at least two group means differ significantly from one another. Post-hoc pairwise comparisons (e.g., Tukey HSD tests) would be warranted to identify which specific groups differ and by how much.'\n          : 'The non-significant F-ratio suggests that the observed differences among group means do not exceed what would be expected by sampling variability alone. No further post-hoc testing is warranted.',\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  if (charts.length > 0) {\n    items.push(\n      new Paragraph({\n        text: `Figure ${data ? '2' : '1'}`,\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 300, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new ImageRun({\n            data: charts[0].buffer,\n            transformation: {\n              width: 600,\n              height: 375\n            },\n            type: 'png'\n          } as any)\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: `${charts[0].title}. `, italics: true }),\n          new TextRun({ text: 'Error bars represent standard errors of the mean. Visual inspection suggests the magnitude of between-group variation relative to within-group variation.', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  return items;\n}\n\nfunction generateCorrelationSection(data: any, charts: { title: string; buffer: Buffer }[]): (Paragraph | Table)[] {\n  const items: (Paragraph | Table)[] = [];\n  \n  items.push(\n    new Paragraph({\n      text: 'Correlation analysis examined the linear relationship between two continuous variables. Pearson\\'s product-moment correlation coefficient (r) quantifies both the strength and direction of the linear association.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  if (data && data.coefficient !== undefined && data.n !== undefined && data.pValue !== undefined) {\n    // Add correlation results table\n    items.push(\n      new Paragraph({\n        text: 'Table 2',\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 300, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Correlation Analysis Results', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 200 }\n      })\n    );\n    \n    const corrTable = new Table({\n      rows: [\n        new TableRow({\n          children: [\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'Statistic', bold: true })] })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'Value', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            })\n          ],\n          tableHeader: true\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Pearson\\'s r')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.coefficient.toFixed(3), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('r')] }),\n            new TableCell({ children: [new Paragraph({ text: (data.coefficient ** 2).toFixed(3), alignment: AlignmentType.CENTER })] })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Sample Size (n)')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: String(data.n), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('p-value')] }),\n            new TableCell({ children: [new Paragraph({ text: data.pValue < 0.001 ? '< .001' : data.pValue.toFixed(3), alignment: AlignmentType.CENTER })] })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('95% CI Lower')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.ciLower?.toFixed(3) || '', alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('95% CI Upper')] }),\n            new TableCell({ children: [new Paragraph({ text: data.ciUpper?.toFixed(3) || '', alignment: AlignmentType.CENTER })] })\n          ]\n        })\n      ],\n      width: { size: 70, type: WidthType.PERCENTAGE },\n      borders: {\n        top: { style: BorderStyle.SINGLE, size: 1 },\n        bottom: { style: BorderStyle.SINGLE, size: 1 },\n        left: { style: BorderStyle.SINGLE, size: 1 },\n        right: { style: BorderStyle.SINGLE, size: 1 },\n        insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },\n        insideVertical: { style: BorderStyle.SINGLE, size: 1 }\n      }\n    });\n    \n    items.push(corrTable);\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Note. ', italics: true }),\n          new TextRun({ text: 'CI = confidence interval. r represents the proportion of variance in one variable predictable from the other.', italics: true })\n        ],\n        spacing: { before: 100, after: 300 }\n      })\n    );\n    \n    const absR = Math.abs(data.coefficient);\n    const strengthInterpretation = absR < 0.1 ? 'negligible' : absR < 0.3 ? 'weak' : absR < 0.5 ? 'moderate' : absR < 0.7 ? 'strong' : 'very strong';\n    const direction = data.coefficient > 0 ? 'positive' : 'negative';\n    const r2 = data.coefficient ** 2;\n    \n    items.push(\n      new Paragraph({\n        text: `The correlation analysis revealed a ${strengthInterpretation} ${direction} correlation between the variables, r(${data.n - 2}) = ${data.coefficient.toFixed(3)}, p ${data.significant ? '<' : '='} ${data.pValue < 0.001 ? '.001' : data.pValue.toFixed(3)}. This ${data.significant ? 'statistically significant' : 'non-significant'} correlation indicates that ${direction === 'positive' ? 'higher values on one variable tend to be associated with higher values on the other' : 'higher values on one variable tend to be associated with lower values on the other'}.`,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 200 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        text: `The coefficient of determination (r = ${r2.toFixed(3)}) indicates that ${(r2 * 100).toFixed(1)}% of the variance in one variable is predictable from the other variable. This ${r2 > 0.25 ? 'substantial' : r2 > 0.09 ? 'moderate' : 'small'} shared variance ${data.significant ? 'supports' : 'does not support'} a meaningful linear relationship between the measures in this sample.`,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 400 }\n      })\n    );\n  } else {\n    // Fallback when data is incomplete\n    items.push(\n      new Paragraph({\n        text: 'The correlation analysis was conducted, but complete statistical details are not available for reporting. Please ensure all required data (correlation coefficient, sample size, and p-value) are provided for comprehensive reporting.',\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  if (charts.length > 0) {\n    items.push(\n      new Paragraph({\n        text: 'Figure 1',\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 300, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new ImageRun({\n            data: charts[0].buffer,\n            transformation: {\n              width: 600,\n              height: 375\n            },\n            type: 'png'\n          } as any)\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: `${charts[0].title}. `, italics: true }),\n          new TextRun({ text: 'Each point represents one observation. The trend line illustrates the direction and approximate strength of the linear relationship. Scatter around the trend line reflects unexplained variance (1 - r).', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  return items;\n}\n\nfunction generateRegressionSection(data: any, charts: { title: string; buffer: Buffer }[]): (Paragraph | Table)[] {\n  const items: (Paragraph | Table)[] = [];\n  \n  items.push(\n    new Paragraph({\n      text: 'Simple linear regression analysis was conducted to evaluate how well the predictor variable accounts for variance in the outcome variable and to estimate the best-fitting linear prediction equation.',\n      alignment: AlignmentType.JUSTIFIED,\n      spacing: { after: 300 }\n    })\n  );\n  \n  if (data && data.rSquared !== undefined && data.fStatistic !== undefined && \n      data.intercept !== undefined && data.slope !== undefined && data.standardError !== undefined && \n      data.n !== undefined) {\n    // Model summary table\n    items.push(\n      new Paragraph({\n        text: 'Table 2',\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 300, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Regression Model Summary', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 200 }\n      })\n    );\n    \n    const modelTable = new Table({\n      rows: [\n        new TableRow({\n          children: [\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'Statistic', bold: true })] })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'Value', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            })\n          ],\n          tableHeader: true\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('R')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.rSquared.toFixed(3), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Adjusted R')] }),\n            new TableCell({ children: [new Paragraph({ text: data.adjustedRSquared?.toFixed(3) || '', alignment: AlignmentType.CENTER })] })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('F-statistic')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.fStatistic.toFixed(3), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('p-value')] }),\n            new TableCell({ children: [new Paragraph({ text: data.pValue < 0.001 ? '< .001' : data.pValue.toFixed(3), alignment: AlignmentType.CENTER })] })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Standard Error')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.standardError.toFixed(3), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        })\n      ],\n      width: { size: 70, type: WidthType.PERCENTAGE },\n      borders: {\n        top: { style: BorderStyle.SINGLE, size: 1 },\n        bottom: { style: BorderStyle.SINGLE, size: 1 },\n        left: { style: BorderStyle.SINGLE, size: 1 },\n        right: { style: BorderStyle.SINGLE, size: 1 },\n        insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },\n        insideVertical: { style: BorderStyle.SINGLE, size: 1 }\n      }\n    });\n    \n    items.push(modelTable);\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Note. ', italics: true }),\n          new TextRun({ text: 'R = proportion of variance explained; Adjusted R = R adjusted for sample size and number of predictors.', italics: true })\n        ],\n        spacing: { before: 100, after: 300 }\n      })\n    );\n    \n    // Regression coefficients table\n    items.push(\n      new Paragraph({\n        text: 'Table 3',\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 400, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Regression Coefficients', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 200 }\n      })\n    );\n    \n    const coeffTable = new Table({\n      rows: [\n        new TableRow({\n          children: [\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'Predictor', bold: true })] })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'B', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'SE B', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 't', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            }),\n            new TableCell({\n              children: [new Paragraph({ children: [new TextRun({ text: 'p', bold: true })], alignment: AlignmentType.CENTER })],\n              shading: { fill: \"E0E0E0\" }\n            })\n          ],\n          tableHeader: true\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('(Intercept)')], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: data.intercept.toFixed(3), alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } }),\n            new TableCell({ children: [new Paragraph({ text: '', alignment: AlignmentType.CENTER })], shading: { fill: \"F8F8F8\" } })\n          ]\n        }),\n        new TableRow({\n          children: [\n            new TableCell({ children: [new Paragraph('Predictor')] }),\n            new TableCell({ children: [new Paragraph({ text: data.slope.toFixed(3), alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: data.slopeStandardError?.toFixed(3) || '', alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: data.tStatistic?.toFixed(3) || '', alignment: AlignmentType.CENTER })] }),\n            new TableCell({ children: [new Paragraph({ text: data.pValue < 0.001 ? '< .001' : data.pValue.toFixed(3), alignment: AlignmentType.CENTER })] })\n          ]\n        })\n      ],\n      width: { size: 100, type: WidthType.PERCENTAGE },\n      borders: {\n        top: { style: BorderStyle.SINGLE, size: 1 },\n        bottom: { style: BorderStyle.SINGLE, size: 1 },\n        left: { style: BorderStyle.SINGLE, size: 1 },\n        right: { style: BorderStyle.SINGLE, size: 1 },\n        insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },\n        insideVertical: { style: BorderStyle.SINGLE, size: 1 }\n      }\n    });\n    \n    items.push(coeffTable);\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: 'Note. ', italics: true }),\n          new TextRun({ text: 'B = unstandardized regression coefficient; SE B = standard error of B; t = t-statistic for testing H: B = 0.', italics: true })\n        ],\n        spacing: { before: 100, after: 300 }\n      })\n    );\n    \n    // Narrative results\n    items.push(\n      new Paragraph({\n        text: `The regression model ${data.significant ? 'was statistically significant' : 'was not statistically significant'}, F(1, ${data.n - 2}) = ${data.fStatistic.toFixed(3)}, p ${data.significant ? '<' : '='} ${data.pValue < 0.001 ? '.001' : data.pValue.toFixed(3)}, and accounted for ${(data.rSquared * 100).toFixed(1)}% of the variance in the dependent variable (R = ${data.rSquared.toFixed(3)}). The regression equation is:  = ${data.intercept.toFixed(3)} + ${data.slope.toFixed(3)}X, with a standard error of estimate of ${data.standardError.toFixed(3)}.`,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 200 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        text: `The regression coefficient (B = ${data.slope.toFixed(3)}) indicates that for each one-unit increase in the predictor variable, the outcome variable ${data.slope > 0 ? 'increases' : 'decreases'} by ${Math.abs(data.slope).toFixed(3)} units, on average. This ${data.significant ? 'statistically significant' : 'non-significant'} relationship ${data.significant ? 'provides evidence for' : 'does not provide strong evidence for'} a predictive association between the variables.`,\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 400 }\n      })\n    );\n  } else {\n    // Fallback when data is incomplete\n    items.push(\n      new Paragraph({\n        text: 'The regression analysis was conducted, but complete statistical details are not available for reporting. Please ensure all required data (R, F-statistic, intercept, slope, standard error, and sample size) are provided for comprehensive reporting.',\n        alignment: AlignmentType.JUSTIFIED,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  if (charts.length > 0) {\n    items.push(\n      new Paragraph({\n        text: 'Figure 1',\n        alignment: AlignmentType.CENTER,\n        spacing: { before: 300, after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new ImageRun({\n            data: charts[0].buffer,\n            transformation: {\n              width: 600,\n              height: 375\n            },\n            type: 'png'\n          } as any)\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 100 }\n      })\n    );\n    \n    items.push(\n      new Paragraph({\n        children: [\n          new TextRun({ text: `${charts[0].title}. `, italics: true }),\n          new TextRun({ text: 'The regression line represents the best linear prediction of Y from X. Vertical distances from points to the line represent prediction errors (residuals). The standard error of estimate quantifies the average magnitude of these residuals.', italics: true })\n        ],\n        alignment: AlignmentType.CENTER,\n        spacing: { after: 400 }\n      })\n    );\n  }\n  \n  return items;\n}\n","size_bytes":69230},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertGameSessionSchema, selectGameSessionSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { generateBarChart, generateGroupedBarChart, generateScatterPlot } from \"./chartGenerator\";\nimport { createScientificReport, type StatisticsTable } from \"./wordDocumentGenerator\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Game Session Management Routes\n  \n  // Get all game sessions\n  app.get(\"/api/sessions\", async (req, res) => {\n    try {\n      const sessions = await storage.getAllGameSessions();\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching game sessions:\", error);\n      res.status(500).json({ error: \"Failed to fetch game sessions\" });\n    }\n  });\n\n  // Get a specific game session\n  app.get(\"/api/sessions/:sessionName\", async (req, res) => {\n    try {\n      const { sessionName } = req.params;\n      const session = await storage.getGameSession(sessionName);\n      \n      if (!session) {\n        return res.status(404).json({ error: \"Session not found\" });\n      }\n      \n      res.json(session);\n    } catch (error) {\n      console.error(\"Error fetching game session:\", error);\n      res.status(500).json({ error: \"Failed to fetch game session\" });\n    }\n  });\n\n  // Create a new game session\n  app.post(\"/api/sessions\", async (req, res) => {\n    try {\n      // Validate request body using Zod schema\n      const validationResult = insertGameSessionSchema.safeParse(req.body);\n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid session data\", \n          details: validationResult.error.errors \n        });\n      }\n\n      const { sessionName, gameState } = validationResult.data;\n      const { sessionInfo, turnStatistics, lastUpdated } = req.body;\n\n      // Check if session already exists\n      const existingSession = await storage.getGameSession(sessionName);\n      if (existingSession) {\n        return res.status(409).json({ error: \"Session with this name already exists\" });\n      }\n\n      const session = await storage.createGameSession(sessionName, gameState, sessionInfo, turnStatistics, lastUpdated);\n      res.status(201).json(session);\n    } catch (error) {\n      console.error(\"Error creating game session:\", error);\n      res.status(500).json({ error: \"Failed to create game session\" });\n    }\n  });\n\n  // Update an existing game session\n  app.put(\"/api/sessions/:sessionName\", async (req, res) => {\n    try {\n      const { sessionName } = req.params;\n      \n      // Validate request body - allow all optional fields\n      const updateSchema = insertGameSessionSchema.partial();\n      const validationResult = updateSchema.safeParse(req.body);\n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid session data\", \n          details: validationResult.error.errors \n        });\n      }\n\n      const { gameState, sessionInfo, turnStatistics, finalReport, lastUpdated } = req.body;\n      \n      // Only update if gameState is provided\n      if (!gameState) {\n        return res.status(400).json({ error: \"gameState is required for updates\" });\n      }\n\n      const session = await storage.updateGameSession(\n        sessionName, \n        gameState, \n        sessionInfo, \n        turnStatistics,\n        finalReport,\n        lastUpdated || undefined\n      );\n      res.json(session);\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"not found\")) {\n        return res.status(404).json({ error: \"Session not found\" });\n      }\n      console.error(\"Error updating game session:\", error);\n      res.status(500).json({ error: \"Failed to update game session\" });\n    }\n  });\n\n  // Delete a game session\n  app.delete(\"/api/sessions/:sessionName\", async (req, res) => {\n    try {\n      const { sessionName } = req.params;\n      const deleted = await storage.deleteGameSession(sessionName);\n      \n      if (!deleted) {\n        return res.status(404).json({ error: \"Session not found\" });\n      }\n      \n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting game session:\", error);\n      res.status(500).json({ error: \"Failed to delete game session\" });\n    }\n  });\n\n  // Generate Word document report\n  app.post(\"/api/generate-word-report\", async (req, res) => {\n    try {\n      const {\n        methodology,\n        descriptiveStats,\n        inferentialData,\n        sessionCount,\n        variableNames,\n        chartData\n      } = req.body;\n\n      if (!methodology || !descriptiveStats || !variableNames) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      // Generate charts\n      const chartBuffers: { title: string; buffer: Buffer }[] = [];\n      \n      if (chartData && Array.isArray(chartData)) {\n        for (const chart of chartData) {\n          try {\n            let buffer: Buffer;\n            \n            if (chart.type === 'bar') {\n              buffer = await generateBarChart(chart.data, chart.title);\n            } else if (chart.type === 'grouped-bar') {\n              buffer = await generateGroupedBarChart(chart.data, chart.title, chart.yLabel || 'Value');\n            } else if (chart.type === 'scatter') {\n              buffer = await generateScatterPlot(chart.data, chart.title, chart.xLabel || 'X', chart.yLabel || 'Y');\n            } else {\n              buffer = await generateBarChart(chart.data, chart.title);\n            }\n            \n            chartBuffers.push({ title: chart.title, buffer });\n          } catch (chartError) {\n            console.error(\"Error generating chart:\", chartError);\n          }\n        }\n      }\n\n      // Generate Word document\n      const docBuffer = await createScientificReport(\n        methodology,\n        descriptiveStats,\n        inferentialData,\n        chartBuffers,\n        sessionCount,\n        variableNames\n      );\n\n      // Set headers for file download\n      res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document');\n      res.setHeader('Content-Disposition', `attachment; filename=\"research-results-${methodology.replace(/\\s+/g, '-').toLowerCase()}.docx\"`);\n      res.send(docBuffer);\n    } catch (error) {\n      console.error(\"Error generating Word document:\", error);\n      res.status(500).json({ error: \"Failed to generate Word document\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","size_bytes":6586},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"client/src/components/examples/AppHeader.tsx":{"content":"import AppHeader from '../AppHeader';\n\nexport default function AppHeaderExample() {\n  return (\n    <div className=\"w-full\">\n      <AppHeader\n        currentTurn={3}\n        maxTurns={8}\n        onNewStrategy={() => console.log('New strategy')}\n        onSave={() => console.log('Save strategy')}\n        onLoad={() => { console.log('Load strategy'); return true; }}\n        onExport={() => { console.log('Export strategy'); return '{\"turn\": 3}'; }}\n        onImport={(data) => { console.log('Import strategy:', data); return true; }}\n        onConcludeStrategy={() => console.log('Conclude strategy')}\n        onSetMaxTurns={(turns) => console.log('Set max turns:', turns)}\n      />\n    </div>\n  );\n}","size_bytes":700},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/CardDisplay.tsx":{"content":"import { Card as CardType } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport DomainBadge from \"./DomainBadge\";\nimport { formatCurrency } from \"../logic/pricing\";\nimport { sanitizeText } from \"../logic/guards\";\nimport { ShoppingCart, Info, Zap, Clock } from \"lucide-react\";\n\ninterface CardDisplayProps {\n  card: CardType;\n  discountedPrice?: number;\n  onAddToCart?: () => void;\n  onViewDetails?: () => void;\n  inCart?: boolean;\n  disabled?: boolean;\n}\n\nconst cardTypeIcons = {\n  asset: <Zap className=\"w-4 h-4\" />,\n  permanent: <ShoppingCart className=\"w-4 h-4\" />,\n  expert: <Clock className=\"w-4 h-4\" />\n};\n\nconst cardTypeLabels = {\n  asset: \"Asset\",\n  permanent: \"Permanent\", \n  expert: \"Expert\"\n};\n\nexport default function CardDisplay({ \n  card, \n  discountedPrice, \n  onAddToCart, \n  onViewDetails,\n  inCart = false,\n  disabled = false \n}: CardDisplayProps) {\n  const finalPrice = discountedPrice ?? card.baseCostK;\n  const hasDiscount = discountedPrice !== undefined && discountedPrice < card.baseCostK;\n\n  return (\n    <Card \n      className={`hover-elevate transition-all ${disabled ? 'opacity-50' : ''} ${inCart ? 'ring-2 ring-primary' : ''}`}\n      data-testid={`card-${card.id}`}\n    >\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-semibold text-sm truncate\" data-testid={`text-card-name-${card.id}`}>\n              {sanitizeText(card.name)}\n            </h3>\n            <p className=\"text-xs text-muted-foreground font-mono\" data-testid={`text-card-id-${card.id}`}>\n              {card.id}\n            </p>\n          </div>\n          <DomainBadge domain={card.domain} className=\"text-xs shrink-0\" />\n        </div>\n        \n        <div className=\"flex items-center justify-between\">\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {cardTypeIcons[card.type]}\n            <span className=\"ml-1\">{sanitizeText(cardTypeLabels[card.type])}</span>\n          </Badge>\n          \n          <div className=\"text-right\">\n            {hasDiscount && (\n              <div className=\"text-xs text-muted-foreground line-through\">\n                {formatCurrency(card.baseCostK)}\n              </div>\n            )}\n            <div className={`font-semibold ${hasDiscount ? 'text-green-600' : ''}`} data-testid={`text-price-${card.id}`}>\n              {formatCurrency(finalPrice)}\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"pt-0\">\n        <div className=\"flex gap-2\">\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={onViewDetails}\n            className=\"flex-1\"\n            data-testid={`button-view-details-${card.id}`}\n          >\n            <Info className=\"w-3 h-3 mr-1\" />\n            Details\n          </Button>\n          \n          {onAddToCart && (\n            <Button\n              size=\"sm\"\n              onClick={onAddToCart}\n              disabled={disabled || inCart}\n              className=\"flex-1\"\n              data-testid={`button-add-cart-${card.id}`}\n            >\n              <ShoppingCart className=\"w-3 h-3 mr-1\" />\n              {inCart ? 'In Cart' : 'Add'}\n            </Button>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":3478},"client/src/utils/questionAnswerer.ts":{"content":"import type { SessionData } from \"./sessionAnalyzer\";\n\ninterface Message {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: Date;\n}\n\ntype Domain = 'joint' | 'economy' | 'cognitive' | 'space' | 'cyber';\n\nfunction determineWinner(gameState: any): 'NATO' | 'Russia' | null {\n  if (gameState.turn < gameState.maxTurns) {\n    return null;\n  }\n  \n  const natoScore = gameState.teams.NATO.totalDeterrence;\n  const russiaScore = gameState.teams.Russia.totalDeterrence;\n  \n  if (natoScore > russiaScore) return 'NATO';\n  if (russiaScore > natoScore) return 'Russia';\n  return null;\n}\n\nexport function answerQuestion(question: string, sessions: SessionData[]): string {\n  const lowerQuestion = question.toLowerCase();\n\n  if (sessions.length === 0) {\n    return \"Please select at least one game session to analyze. Once you've selected sessions, I can answer questions based on the actual data from those games.\";\n  }\n\n  // Winner analysis\n  if (lowerQuestion.includes('who won') || lowerQuestion.includes('winner')) {\n    const winners = sessions.map(s => ({\n      name: s.sessionName,\n      winner: determineWinner(s.gameState)\n    }));\n    \n    const natoWins = winners.filter(w => w.winner === 'NATO').length;\n    const russiaWins = winners.filter(w => w.winner === 'Russia').length;\n    const ties = winners.filter(w => w.winner === null).length;\n    \n    let response = `Based on ${sessions.length} selected session${sessions.length > 1 ? 's' : ''}:\\n\\n`;\n    response += ` NATO victories: ${natoWins}\\n`;\n    response += ` Russia victories: ${russiaWins}\\n`;\n    response += ` Incomplete/Tied: ${ties}\\n\\n`;\n    \n    if (natoWins > 0 || russiaWins > 0) {\n      response += `Win rate: NATO ${Math.round(natoWins / Math.max(natoWins + russiaWins, 1) * 100)}% vs Russia ${Math.round(russiaWins / Math.max(natoWins + russiaWins, 1) * 100)}%`;\n    }\n    \n    return response;\n  }\n\n  // Score analysis\n  if (lowerQuestion.includes('score') || lowerQuestion.includes('deterrence')) {\n    const completedSessions = sessions.filter(s => determineWinner(s.gameState) !== null);\n    \n    if (completedSessions.length === 0) {\n      return \"None of the selected sessions are completed yet. Final scores are only available for finished games.\";\n    }\n    \n    const natoScores = completedSessions.map(s => s.gameState.teams.NATO.totalDeterrence);\n    const russiaScores = completedSessions.map(s => s.gameState.teams.Russia.totalDeterrence);\n    \n    const avgNATO = natoScores.reduce((a, b) => a + b, 0) / natoScores.length;\n    const avgRussia = russiaScores.reduce((a, b) => a + b, 0) / russiaScores.length;\n    \n    const maxNATO = Math.max(...natoScores);\n    const maxRussia = Math.max(...russiaScores);\n    \n    let response = `Deterrence scores across ${completedSessions.length} completed session${completedSessions.length > 1 ? 's' : ''}:\\n\\n`;\n    response += `NATO:\\n`;\n    response += ` Average: ${Math.round(avgNATO)}\\n`;\n    response += ` Highest: ${maxNATO}\\n\\n`;\n    response += `Russia:\\n`;\n    response += ` Average: ${Math.round(avgRussia)}\\n`;\n    response += ` Highest: ${maxRussia}\\n\\n`;\n    response += `Average margin: ${Math.abs(Math.round(avgNATO - avgRussia))} points`;\n    \n    return response;\n  }\n\n  // Domain analysis\n  const domains: Domain[] = ['joint', 'economy', 'cognitive', 'space', 'cyber'];\n  const mentionedDomain = domains.find(d => lowerQuestion.includes(d));\n  \n  if (mentionedDomain || lowerQuestion.includes('domain')) {\n    const completedSessions = sessions.filter(s => determineWinner(s.gameState) !== null);\n    \n    if (completedSessions.length === 0) {\n      return \"None of the selected sessions are completed yet. Domain analysis requires finished games.\";\n    }\n    \n    if (mentionedDomain) {\n      const natoScores = completedSessions.map(s => s.gameState.teams.NATO.deterrence[mentionedDomain]);\n      const russiaScores = completedSessions.map(s => s.gameState.teams.Russia.deterrence[mentionedDomain]);\n      \n      const avgNATO = natoScores.reduce((a, b) => a + b, 0) / natoScores.length;\n      const avgRussia = russiaScores.reduce((a, b) => a + b, 0) / russiaScores.length;\n      \n      return `${mentionedDomain.charAt(0).toUpperCase() + mentionedDomain.slice(1)} domain performance across ${completedSessions.length} completed session${completedSessions.length > 1 ? 's' : ''}:\\n\\n` +\n        ` NATO average: ${Math.round(avgNATO)}\\n` +\n        ` Russia average: ${Math.round(avgRussia)}\\n` +\n        ` Advantage: ${avgNATO > avgRussia ? 'NATO' : 'Russia'} by ${Math.abs(Math.round(avgNATO - avgRussia))} points`;\n    }\n    \n    // All domains\n    let response = `Domain performance across ${completedSessions.length} completed session${completedSessions.length > 1 ? 's' : ''}:\\n\\n`;\n    \n    domains.forEach(domain => {\n      const natoAvg = completedSessions.reduce((sum, s) => sum + s.gameState.teams.NATO.deterrence[domain], 0) / completedSessions.length;\n      const russiaAvg = completedSessions.reduce((sum, s) => sum + s.gameState.teams.Russia.deterrence[domain], 0) / completedSessions.length;\n      \n      response += `${domain.charAt(0).toUpperCase() + domain.slice(1)}:\\n`;\n      response += `  NATO: ${Math.round(natoAvg)} | Russia: ${Math.round(russiaAvg)}\\n`;\n    });\n    \n    return response;\n  }\n\n  // Budget analysis\n  if (lowerQuestion.includes('budget') || lowerQuestion.includes('spending')) {\n    const avgNATOBudget = sessions.reduce((sum, s) => sum + s.gameState.teams.NATO.budget, 0) / sessions.length;\n    const avgRussiaBudget = sessions.reduce((sum, s) => sum + s.gameState.teams.Russia.budget, 0) / sessions.length;\n    \n    return `Budget status across ${sessions.length} session${sessions.length > 1 ? 's' : ''}:\\n\\n` +\n      ` NATO average remaining: ${Math.round(avgNATOBudget)}K\\n` +\n      ` Russia average remaining: ${Math.round(avgRussiaBudget)}K\\n\\n` +\n      `Note: Lower budgets indicate more aggressive spending strategies.`;\n  }\n\n  // Card analysis\n  if (lowerQuestion.includes('card') || lowerQuestion.includes('permanent')) {\n    const avgNATOPermanents = sessions.reduce((sum, s) => sum + s.gameState.teams.NATO.ownedPermanents.length, 0) / sessions.length;\n    const avgRussiaPermanents = sessions.reduce((sum, s) => sum + s.gameState.teams.Russia.ownedPermanents.length, 0) / sessions.length;\n    \n    const avgNATOPurchases = sessions.reduce((sum, s) => sum + (s.gameState.teams.NATO.recentPurchases?.length || 0), 0) / sessions.length;\n    const avgRussiaPurchases = sessions.reduce((sum, s) => sum + (s.gameState.teams.Russia.recentPurchases?.length || 0), 0) / sessions.length;\n    \n    return `Card purchase patterns across ${sessions.length} session${sessions.length > 1 ? 's' : ''}:\\n\\n` +\n      `NATO:\\n` +\n      ` Average permanent cards: ${avgNATOPermanents.toFixed(1)}\\n` +\n      ` Average total purchases: ${avgNATOPurchases.toFixed(1)}\\n\\n` +\n      `Russia:\\n` +\n      ` Average permanent cards: ${avgRussiaPermanents.toFixed(1)}\\n` +\n      ` Average total purchases: ${avgRussiaPurchases.toFixed(1)}`;\n  }\n\n  // Turn analysis\n  if (lowerQuestion.includes('turn') || lowerQuestion.includes('how long')) {\n    const avgTurn = sessions.reduce((sum, s) => sum + s.gameState.turn, 0) / sessions.length;\n    const completedSessions = sessions.filter(s => s.gameState.turn >= s.gameState.maxTurns);\n    \n    return `Turn progression across ${sessions.length} session${sessions.length > 1 ? 's' : ''}:\\n\\n` +\n      ` Average current turn: ${avgTurn.toFixed(1)}\\n` +\n      ` Completed sessions: ${completedSessions.length}\\n` +\n      ` In progress: ${sessions.length - completedSessions.length}`;\n  }\n\n  // Team comparison\n  if (lowerQuestion.includes('compare') || lowerQuestion.includes('difference') || lowerQuestion.includes('vs')) {\n    const completedSessions = sessions.filter(s => determineWinner(s.gameState) !== null);\n    \n    if (completedSessions.length === 0) {\n      return \"Please select completed sessions for team comparison analysis.\";\n    }\n    \n    const natoWins = completedSessions.filter(s => determineWinner(s.gameState) === 'NATO').length;\n    const russiaWins = completedSessions.filter(s => determineWinner(s.gameState) === 'Russia').length;\n    \n    const avgNATOScore = completedSessions.reduce((sum, s) => sum + s.gameState.teams.NATO.totalDeterrence, 0) / completedSessions.length;\n    const avgRussiaScore = completedSessions.reduce((sum, s) => sum + s.gameState.teams.Russia.totalDeterrence, 0) / completedSessions.length;\n    \n    return `NATO vs Russia comparison (${completedSessions.length} completed sessions):\\n\\n` +\n      `Victories:\\n` +\n      ` NATO: ${natoWins} (${Math.round(natoWins / completedSessions.length * 100)}%)\\n` +\n      ` Russia: ${russiaWins} (${Math.round(russiaWins / completedSessions.length * 100)}%)\\n\\n` +\n      `Average Total Deterrence:\\n` +\n      ` NATO: ${Math.round(avgNATOScore)}\\n` +\n      ` Russia: ${Math.round(avgRussiaScore)}\\n` +\n      ` Difference: ${Math.abs(Math.round(avgNATOScore - avgRussiaScore))} points`;\n  }\n\n  // Session list\n  if (lowerQuestion.includes('session') && (lowerQuestion.includes('list') || lowerQuestion.includes('show'))) {\n    let response = `You have selected ${sessions.length} session${sessions.length > 1 ? 's' : ''}:\\n\\n`;\n    sessions.forEach((s, i) => {\n      const winner = determineWinner(s.gameState);\n      response += `${i + 1}. ${s.sessionName}\\n`;\n      response += `   Turn ${s.gameState.turn}/${s.gameState.maxTurns}`;\n      if (winner) {\n        response += ` - Winner: ${winner}`;\n      }\n      response += '\\n';\n    });\n    return response;\n  }\n\n  // Default response with suggestions\n  return `I can answer questions about the ${sessions.length} selected session${sessions.length > 1 ? 's' : ''} based on actual game data. Try asking:\\n\\n` +\n    ` \"Who won the games?\"\\n` +\n    ` \"What were the final scores?\"\\n` +\n    ` \"How did teams perform in the economy domain?\"\\n` +\n    ` \"What's the average budget remaining?\"\\n` +\n    ` \"How many cards were purchased?\"\\n` +\n    ` \"Compare NATO vs Russia\"\\n` +\n    ` \"Show me the session list\"\\n\\n` +\n    `All answers are based on real data from your selected sessions.`;\n}\n\nexport type { Message };\n","size_bytes":10286},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/MobileFooter.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ShoppingCart, SkipForward, Users, Target } from \"lucide-react\";\nimport { useMDDSStore } from '../state/store';\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n\nexport default function MobileFooter() {\n  const isMobile = useIsMobile();\n  const store = useMDDSStore();\n  \n  if (!isMobile) return null;\n\n  const natoState = store.teams.NATO;\n  const russiaState = store.teams.Russia;\n  const natoCartCount = natoState.cart.length;\n  const russiaCartCount = russiaState.cart.length;\n\n  const scrollToSection = (selector: string) => {\n    const element = document.querySelector(selector);\n    if (element) {\n      element.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n  };\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-background/95 backdrop-blur border-t border-border z-50 md:hidden\">\n      <div className=\"flex items-center justify-around p-2\">\n        {/* NATO Cart */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"flex-1 flex flex-col items-center gap-1 py-2 px-1 h-auto text-blue-600\"\n          onClick={() => scrollToSection('[data-testid=\"cart-nato\"]')}\n          data-testid=\"footer-nato-cart\"\n        >\n          <div className=\"relative\">\n            <ShoppingCart className=\"w-4 h-4\" />\n            {natoCartCount > 0 && (\n              <Badge className=\"absolute -top-2 -right-2 bg-blue-600 text-white text-xs w-5 h-5 p-0 flex items-center justify-center\">\n                {natoCartCount}\n              </Badge>\n            )}\n          </div>\n          <span className=\"text-xs\">NATO</span>\n        </Button>\n\n        {/* Russia Cart */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"flex-1 flex flex-col items-center gap-1 py-2 px-1 h-auto text-red-600\"\n          onClick={() => scrollToSection('[data-testid=\"cart-russia\"]')}\n          data-testid=\"footer-russia-cart\"\n        >\n          <div className=\"relative\">\n            <ShoppingCart className=\"w-4 h-4\" />\n            {russiaCartCount > 0 && (\n              <Badge className=\"absolute -top-2 -right-2 bg-red-600 text-white text-xs w-5 h-5 p-0 flex items-center justify-center\">\n                {russiaCartCount}\n              </Badge>\n            )}\n          </div>\n          <span className=\"text-xs\">Russia</span>\n        </Button>\n\n        {/* Teams Status */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"flex-1 flex flex-col items-center gap-1 py-2 px-1 h-auto\"\n          onClick={() => scrollToSection('.glass-panel')}\n          data-testid=\"footer-teams\"\n        >\n          <Users className=\"w-4 h-4\" />\n          <span className=\"text-xs\">Teams</span>\n        </Button>\n\n        {/* Deterrence */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"flex-1 flex flex-col items-center gap-1 py-2 px-1 h-auto\"\n          onClick={() => scrollToSection('[data-testid=\"deterrence-chart\"]')}\n          data-testid=\"footer-deterrence\"\n        >\n          <Target className=\"w-4 h-4\" />\n          <span className=\"text-xs\">Chart</span>\n        </Button>\n\n        {/* Finish Turn */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"flex-1 flex flex-col items-center gap-1 py-2 px-1 h-auto\"\n          onClick={() => {\n            store.advanceGameTurn();\n            store.saveToLocalStorage();\n          }}\n          data-testid=\"footer-finish-turn\"\n        >\n          <SkipForward className=\"w-4 h-4\" />\n          <span className=\"text-xs\">Turn</span>\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {store.turn}/{store.maxTurns}\n          </Badge>\n        </Button>\n      </div>\n    </div>\n  );\n}","size_bytes":3811},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/DefenseOffenseChart.tsx":{"content":"import { useState } from 'react';\nimport { ChevronDown, ChevronUp, Shield, Sword, Eye, EyeOff, ZoomIn } from 'lucide-react';\nimport { Dialog, DialogContent, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { useMDDSStore } from '@/state/store';\nimport { LineChart as RechartsLineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\nimport { Domain, Card } from '@shared/schema';\nimport cardsData from '../data/cards.json';\n\nconst domainColors = {\n  joint: { color: '#9CA3AF', textClass: 'text-gray-500' },\n  economy: { color: '#10B981', textClass: 'text-green-500' },\n  cognitive: { color: '#8B5CF6', textClass: 'text-purple-500' },\n  space: { color: '#3B82F6', textClass: 'text-blue-500' },\n  cyber: { color: '#F59E0B', textClass: 'text-yellow-500' }\n} as const;\n\ninterface IndividualChartProps {\n  title: string;\n  team: 'NATO' | 'Russia';\n  type: 'Defense' | 'Offense';\n  data: any[];\n  visibleDomains: Record<Domain, boolean>;\n  onToggleDomain: (domain: Domain) => void;\n  bgClass: string;\n  chartAnalysis: string;\n  onAnalysisChange: (value: string) => void;\n}\n\nfunction IndividualChart({ title, team, type, data, visibleDomains, onToggleDomain, bgClass, chartAnalysis, onAnalysisChange }: IndividualChartProps) {\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"glass-panel p-3 border border-border/50\">\n          <p className=\"font-semibold mb-2\">{`Turn ${label}`}</p>\n          {payload.map((entry: any, index: number) => {\n            const domain = entry.dataKey;\n            const color = domainColors[domain as Domain]?.color || '#666';\n            const Icon = type === 'Defense' ? Shield : Sword;\n            return (\n              <p key={index} style={{ color }} className=\"flex items-center gap-1\">\n                <Icon className=\"w-3 h-3\" />\n                {domain}: {entry.value}\n              </p>\n            );\n          })}\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className={`${bgClass} p-4 rounded-lg border border-border/50`}>\n      <div className=\"flex items-center justify-between mb-3\">\n        <h4 className=\"font-semibold text-sm\">{title}</h4>\n        <div className=\"flex items-center gap-2\">\n          <Dialog>\n            <DialogTrigger asChild>\n              <button\n                className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-md border border-border/50 hover-elevate transition-all\"\n                data-testid={`button-zoom-${team.toLowerCase()}-${type.toLowerCase()}`}\n              >\n                <ZoomIn className=\"w-3 h-3\" />\n                Expand\n              </button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-7xl w-[90vw] max-h-[90vh] overflow-y-auto\">\n              <DialogTitle className=\"text-center\">{title}</DialogTitle>\n              \n              {/* Chart Explanation */}\n              <div className=\"mt-4 p-4 bg-muted/30 rounded-lg border border-border/50\">\n                <h4 className=\"font-semibold text-sm mb-2\">Chart Explanation</h4>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  {type === 'Defense' \n                    ? `This chart displays ${team}'s defensive strategy effectiveness across five domains (Joint, Economy, Cognitive, Space, Cyber). Each line represents the cumulative positive effects from cards purchased to strengthen ${team}'s own deterrence capabilities in that specific domain. Higher values indicate stronger defensive positioning in that domain during that turn.`\n                    : `This chart shows ${team}'s offensive strategy impact on the opponent across five domains. Each line tracks the cumulative negative effects inflicted on the opponent's deterrence through ${team}'s card purchases. Values below zero indicate successful offensive actions that weakened the opponent's position in that domain during that turn.`\n                  }\n                </p>\n              </div>\n\n              {/* Chart */}\n              <div className=\"mt-4\">\n                <ResponsiveContainer width=\"100%\" height={450}>\n                  <RechartsLineChart data={data} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--muted-foreground) / 0.2)\" />\n                    <XAxis \n                      dataKey=\"turn\" \n                      stroke=\"hsl(var(--muted-foreground))\"\n                      tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                    />\n                    <YAxis \n                      stroke=\"hsl(var(--muted-foreground))\"\n                      tick={{ fill: 'hsl(var(--muted-foreground))' }}\n                    />\n                    <Tooltip content={<CustomTooltip />} />\n                    {(Object.keys(domainColors) as Domain[]).map(domain => {\n                      if (!visibleDomains[domain]) return null;\n                      return (\n                        <Line\n                          key={domain}\n                          type=\"monotone\"\n                          dataKey={domain}\n                          stroke={domainColors[domain].color}\n                          name={domain}\n                          strokeWidth={3}\n                          dot={{ r: 5 }}\n                          activeDot={{ r: 7 }}\n                        />\n                      );\n                    })}\n                  </RechartsLineChart>\n                </ResponsiveContainer>\n              </div>\n\n              {/* User Analysis Input */}\n              <div className=\"mt-4 space-y-2\">\n                <Label htmlFor=\"chart-analysis\" className=\"text-sm font-semibold\">\n                  Your Analysis: What does this chart tell you?\n                </Label>\n                <Textarea\n                  id=\"chart-analysis\"\n                  placeholder=\"Write your interpretation of what this chart reveals about the strategic patterns, trends, and decision-making...\"\n                  value={chartAnalysis}\n                  onChange={(e) => onAnalysisChange(e.target.value)}\n                  className=\"min-h-[100px] resize-y\"\n                  data-testid={`textarea-chart-analysis-${team.toLowerCase()}-${type.toLowerCase()}`}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Tip: Consider domain strengths, turn-by-turn changes, strategic focus areas, and how this compares to opponent activity.\n                </p>\n              </div>\n            </DialogContent>\n          </Dialog>\n          <div className=\"flex gap-1\">\n            {(Object.keys(domainColors) as Domain[]).map(domain => (\n              <button\n                key={domain}\n                onClick={() => onToggleDomain(domain)}\n                className={`w-3 h-3 rounded-full transition-opacity ${\n                  visibleDomains[domain] ? 'opacity-100' : 'opacity-30'\n                }`}\n                style={{ backgroundColor: domainColors[domain].color }}\n                title={`Toggle ${domain}`}\n                data-testid={`toggle-${team.toLowerCase()}-${type.toLowerCase()}-${domain}`}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"h-48\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <RechartsLineChart data={data} margin={{ top: 5, right: 10, left: 10, bottom: 5 }}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--muted-foreground) / 0.2)\" />\n            <XAxis \n              dataKey=\"turn\" \n              stroke=\"hsl(var(--muted-foreground))\"\n              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n              fontSize={10}\n            />\n            <YAxis \n              stroke=\"hsl(var(--muted-foreground))\"\n              tick={{ fill: 'hsl(var(--muted-foreground))' }}\n              fontSize={10}\n            />\n            <Tooltip content={<CustomTooltip />} />\n            \n            {(Object.keys(domainColors) as Domain[]).map(domain => {\n              if (!visibleDomains[domain]) return null;\n              const color = domainColors[domain].color;\n              return (\n                <Line\n                  key={domain}\n                  type=\"monotone\"\n                  dataKey={domain}\n                  stroke={color}\n                  strokeWidth={2}\n                  dot={{ fill: color, strokeWidth: 1, r: 2 }}\n                  name={domain}\n                />\n              );\n            })}\n          </RechartsLineChart>\n        </ResponsiveContainer>\n      </div>\n    </div>\n  );\n}\n\ninterface DefenseOffenseChartProps {\n  forceExpanded?: boolean;\n  hideToggle?: boolean;\n}\n\nexport default function DefenseOffenseChart({ forceExpanded = false, hideToggle = false }: DefenseOffenseChartProps = {}) {\n  const [isExpanded, setIsExpanded] = useState(forceExpanded);\n  const [visibleDomains, setVisibleDomains] = useState<Record<Domain, boolean>>({\n    joint: true,\n    economy: true,\n    cognitive: true,\n    space: true,\n    cyber: true\n  });\n  \n  // Chart analysis state for each of the 4 charts\n  const [natoDefenseAnalysis, setNatoDefenseAnalysis] = useState('');\n  const [natoOffenseAnalysis, setNatoOffenseAnalysis] = useState('');\n  const [russiaDefenseAnalysis, setRussiaDefenseAnalysis] = useState('');\n  const [russiaOffenseAnalysis, setRussiaOffenseAnalysis] = useState('');\n  \n  const turnStatistics = useMDDSStore(state => state.turnStatistics);\n  const strategyLog = useMDDSStore(state => state.strategyLog);\n  \n  const cards = cardsData as Card[];\n\n  const toggleExpanded = () => setIsExpanded(!isExpanded);\n  \n  const toggleDomainVisibility = (domain: Domain) => {\n    setVisibleDomains(prev => ({\n      ...prev,\n      [domain]: !prev[domain]\n    }));\n  };\n\n  // Only show if we have 2+ turns of data\n  if (turnStatistics.length < 2) {\n    return null;\n  }\n\n  // Calculate team's offensive effects on opponent's dimensions for each turn\n  const calculateOffensiveEffects = (attackingTeam: 'NATO' | 'Russia') => {\n    const effectsByTurn: Record<number, Record<Domain, number>> = {};\n    \n    // Initialize all turns with zero effects\n    turnStatistics.forEach(stat => {\n      effectsByTurn[stat.turn] = {\n        joint: 0,\n        economy: 0,\n        cognitive: 0,\n        space: 0,\n        cyber: 0\n      };\n    });\n    \n    // Process strategy log to find team card purchases\n    strategyLog.forEach(logEntry => {\n      if (logEntry.team === attackingTeam && logEntry.action.includes('purchased')) {\n        // Extract card ID from the action string (format: \"TEAM purchased CardName (ID) for XK\")\n        const cardIdMatch = logEntry.action.match(/\\(([^)]+)\\)/);\n        if (cardIdMatch) {\n          const cardId = cardIdMatch[1];\n          const card = cards.find(c => c.id === cardId);\n          \n          if (card && card.effects) {\n            // Sum effects on opponent (keep negative values to show below zero line)\n            card.effects.forEach(effect => {\n              if (effect.target === 'opponent') {\n                // Keep negative effects as negative to show offensive impact below zero\n                effectsByTurn[logEntry.turn][effect.domain] += effect.delta;\n              }\n            });\n          }\n        }\n      }\n    });\n    \n    return effectsByTurn;\n  };\n  \n  const natoOffensiveEffects = calculateOffensiveEffects('NATO');\n  const russiaOffensiveEffects = calculateOffensiveEffects('Russia');\n  \n  // Calculate team's defensive effects (self-targeting positive effects) for each turn\n  const calculateDefensiveEffects = (defendingTeam: 'NATO' | 'Russia') => {\n    const effectsByTurn: Record<number, Record<Domain, number>> = {};\n    \n    // Initialize all turns with zero effects\n    turnStatistics.forEach(stat => {\n      effectsByTurn[stat.turn] = {\n        joint: 0,\n        economy: 0,\n        cognitive: 0,\n        space: 0,\n        cyber: 0\n      };\n    });\n    \n    // Process strategy log to find team card purchases\n    strategyLog.forEach(logEntry => {\n      if (logEntry.team === defendingTeam && logEntry.action.includes('purchased')) {\n        // Extract card ID from the action string (format: \"TEAM purchased CardName (ID) for XK\")\n        const cardIdMatch = logEntry.action.match(/\\(([^)]+)\\)/);\n        if (cardIdMatch) {\n          const cardId = cardIdMatch[1];\n          const card = cards.find(c => c.id === cardId);\n          \n          if (card && card.effects) {\n            // Sum positive effects on self (defensive)\n            card.effects.forEach(effect => {\n              if (effect.target === 'self' && effect.delta > 0) {\n                effectsByTurn[logEntry.turn][effect.domain] += effect.delta;\n              }\n            });\n          }\n        }\n      }\n    });\n    \n    return effectsByTurn;\n  };\n  \n  const natoDefensiveEffects = calculateDefensiveEffects('NATO');\n  const russiaDefensiveEffects = calculateDefensiveEffects('Russia');\n  \n  // Prepare data for NATO Defensive chart (showing self-effects)\n  const natoDefenseData = turnStatistics.map(stat => ({\n    turn: stat.turn,\n    joint: natoDefensiveEffects[stat.turn]?.joint || 0,\n    economy: natoDefensiveEffects[stat.turn]?.economy || 0,\n    cognitive: natoDefensiveEffects[stat.turn]?.cognitive || 0,\n    space: natoDefensiveEffects[stat.turn]?.space || 0,\n    cyber: natoDefensiveEffects[stat.turn]?.cyber || 0\n  }));\n  \n  // Prepare data for NATO Offensive chart (showing effects on Russia)\n  const natoOffenseData = turnStatistics.map(stat => ({\n    turn: stat.turn,\n    joint: natoOffensiveEffects[stat.turn]?.joint || 0,\n    economy: natoOffensiveEffects[stat.turn]?.economy || 0,\n    cognitive: natoOffensiveEffects[stat.turn]?.cognitive || 0,\n    space: natoOffensiveEffects[stat.turn]?.space || 0,\n    cyber: natoOffensiveEffects[stat.turn]?.cyber || 0\n  }));\n\n  // Prepare data for Russia Defensive chart (showing self-effects)\n  const russiaDefenseData = turnStatistics.map(stat => ({\n    turn: stat.turn,\n    joint: russiaDefensiveEffects[stat.turn]?.joint || 0,\n    economy: russiaDefensiveEffects[stat.turn]?.economy || 0,\n    cognitive: russiaDefensiveEffects[stat.turn]?.cognitive || 0,\n    space: russiaDefensiveEffects[stat.turn]?.space || 0,\n    cyber: russiaDefensiveEffects[stat.turn]?.cyber || 0\n  }));\n\n  // Prepare data for Russia Offensive chart (showing effects on NATO)\n  const russiaOffenseData = turnStatistics.map(stat => ({\n    turn: stat.turn,\n    joint: russiaOffensiveEffects[stat.turn]?.joint || 0,\n    economy: russiaOffensiveEffects[stat.turn]?.economy || 0,\n    cognitive: russiaOffensiveEffects[stat.turn]?.cognitive || 0,\n    space: russiaOffensiveEffects[stat.turn]?.space || 0,\n    cyber: russiaOffensiveEffects[stat.turn]?.cyber || 0\n  }));\n\n  const shouldShowContent = forceExpanded || isExpanded || hideToggle;\n\n  return (\n    <div className=\"space-y-3\">\n      {!hideToggle && (\n        <button\n          onClick={toggleExpanded}\n          className=\"w-full flex items-center justify-between p-3 glass-panel hover-elevate transition-all duration-300 text-left\"\n          data-testid=\"button-toggle-defense-offense-chart\"\n        >\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex items-center gap-1\">\n              <Shield className=\"w-4 h-4 text-blue-500\" />\n              <Sword className=\"w-4 h-4 text-red-500\" />\n            </div>\n            <h3 className=\"font-semibold\">Defensive/Offensive Statistics Chart</h3>\n            <span className=\"text-sm text-muted-foreground\">\n              (Four interactive domain charts)\n            </span>\n          </div>\n          {isExpanded ? (\n            <ChevronUp className=\"w-4 h-4 text-muted-foreground\" />\n          ) : (\n            <ChevronDown className=\"w-4 h-4 text-muted-foreground\" />\n          )}\n        </button>\n      )}\n      \n      {shouldShowContent && (\n        <div className=\"space-y-4\">\n          {/* Global Domain Controls */}\n          <div className=\"p-3 glass-panel\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <span className=\"text-sm font-medium\">Dimensional Visibility:</span>\n            </div>\n            <div className=\"flex flex-wrap gap-2\">\n              {(Object.keys(domainColors) as Domain[]).map(domain => (\n                <button\n                  key={domain}\n                  onClick={() => toggleDomainVisibility(domain)}\n                  className={`flex items-center gap-1 px-3 py-1 text-xs rounded-md transition-colors ${\n                    visibleDomains[domain]\n                      ? `${domainColors[domain].textClass} bg-current/20`\n                      : 'bg-secondary/50 text-muted-foreground'\n                  }`}\n                  data-testid={`button-toggle-global-domain-${domain}`}\n                >\n                  {visibleDomains[domain] ? <Eye className=\"w-3 h-3\" /> : <EyeOff className=\"w-3 h-3\" />}\n                  {domain.charAt(0).toUpperCase() + domain.slice(1)}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Four Chart Grid */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n            {/* NATO Defense Chart */}\n            <IndividualChart\n              title=\"NATO Defensive Effects\"\n              team=\"NATO\"\n              type=\"Defense\"\n              data={natoDefenseData}\n              visibleDomains={visibleDomains}\n              onToggleDomain={toggleDomainVisibility}\n              bgClass=\"bg-blue-50/5 dark:bg-blue-950/20\"\n              chartAnalysis={natoDefenseAnalysis}\n              onAnalysisChange={setNatoDefenseAnalysis}\n            />\n            \n            {/* NATO Offense Chart */}\n            <IndividualChart\n              title=\"NATO Offensive Effects on Russia\"\n              team=\"NATO\"\n              type=\"Offense\"\n              data={natoOffenseData}\n              visibleDomains={visibleDomains}\n              onToggleDomain={toggleDomainVisibility}\n              bgClass=\"bg-blue-50/5 dark:bg-blue-950/20\"\n              chartAnalysis={natoOffenseAnalysis}\n              onAnalysisChange={setNatoOffenseAnalysis}\n            />\n            \n            {/* Russia Offense Chart */}\n            <IndividualChart\n              title=\"Russia Offensive Effects on NATO\"\n              team=\"Russia\"\n              type=\"Offense\"\n              data={russiaOffenseData}\n              visibleDomains={visibleDomains}\n              onToggleDomain={toggleDomainVisibility}\n              bgClass=\"bg-red-50/5 dark:bg-red-950/20\"\n              chartAnalysis={russiaOffenseAnalysis}\n              onAnalysisChange={setRussiaOffenseAnalysis}\n            />\n            \n            {/* Russia Defense Chart */}\n            <IndividualChart\n              title=\"Russia Defensive Effects\"\n              team=\"Russia\"\n              type=\"Defense\"\n              data={russiaDefenseData}\n              visibleDomains={visibleDomains}\n              onToggleDomain={toggleDomainVisibility}\n              bgClass=\"bg-red-50/5 dark:bg-red-950/20\"\n              chartAnalysis={russiaDefenseAnalysis}\n              onAnalysisChange={setRussiaDefenseAnalysis}\n            />\n          </div>\n          \n          {/* Legend */}\n          <div className=\"text-xs text-muted-foreground p-3 glass-panel\">\n            <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n              {(Object.entries(domainColors) as [Domain, typeof domainColors[Domain]][]).map(([domain, config]) => (\n                <div key={domain} className=\"flex items-center justify-center gap-1\">\n                  <div \n                    className=\"w-3 h-3 rounded-full\" \n                    style={{ backgroundColor: config.color }}\n                  />\n                  <span className={config.textClass}>{domain.charAt(0).toUpperCase() + domain.slice(1)}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":20131},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/examples/CardDetailModal.tsx":{"content":"import { useState } from 'react';\nimport { Button } from \"@/components/ui/button\";\nimport CardDetailModal from '../CardDetailModal';\nimport { Card } from '@shared/schema';\n\nexport default function CardDetailModalExample() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState<Card | null>(null);\n\n  const sampleAssetCard: Card = {\n    id: \"J1\",\n    name: \"Strategic Command Center\",\n    domain: \"joint\",\n    type: \"asset\",\n    baseCostK: 150,\n    effects: [\n      { target: \"self\", domain: \"joint\", delta: 15 },\n      { target: \"opponent\", domain: \"joint\", delta: -5 }\n    ]\n  };\n\n  const samplePermanentCard: Card = {\n    id: \"E2\",\n    name: \"Trade Alliance Network\",\n    domain: \"economy\",\n    type: \"permanent\",\n    baseCostK: 180,\n    permanentMods: {\n      flatDiscountK: 50,\n      appliesToCardIds: [\"E5\", \"E7\", \"J4\"]\n    }\n  };\n\n  const sampleExpertCard: Card = {\n    id: \"CG3\",\n    name: \"Information Warfare Specialist\",\n    domain: \"cognitive\",\n    type: \"expert\",\n    baseCostK: 100,\n    expertInfo: \"Provides strategic insights on information campaigns and cognitive influence strategies across multiple domains.\"\n  };\n\n  const openModal = (card: Card) => {\n    setSelectedCard(card);\n    setIsOpen(true);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex gap-2 flex-wrap\">\n        <Button onClick={() => openModal(sampleAssetCard)}>\n          View Asset Card\n        </Button>\n        <Button onClick={() => openModal(samplePermanentCard)}>\n          View Permanent Card  \n        </Button>\n        <Button onClick={() => openModal(sampleExpertCard)}>\n          View Expert Card\n        </Button>\n      </div>\n\n      <CardDetailModal\n        card={selectedCard}\n        isOpen={isOpen}\n        onClose={() => setIsOpen(false)}\n        onAddToCart={() => console.log('Added to cart:', selectedCard?.id)}\n        discountedPrice={selectedCard?.id === 'E2' ? 130 : undefined}\n      />\n    </div>\n  );\n}","size_bytes":1984},"client/src/components/Statistics.tsx":{"content":"import { useState } from 'react';\nimport { ChevronDown, ChevronUp, BarChart3, TrendingUp, Shield, Sword } from 'lucide-react';\nimport { useMDDSStore } from '@/state/store';\nimport DefenseOffenseChart from './DefenseOffenseChart';\n\nconst domainColors = {\n  joint: 'text-gray-500',\n  economy: 'text-green-500',\n  cognitive: 'text-purple-500',\n  space: 'text-blue-500',\n  cyber: 'text-yellow-500'\n} as const;\n\nexport default function TurnBasedLogs() {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [isPurchaseLogsExpanded, setIsPurchaseLogsExpanded] = useState(false);\n  const [activeSection, setActiveSection] = useState<'overall' | 'dimension' | 'defense' | null>(null);\n  const turnStatistics = useMDDSStore(state => state.turnStatistics);\n  const strategyLog = useMDDSStore(state => state.strategyLog);\n\n  const toggleExpanded = () => setIsExpanded(!isExpanded);\n\n  return (\n    <div className=\"glass-card border border-border/50\">\n      {/* Header */}\n      <button\n        onClick={toggleExpanded}\n        className=\"w-full flex items-center justify-between p-4 hover-elevate transition-all duration-300 text-left\"\n        data-testid=\"button-toggle-turn-logs\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <BarChart3 className=\"w-5 h-5 text-primary\" />\n          <h2 className=\"text-lg font-semibold\">Turn-based logs</h2>\n          <span className=\"text-sm text-muted-foreground\">\n          </span>\n        </div>\n        {isExpanded ? (\n          <ChevronUp className=\"w-5 h-5 text-muted-foreground\" />\n        ) : (\n          <ChevronDown className=\"w-5 h-5 text-muted-foreground\" />\n        )}\n      </button>\n\n      {/* Content */}\n      {isExpanded && (\n        <div className=\"border-t border-border/50 p-4 space-y-4\" data-testid=\"turn-logs-content\">\n          {turnStatistics.length === 0 && strategyLog.length === 0 ? (\n            <p className=\"text-muted-foreground text-center py-4\">No logs available yet.</p>\n          ) : (\n            <div className=\"space-y-6\">\n              {/* Purchase Logs */}\n              {strategyLog.length > 0 && (\n                <div className=\"space-y-3\">\n                  <button\n                    onClick={() => setIsPurchaseLogsExpanded(!isPurchaseLogsExpanded)}\n                    className=\"w-full flex items-center justify-between p-3 glass-panel hover-elevate transition-all duration-300 text-left\"\n                    data-testid=\"button-toggle-purchase-logs\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <BarChart3 className=\"w-4 h-4\" />\n                      <h3 className=\"font-semibold\">Card Purchase Logs</h3>\n                      <span className=\"text-sm text-muted-foreground\">\n                      </span>\n                    </div>\n                    {isPurchaseLogsExpanded ? (\n                      <ChevronUp className=\"w-4 h-4 text-muted-foreground\" />\n                    ) : (\n                      <ChevronDown className=\"w-4 h-4 text-muted-foreground\" />\n                    )}\n                  </button>\n                  \n                  {isPurchaseLogsExpanded && (\n                    <div className=\"max-h-60 overflow-y-auto space-y-2\" data-testid=\"purchase-logs\">\n                      {strategyLog\n                        .filter(log => log.action.includes('purchased'))\n                        .map((log, index) => {\n                          const teamColor = log.team === 'NATO' ? 'text-blue-400' : 'text-red-400';\n                          \n                          return (\n                            <div key={index} className=\"glass-panel p-3 text-sm\" data-testid={`purchase-log-${index}`}>\n                              <div className=\"flex items-center justify-between gap-4\">\n                                <div className=\"flex items-center gap-2\">\n                                  <span className={`font-semibold ${teamColor}`}>{log.team}</span>\n                                  <span className=\"text-muted-foreground\">Turn {log.turn}:</span>\n                                </div>\n                                <div className=\"text-xs text-muted-foreground\">\n                                  {new Date(log.timestamp).toLocaleTimeString()}\n                                </div>\n                              </div>\n                              <div className=\"mt-1\">\n                                {log.action.replace(`${log.team} purchased `, '')}\n                              </div>\n                            </div>\n                          );\n                        })\n                      }\n                    </div>\n                  )}\n                </div>\n              )}\n              \n              {/* Three Square Buttons */}\n              {turnStatistics.length > 0 && (\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-3 gap-2 mb-6\">\n                    <button\n                      onClick={() => setActiveSection(activeSection === 'overall' ? null : 'overall')}\n                      className={`p-4 text-center font-semibold transition-all duration-300 hover-elevate ${\n                        activeSection === 'overall' \n                          ? 'bg-blue-500/20 text-blue-400 border-2 border-blue-500/50' \n                          : 'glass-panel border border-border/50 text-muted-foreground hover:text-foreground'\n                      }`}\n                      style={{ borderRadius: '3px' }}\n                      data-testid=\"button-overall-statistics\"\n                    >\n                      <BarChart3 className=\"w-5 h-5 mx-auto mb-2\" />\n                      <div className=\"text-sm\">Overall Statistics</div>\n                    </button>\n                    \n                    <button\n                      onClick={() => setActiveSection(activeSection === 'dimension' ? null : 'dimension')}\n                      className={`p-4 text-center font-semibold transition-all duration-300 hover-elevate ${\n                        activeSection === 'dimension' \n                          ? 'bg-green-500/20 text-green-400 border-2 border-green-500/50' \n                          : 'glass-panel border border-border/50 text-muted-foreground hover:text-foreground'\n                      }`}\n                      style={{ borderRadius: '3px' }}\n                      data-testid=\"button-dimension-statistics\"\n                    >\n                      <TrendingUp className=\"w-5 h-5 mx-auto mb-2\" />\n                      <div className=\"text-sm\">Dimension Based Statistics</div>\n                    </button>\n                    \n                    <button\n                      onClick={() => setActiveSection(activeSection === 'defense' ? null : 'defense')}\n                      className={`p-4 text-center font-semibold transition-all duration-300 hover-elevate ${\n                        activeSection === 'defense' \n                          ? 'bg-purple-500/20 text-purple-400 border-2 border-purple-500/50' \n                          : 'glass-panel border border-border/50 text-muted-foreground hover:text-foreground'\n                      }`}\n                      style={{ borderRadius: '3px' }}\n                      data-testid=\"button-defense-offense-statistics\"\n                    >\n                      <div className=\"flex items-center justify-center gap-1 mb-2\">\n                        <Shield className=\"w-4 h-4\" />\n                        <Sword className=\"w-4 h-4\" />\n                      </div>\n                      <div className=\"text-sm\">Defensive/Offensive Statistics Chart</div>\n                    </button>\n                  </div>\n\n                  {/* Overall Statistics Content */}\n                  {activeSection === 'overall' && (\n                    <div className=\"overflow-x-auto\">\n                      <table className=\"w-full text-sm\">\n                        <thead>\n                          <tr className=\"border-b border-border/50\">\n                            <th className=\"text-left py-2 px-1 font-medium\">Turn</th>\n                            <th className=\"text-center py-2 px-1 font-medium text-blue-400\">NATO Total</th>\n                            <th className=\"text-center py-2 px-1 font-medium text-red-400\">Russia Total</th>\n                            <th className=\"text-center py-2 px-1 font-medium text-gray-500\">Joint</th>\n                            <th className=\"text-center py-2 px-1 font-medium text-green-500\">Economy</th>\n                            <th className=\"text-center py-2 px-1 font-medium text-purple-500\">Cognitive</th>\n                            <th className=\"text-center py-2 px-1 font-medium text-blue-500\">Space</th>\n                            <th className=\"text-center py-2 px-1 font-medium text-yellow-500\">Cyber</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {turnStatistics.map((stat, index) => {\n                            return (\n                              <tr key={index} className=\"border-b border-border/20\">\n                                <td className=\"py-2 px-1 font-medium\" data-testid={`turn-${stat.turn}`}>\n                                  Turn {stat.turn}\n                                </td>\n                                <td className=\"text-center py-2 px-1 text-blue-400 font-semibold\" data-testid={`nato-total-${stat.turn}`}>\n                                  {stat.natoTotalDeterrence}\n                                </td>\n                                <td className=\"text-center py-2 px-1 text-red-400 font-semibold\" data-testid={`russia-total-${stat.turn}`}>\n                                  {stat.russiaTotalDeterrence}\n                                </td>\n                                <td className=\"text-center py-2 px-1\" data-testid={`joint-${stat.turn}`}>\n                                  <div className=\"space-y-1 text-xs\">\n                                    <div className=\"text-blue-400 font-medium\">{stat.natoDeterrence.joint}</div>\n                                    <div className=\"text-red-400 font-medium\">{stat.russiaDeterrence.joint}</div>\n                                  </div>\n                                </td>\n                                <td className=\"text-center py-2 px-1\" data-testid={`economy-${stat.turn}`}>\n                                  <div className=\"space-y-1 text-xs\">\n                                    <div className=\"text-blue-400 font-medium\">{stat.natoDeterrence.economy}</div>\n                                    <div className=\"text-red-400 font-medium\">{stat.russiaDeterrence.economy}</div>\n                                  </div>\n                                </td>\n                                <td className=\"text-center py-2 px-1\" data-testid={`cognitive-${stat.turn}`}>\n                                  <div className=\"space-y-1 text-xs\">\n                                    <div className=\"text-blue-400 font-medium\">{stat.natoDeterrence.cognitive}</div>\n                                    <div className=\"text-red-400 font-medium\">{stat.russiaDeterrence.cognitive}</div>\n                                  </div>\n                                </td>\n                                <td className=\"text-center py-2 px-1\" data-testid={`space-${stat.turn}`}>\n                                  <div className=\"space-y-1 text-xs\">\n                                    <div className=\"text-blue-400 font-medium\">{stat.natoDeterrence.space}</div>\n                                    <div className=\"text-red-400 font-medium\">{stat.russiaDeterrence.space}</div>\n                                  </div>\n                                </td>\n                                <td className=\"text-center py-2 px-1\" data-testid={`cyber-${stat.turn}`}>\n                                  <div className=\"space-y-1 text-xs\">\n                                    <div className=\"text-blue-400 font-medium\">{stat.natoDeterrence.cyber}</div>\n                                    <div className=\"text-red-400 font-medium\">{stat.russiaDeterrence.cyber}</div>\n                                  </div>\n                                </td>\n                              </tr>\n                            );\n                          })}\n                        </tbody>\n                      </table>\n                    </div>\n                  )}\n\n                  {/* Dimension Based Statistics Content */}\n                  {activeSection === 'dimension' && (\n                    <div className=\"grid grid-cols-1 md:grid-cols-5 gap-3\">\n                      {Object.entries(turnStatistics[turnStatistics.length - 1].natoDeterrence).map(([domain, natoValue]) => {\n                        const russiaValue = turnStatistics[turnStatistics.length - 1].russiaDeterrence[domain as keyof typeof turnStatistics[number]['russiaDeterrence']];\n                        const domainAdvantage = natoValue - russiaValue;\n                        \n                        return (\n                          <div key={domain} className=\"glass-panel p-3 text-center\" data-testid={`domain-breakdown-${domain}`}>\n                            <h4 className={`font-medium capitalize text-xs mb-2 ${domainColors[domain as keyof typeof domainColors]}`}>\n                              {domain}\n                            </h4>\n                            <div className=\"space-y-1 text-xs\">\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-blue-400\">NATO:</span>\n                                <span className=\"font-semibold\">{natoValue}</span>\n                              </div>\n                              <div className=\"flex justify-between\">\n                                <span className=\"text-red-400\">Russia:</span>\n                                <span className=\"font-semibold\">{russiaValue}</span>\n                              </div>\n                              <div className=\"pt-1 border-t border-border/30\">\n                                <div className={`font-semibold ${\n                                  domainAdvantage > 0 ? 'text-blue-400' : \n                                  domainAdvantage < 0 ? 'text-red-400' : \n                                  'text-muted-foreground'\n                                }`}>\n                                  {domainAdvantage > 0 ? `+${domainAdvantage}` : domainAdvantage}\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  )}\n\n                  {/* Defensive/Offensive Statistics Chart Content */}\n                  {activeSection === 'defense' && (\n                    <div className=\"space-y-4\">\n                      <DefenseOffenseChart forceExpanded={true} hideToggle={true} />\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":15109},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/pages/Analysis.tsx":{"content":"import { useState, useMemo, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, Target, Brain, TrendingUp, Lightbulb, Filter, CheckSquare, Square, Sparkles, Send, MessageSquare } from \"lucide-react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { analyzeSelectedSessions, analyzeGenericPatterns, type SessionData } from \"@/utils/sessionAnalyzer\";\nimport { answerQuestion, type Message } from \"@/utils/questionAnswerer\";\n\ninterface GameSession {\n  sessionName: string;\n  gameState: any;\n  turnStatistics?: any;\n  createdAt: string;\n}\n\nexport default function Analysis() {\n  const [, setLocation] = useLocation();\n  const [selectedSessions, setSelectedSessions] = useState<string[]>([]);\n  const [sessionSearch, setSessionSearch] = useState(\"\");\n  const [dateFilter, setDateFilter] = useState<string>(\"all\");\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [questionInput, setQuestionInput] = useState(\"\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const { data: sessions, isLoading } = useQuery<GameSession[]>({\n    queryKey: ['/api/sessions'],\n  });\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleBack = () => {\n    setLocation('/database');\n  };\n\n  const filteredSessions = useMemo(() => {\n    if (!sessions) return [];\n    \n    let filtered = [...sessions];\n    \n    // Search filter\n    if (sessionSearch) {\n      filtered = filtered.filter(s => \n        s.sessionName.toLowerCase().includes(sessionSearch.toLowerCase())\n      );\n    }\n    \n    // Date filter\n    if (dateFilter !== \"all\") {\n      const now = new Date();\n      const filterDate = new Date();\n      \n      if (dateFilter === \"week\") {\n        filterDate.setDate(now.getDate() - 7);\n      } else if (dateFilter === \"month\") {\n        filterDate.setMonth(now.getMonth() - 1);\n      } else if (dateFilter === \"3months\") {\n        filterDate.setMonth(now.getMonth() - 3);\n      }\n      \n      filtered = filtered.filter(s => new Date(s.createdAt) >= filterDate);\n    }\n    \n    // Sort by date (latest first)\n    return filtered.sort((a, b) => \n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n  }, [sessions, sessionSearch, dateFilter]);\n\n  const handleToggleSession = (sessionName: string) => {\n    setSelectedSessions(prev => \n      prev.includes(sessionName)\n        ? prev.filter(s => s !== sessionName)\n        : [...prev, sessionName]\n    );\n  };\n\n  const handleSelectAll = () => {\n    if (selectedSessions.length === filteredSessions.length) {\n      setSelectedSessions([]);\n    } else {\n      setSelectedSessions(filteredSessions.map(s => s.sessionName));\n    }\n  };\n\n  const allSelected = filteredSessions.length > 0 && selectedSessions.length === filteredSessions.length;\n\n  // Get analysis for selected sessions\n  const selectedSessionsData: SessionData[] = useMemo(() => {\n    if (!sessions) return [];\n    return sessions\n      .filter(s => selectedSessions.includes(s.sessionName))\n      .map(s => ({\n        sessionName: s.sessionName,\n        gameState: s.gameState,\n        turnStatistics: s.turnStatistics\n      }));\n  }, [sessions, selectedSessions]);\n\n  const genericAnalysisResult = useMemo(() => {\n    return analyzeGenericPatterns(selectedSessionsData);\n  }, [selectedSessionsData]);\n\n  const predeterminedAnalysisResult = useMemo(() => {\n    return analyzeSelectedSessions(selectedSessionsData);\n  }, [selectedSessionsData]);\n\n  const handleAskQuestion = () => {\n    if (!questionInput.trim()) return;\n\n    // Add user message\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: questionInput,\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n\n    // Get answer based on selected sessions data\n    const answer = answerQuestion(questionInput, selectedSessionsData);\n\n    // Add assistant response\n    const assistantMessage: Message = {\n      id: (Date.now() + 1).toString(),\n      role: 'assistant',\n      content: answer,\n      timestamp: new Date()\n    };\n\n    setTimeout(() => {\n      setMessages(prev => [...prev, assistantMessage]);\n    }, 300);\n\n    setQuestionInput(\"\");\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleAskQuestion();\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto p-6 space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            onClick={handleBack}\n            data-testid=\"button-back-to-database\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold\">Automatic Strategy Analysis</h1>\n            <p className=\"text-muted-foreground\">\n              Pattern analysis and strategic insights from game sessions\n            </p>\n          </div>\n        </div>\n\n        {/* Session Selection Filter */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"rounded-lg bg-primary/10 p-2\">\n                  <Filter className=\"w-5 h-5 text-primary\" />\n                </div>\n                <div>\n                  <CardTitle>Select Sessions for Analysis</CardTitle>\n                  <CardDescription>\n                    Choose which game sessions to include in the AI pattern analysis\n                  </CardDescription>\n                </div>\n              </div>\n              <Badge variant=\"secondary\" className=\"text-sm\" data-testid=\"badge-selected-count\">\n                {selectedSessions.length} selected\n              </Badge>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* Filter Controls */}\n            <div className=\"grid gap-4 md:grid-cols-3\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Search Sessions</label>\n                <Input\n                  placeholder=\"Search by name...\"\n                  value={sessionSearch}\n                  onChange={(e) => setSessionSearch(e.target.value)}\n                  data-testid=\"input-session-search\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Date Range</label>\n                <Select value={dateFilter} onValueChange={setDateFilter}>\n                  <SelectTrigger data-testid=\"select-date-filter\">\n                    <SelectValue placeholder=\"All time\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All time</SelectItem>\n                    <SelectItem value=\"week\">Last 7 days</SelectItem>\n                    <SelectItem value=\"month\">Last month</SelectItem>\n                    <SelectItem value=\"3months\">Last 3 months</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Quick Actions</label>\n                <Button\n                  variant=\"outline\"\n                  className=\"w-full\"\n                  onClick={handleSelectAll}\n                  data-testid=\"button-select-all\"\n                >\n                  {allSelected ? (\n                    <>\n                      <CheckSquare className=\"w-4 h-4 mr-2\" />\n                      Deselect All\n                    </>\n                  ) : (\n                    <>\n                      <Square className=\"w-4 h-4 mr-2\" />\n                      Select All\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            {/* Session List */}\n            {isLoading && (\n              <div className=\"space-y-2\">\n                {[1, 2, 3].map((i) => (\n                  <Skeleton key={i} className=\"h-12 w-full\" />\n                ))}\n              </div>\n            )}\n\n            {!isLoading && filteredSessions.length > 0 && (\n              <div className=\"border rounded-lg max-h-64 overflow-y-auto\">\n                <div className=\"divide-y\">\n                  {filteredSessions.map((session) => (\n                    <div\n                      key={session.sessionName}\n                      className=\"flex items-center gap-3 p-3 hover-elevate\"\n                      data-testid={`session-item-${session.sessionName}`}\n                    >\n                      <Checkbox\n                        checked={selectedSessions.includes(session.sessionName)}\n                        onCheckedChange={() => handleToggleSession(session.sessionName)}\n                        data-testid={`checkbox-session-${session.sessionName}`}\n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"font-medium truncate\">{session.sessionName}</div>\n                        <div className=\"text-xs text-muted-foreground\">\n                          Turn {session.gameState.turn}/{session.gameState.maxTurns}  {new Date(session.createdAt).toLocaleDateString()}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {!isLoading && filteredSessions.length === 0 && (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No sessions found matching your filters\n              </div>\n            )}\n\n            {!isLoading && sessions && sessions.length === 0 && (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                No game sessions available. Play some games first to enable analysis.\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Main Content */}\n        <Tabs defaultValue=\"generic\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full max-w-2xl grid-cols-3\">\n            <TabsTrigger value=\"generic\" data-testid=\"tab-generic-pattern\">\n              Generic Patternization\n            </TabsTrigger>\n            <TabsTrigger value=\"predetermined\" data-testid=\"tab-predetermined-pattern\">\n              Predetermined Considerations\n            </TabsTrigger>\n            <TabsTrigger value=\"questions\" data-testid=\"tab-ask-questions\">\n              Ask Questions\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Generic Patternization Section */}\n          <TabsContent value=\"generic\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"rounded-lg bg-blue-500/10 p-2\">\n                    <Target className=\"w-6 h-6 text-blue-500\" />\n                  </div>\n                  <div>\n                    <CardTitle>Generic Patternization for the Best Strategy to Win</CardTitle>\n                    <CardDescription>\n                      {selectedSessions.length > 0 \n                        ? `Analysis of winning patterns based on ${selectedSessions.length} selected session${selectedSessions.length > 1 ? 's' : ''}`\n                        : 'Select sessions above to analyze winning patterns'}\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {selectedSessions.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <Sparkles className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                    <p className=\"text-lg\">Select game sessions above to discover all winning strategies</p>\n                    <p className=\"text-sm mt-2\">The system will analyze every pattern and correlation without limitations</p>\n                  </div>\n                ) : (\n                  <>\n                    {/* Headline Insight */}\n                    <div className=\"rounded-lg bg-gradient-to-r from-blue-500/10 to-green-500/10 border border-blue-500/20 p-6\">\n                      <div className=\"flex items-start gap-3\">\n                        <Sparkles className=\"w-6 h-6 text-blue-500 mt-1 flex-shrink-0\" />\n                        <div>\n                          <h3 className=\"font-semibold text-lg mb-2\">Headline Insight</h3>\n                          <p className=\"text-foreground leading-relaxed\">{genericAnalysisResult.headlineInsight}</p>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Patterns & Observations */}\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <TrendingUp className=\"w-5 h-5 text-green-500\" />\n                        <h3 className=\"font-semibold text-lg\">All Winning Strategies & Correlations</h3>\n                      </div>\n                      \n                      <div className=\"grid gap-3\">\n                        {genericAnalysisResult.patterns.map((pattern, index) => (\n                          <div\n                            key={index}\n                            className=\"rounded-lg border p-4 hover-elevate\"\n                            data-testid={`generic-pattern-${index}`}\n                          >\n                            <div className=\"flex items-start gap-3\">\n                              <Badge variant=\"secondary\" className=\"mt-1 flex-shrink-0\">\n                                {index + 1}\n                              </Badge>\n                              <p className=\"text-sm leading-relaxed\">{pattern}</p>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n\n                    {/* Narrative Commentary */}\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Brain className=\"w-5 h-5 text-blue-500\" />\n                        <h3 className=\"font-semibold text-lg\">Strategic Analysis</h3>\n                      </div>\n                      \n                      <Card className=\"border-l-4 border-l-blue-500\">\n                        <CardContent className=\"pt-6\">\n                          <p className=\"text-sm leading-relaxed text-muted-foreground whitespace-pre-line\">\n                            {genericAnalysisResult.narrativeCommentary}\n                          </p>\n                        </CardContent>\n                      </Card>\n                    </div>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Predetermined Considerations Section */}\n          <TabsContent value=\"predetermined\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"rounded-lg bg-purple-500/10 p-2\">\n                    <Brain className=\"w-6 h-6 text-purple-500\" />\n                  </div>\n                  <div>\n                    <CardTitle>Patternization based on Predetermined Considerations</CardTitle>\n                    <CardDescription>\n                      {selectedSessions.length > 0 \n                        ? `Context-specific analysis based on ${selectedSessions.length} selected session${selectedSessions.length > 1 ? 's' : ''}`\n                        : 'Select sessions above to analyze context-specific patterns'}\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {selectedSessions.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <Sparkles className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                    <p className=\"text-lg\">Select game sessions above to unlock strategic insights</p>\n                    <p className=\"text-sm mt-2\">The AI will analyze card timing, momentum swings, team strategies, and winning patterns</p>\n                  </div>\n                ) : (\n                  <>\n                    {/* Headline Insight */}\n                    <div className=\"rounded-lg bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/20 p-6\">\n                      <div className=\"flex items-start gap-3\">\n                        <Sparkles className=\"w-6 h-6 text-purple-500 mt-1 flex-shrink-0\" />\n                        <div>\n                          <h3 className=\"font-semibold text-lg mb-2\">Headline Insight</h3>\n                          <p className=\"text-foreground leading-relaxed\">{predeterminedAnalysisResult.headlineInsight}</p>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Patterns & Observations */}\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <TrendingUp className=\"w-5 h-5 text-blue-500\" />\n                        <h3 className=\"font-semibold text-lg\">Patterns & Observations</h3>\n                      </div>\n                      \n                      <div className=\"grid gap-3\">\n                        {predeterminedAnalysisResult.patterns.map((pattern, index) => (\n                          <div\n                            key={index}\n                            className=\"rounded-lg border p-4 hover-elevate\"\n                            data-testid={`pattern-item-${index}`}\n                          >\n                            <div className=\"flex items-start gap-3\">\n                              <Badge variant=\"secondary\" className=\"mt-1 flex-shrink-0\">\n                                {index + 1}\n                              </Badge>\n                              <p className=\"text-sm leading-relaxed\">{pattern}</p>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n\n                    {/* Narrative Commentary */}\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Brain className=\"w-5 h-5 text-purple-500\" />\n                        <h3 className=\"font-semibold text-lg\">Narrative Commentary</h3>\n                        <Badge variant=\"outline\" className=\"text-xs\">Sports Analytics Style</Badge>\n                      </div>\n                      \n                      <Card className=\"border-l-4 border-l-purple-500\">\n                        <CardContent className=\"pt-6\">\n                          <p className=\"text-sm leading-relaxed text-muted-foreground whitespace-pre-line\">\n                            {predeterminedAnalysisResult.narrativeCommentary}\n                          </p>\n                        </CardContent>\n                      </Card>\n                    </div>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Ask Questions Section */}\n          <TabsContent value=\"questions\" className=\"space-y-6\">\n            <Card className=\"flex flex-col\" style={{ height: 'calc(100vh - 400px)', minHeight: '500px' }}>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"rounded-lg bg-green-500/10 p-2\">\n                    <MessageSquare className=\"w-6 h-6 text-green-500\" />\n                  </div>\n                  <div>\n                    <CardTitle>Ask Questions About Selected Sessions</CardTitle>\n                    <CardDescription>\n                      {selectedSessions.length > 0 \n                        ? `Ask questions based on ${selectedSessions.length} selected session${selectedSessions.length > 1 ? 's' : ''} - answers are derived from real game data`\n                        : 'Select sessions above to start asking questions'}\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"flex-1 flex flex-col overflow-hidden\">\n                {selectedSessions.length === 0 ? (\n                  <div className=\"flex-1 flex items-center justify-center text-center py-12 text-muted-foreground\">\n                    <div>\n                      <MessageSquare className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\n                      <p className=\"text-lg\">Select game sessions above to start asking questions</p>\n                      <p className=\"text-sm mt-2\">All answers will be based on authentic data from your selected sessions</p>\n                    </div>\n                  </div>\n                ) : (\n                  <>\n                    {/* Messages Area */}\n                    <ScrollArea className=\"flex-1 pr-4 mb-4\">\n                      <div className=\"space-y-4\">\n                        {messages.length === 0 && (\n                          <div className=\"text-center py-8 text-muted-foreground\">\n                            <p className=\"text-sm\">Start by asking a question about your selected sessions.</p>\n                            <p className=\"text-xs mt-2\">Try: \"Who won the games?\" or \"What were the final scores?\"</p>\n                          </div>\n                        )}\n                        \n                        {messages.map((message) => (\n                          <div\n                            key={message.id}\n                            className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                            data-testid={`message-${message.role}-${message.id}`}\n                          >\n                            <div\n                              className={`max-w-[80%] rounded-lg p-4 ${\n                                message.role === 'user'\n                                  ? 'bg-primary text-primary-foreground'\n                                  : 'bg-muted'\n                              }`}\n                            >\n                              <p className=\"text-sm whitespace-pre-line\">{message.content}</p>\n                              <p className=\"text-xs opacity-70 mt-2\">\n                                {new Date(message.timestamp).toLocaleTimeString()}\n                              </p>\n                            </div>\n                          </div>\n                        ))}\n                        <div ref={messagesEndRef} />\n                      </div>\n                    </ScrollArea>\n\n                    {/* Input Area */}\n                    <div className=\"border-t pt-4\">\n                      <div className=\"flex gap-2\">\n                        <Input\n                          value={questionInput}\n                          onChange={(e) => setQuestionInput(e.target.value)}\n                          onKeyPress={handleKeyPress}\n                          placeholder=\"Ask a question about the selected sessions...\"\n                          className=\"flex-1\"\n                          data-testid=\"input-question\"\n                        />\n                        <Button\n                          onClick={handleAskQuestion}\n                          disabled={!questionInput.trim()}\n                          data-testid=\"button-send-question\"\n                        >\n                          <Send className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground mt-2\">\n                        Press Enter to send  All answers based on real session data\n                      </p>\n                    </div>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","size_bytes":24889},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/logic/filters.ts":{"content":"import { Card, Domain } from '@shared/schema';\n\n// Domain quotas enforcement\nexport function applyDomainQuotas(cards: Card[]): Card[] {\n  const quotas: Record<Domain, number> = {\n    economy: 10,\n    cyber: 11, \n    joint: 11,\n    space: 10,\n    cognitive: 13\n  };\n\n  const byDomain: Record<Domain, Card[]> = {\n    economy: [],\n    cyber: [],\n    joint: [],\n    space: [],\n    cognitive: []\n  };\n\n  // Group cards by domain\n  for (const card of cards) {\n    byDomain[card.domain].push(card);\n  }\n\n  const kept: Card[] = [];\n  \n  // Apply quotas for each domain\n  for (const domain of Object.keys(byDomain) as Domain[]) {\n    const domainCards = byDomain[domain];\n    \n    // Sort by numeric part of ID (e.g., J1, J2, ...)\n    const sorted = domainCards.slice().sort((a, b) => {\n      const numA = parseInt(a.id.replace(/\\D/g, '')) || 0;\n      const numB = parseInt(b.id.replace(/\\D/g, '')) || 0;\n      return numA - numB;\n    });\n    \n    // Keep only the quota amount\n    kept.push(...sorted.slice(0, quotas[domain]));\n  }\n\n  return kept;\n}\n\n// Infer domain from card ID prefix\nexport function inferDomainFromId(id: string): Domain {\n  const prefix = id.match(/^[A-Z]+/)?.[0] || '';\n  \n  switch (prefix) {\n    case 'E': return 'economy';\n    case 'CY': return 'cyber';\n    case 'CG': return 'cognitive';\n    case 'S': return 'space';\n    case 'J': return 'joint';\n    default: throw new Error(`Unknown domain prefix in card ID: ${id}`);\n  }\n}","size_bytes":1443},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/CardDetailModal.tsx":{"content":"import { useState } from \"react\";\nimport { Card as CardType } from \"@shared/schema\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport DomainBadge from \"./DomainBadge\";\nimport { formatCurrency } from \"../logic/pricing\";\nimport { sanitizeText } from \"../logic/guards\";\nimport { Zap, Clock, ShoppingCart, TrendingUp, TrendingDown, Info, Lock, Unlock } from \"lucide-react\";\n\ninterface CardDetailModalProps {\n  card: CardType | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onAddToCart?: () => void;\n  discountedPrice?: number;\n  inCart?: boolean;\n  disabled?: boolean;\n}\n\nexport default function CardDetailModal({ \n  card, \n  isOpen, \n  onClose, \n  onAddToCart,\n  discountedPrice,\n  inCart = false,\n  disabled = false \n}: CardDetailModalProps) {\n  const [isUnlocked, setIsUnlocked] = useState(false);\n  const [passwordInput, setPasswordInput] = useState(\"\");\n  const [showPasswordInput, setShowPasswordInput] = useState(false);\n  const [passwordError, setPasswordError] = useState(\"\");\n  \n  if (!card) return null;\n\n  const finalPrice = discountedPrice ?? card.baseCostK;\n  const hasDiscount = discountedPrice !== undefined && discountedPrice < card.baseCostK;\n\n  const handlePasswordSubmit = () => {\n    if (passwordInput === \"MDDS\") {\n      setIsUnlocked(true);\n      setShowPasswordInput(false);\n      setPasswordError(\"\");\n      setPasswordInput(\"\");\n    } else {\n      setPasswordError(\"Incorrect password\");\n      setPasswordInput(\"\");\n    }\n  };\n\n  const handleClose = () => {\n    setIsUnlocked(false);\n    setShowPasswordInput(false);\n    setPasswordInput(\"\");\n    setPasswordError(\"\");\n    onClose();\n  };\n\n  const getTypeIcon = () => {\n    switch (card.type) {\n      case 'asset': return <Zap className=\"w-5 h-5\" />;\n      case 'permanent': return <ShoppingCart className=\"w-5 h-5\" />;\n      case 'expert': return <Clock className=\"w-5 h-5\" />;\n    }\n  };\n\n  const getTypeDescription = () => {\n    switch (card.type) {\n      case 'asset': return 'Provides immediate deterrence effects when purchased';\n      case 'permanent': return 'Provides ongoing discounts to specified cards';\n      case 'expert': return 'Becomes available next turn for informational purposes only';\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-2xl\" data-testid=\"modal-card-details\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <span data-testid=\"text-modal-card-name\">{sanitizeText(card.name)}</span>\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Always Visible: Basic Info */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <h4 className=\"font-medium text-sm text-muted-foreground\">Card ID</h4>\n              <p className=\"font-mono\" data-testid=\"text-modal-card-id\">{card.id}</p>\n            </div>\n            <div>\n              <h4 className=\"font-medium text-sm text-muted-foreground\">Cost</h4>\n              <div className=\"flex items-center gap-4\">\n                {hasDiscount && (\n                  <div className=\"text-sm text-muted-foreground line-through\">\n                    Original: {formatCurrency(card.baseCostK)}\n                  </div>\n                )}\n                <div className={`text-lg font-bold ${hasDiscount ? 'text-green-600' : ''}`} data-testid=\"text-modal-price\">\n                  {formatCurrency(finalPrice)}\n                </div>\n                {hasDiscount && (\n                  <Badge variant=\"secondary\" className=\"text-green-600\">\n                    -{formatCurrency(card.baseCostK - finalPrice)} discount\n                  </Badge>\n                )}\n              </div>\n            </div>\n          </div>\n\n          <Separator />\n\n          {/* Protected Information Section */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h4 className=\"font-medium text-sm text-muted-foreground\">Detailed Information</h4>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setShowPasswordInput(!showPasswordInput)}\n                className=\"flex items-center gap-2\"\n                data-testid=\"button-unlock-details\"\n              >\n                {isUnlocked ? <Unlock className=\"w-4 h-4\" /> : <Lock className=\"w-4 h-4\" />}\n                {isUnlocked ? 'Unlocked' : 'Unlock Details'}\n              </Button>\n            </div>\n\n            {showPasswordInput && !isUnlocked && (\n              <div className=\"space-y-2 p-3 bg-muted rounded-md\">\n                <div className=\"flex gap-2\">\n                  <Input\n                    type=\"password\"\n                    placeholder=\"Enter password\"\n                    value={passwordInput}\n                    onChange={(e) => setPasswordInput(e.target.value)}\n                    onKeyPress={(e) => e.key === 'Enter' && handlePasswordSubmit()}\n                    data-testid=\"input-password\"\n                  />\n                  <Button onClick={handlePasswordSubmit} size=\"sm\" data-testid=\"button-submit-password\">\n                    Unlock\n                  </Button>\n                </div>\n                {passwordError && (\n                  <p className=\"text-sm text-red-600\">{passwordError}</p>\n                )}\n              </div>\n            )}\n\n            {isUnlocked && (\n              <div className=\"space-y-4\">\n                {/* Type Information */}\n                <div>\n                  <h4 className=\"font-medium text-sm text-muted-foreground\">Type & Domain</h4>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <Badge variant=\"outline\">\n                      {getTypeIcon()}\n                      <span className=\"ml-1\">{sanitizeText(card.type.charAt(0).toUpperCase() + card.type.slice(1))}</span>\n                    </Badge>\n                    <DomainBadge domain={card.domain} />\n                  </div>\n                </div>\n\n                {/* Type-specific Details */}\n                <div>\n                  <h4 className=\"font-medium text-sm text-muted-foreground mb-2\">Description</h4>\n                  <p className=\"text-sm text-muted-foreground mb-3\">\n                    {sanitizeText(getTypeDescription())}\n                  </p>\n\n                  {/* Asset Effects */}\n                  {card.type === 'asset' && card.effects && (\n                    <div className=\"space-y-2\">\n                      <h5 className=\"font-medium text-sm\">Effects</h5>\n                      {card.effects.map((effect, index) => (\n                        <div key={index} className=\"flex items-center gap-2 p-2 bg-white border border-border rounded-md\">\n                          {effect.delta > 0 ? (\n                            <TrendingUp className=\"w-4 h-4 text-green-600\" />\n                          ) : (\n                            <TrendingDown className=\"w-4 h-4 text-red-600\" />\n                          )}\n                          <span className=\"text-sm text-foreground\">\n                            {effect.target === 'self' ? 'Self' : 'Opponent'} {effect.domain}: \n                            <span className={effect.delta > 0 ? 'text-green-600 font-medium' : 'text-red-600 font-medium'}>\n                              {effect.delta > 0 ? '+' : ''}{effect.delta}\n                            </span>\n                          </span>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n\n                  {/* Permanent Discounts */}\n                  {card.type === 'permanent' && card.permanentMods && (\n                    <div className=\"space-y-2\">\n                      <h5 className=\"font-medium text-sm\">Provides Discounts</h5>\n                      <div className=\"p-3 bg-muted rounded-md\">\n                        <p className=\"text-sm font-medium text-green-600 mb-2\">\n                          -{formatCurrency(card.permanentMods.flatDiscountK)} discount to:\n                        </p>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {card.permanentMods.appliesToCardIds.map(cardId => (\n                            <Badge key={cardId} variant=\"secondary\" className=\"text-xs\">\n                              {cardId}\n                            </Badge>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Expert Info */}\n                  {card.type === 'expert' && card.expertInfo && (\n                    <div className=\"space-y-2\">\n                      <h5 className=\"font-medium text-sm\">Expert Information</h5>\n                      <div className=\"flex items-start gap-2 p-3 bg-muted rounded-md\">\n                        <Info className=\"w-4 h-4 text-muted-foreground mt-0.5 shrink-0\" />\n                        <p className=\"text-sm\" data-testid=\"text-expert-info\">\n                          {sanitizeText(card.expertInfo)}\n                        </p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Actions */}\n          {onAddToCart && (\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={onAddToCart}\n                disabled={disabled || inCart}\n                className=\"flex-1\"\n                data-testid=\"button-modal-add-cart\"\n              >\n                <ShoppingCart className=\"w-4 h-4 mr-2\" />\n                {inCart ? 'In Cart' : 'Add to Cart'}\n              </Button>\n              <Button variant=\"outline\" onClick={handleClose} data-testid=\"button-modal-close\">\n                Close\n              </Button>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":10155},"replit.md":{"content":"# MDDS - Multi Dimension Deterrence Strategy\n\n## Overview\n\nMDDS is an interactive web application for strategic planning and analysis across multiple domains of deterrence. The system enables two teams (NATO and Russia) to make strategic decisions using cards representing assets, permanent capabilities, and expert advisors across five domains: Joint, Economy, Cognitive, Space, and Cyber. The application implements a turn-based strategy system with budget constraints, deterrence scoring, and comprehensive logging of strategic decisions.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\nThe application is built using a modern React-based architecture with TypeScript:\n\n- **Framework**: React 18 with Vite for development and bundling\n- **State Management**: Zustand store for global game state management\n- **Styling**: Tailwind CSS with shadcn/ui component library for consistent design\n- **UI Components**: Radix UI primitives providing accessible, customizable components\n- **Routing**: Wouter for lightweight client-side routing with routes for main game (/), database sessions (/database), and mobile views (/mobile)\n\nThe frontend follows a component-based architecture with clear separation of concerns between presentation components, state logic, and business rules.\n\n### Key Features\n- **Database Sessions View**: Accessible from Settings dialog (password: \"MDDS\"), displays all stored game sessions with session name, turn information, participants, current phase/team, and deterrence scores. Features robust type safety with comprehensive data normalization to handle various API response structures. Includes research icon (flask) for quick access to Research Dashboard.\n- **Analysis Dashboard**: Multi-tab interface (/analysis) featuring:\n  - **Generic Patternization**: Discovers all winning strategies and correlations across 7 analysis categories (winning strategies, domain correlations, budget patterns, card effectiveness, timing patterns, turn-by-turn patterns, team-specific formulas)\n  - **Predetermined Considerations**: Answers strategic questions about card timing, momentum swings, team asymmetry, comeback triggers, dimension correlation, strategy consistency, and cross-session recurrence. Includes comprehensive card-related statistics:\n    - **Most Purchased Cards**: Top 5 most frequently purchased cards with individual purchase counts across all sessions\n    - **Card Type Win Rates**: Asset, Permanent, and Expert card purchase totals with calculated win rates (% of purchases leading to victories)\n    - **High-Correlation Cards**: Identifies specific cards with 60% win rate (minimum 2 uses) showing strong correlation with victory\n    - **Permanent Card Holdings**: Average and maximum permanent cards held by winning teams\n  - **Ask Questions**: Interactive Q&A interface with LLM-style chat experience for querying selected sessions. Provides authentic, data-driven answers based on real session data (winners, scores, domains, budgets, cards, turns, comparisons)\n- **Research Dashboard** (/research): Statistical analysis environment featuring two-column responsive layout:\n  - **Layout Structure**: Two equal-width columns on large screens (lg:col-span-1 each, 50% width):\n    - **Left Column**: Research question development, session filtering, variable selection, card purchase frequency analysis, and card rankings by dimension\n    - **Right Column**: Research question development, hypothesis development, statistics, test recommendations, and report generation\n  - **Research Question Development**: Interactive research question formulation tool appearing at the top of both columns. Features include:\n    - 10 predefined research question templates (Card Strategy Effectiveness, Domain Investment Patterns, Team Performance Differences, Budget Allocation Efficiency, Permanent vs Temporary Cards, Early vs Late Investment, Defensive-Offensive Balance, Comeback Possibilities, Domain Specialization, Turn Duration Impact)\n    - Dropdown selector for quick template selection\n    - Free-form textarea for custom research questions\n    - Independent state management for left and right columns (two separate research questions)\n    - Auto-clear dropdown when manually editing research question\n    - Guides exploratory analysis with structured inquiry frameworks\n  - **Hypothesis Development**: Interactive hypothesis analyzer that intelligently recommends relevant variables based on natural language input. Uses keyword matching and pattern detection to identify team mentions (NATO/Russia), domain references (economy, cyber, space, cognitive, joint), and comparison terms (correlation, impact, versus). Features include:\n    - Real-time analysis of hypothesis text with useMemo optimization\n    - Smart variable recommendations with deduplication logic\n    - Visual distinction between Selected and Recommended variables\n    - Bulk \"Select All Recommended\" functionality\n    - Fallback suggestions when hypothesis lacks specific keywords\n  - **Session Filtering**: Search, winner filtering, and date-based filtering for research dataset selection\n  - **Variable Selection**: 14+ dependent variables (deterrence scores, budget metrics, turn counts) across NATO/Russia teams\n  - **Card Purchase Frequency**: Multi-card selection analysis showing percentage of sessions where cards were purchased, with team filtering (Both/NATO/Russia) and session-based percentage calculations using Set-based tracking to prevent >100% values\n  - **Card Rankings by Dimension**: Comprehensive ranking system displaying top 5 most-purchased cards by NATO and Russia, organized by dimension (Joint, Economy, Cognitive, Space, Cyber). For each card, displays:\n    - Purchase count and ranking position\n    - Domain percentage (frequency within that specific dimension)\n    - Overall percentage (frequency across all card purchases)\n    - Side-by-side NATO (blue) and Russia (red) comparisons\n    - Empty states for dimensions with no purchases\n  - **Descriptive Statistics**: Automated calculation of N, Mean, SD, Min, Max, Range, Median, and IQR for selected variables\n  - **Statistical Test Recommendations**: Intelligent recommendation system for 11 statistical methodologies (t-tests, ANOVA, MANOVA, correlation, regression, non-parametric tests) with appropriateness detection based on data characteristics\n  - **Scientific Word Document Generation**: Automated creation of publication-ready .docx reports including:\n    - Actual statistical calculations (t-tests with p-values, ANOVA with F-statistics, correlation coefficients, regression analyses)\n    - Descriptive statistics tables with properly formatted values\n    - Embedded statistical charts (bar charts, scatter plots, line graphs) generated server-side\n    - Methodology-specific inferential analysis sections with appropriate statistical frameworks\n    - APA-style formatting with proper figure/table numbering\n    - Summary and interpretation sections following scientific publication standards\n  - **Robust Data Validation**: Comprehensive edge-case handling ensures safe defaults when data is insufficient (minimum 2-3 observations per group required)\n  - **Report Export**: Download generated reports as professionally formatted Word documents (.docx)\n- **Settings Dialog**: Centralized settings interface with collapsible Card Purchase Logs and navigation to database sessions\n- **Login Screen**: Glassmorphism interface with session creation and optional \"Skip Turn 1\" configuration\n- **Mobile Interface**: Dedicated mobile views for session management\n\n### Design System\nThe application implements a Material Design-inspired system with:\n\n- **Color Palette**: Domain-specific accent colors (Joint: gray, Economy: green, Cognitive: purple, Space: blue, Cyber: yellow)\n- **Typography**: Inter font family for primary text, JetBrains Mono for data display\n- **Theme Support**: Light/dark mode switching with CSS custom properties\n- **Responsive Layout**: Mobile-first design approach with Tailwind breakpoints\n\n### Business Logic Architecture\nCore game logic is separated into specialized modules:\n\n- **Turn Engine** (`turnEngine.ts`): Manages turn phases (purchase  commit  advance) and validates domain spending restrictions\n- **Scoring System** (`scoring.ts`): Calculates deterrence effects and applies card impacts across domains\n- **Pricing Logic** (`pricing.ts`): Handles permanent card discounts and budget calculations\n- **Content Guards** (`guards.ts`): Runtime text sanitization replacing forbidden words (\"game\", \"operation\") with \"strategy\"\n- **Domain Filters** (`filters.ts`): Enforces card quotas and domain-based constraints\n\n### State Management\nZustand provides centralized state management with:\n\n- **Game State**: Turn tracking, phase management, team states\n- **Team State**: Individual budgets, deterrence scores, owned cards, shopping carts\n- **Persistence**: localStorage integration for save/load/export/import functionality\n- **Action Logging**: Comprehensive strategy log with timestamps and team attribution\n\n### Data Architecture\nThe application uses a schema-first approach with Zod validation:\n\n- **Card System**: Three card types (asset, permanent, expert) with different behaviors and effects\n- **Domain System**: Five domains with individual deterrence tracking and budget allocation\n- **Team System**: NATO vs Russia with independent state management\n- **Turn System**: Base turn (200K per domain) vs pooled turns (1000K total budget)\n\n### Backend Architecture\nMinimal Express.js server providing:\n\n- **Static Asset Serving**: Production build serving with Vite integration\n- **Development Server**: Hot module replacement and error overlay support\n- **Storage Interface**: Extensible storage abstraction (currently in-memory, designed for database expansion)\n- **Database Schema**: Drizzle ORM configuration prepared for PostgreSQL integration\n\nThe backend is designed as a lightweight foundation that can be extended with database persistence, user authentication, and multiplayer functionality.\n\n## External Dependencies\n\n### Core Framework Dependencies\n- **React Ecosystem**: React 18, React DOM, React Query for state synchronization\n- **Build Tools**: Vite for development server and production bundling, TypeScript for type safety\n- **Styling**: Tailwind CSS for utility-first styling, PostCSS for processing\n\n### UI Component Libraries\n- **Radix UI**: Comprehensive set of unstyled, accessible UI primitives (@radix-ui/react-*)\n- **shadcn/ui**: Pre-built component library built on Radix UI primitives\n- **Lucide React**: Icon library providing consistent iconography\n- **Class Variance Authority**: Type-safe CSS class composition\n\n### Development Dependencies\n- **Drizzle ORM**: Type-safe database ORM with PostgreSQL dialect support\n- **Zod**: Runtime type validation and schema definition\n- **ESBuild**: Fast JavaScript bundler for server-side code\n- **Date-fns**: Date manipulation and formatting utilities\n\n### Research & Statistical Analysis\n- **simple-statistics**: Statistical calculations library for t-tests, ANOVA, correlation, and regression analysis\n- **docx**: Professional Word document generation with tables, charts, and APA formatting\n- **canvas & chartjs-node-canvas**: Server-side chart rendering for embedded visualizations\n- **Chart.js**: Statistical chart generation (bar charts, scatter plots, line graphs)\n\n### Database Integration\n- **Neon Database**: Serverless PostgreSQL platform (@neondatabase/serverless)\n- **Connection Management**: Environment-based database URL configuration\n- **Migration System**: Drizzle Kit for schema migrations and database management\n\n### State & Data Management\n- **Zustand**: Lightweight state management without boilerplate\n- **React Hook Form**: Form state management with validation (@hookform/resolvers)\n- **Local Storage**: Browser-based persistence for game state\n\nThe application is designed for deployment on platforms like Replit, with database provisioning handled through environment variables and minimal external service dependencies.\n\n## Deployment Documentation\n\nThe application includes comprehensive deployment documentation for production environments:\n\n### Deployment Files\n- **README.md**: Application overview, features, quick start guide, and technology stack\n- **DEPLOYMENT.md**: Complete step-by-step deployment guide for Windows and Linux servers\n  - Prerequisites and system requirements\n  - Windows Server deployment (IIS/standalone)\n  - Linux Server deployment (Ubuntu/CentOS with Nginx)\n  - Database setup and configuration\n  - SSL/HTTPS configuration\n  - Process management with PM2\n  - Troubleshooting guide\n- **PACKAGING.md**: Instructions for creating deployment packages\n  - What to include/exclude in ZIP files\n  - Multiple packaging methods (Git, manual, npm scripts)\n  - Security best practices\n  - Version management\n  - Checksum generation\n- **.env.example**: Template for environment variables\n\n### Deployment Targets\nThe application can be deployed to:\n- Windows Server 2016+ (IIS or standalone)\n- Linux servers (Ubuntu 18.04+, CentOS 7+, Debian 10+)\n- Any platform supporting Node.js 18+ and PostgreSQL 14+\n- Cloud platforms (AWS, Azure, Google Cloud, DigitalOcean)\n- VPS providers with SSH access\n\n### Single-Player AI Features\n- **Password Protection**: Single game mode requires password \"MDDS\"\n- **Skip Turn 1**: Optional checkbox to start directly at Turn 2 with pooled budget\n- **Balanced AI Strategy**: Russia AI tracks NATO deterrence scores and adapts strategy\n  - Gap analysis across all domains\n  - Impact-based card selection (not just cost)\n  - Budget allocation proportional to deterrence gaps\n  - Competitive scoring for engaging gameplay","size_bytes":13794},"client/src/components/examples/TeamPanel.tsx":{"content":"import TeamPanel from '../TeamPanel';\nimport { TeamState } from '@shared/schema';\n\nexport default function TeamPanelExample() {\n  const sampleNATOState: TeamState = {\n    deterrence: {\n      joint: 115,\n      economy: 105, \n      cognitive: 90,\n      space: 120,\n      cyber: 95\n    },\n    totalDeterrence: 525,\n    budget: 850,\n    ownedPermanents: [\n      {\n        id: \"J2\",\n        name: \"Intelligence Fusion Hub\", \n        domain: \"joint\",\n        type: \"permanent\",\n        baseCostK: 200,\n        permanentMods: {\n          flatDiscountK: 50,\n          appliesToCardIds: [\"CY3\", \"CG5\"]\n        }\n      }\n    ],\n    expertsQueue: [\n      {\n        card: {\n          id: \"J3\",\n          name: \"Joint Strategic Advisor\",\n          domain: \"joint\", \n          type: \"expert\",\n          baseCostK: 100,\n          expertInfo: \"Provides strategic insights\"\n        },\n        availableTurn: 3\n      }\n    ],\n    cart: [\n      {\n        id: \"E1\",\n        name: \"Economic Sanctions\",\n        domain: \"economy\",\n        type: \"asset\", \n        baseCostK: 120\n      }\n    ]\n  };\n\n  const sampleRussiaState: TeamState = {\n    deterrence: {\n      joint: 100,\n      economy: 100,\n      cognitive: 100, \n      space: 100,\n      cyber: 100\n    },\n    totalDeterrence: 500,\n    budget: 1000,\n    ownedPermanents: [],\n    expertsQueue: [],\n    cart: []\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 max-w-4xl\">\n      <TeamPanel team=\"NATO\" teamState={sampleNATOState} isActive={true} />\n      <TeamPanel team=\"Russia\" teamState={sampleRussiaState} />\n    </div>\n  );\n}","size_bytes":1586},"client/src/components/DomainBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Domain } from \"@shared/schema\";\nimport { sanitizeText } from \"../logic/guards\";\n\ninterface DomainBadgeProps {\n  domain: Domain;\n  className?: string;\n}\n\nconst domainColors: Record<Domain, string> = {\n  joint: \"bg-gray-500 text-white\",\n  economy: \"bg-green-600 text-white\", \n  cognitive: \"bg-purple-600 text-white\",\n  space: \"bg-blue-500 text-white\",\n  cyber: \"bg-yellow-500 text-black\"\n};\n\nconst domainLabels: Record<Domain, string> = {\n  joint: \"Joint\",\n  economy: \"Economy\", \n  cognitive: \"Cognitive\",\n  space: \"Space\",\n  cyber: \"Cyber\"\n};\n\nexport default function DomainBadge({ domain, className = \"\" }: DomainBadgeProps) {\n  return (\n    <Badge \n      className={`${domainColors[domain]} ${className}`}\n      data-testid={`badge-domain-${domain}`}\n    >\n      {sanitizeText(domainLabels[domain])}\n    </Badge>\n  );\n}","size_bytes":876},"server/chartGenerator.ts":{"content":"import { ChartJSNodeCanvas } from 'chartjs-node-canvas';\nimport { ChartConfiguration } from 'chart.js';\n\nconst width = 800;\nconst height = 500;\nconst chartJSNodeCanvas = new ChartJSNodeCanvas({ width, height, backgroundColour: 'white' });\n\nexport interface BarChartData {\n  labels: string[];\n  datasets: {\n    label: string;\n    data: number[];\n    backgroundColor?: string | string[];\n    borderColor?: string | string[];\n  }[];\n}\n\nexport interface ScatterPlotData {\n  datasets: {\n    label: string;\n    data: { x: number; y: number }[];\n    backgroundColor?: string;\n    borderColor?: string;\n  }[];\n}\n\nexport interface BoxPlotData {\n  labels: string[];\n  datasets: {\n    label: string;\n    data: number[][];\n  }[];\n}\n\nexport async function generateBarChart(data: BarChartData, title: string): Promise<Buffer> {\n  const configuration: ChartConfiguration = {\n    type: 'bar',\n    data: {\n      labels: data.labels,\n      datasets: data.datasets.map(ds => ({\n        label: ds.label,\n        data: ds.data,\n        backgroundColor: ds.backgroundColor || 'rgba(54, 162, 235, 0.6)',\n        borderColor: ds.borderColor || 'rgba(54, 162, 235, 1)',\n        borderWidth: 1\n      }))\n    },\n    options: {\n      responsive: true,\n      plugins: {\n        title: {\n          display: true,\n          text: title,\n          font: {\n            size: 16,\n            weight: 'bold'\n          }\n        },\n        legend: {\n          display: true,\n          position: 'top'\n        }\n      },\n      scales: {\n        y: {\n          beginAtZero: true,\n          title: {\n            display: true,\n            text: 'Value'\n          }\n        },\n        x: {\n          title: {\n            display: true,\n            text: 'Groups'\n          }\n        }\n      }\n    }\n  };\n\n  return await chartJSNodeCanvas.renderToBuffer(configuration);\n}\n\nexport async function generateScatterPlot(data: ScatterPlotData, title: string, xLabel: string, yLabel: string): Promise<Buffer> {\n  const configuration: ChartConfiguration = {\n    type: 'scatter',\n    data: {\n      datasets: data.datasets.map(ds => ({\n        label: ds.label,\n        data: ds.data,\n        backgroundColor: ds.backgroundColor || 'rgba(255, 99, 132, 0.6)',\n        borderColor: ds.borderColor || 'rgba(255, 99, 132, 1)',\n        pointRadius: 5,\n        pointHoverRadius: 7\n      }))\n    },\n    options: {\n      responsive: true,\n      plugins: {\n        title: {\n          display: true,\n          text: title,\n          font: {\n            size: 16,\n            weight: 'bold'\n          }\n        },\n        legend: {\n          display: true,\n          position: 'top'\n        }\n      },\n      scales: {\n        x: {\n          type: 'linear',\n          position: 'bottom',\n          title: {\n            display: true,\n            text: xLabel\n          }\n        },\n        y: {\n          title: {\n            display: true,\n            text: yLabel\n          }\n        }\n      }\n    }\n  };\n\n  return await chartJSNodeCanvas.renderToBuffer(configuration);\n}\n\nexport async function generateLineChart(data: BarChartData, title: string): Promise<Buffer> {\n  const configuration: ChartConfiguration = {\n    type: 'line',\n    data: {\n      labels: data.labels,\n      datasets: data.datasets.map(ds => ({\n        label: ds.label,\n        data: ds.data,\n        borderColor: ds.borderColor || 'rgba(75, 192, 192, 1)',\n        backgroundColor: ds.backgroundColor || 'rgba(75, 192, 192, 0.2)',\n        borderWidth: 2,\n        fill: false,\n        tension: 0.1\n      }))\n    },\n    options: {\n      responsive: true,\n      plugins: {\n        title: {\n          display: true,\n          text: title,\n          font: {\n            size: 16,\n            weight: 'bold'\n          }\n        },\n        legend: {\n          display: true,\n          position: 'top'\n        }\n      },\n      scales: {\n        y: {\n          beginAtZero: true,\n          title: {\n            display: true,\n            text: 'Value'\n          }\n        },\n        x: {\n          title: {\n            display: true,\n            text: 'Categories'\n          }\n        }\n      }\n    }\n  };\n\n  return await chartJSNodeCanvas.renderToBuffer(configuration);\n}\n\nexport async function generateGroupedBarChart(data: BarChartData, title: string, yLabel: string): Promise<Buffer> {\n  const configuration: ChartConfiguration = {\n    type: 'bar',\n    data: {\n      labels: data.labels,\n      datasets: data.datasets.map((ds, i) => ({\n        label: ds.label,\n        data: ds.data,\n        backgroundColor: ds.backgroundColor || `hsla(${i * 60}, 70%, 60%, 0.6)`,\n        borderColor: ds.borderColor || `hsla(${i * 60}, 70%, 60%, 1)`,\n        borderWidth: 1\n      }))\n    },\n    options: {\n      responsive: true,\n      plugins: {\n        title: {\n          display: true,\n          text: title,\n          font: {\n            size: 16,\n            weight: 'bold'\n          }\n        },\n        legend: {\n          display: true,\n          position: 'top'\n        }\n      },\n      scales: {\n        y: {\n          beginAtZero: true,\n          title: {\n            display: true,\n            text: yLabel\n          }\n        },\n        x: {\n          title: {\n            display: true,\n            text: 'Groups'\n          }\n        }\n      }\n    }\n  };\n\n  return await chartJSNodeCanvas.renderToBuffer(configuration);\n}\n","size_bytes":5322},"client/src/logic/scoring.ts":{"content":"import { Card, CardEffect, Domain, TeamState } from '@shared/schema';\n\n// Apply card effects to deterrence values\nexport function applyCardEffects(\n  card: Card,\n  buyerTeam: TeamState,\n  opponentTeam: TeamState\n): { buyer: TeamState; opponent: TeamState } {\n  if (!card.effects || card.type !== 'asset') {\n    return { buyer: buyerTeam, opponent: opponentTeam };\n  }\n\n  const newBuyer = { ...buyerTeam };\n  const newOpponent = { ...opponentTeam };\n\n  for (const effect of card.effects) {\n    if (effect.target === 'self') {\n      // Apply effect to buyer\n      newBuyer.deterrence[effect.domain] = Math.max(\n        0, \n        newBuyer.deterrence[effect.domain] + effect.delta\n      );\n    } else {\n      // Apply effect to opponent\n      newOpponent.deterrence[effect.domain] = Math.max(\n        0,\n        newOpponent.deterrence[effect.domain] + effect.delta\n      );\n    }\n  }\n\n  // Recalculate total deterrence\n  newBuyer.totalDeterrence = calculateTotalDeterrence(newBuyer.deterrence);\n  newOpponent.totalDeterrence = calculateTotalDeterrence(newOpponent.deterrence);\n\n  return { buyer: newBuyer, opponent: newOpponent };\n}\n\n// Calculate total deterrence from all domains\nexport function calculateTotalDeterrence(deterrence: Record<Domain, number>): number {\n  return Object.values(deterrence).reduce((sum, value) => sum + value, 0);\n}\n\n// Initialize default deterrence values\nexport function getInitialDeterrence(): Record<Domain, number> {\n  return {\n    joint: 100,\n    economy: 100,\n    cognitive: 100,\n    space: 100,\n    cyber: 100\n  };\n}\n\n// Calculate deterrence delta between two states\nexport function calculateDeterrenceDelta(\n  before: Record<Domain, number>,\n  after: Record<Domain, number>\n): Record<Domain, number> {\n  const delta: Record<Domain, number> = {} as Record<Domain, number>;\n  \n  for (const domain of Object.keys(before) as Domain[]) {\n    delta[domain] = after[domain] - before[domain];\n  }\n  \n  return delta;\n}","size_bytes":1945},"client/src/utils/sessionAnalyzer.ts":{"content":"import type { GameState, Team, Domain } from \"@shared/schema\";\nimport cardsData from \"@/data/cards.json\";\n\nexport interface SessionData {\n  sessionName: string;\n  gameState: GameState;\n  turnStatistics?: any;\n}\n\nexport interface AnalysisResult {\n  headlineInsight: string;\n  patterns: string[];\n  narrativeCommentary: string;\n  visualSuggestions: string[];\n}\n\nexport function analyzeGenericPatterns(sessions: SessionData[]): AnalysisResult {\n  if (sessions.length === 0) {\n    return {\n      headlineInsight: \"No sessions selected for analysis\",\n      patterns: [],\n      narrativeCommentary: \"Select some game sessions to discover winning strategies and correlations.\",\n      visualSuggestions: []\n    };\n  }\n\n  const allPatterns: string[] = [];\n  \n  // Analyze all winning strategies\n  const winnerAnalysis = analyzeAllWinningStrategies(sessions);\n  allPatterns.push(...winnerAnalysis.patterns);\n\n  // Analyze domain correlations comprehensively\n  const domainCorrelations = analyzeCompleteDomainCorrelations(sessions);\n  allPatterns.push(...domainCorrelations.patterns);\n\n  // Analyze budget strategies\n  const budgetStrategies = analyzeBudgetPatterns(sessions);\n  allPatterns.push(...budgetStrategies.patterns);\n\n  // Analyze card type effectiveness\n  const cardEffectiveness = analyzeCardTypeEffectiveness(sessions);\n  allPatterns.push(...cardEffectiveness.patterns);\n\n  // Analyze timing patterns\n  const timingPatterns = analyzeComprehensiveTiming(sessions);\n  allPatterns.push(...timingPatterns.patterns);\n\n  // Analyze turn-by-turn patterns\n  const turnPatterns = analyzeTurnByTurnPatterns(sessions);\n  allPatterns.push(...turnPatterns.patterns);\n\n  // Analyze team-specific winning formulas\n  const teamFormulas = analyzeTeamWinningFormulas(sessions);\n  allPatterns.push(...teamFormulas.patterns);\n\n  // Generate headline\n  const winnerStats = analyzeWinners(sessions);\n  const headlineInsight = generateGenericHeadline(sessions, winnerStats, allPatterns.length);\n\n  // Generate narrative\n  const narrativeCommentary = generateGenericNarrative(\n    sessions,\n    winnerAnalysis,\n    domainCorrelations,\n    budgetStrategies,\n    cardEffectiveness,\n    timingPatterns,\n    teamFormulas,\n    winnerStats\n  );\n\n  const visualSuggestions = [\n    \"Win rate correlation matrix by domain strength combinations\",\n    \"Scatter plot of budget spending vs final deterrence scores\",\n    \"Timeline heatmap showing critical decision points across all games\",\n    \"Domain strength evolution chart comparing winners vs losers\",\n    \"Card purchase frequency histogram by turn and outcome\",\n    \"Team strategy comparison radar chart showing average domain investment\"\n  ];\n\n  return {\n    headlineInsight,\n    patterns: allPatterns,\n    narrativeCommentary,\n    visualSuggestions\n  };\n}\n\nfunction analyzeAllWinningStrategies(sessions: SessionData[]) {\n  const patterns: string[] = [];\n  \n  const winners = sessions.map(s => ({\n    team: determineWinner(s.gameState),\n    state: s.gameState\n  })).filter(w => w.team !== null);\n\n  if (winners.length === 0) {\n    return { patterns: [\"No completed games to analyze winning strategies\"] };\n  }\n\n  // Analyze final scores\n  const avgWinningScore = winners.reduce((sum, w) => {\n    return sum + (w.team ? w.state.teams[w.team].totalDeterrence : 0);\n  }, 0) / winners.length;\n\n  const avgLosingScore = winners.reduce((sum, w) => {\n    const loser = w.team === 'NATO' ? 'Russia' : 'NATO';\n    return sum + w.state.teams[loser].totalDeterrence;\n  }, 0) / winners.length;\n\n  patterns.push(`Winners average ${Math.round(avgWinningScore)} total deterrence vs losers' ${Math.round(avgLosingScore)} - a ${Math.round(avgWinningScore - avgLosingScore)} point gap`);\n\n  // Analyze permanent card counts\n  const avgWinnerPermanents = winners.reduce((sum, w) => {\n    return sum + (w.team ? w.state.teams[w.team].ownedPermanents.length : 0);\n  }, 0) / winners.length;\n\n  patterns.push(`Winning teams hold an average of ${avgWinnerPermanents.toFixed(1)} permanent cards by game end`);\n\n  return { patterns };\n}\n\nfunction analyzeCompleteDomainCorrelations(sessions: SessionData[]) {\n  const patterns: string[] = [];\n  \n  const domainWins: Record<Domain, number> = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 };\n  const domainScores: Record<Domain, number[]> = { joint: [], economy: [], cognitive: [], space: [], cyber: [] };\n  \n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    if (!winner) return;\n\n    const winnerState = session.gameState.teams[winner];\n    \n    // Track which domain was strongest\n    let maxDomain: Domain = 'joint';\n    let maxScore = 0;\n    (Object.keys(winnerState.deterrence) as Domain[]).forEach(domain => {\n      const score = winnerState.deterrence[domain];\n      domainScores[domain].push(score);\n      if (score > maxScore) {\n        maxScore = score;\n        maxDomain = domain;\n      }\n    });\n    domainWins[maxDomain]++;\n  });\n\n  // Report all domain correlations\n  (Object.keys(domainWins) as Domain[]).forEach(domain => {\n    const wins = domainWins[domain];\n    const scores = domainScores[domain];\n    if (wins > 0 && scores.length > 0) {\n      const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;\n      patterns.push(`${domain.charAt(0).toUpperCase() + domain.slice(1)} domain dominance: ${wins} victories with avg score of ${Math.round(avgScore)}`);\n    }\n  });\n\n  return { patterns };\n}\n\nfunction analyzeBudgetPatterns(sessions: SessionData[]) {\n  const patterns: string[] = [];\n  \n  const winners = sessions.map(s => ({\n    team: determineWinner(s.gameState),\n    finalBudget: s.gameState.teams[determineWinner(s.gameState) || 'NATO']?.budget || 0\n  })).filter(w => w.team !== null);\n\n  if (winners.length > 0) {\n    const avgFinalBudget = winners.reduce((sum, w) => sum + w.finalBudget, 0) / winners.length;\n    \n    if (avgFinalBudget < 50) {\n      patterns.push(`Winners typically exhaust their budgets (avg ${Math.round(avgFinalBudget)}K remaining) - aggressive spending pays off`);\n    } else if (avgFinalBudget > 200) {\n      patterns.push(`Winners maintain budget reserves (avg ${Math.round(avgFinalBudget)}K remaining) - conservative play succeeds`);\n    } else {\n      patterns.push(`Winners balance spending and reserves (avg ${Math.round(avgFinalBudget)}K remaining at game end)`);\n    }\n  }\n\n  return { patterns };\n}\n\nfunction analyzeCardTypeEffectiveness(sessions: SessionData[]) {\n  const patterns: string[] = [];\n  \n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    if (!winner) return;\n\n    const winnerState = session.gameState.teams[winner];\n    const permanentCount = winnerState.ownedPermanents.length;\n    const totalPurchases = winnerState.recentPurchases?.length || 0;\n\n    if (permanentCount >= totalPurchases * 0.4) {\n      patterns.push(`High permanent card ratio (${Math.round(permanentCount / Math.max(totalPurchases, 1) * 100)}%) correlates with victory in session \"${session.sessionName}\"`);\n    }\n  });\n\n  if (patterns.length === 0) {\n    patterns.push(\"Mixed card strategies observed - no single card type dominates winning formulas\");\n  }\n\n  return { patterns };\n}\n\nfunction analyzeComprehensiveTiming(sessions: SessionData[]) {\n  const patterns: string[] = [];\n  \n  const earlyActionWins = sessions.filter(s => {\n    const winner = determineWinner(s.gameState);\n    if (!winner) return false;\n    const purchases = s.gameState.teams[winner].recentPurchases || [];\n    return purchases.filter(p => p.purchasedTurn <= 3).length >= 2;\n  }).length;\n\n  const lateActionWins = sessions.filter(s => {\n    const winner = determineWinner(s.gameState);\n    if (!winner) return false;\n    const purchases = s.gameState.teams[winner].recentPurchases || [];\n    return purchases.filter(p => p.purchasedTurn > s.gameState.maxTurns - 3).length >= 2;\n  }).length;\n\n  const totalWins = sessions.filter(s => determineWinner(s.gameState) !== null).length;\n\n  if (totalWins > 0) {\n    patterns.push(`Early aggression (turns 1-3): ${earlyActionWins} wins (${Math.round(earlyActionWins / totalWins * 100)}%)`);\n    patterns.push(`Late-game surge strategy: ${lateActionWins} wins (${Math.round(lateActionWins / totalWins * 100)}%)`);\n  }\n\n  return { patterns };\n}\n\nfunction analyzeTurnByTurnPatterns(sessions: SessionData[]) {\n  const patterns: string[] = [];\n  \n  const turnDistribution: Record<number, number> = {};\n  \n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    if (!winner) return;\n\n    const purchases = session.gameState.teams[winner].recentPurchases || [];\n    purchases.forEach(p => {\n      turnDistribution[p.purchasedTurn] = (turnDistribution[p.purchasedTurn] || 0) + 1;\n    });\n  });\n\n  const criticalTurns = Object.entries(turnDistribution)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 3);\n\n  if (criticalTurns.length > 0) {\n    patterns.push(`Most critical purchase turns: ${criticalTurns.map(([turn, count]) => `Turn ${turn} (${count} key purchases)`).join(', ')}`);\n  }\n\n  return { patterns };\n}\n\nfunction analyzeTeamWinningFormulas(sessions: SessionData[]) {\n  const patterns: string[] = [];\n  \n  const natoWins = sessions.filter(s => determineWinner(s.gameState) === 'NATO');\n  const russiaWins = sessions.filter(s => determineWinner(s.gameState) === 'Russia');\n\n  if (natoWins.length > 0) {\n    const natoAvgDomains = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 } as Record<Domain, number>;\n    natoWins.forEach(s => {\n      const state = s.gameState.teams.NATO;\n      (Object.keys(state.deterrence) as Domain[]).forEach(d => {\n        natoAvgDomains[d] += state.deterrence[d];\n      });\n    });\n    \n    const topNATODomain = (Object.entries(natoAvgDomains) as [Domain, number][])\n      .sort((a, b) => b[1] - a[1])[0];\n    \n    patterns.push(`NATO winning formula: Prioritize ${topNATODomain[0]} (avg ${Math.round(topNATODomain[1] / natoWins.length)}) across ${natoWins.length} victories`);\n  }\n\n  if (russiaWins.length > 0) {\n    const russiaAvgDomains = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 } as Record<Domain, number>;\n    russiaWins.forEach(s => {\n      const state = s.gameState.teams.Russia;\n      (Object.keys(state.deterrence) as Domain[]).forEach(d => {\n        russiaAvgDomains[d] += state.deterrence[d];\n      });\n    });\n    \n    const topRussiaDomain = (Object.entries(russiaAvgDomains) as [Domain, number][])\n      .sort((a, b) => b[1] - a[1])[0];\n    \n    patterns.push(`Russia winning formula: Prioritize ${topRussiaDomain[0]} (avg ${Math.round(topRussiaDomain[1] / russiaWins.length)}) across ${russiaWins.length} victories`);\n  }\n\n  return { patterns };\n}\n\nfunction generateGenericHeadline(sessions: SessionData[], winnerStats: any, patternCount: number): string {\n  if (sessions.length === 0) return \"No data to analyze\";\n  if (winnerStats.total === 0) return `Analyzed ${sessions.length} sessions - ${patternCount} strategic patterns identified`;\n\n  return `Comprehensive analysis of ${sessions.length} sessions reveals ${patternCount} distinct winning strategies and performance correlations.`;\n}\n\nfunction generateGenericNarrative(\n  sessions: SessionData[],\n  winnerAnalysis: any,\n  domainCorrelations: any,\n  budgetStrategies: any,\n  cardEffectiveness: any,\n  timingPatterns: any,\n  teamFormulas: any,\n  winnerStats: any\n): string {\n  if (sessions.length === 0) {\n    return \"Select some game sessions to unlock comprehensive strategic analysis. The system will identify all winning patterns, domain correlations, and effective strategies without limitations.\";\n  }\n\n  let narrative = `Analyzing ${sessions.length} complete strategic encounters, we've identified every measurable pattern that correlates with victory. `;\n\n  if (winnerStats.total > 0) {\n    narrative += `Out of ${winnerStats.total} decided games, the data reveals clear performance gaps between winners and losers across all dimensions. `;\n  }\n\n  narrative += `The winning strategies aren't random - they follow identifiable patterns in domain investment, timing, and resource allocation. `;\n  \n  narrative += `Some teams dominate through single-domain superiority, building an insurmountable lead in one area. Others spread their investments across multiple domains, creating a balanced deterrence profile that's hard to crack. `;\n\n  narrative += `Budget management separates winners from losers - not just how much you spend, but when you spend it and what you buy. `;\n\n  narrative += `Permanent cards provide long-term value, but asset cards deliver immediate impact. Expert advisors offer specialized advantages at critical moments. The most successful teams find the right mix for their strategic approach. `;\n\n  narrative += `Every session tells a story of adaptation, timing, and strategic vision. The patterns are here - learn from them, adapt them to your style, and execute with precision.`;\n\n  return narrative;\n}\n\nexport function analyzeSelectedSessions(sessions: SessionData[]): AnalysisResult {\n  if (sessions.length === 0) {\n    return {\n      headlineInsight: \"No sessions selected for analysis\",\n      patterns: [],\n      narrativeCommentary: \"Select some game sessions to see strategic patterns and insights.\",\n      visualSuggestions: []\n    };\n  }\n\n  // Analyze card timing patterns\n  const cardTimingInsights = analyzeCardTiming(sessions);\n  \n  // Analyze momentum and comebacks\n  const momentumInsights = analyzeMomentumSwings(sessions);\n  \n  // Analyze team asymmetry\n  const asymmetryInsights = analyzeTeamAsymmetry(sessions);\n  \n  // Analyze comeback triggers\n  const comebackInsights = analyzeComebackTriggers(sessions);\n  \n  // Analyze dimension correlation\n  const dimensionInsights = analyzeDimensionCorrelation(sessions);\n  \n  // Analyze strategy consistency\n  const consistencyInsights = analyzeStrategyConsistency(sessions);\n  \n  // Analyze cross-session patterns\n  const crossSessionInsights = analyzeCrossSessionPatterns(sessions);\n\n  // Analyze card statistics\n  const cardStatsInsights = analyzeCardStatistics(sessions);\n\n  // Determine winner stats\n  const winnerStats = analyzeWinners(sessions);\n\n  // Build the comprehensive analysis\n  const allPatterns = [\n    ...cardTimingInsights.patterns,\n    ...momentumInsights.patterns,\n    ...asymmetryInsights.patterns,\n    ...comebackInsights.patterns,\n    ...dimensionInsights.patterns,\n    ...consistencyInsights.patterns,\n    ...crossSessionInsights.patterns,\n    ...cardStatsInsights.patterns\n  ].filter(Boolean);\n\n  const headlineInsight = generateHeadlineInsight(sessions, winnerStats, dimensionInsights);\n  const narrativeCommentary = generateNarrativeCommentary(\n    sessions,\n    cardTimingInsights,\n    momentumInsights,\n    asymmetryInsights,\n    comebackInsights,\n    dimensionInsights,\n    consistencyInsights,\n    crossSessionInsights,\n    winnerStats\n  );\n\n  const visualSuggestions = [\n    \"Timeline chart showing deterrence momentum shifts turn-by-turn\",\n    \"Heatmap of domain strength by team (NATO vs Russia average deterrence per domain)\",\n    \"Bar chart comparing early-game vs late-game card purchase timing\",\n    \"Win rate breakdown by dominant dimension for each team\",\n    \"Comeback frequency tracker showing turn-by-turn lead changes\"\n  ];\n\n  return {\n    headlineInsight,\n    patterns: allPatterns,\n    narrativeCommentary,\n    visualSuggestions\n  };\n}\n\nfunction analyzeCardTiming(sessions: SessionData[]) {\n  let earlyPermanentWins = 0;\n  let latePermanentWins = 0;\n  let totalGamesWithWinner = 0;\n\n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    if (!winner) return;\n    \n    totalGamesWithWinner++;\n    const winnerState = session.gameState.teams[winner];\n    \n    // Check when permanents were acquired\n    const earlyPermanents = winnerState.recentPurchases?.filter(p => \n      p.purchasedTurn <= 4 && \n      winnerState.ownedPermanents.some(perm => perm.id === p.cardId)\n    ).length || 0;\n    \n    const latePermanents = winnerState.recentPurchases?.filter(p => \n      p.purchasedTurn > 4 && \n      winnerState.ownedPermanents.some(perm => perm.id === p.cardId)\n    ).length || 0;\n\n    if (earlyPermanents > latePermanents) earlyPermanentWins++;\n    else if (latePermanents > earlyPermanents) latePermanentWins++;\n  });\n\n  const patterns = [];\n  if (totalGamesWithWinner > 0) {\n    if (earlyPermanentWins > latePermanentWins) {\n      patterns.push(`Early permanent cards strongly correlate with victory (${Math.round(earlyPermanentWins / totalGamesWithWinner * 100)}% of wins)`);\n    } else if (latePermanentWins > earlyPermanentWins) {\n      patterns.push(`Late-game permanent acquisitions can turn the tide (${Math.round(latePermanentWins / totalGamesWithWinner * 100)}% of wins)`);\n    } else {\n      patterns.push(\"Permanent card timing shows no clear pattern - victory depends on overall strategy\");\n    }\n  }\n\n  return { patterns, earlyPermanentWins, latePermanentWins };\n}\n\nfunction analyzeMomentumSwings(sessions: SessionData[]) {\n  let comebackWins = 0;\n  let dominantWins = 0;\n\n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    if (!winner) return;\n\n    // Check mid-game (turn 5) vs final scores\n    const loser = winner === 'NATO' ? 'Russia' : 'NATO';\n    const finalWinnerScore = session.gameState.teams[winner].totalDeterrence;\n    const finalLoserScore = session.gameState.teams[loser].totalDeterrence;\n\n    // If we had turn statistics, we could check mid-game scores\n    // For now, use margin of victory as proxy\n    const margin = Math.abs(finalWinnerScore - finalLoserScore);\n    \n    if (margin < 100) {\n      comebackWins++;\n    } else {\n      dominantWins++;\n    }\n  });\n\n  const patterns = [];\n  const total = comebackWins + dominantWins;\n  if (total > 0) {\n    if (comebackWins > dominantWins) {\n      patterns.push(`Comebacks are the norm - ${Math.round(comebackWins / total * 100)}% of games are close battles to the end`);\n    } else {\n      patterns.push(`Early leads tend to stick - ${Math.round(dominantWins / total * 100)}% of games show clear dominance from start to finish`);\n    }\n  }\n\n  return { patterns, comebackWins, dominantWins };\n}\n\nfunction analyzeTeamAsymmetry(sessions: SessionData[]) {\n  const natoStrengths: Record<Domain, number> = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 };\n  const russiaStrengths: Record<Domain, number> = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 };\n  let natoCount = 0;\n  let russiaCount = 0;\n\n  sessions.forEach(session => {\n    const natoState = session.gameState.teams.NATO;\n    const russiaState = session.gameState.teams.Russia;\n\n    (Object.keys(natoStrengths) as Domain[]).forEach(domain => {\n      natoStrengths[domain] += natoState.deterrence[domain];\n      russiaStrengths[domain] += russiaState.deterrence[domain];\n    });\n\n    natoCount++;\n    russiaCount++;\n  });\n\n  const patterns = [];\n  if (natoCount > 0) {\n    const natoAvg = Object.entries(natoStrengths).map(([domain, total]) => ({\n      domain,\n      avg: total / natoCount\n    })).sort((a, b) => b.avg - a.avg);\n\n    const russiaAvg = Object.entries(russiaStrengths).map(([domain, total]) => ({\n      domain,\n      avg: total / russiaCount\n    })).sort((a, b) => b.avg - a.avg);\n\n    patterns.push(`NATO's go-to domains: ${natoAvg[0].domain} (avg ${Math.round(natoAvg[0].avg)}), ${natoAvg[1].domain} (avg ${Math.round(natoAvg[1].avg)})`);\n    patterns.push(`Russia's preferred battlegrounds: ${russiaAvg[0].domain} (avg ${Math.round(russiaAvg[0].avg)}), ${russiaAvg[1].domain} (avg ${Math.round(russiaAvg[1].avg)})`);\n  }\n\n  return { patterns, natoStrengths, russiaStrengths };\n}\n\nfunction analyzeComebackTriggers(sessions: SessionData[]) {\n  const patterns = [];\n  \n  // Analyze strategy log for comeback patterns\n  sessions.forEach(session => {\n    const log = session.gameState.strategyLog || [];\n    const midGameActions = log.filter(entry => entry.turn >= 5 && entry.turn <= 8);\n    \n    if (midGameActions.length > 0) {\n      // Look for patterns in mid-game purchases\n      const permanentPurchases = midGameActions.filter(entry => \n        entry.action.includes('permanent') || entry.action.includes('Permanent')\n      );\n      \n      if (permanentPurchases.length > 2) {\n        patterns.push(\"Mid-game permanent card investments often trigger momentum shifts\");\n      }\n    }\n  });\n\n  if (patterns.length === 0) {\n    patterns.push(\"Comeback triggers vary - no single card type dominates turnaround scenarios\");\n  }\n\n  return { patterns };\n}\n\nfunction analyzeDimensionCorrelation(sessions: SessionData[]) {\n  const winsByDomain: Record<Domain, number> = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 };\n  let totalWins = 0;\n\n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    if (!winner) return;\n    \n    totalWins++;\n    const winnerState = session.gameState.teams[winner];\n    \n    // Find winner's strongest domain\n    let strongestDomain: Domain = 'joint';\n    let maxScore = 0;\n    (Object.keys(winnerState.deterrence) as Domain[]).forEach(domain => {\n      if (winnerState.deterrence[domain] > maxScore) {\n        maxScore = winnerState.deterrence[domain];\n        strongestDomain = domain;\n      }\n    });\n\n    winsByDomain[strongestDomain]++;\n  });\n\n  const patterns = [];\n  if (totalWins > 0) {\n    const sortedDomains = (Object.entries(winsByDomain) as [Domain, number][])\n      .sort((a, b) => b[1] - a[1]);\n    \n    patterns.push(`${sortedDomains[0][0]} dominance appears in ${Math.round(sortedDomains[0][1] / totalWins * 100)}% of victories - the most decisive dimension`);\n    \n    if (sortedDomains[1][1] > 0) {\n      patterns.push(`${sortedDomains[1][0]} strength correlates with ${Math.round(sortedDomains[1][1] / totalWins * 100)}% of wins - a solid secondary path`);\n    }\n  }\n\n  return { patterns, winsByDomain };\n}\n\nfunction analyzeStrategyConsistency(sessions: SessionData[]) {\n  let balancedWins = 0;\n  let focusedWins = 0;\n\n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    if (!winner) return;\n    \n    const winnerState = session.gameState.teams[winner];\n    const scores = Object.values(winnerState.deterrence);\n    const avg = scores.reduce((a, b) => a + b, 0) / scores.length;\n    const variance = scores.reduce((sum, score) => sum + Math.pow(score - avg, 2), 0) / scores.length;\n\n    if (variance < 500) {\n      balancedWins++;\n    } else {\n      focusedWins++;\n    }\n  });\n\n  const patterns = [];\n  const total = balancedWins + focusedWins;\n  if (total > 0) {\n    if (balancedWins > focusedWins) {\n      patterns.push(`Balanced offense across all domains wins ${Math.round(balancedWins / total * 100)}% of the time - consistency beats specialization`);\n    } else {\n      patterns.push(`Focused domain dominance wins ${Math.round(focusedWins / total * 100)}% of games - specialists prevail over generalists`);\n    }\n  }\n\n  return { patterns, balancedWins, focusedWins };\n}\n\nfunction analyzeCrossSessionPatterns(sessions: SessionData[]) {\n  const patterns = [];\n  \n  // Find common winning patterns\n  const winners = sessions.map(s => determineWinner(s.gameState)).filter(Boolean);\n  const natoWins = winners.filter(w => w === 'NATO').length;\n  const russiaWins = winners.filter(w => w === 'Russia').length;\n\n  if (winners.length > 0) {\n    patterns.push(`Across ${sessions.length} sessions: NATO ${natoWins} wins, Russia ${russiaWins} wins`);\n    \n    if (sessions.length >= 3) {\n      // Check for recurring strategies\n      const earlySpenders = sessions.filter(s => {\n        const winner = determineWinner(s.gameState);\n        if (!winner) return false;\n        const purchases = s.gameState.teams[winner].recentPurchases || [];\n        return purchases.filter(p => p.purchasedTurn <= 3).length >= 3;\n      }).length;\n\n      if (earlySpenders >= sessions.length / 2) {\n        patterns.push(`${Math.round(earlySpenders / sessions.length * 100)}% of winners invested heavily in turns 1-3 - early aggression pays off`);\n      }\n    }\n  }\n\n  return { patterns };\n}\n\nfunction analyzeCardStatistics(sessions: SessionData[]) {\n  const patterns = [];\n  \n  // Create a lookup map for cards\n  const cardLookup = new Map(cardsData.map(card => [card.id, card]));\n  \n  // Track card purchase frequency\n  const cardPurchases: Record<string, { count: number; wins: number; cardName: string; cardType: string }> = {};\n  \n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    \n    // Analyze both teams' purchases\n    ['NATO', 'Russia'].forEach(teamName => {\n      const team = session.gameState.teams[teamName as Team];\n      const isWinner = winner === teamName;\n      \n      team.recentPurchases?.forEach(purchase => {\n        const card = cardLookup.get(purchase.cardId);\n        \n        if (!cardPurchases[purchase.cardId]) {\n          cardPurchases[purchase.cardId] = {\n            count: 0,\n            wins: 0,\n            cardName: card?.name || purchase.cardId,\n            cardType: card?.type || 'unknown'\n          };\n        }\n        cardPurchases[purchase.cardId].count++;\n        if (isWinner) {\n          cardPurchases[purchase.cardId].wins++;\n        }\n      });\n    });\n  });\n\n  // Find most frequently purchased cards\n  const sortedByFrequency = Object.entries(cardPurchases)\n    .sort((a, b) => b[1].count - a[1].count)\n    .slice(0, 5);\n\n  if (sortedByFrequency.length > 0) {\n    // Show all top 5 with counts\n    sortedByFrequency.forEach(([_, data], index) => {\n      if (index === 0) {\n        patterns.push(`Most purchased card: ${data.cardName} (${data.count} purchases across all sessions)`);\n      } else {\n        patterns.push(`#${index + 1} popular pick: ${data.cardName} (${data.count} purchases)`);\n      }\n    });\n  }\n\n  // Analyze card types by winner\n  const cardTypeStats: Record<string, { total: number; winnerPurchases: number }> = {\n    asset: { total: 0, winnerPurchases: 0 },\n    permanent: { total: 0, winnerPurchases: 0 },\n    expert: { total: 0, winnerPurchases: 0 }\n  };\n\n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    \n    ['NATO', 'Russia'].forEach(teamName => {\n      const team = session.gameState.teams[teamName as Team];\n      const isWinner = winner === teamName;\n      \n      team.recentPurchases?.forEach(purchase => {\n        const card = cardLookup.get(purchase.cardId);\n        const cardType = card?.type || 'asset';\n        if (cardTypeStats[cardType]) {\n          cardTypeStats[cardType].total++;\n          if (isWinner) {\n            cardTypeStats[cardType].winnerPurchases++;\n          }\n        }\n      });\n    });\n  });\n\n  // Report card type effectiveness\n  Object.entries(cardTypeStats).forEach(([type, stats]) => {\n    if (stats.total > 0) {\n      const winRate = Math.round((stats.winnerPurchases / stats.total) * 100);\n      const typeName = type.charAt(0).toUpperCase() + type.slice(1);\n      patterns.push(`${typeName} cards: ${stats.total} purchases total, ${winRate}% win rate when used`);\n    }\n  });\n\n  // Find cards with highest win correlation\n  const winningCards = Object.entries(cardPurchases)\n    .filter(([_, data]) => data.count >= 2) // At least 2 purchases\n    .sort((a, b) => (b[1].wins / b[1].count) - (a[1].wins / a[1].count))\n    .slice(0, 3);\n\n  if (winningCards.length > 0) {\n    winningCards.forEach(([_, data]) => {\n      const winRate = Math.round((data.wins / data.count) * 100);\n      if (winRate >= 60) {\n        patterns.push(`${data.cardName} shows strong correlation with victory (${winRate}% win rate in ${data.count} uses)`);\n      }\n    });\n  }\n\n  // Analyze permanent card holdings\n  const permanentCardCounts: number[] = [];\n  sessions.forEach(session => {\n    const winner = determineWinner(session.gameState);\n    if (winner) {\n      const winnerState = session.gameState.teams[winner];\n      permanentCardCounts.push(winnerState.ownedPermanents.length);\n    }\n  });\n\n  if (permanentCardCounts.length > 0) {\n    const avgPermanents = permanentCardCounts.reduce((sum, count) => sum + count, 0) / permanentCardCounts.length;\n    const maxPermanents = Math.max(...permanentCardCounts);\n    patterns.push(`Winning teams average ${avgPermanents.toFixed(1)} permanent cards (max: ${maxPermanents} in a single victory)`);\n  }\n\n  return { patterns };\n}\n\nfunction analyzeWinners(sessions: SessionData[]) {\n  const natoWins = sessions.filter(s => determineWinner(s.gameState) === 'NATO').length;\n  const russiaWins = sessions.filter(s => determineWinner(s.gameState) === 'Russia').length;\n  \n  return { natoWins, russiaWins, total: natoWins + russiaWins };\n}\n\nfunction determineWinner(gameState: GameState): Team | null {\n  const natoScore = gameState.teams.NATO.totalDeterrence;\n  const russiaScore = gameState.teams.Russia.totalDeterrence;\n  \n  if (natoScore > russiaScore) return 'NATO';\n  if (russiaScore > natoScore) return 'Russia';\n  return null;\n}\n\nfunction generateHeadlineInsight(\n  sessions: SessionData[],\n  winnerStats: { natoWins: number; russiaWins: number; total: number },\n  dimensionInsights: { winsByDomain: Record<Domain, number> }\n): string {\n  if (sessions.length === 0) return \"No data to analyze\";\n  if (winnerStats.total === 0) return `Analyzed ${sessions.length} sessions - all games still in progress or tied`;\n\n  const topDomain = (Object.entries(dimensionInsights.winsByDomain) as [Domain, number][])\n    .sort((a, b) => b[1] - a[1])[0];\n\n  if (winnerStats.natoWins > winnerStats.russiaWins) {\n    return `NATO dominates with ${winnerStats.natoWins} victories across ${sessions.length} sessions, with ${topDomain[0]} superiority being the most decisive factor.`;\n  } else if (winnerStats.russiaWins > winnerStats.natoWins) {\n    return `Russia takes control with ${winnerStats.russiaWins} wins across ${sessions.length} matches, leveraging ${topDomain[0]} strength as their primary weapon.`;\n  } else {\n    return `A dead heat - NATO and Russia split ${winnerStats.total} decisions evenly, with ${topDomain[0]} emerging as the key battleground dimension.`;\n  }\n}\n\nfunction generateNarrativeCommentary(\n  sessions: SessionData[],\n  cardTiming: any,\n  momentum: any,\n  asymmetry: any,\n  comeback: any,\n  dimension: any,\n  consistency: any,\n  crossSession: any,\n  winners: any\n): string {\n  if (sessions.length === 0) {\n    return \"Select some game sessions to unlock detailed strategic insights. The analysis will examine card timing, momentum shifts, team preferences, and winning patterns across your selected matches.\";\n  }\n\n  let commentary = `Looking at ${sessions.length} strategic encounters, we're seeing some fascinating patterns emerge. `;\n\n  // Winner narrative\n  if (winners.total > 0) {\n    if (winners.natoWins > winners.russiaWins) {\n      commentary += `NATO's been running the table lately, notching ${winners.natoWins} wins compared to Russia's ${winners.russiaWins}. `;\n    } else if (winners.russiaWins > winners.natoWins) {\n      commentary += `Russia's finding their groove with ${winners.russiaWins} victories while NATO manages just ${winners.natoWins}. `;\n    } else {\n      commentary += `It's a perfectly balanced rivalry - both sides claiming ${winners.natoWins} wins apiece. `;\n    }\n  }\n\n  // Card timing narrative\n  if (cardTiming.earlyPermanentWins > cardTiming.latePermanentWins) {\n    commentary += `Winners are investing in permanent cards early - it's like building your infrastructure in the first quarter and reaping dividends all game long. `;\n  } else if (cardTiming.latePermanentWins > cardTiming.earlyPermanentWins) {\n    commentary += `We're seeing late-game permanent purchases paying off - teams that stay patient and strike in the clutch are finding success. `;\n  }\n\n  // Momentum narrative\n  if (momentum.comebackWins > momentum.dominantWins) {\n    commentary += `These matches are nail-biters - early leads mean nothing when the late game arrives. `;\n  } else if (momentum.dominantWins > 0) {\n    commentary += `Once a team gets ahead, they tend to stay there - early momentum is king in these matchups. `;\n  }\n\n  // Strategy consistency narrative\n  if (consistency.balancedWins > consistency.focusedWins) {\n    commentary += `The balanced approach is winning out - teams that spread their investments across all five dimensions are harder to crack. `;\n  } else if (consistency.focusedWins > 0) {\n    commentary += `Specialists are thriving - picking two or three domains and dominating them proves more effective than spreading thin. `;\n  }\n\n  commentary += `The data tells a clear story: success requires reading the opponent, timing your investments, and either building an unassailable lead or staying close enough to strike when opportunities emerge.`;\n\n  return commentary;\n}\n","size_bytes":32715},"client/src/components/TeamPanel.tsx":{"content":"import { Team, TeamState, Domain } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport DomainBadge from \"./DomainBadge\";\nimport { formatCurrency } from \"../logic/pricing\";\nimport { sanitizeText } from \"../logic/guards\";\nimport { Shield, Clock, Coins } from \"lucide-react\";\n\ninterface TeamPanelProps {\n  team: Team;\n  teamState: TeamState;\n  isActive?: boolean;\n  currentTurn?: number;\n}\n\nconst teamColors = {\n  NATO: \"bg-blue-600 text-white\",\n  Russia: \"bg-red-600 text-white\"\n};\n\nconst teamBorders = {\n  NATO: \"ring-2 ring-blue-500\",\n  Russia: \"ring-2 ring-red-500\"\n};\n\nexport default function TeamPanel({ team, teamState, isActive = false, currentTurn = 1 }: TeamPanelProps) {\n  const domainOrder: Domain[] = ['joint', 'economy', 'cognitive', 'space', 'cyber'];\n\n  return (\n    <Card \n      className={`${teamBorders[team]} transition-all`}\n      data-testid={`panel-team-${team.toLowerCase()}`}\n    >\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center gap-2\">\n          <Badge className={teamColors[team]}>\n            <Shield className=\"w-4 h-4 mr-1\" />\n            {sanitizeText(team)}\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-4\">\n        {/* Budget */}\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <Coins className=\"w-4 h-4 text-muted-foreground\" />\n              <span className=\"text-sm font-medium\">Budget</span>\n            </div>\n            <span className=\"font-mono font-semibold\" data-testid={`text-budget-${team.toLowerCase()}`}>\n              {formatCurrency(teamState.budget)}\n            </span>\n          </div>\n          {currentTurn === 1 && (\n            <div className=\"text-xs text-muted-foreground\">\n              Turn 1: Must spend exactly 200K per domain\n            </div>\n          )}\n        </div>\n\n        {/* Total Deterrence */}\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm font-medium\">Total Deterrence</span>\n            <span className=\"font-mono font-bold text-lg\" data-testid={`text-total-deterrence-${team.toLowerCase()}`}>\n              {teamState.totalDeterrence}\n            </span>\n          </div>\n        </div>\n\n        {/* Domain Deterrence */}\n        <div className=\"space-y-3\">\n          <h4 className=\"text-sm font-medium text-muted-foreground\">Dimensional Deterrence</h4>\n          {domainOrder.map(domain => (\n            <div key={domain} className=\"space-y-1\">\n              <div className=\"flex items-center justify-between\">\n                <DomainBadge domain={domain} className=\"text-xs\" />\n                <span className=\"font-mono text-sm\" data-testid={`text-deterrence-${domain}-${team.toLowerCase()}`}>\n                  {teamState.deterrence[domain]}\n                </span>\n              </div>\n              <Progress \n                value={200} \n                max={200} \n                className={`h-2 ${team === 'Russia' ? '[&>div]:bg-red-500' : '[&>div]:bg-blue-500'}`}\n              />\n            </div>\n          ))}\n        </div>\n\n        {/* Active Permanents */}\n        {teamState.ownedPermanents.length > 0 && (\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-medium text-muted-foreground\">Active Permanents</h4>\n            <div className=\"flex flex-wrap gap-1\">\n              {teamState.ownedPermanents.map((permanent, index) => (\n                <Badge \n                  key={`permanent-${permanent.id}-${index}`} \n                  variant=\"secondary\" \n                  className=\"text-xs\"\n                  data-testid={`badge-permanent-${permanent.id}`}\n                >\n                  {permanent.id}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Permanent Queue */}\n        {teamState.permanentsQueue && teamState.permanentsQueue.length > 0 && (\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-medium text-muted-foreground flex items-center gap-1\">\n              <Clock className=\"w-3 h-3\" />\n              Permanent Queue\n            </h4>\n            <div className=\"space-y-1\">\n              {(teamState.permanentsQueue || []).map((permanent, index) => (\n                <div \n                  key={`permanent-queue-${permanent.card.id}-${index}`}\n                  className=\"flex items-center justify-between text-xs\"\n                  data-testid={`permanent-queue-${permanent.card.id}`}\n                >\n                  <span>{permanent.card.name}</span>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    T+{permanent.availableTurn}\n                  </Badge>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Expert Queue */}\n        {teamState.expertsQueue.length > 0 && (\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-medium text-muted-foreground flex items-center gap-1\">\n              <Clock className=\"w-3 h-3\" />\n              Expert Queue\n            </h4>\n            <div className=\"space-y-1\">\n              {teamState.expertsQueue.map((expert, index) => (\n                <div \n                  key={`expert-${expert.card.id}-${index}`}\n                  className=\"flex items-center justify-between text-xs\"\n                  data-testid={`expert-queue-${expert.card.id}`}\n                >\n                  <span>{expert.card.name}</span>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    T+{expert.availableTurn}\n                  </Badge>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Cart Items */}\n        {teamState.cart.length > 0 && (\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-medium text-muted-foreground\">Cart ({teamState.cart.length})</h4>\n            <div className=\"flex flex-wrap gap-1\">\n              {teamState.cart.map((card, index) => (\n                <Badge \n                  key={`cart-${card.id}-${index}`} \n                  variant=\"outline\" \n                  className=\"text-xs\"\n                  data-testid={`badge-cart-${card.id}`}\n                >\n                  {card.id}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6687},"client/src/utils/statisticalCalculations.ts":{"content":"import * as ss from 'simple-statistics';\n\nexport interface TTestResult {\n  tStatistic: number;\n  degreesOfFreedom: number;\n  pValue: number;\n  mean1: number;\n  mean2: number;\n  sd1: number;\n  sd2: number;\n  n1: number;\n  n2: number;\n  cohensD: number;\n  significant: boolean;\n}\n\nexport interface CorrelationResult {\n  coefficient: number;\n  pValue: number;\n  n: number;\n  significant: boolean;\n  interpretation: string;\n}\n\nexport interface ANOVAResult {\n  fStatistic: number;\n  pValue: number;\n  betweenGroupsDF: number;\n  withinGroupsDF: number;\n  betweenGroupsSS: number;\n  withinGroupsSS: number;\n  totalSS: number;\n  etaSquared: number;\n  significant: boolean;\n  groupMeans: { group: string; mean: number; sd: number; n: number }[];\n}\n\nexport interface RegressionResult {\n  slope: number;\n  intercept: number;\n  rSquared: number;\n  fStatistic: number;\n  pValue: number;\n  standardError: number;\n  n: number;\n  significant: boolean;\n}\n\nexport function calculateTTest(group1: number[], group2: number[]): TTestResult {\n  // Validate inputs\n  if (group1.length < 2 || group2.length < 2) {\n    return {\n      tStatistic: 0,\n      degreesOfFreedom: 0,\n      pValue: 1,\n      mean1: group1.length > 0 ? ss.mean(group1) || 0 : 0,\n      mean2: group2.length > 0 ? ss.mean(group2) || 0 : 0,\n      sd1: 0,\n      sd2: 0,\n      n1: group1.length,\n      n2: group2.length,\n      cohensD: 0,\n      significant: false\n    };\n  }\n  \n  const mean1 = ss.mean(group1) || 0;\n  const mean2 = ss.mean(group2) || 0;\n  const sd1 = ss.standardDeviation(group1) || 0;\n  const sd2 = ss.standardDeviation(group2) || 0;\n  const n1 = group1.length;\n  const n2 = group2.length;\n  \n  const result = ss.tTestTwoSample(group1, group2) || 0;\n  \n  const pooledSD = Math.sqrt(((n1 - 1) * sd1 * sd1 + (n2 - 1) * sd2 * sd2) / (n1 + n2 - 2));\n  const cohensD = pooledSD > 0 ? Math.abs(mean1 - mean2) / pooledSD : 0;\n  \n  const df = n1 + n2 - 2;\n  const pValue = calculateTTestPValue(result, df);\n  \n  return {\n    tStatistic: result,\n    degreesOfFreedom: df,\n    pValue,\n    mean1,\n    mean2,\n    sd1,\n    sd2,\n    n1,\n    n2,\n    cohensD,\n    significant: pValue < 0.05\n  };\n}\n\nfunction calculateTTestPValue(tStat: number, df: number): number {\n  const absTStat = Math.abs(tStat);\n  \n  if (df < 1) return 1;\n  \n  const t = absTStat;\n  const a = df / (df + t * t);\n  \n  let p = a;\n  if (df > 1) {\n    let term = a;\n    for (let i = df - 2; i >= 2; i -= 2) {\n      term *= a * i / (i + 1);\n      p += term;\n    }\n  }\n  \n  if (df % 2 === 0) {\n    p = 1 - Math.sqrt(a) * p;\n  } else {\n    p = 1 - (2 / Math.PI) * (Math.atan(t / Math.sqrt(df)) + Math.sqrt(a) * p);\n  }\n  \n  return Math.min(Math.max(p * 2, 0), 1);\n}\n\nexport function calculateCorrelation(x: number[], y: number[]): CorrelationResult {\n  if (x.length !== y.length || x.length < 3) {\n    return {\n      coefficient: 0,\n      pValue: 1,\n      n: x.length,\n      significant: false,\n      interpretation: 'Insufficient data (need at least 3 data points)'\n    };\n  }\n  \n  const r = ss.sampleCorrelation(x, y);\n  const n = x.length;\n  \n  const t = r * Math.sqrt((n - 2) / (1 - r * r));\n  const df = n - 2;\n  const pValue = calculateTTestPValue(t, df);\n  \n  let interpretation = '';\n  const absR = Math.abs(r);\n  if (absR < 0.3) interpretation = 'weak';\n  else if (absR < 0.7) interpretation = 'moderate';\n  else interpretation = 'strong';\n  \n  if (r < 0) interpretation += ' negative';\n  else interpretation += ' positive';\n  \n  return {\n    coefficient: r,\n    pValue,\n    n,\n    significant: pValue < 0.05,\n    interpretation\n  };\n}\n\nexport function calculateANOVA(groups: { name: string; values: number[] }[]): ANOVAResult {\n  // Validate inputs - need at least 2 groups with at least 2 values each\n  const validGroups = groups.filter(g => g.values.length >= 2);\n  if (validGroups.length < 2) {\n    return {\n      fStatistic: 0,\n      pValue: 1,\n      betweenGroupsDF: 0,\n      withinGroupsDF: 0,\n      betweenGroupsSS: 0,\n      withinGroupsSS: 0,\n      totalSS: 0,\n      etaSquared: 0,\n      significant: false,\n      groupMeans: groups.map(g => ({\n        group: g.name,\n        mean: g.values.length > 0 ? ss.mean(g.values) || 0 : 0,\n        sd: g.values.length > 1 ? ss.standardDeviation(g.values) || 0 : 0,\n        n: g.values.length\n      }))\n    };\n  }\n  \n  const allValues: number[] = [];\n  const groupSizes: number[] = [];\n  const groupMeans: { group: string; mean: number; sd: number; n: number }[] = [];\n  \n  validGroups.forEach(group => {\n    allValues.push(...group.values);\n    groupSizes.push(group.values.length);\n    groupMeans.push({\n      group: group.name,\n      mean: ss.mean(group.values) || 0,\n      sd: ss.standardDeviation(group.values) || 0,\n      n: group.values.length\n    });\n  });\n  \n  const grandMean = ss.mean(allValues) || 0;\n  const totalN = allValues.length;\n  const k = validGroups.length;\n  \n  let betweenGroupsSS = 0;\n  validGroups.forEach((group, i) => {\n    const groupMean = ss.mean(group.values) || 0;\n    betweenGroupsSS += groupSizes[i] * Math.pow(groupMean - grandMean, 2);\n  });\n  \n  let withinGroupsSS = 0;\n  validGroups.forEach((group) => {\n    const groupMean = ss.mean(group.values) || 0;\n    group.values.forEach(value => {\n      withinGroupsSS += Math.pow(value - groupMean, 2);\n    });\n  });\n  \n  const totalSS = betweenGroupsSS + withinGroupsSS;\n  \n  const betweenGroupsDF = k - 1;\n  const withinGroupsDF = totalN - k;\n  \n  const betweenGroupsMS = betweenGroupsSS / betweenGroupsDF;\n  const withinGroupsMS = withinGroupsSS / withinGroupsDF;\n  \n  const fStatistic = betweenGroupsMS / withinGroupsMS;\n  \n  const pValue = calculateFTestPValue(fStatistic, betweenGroupsDF, withinGroupsDF);\n  \n  const etaSquared = betweenGroupsSS / totalSS;\n  \n  return {\n    fStatistic,\n    pValue,\n    betweenGroupsDF,\n    withinGroupsDF,\n    betweenGroupsSS,\n    withinGroupsSS,\n    totalSS,\n    etaSquared,\n    significant: pValue < 0.05,\n    groupMeans\n  };\n}\n\nfunction calculateFTestPValue(f: number, df1: number, df2: number): number {\n  if (f <= 0 || df1 <= 0 || df2 <= 0) return 1;\n  \n  const x = df2 / (df2 + df1 * f);\n  \n  let p = betaIncomplete(x, df2 / 2, df1 / 2);\n  \n  return Math.min(Math.max(p, 0), 1);\n}\n\nfunction betaIncomplete(x: number, a: number, b: number): number {\n  if (x <= 0) return 0;\n  if (x >= 1) return 1;\n  \n  const bt = Math.exp(\n    gammaLn(a + b) - gammaLn(a) - gammaLn(b) +\n    a * Math.log(x) + b * Math.log(1 - x)\n  );\n  \n  if (x < (a + 1) / (a + b + 2)) {\n    return bt * betaContinuedFraction(x, a, b) / a;\n  } else {\n    return 1 - bt * betaContinuedFraction(1 - x, b, a) / b;\n  }\n}\n\nfunction betaContinuedFraction(x: number, a: number, b: number): number {\n  const maxIterations = 100;\n  const epsilon = 3e-7;\n  \n  const qab = a + b;\n  const qap = a + 1;\n  const qam = a - 1;\n  let c = 1;\n  let d = 1 - qab * x / qap;\n  \n  if (Math.abs(d) < epsilon) d = epsilon;\n  d = 1 / d;\n  let h = d;\n  \n  for (let m = 1; m <= maxIterations; m++) {\n    const m2 = 2 * m;\n    let aa = m * (b - m) * x / ((qam + m2) * (a + m2));\n    d = 1 + aa * d;\n    if (Math.abs(d) < epsilon) d = epsilon;\n    c = 1 + aa / c;\n    if (Math.abs(c) < epsilon) c = epsilon;\n    d = 1 / d;\n    h *= d * c;\n    \n    aa = -(a + m) * (qab + m) * x / ((a + m2) * (qap + m2));\n    d = 1 + aa * d;\n    if (Math.abs(d) < epsilon) d = epsilon;\n    c = 1 + aa / c;\n    if (Math.abs(c) < epsilon) c = epsilon;\n    d = 1 / d;\n    const del = d * c;\n    h *= del;\n    \n    if (Math.abs(del - 1) < epsilon) break;\n  }\n  \n  return h;\n}\n\nfunction gammaLn(x: number): number {\n  const cof = [\n    76.18009172947146, -86.50532032941677,\n    24.01409824083091, -1.231739572450155,\n    0.001208650973866179, -0.000005395239384953\n  ];\n  \n  let y = x;\n  let tmp = x + 5.5;\n  tmp -= (x + 0.5) * Math.log(tmp);\n  let ser = 1.000000000190015;\n  \n  for (let j = 0; j < 6; j++) {\n    ser += cof[j] / ++y;\n  }\n  \n  return -tmp + Math.log(2.5066282746310005 * ser / x);\n}\n\nexport function calculateRegression(x: number[], y: number[]): RegressionResult {\n  if (x.length !== y.length || x.length < 3) {\n    return {\n      slope: 0,\n      intercept: 0,\n      rSquared: 0,\n      fStatistic: 0,\n      pValue: 1,\n      standardError: 0,\n      n: x.length,\n      significant: false\n    };\n  }\n  \n  const n = x.length;\n  const regression = ss.linearRegression([x, y]);\n  const slope = regression.m;\n  const intercept = regression.b;\n  \n  const yMean = ss.mean(y) || 0;\n  let sst = 0;\n  let sse = 0;\n  \n  for (let i = 0; i < n; i++) {\n    const yPred = slope * x[i] + intercept;\n    sst += Math.pow(y[i] - yMean, 2);\n    sse += Math.pow(y[i] - yPred, 2);\n  }\n  \n  const rSquared = 1 - (sse / sst);\n  const mse = sse / (n - 2);\n  const standardError = Math.sqrt(mse);\n  \n  const msr = (sst - sse);\n  const fStatistic = msr / mse;\n  \n  const pValue = calculateFTestPValue(fStatistic, 1, n - 2);\n  \n  return {\n    slope,\n    intercept,\n    rSquared,\n    fStatistic,\n    pValue,\n    standardError,\n    n,\n    significant: pValue < 0.05\n  };\n}\n","size_bytes":8972},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"./components/ThemeProvider\";\nimport MDDSStrategy from \"./pages/MDDSStrategy\";\nimport SinglePlayerGame from \"./pages/SinglePlayerGame\";\nimport MobileSession from \"./pages/MobileSession\";\nimport MobileLogin from \"./pages/MobileLogin\";\nimport DatabaseSessions from \"./pages/DatabaseSessions\";\nimport Analysis from \"./pages/Analysis\";\nimport Research from \"./pages/Research\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={MDDSStrategy} />\n      <Route path=\"/single-player\" component={SinglePlayerGame} />\n      <Route path=\"/database\" component={DatabaseSessions} />\n      <Route path=\"/analysis\" component={Analysis} />\n      <Route path=\"/research\" component={Research} />\n      <Route path=\"/mobile\" component={MobileLogin} />\n      <Route path=\"/mobile/:sessionName\" component={MobileSession} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <ThemeProvider defaultTheme=\"dark\" storageKey=\"mdds-theme\">\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </QueryClientProvider>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1536},"client/src/components/TurnController.tsx":{"content":"import { useState } from 'react';\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { AlertTriangle, Play, SkipForward, RotateCcw } from \"lucide-react\";\nimport { sanitizeText } from '../logic/guards';\n\ninterface TurnControllerProps {\n  currentTurn: number;\n  maxTurns: number;\n  currentTeam: 'NATO' | 'Russia';\n  phase: 'purchase' | 'commit' | 'advance';\n  onCommitPurchases: () => void;\n  onAdvanceTurn: () => void;\n  onUndoLastCommit?: () => void;\n  canCommit: boolean;\n  canAdvance: boolean;\n  validationErrors: string[];\n}\n\nexport default function TurnController({\n  currentTurn,\n  maxTurns,\n  currentTeam,\n  phase,\n  onCommitPurchases,\n  onAdvanceTurn, \n  onUndoLastCommit,\n  canCommit,\n  canAdvance,\n  validationErrors\n}: TurnControllerProps) {\n  const [isConfirmingCommit, setIsConfirmingCommit] = useState(false);\n\n  const turnProgress = (currentTurn / maxTurns) * 100;\n\n  const handleCommit = () => {\n    if (validationErrors.length > 0) {\n      setIsConfirmingCommit(true);\n      return;\n    }\n    onCommitPurchases();\n    setIsConfirmingCommit(false);\n  };\n\n  return (\n    <Card data-testid=\"turn-controller\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Play className=\"w-5 h-5\" />\n            {sanitizeText('Turn Controller')}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\">Turn {currentTurn}/{maxTurns}</Badge>\n            <Badge className={currentTeam === 'NATO' ? 'bg-blue-600' : 'bg-red-600'}>\n              {currentTeam}\n            </Badge>\n          </div>\n        </CardTitle>\n        \n        <div className=\"space-y-2\">\n          <div className=\"flex justify-between text-sm\">\n            <span>Strategy Progress</span>\n            <span>{Math.round(turnProgress)}%</span>\n          </div>\n          <Progress value={turnProgress} className=\"h-2\" />\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        {/* Phase Indicator */}\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-sm font-medium\">Current Phase:</span>\n          <Badge variant={phase === 'purchase' ? 'default' : 'secondary'}>\n            {sanitizeText(phase.charAt(0).toUpperCase() + phase.slice(1))} Phase\n          </Badge>\n        </div>\n\n        {/* Validation Errors */}\n        {validationErrors.length > 0 && (\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-2 text-destructive\">\n              <AlertTriangle className=\"w-4 h-4\" />\n              <span className=\"text-sm font-medium\">Validation Issues:</span>\n            </div>\n            <ul className=\"text-sm text-destructive space-y-1\">\n              {validationErrors.map((error, index) => (\n                <li key={index} className=\"ml-4\" data-testid={`error-${index}`}>\n                   {sanitizeText(error)}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {/* Action Buttons */}\n        <div className=\"flex flex-col gap-2\">\n          {!isConfirmingCommit ? (\n            <>\n              <Button\n                onClick={handleCommit}\n                disabled={!canCommit}\n                size=\"lg\"\n                className=\"w-full\"\n                data-testid=\"button-commit-purchases\"\n              >\n                <Play className=\"w-4 h-4 mr-2\" />\n                {sanitizeText('Commit Purchases')}\n              </Button>\n              \n              <Button\n                onClick={onAdvanceTurn}\n                disabled={!canAdvance}\n                variant=\"outline\"\n                size=\"lg\" \n                className=\"w-full\"\n                data-testid=\"button-advance-turn\"\n              >\n                <SkipForward className=\"w-4 h-4 mr-2\" />\n                {sanitizeText('Advance Turn')}\n              </Button>\n              \n              {onUndoLastCommit && (\n                <Button\n                  onClick={onUndoLastCommit}\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  className=\"w-full\"\n                  data-testid=\"button-undo-commit\"\n                >\n                  <RotateCcw className=\"w-4 h-4 mr-2\" />\n                  {sanitizeText('Undo Last Commit')}\n                </Button>\n              )}\n            </>\n          ) : (\n            <div className=\"space-y-2\">\n              <p className=\"text-sm text-destructive font-medium\">\n                {sanitizeText('There are validation issues. Commit anyway?')}\n              </p>\n              <div className=\"flex gap-2\">\n                <Button\n                  onClick={() => {\n                    onCommitPurchases();\n                    setIsConfirmingCommit(false);\n                  }}\n                  variant=\"destructive\"\n                  size=\"sm\"\n                  className=\"flex-1\"\n                  data-testid=\"button-force-commit\"\n                >\n                  {sanitizeText('Force Commit')}\n                </Button>\n                <Button\n                  onClick={() => setIsConfirmingCommit(false)}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"flex-1\"\n                  data-testid=\"button-cancel-commit\"\n                >\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Turn Information */}\n        <div className=\"text-xs text-muted-foreground space-y-1\">\n          {currentTurn === 1 && (\n            <p>{sanitizeText('Turn 1: Must spend exactly 200K per domain')}</p>\n          )}\n          {currentTurn >= 2 && (\n            <p>{sanitizeText('Turn 2+: 1000K pooled budget available')}</p>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6043},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"design_guidelines.md":{"content":"# MDDS Web Application Design Guidelines\n\n## Design Approach: Design System (Material Design)\n**Justification**: This is a utility-focused, information-dense strategic planning application requiring clear hierarchy, excellent readability, and consistent interaction patterns. Material Design provides the structured foundation needed for complex data visualization and decision-making interfaces.\n\n## Core Design Elements\n\n### Color Palette\n**Primary Colors:**\n- Light mode: 63 91% 23% (NATO blue-green)\n- Dark mode: 220 85% 25% (deep strategic blue)\n\n**Background Colors:**\n- Light mode: 0 0% 98% (near white)\n- Dark mode: 220 15% 8% (dark strategic)\n\n**Domain-Specific Accent Colors:**\n- Joint: 240 75% 45% (command blue)\n- Economy: 120 60% 35% (economic green)\n- Cognitive: 280 65% 45% (information purple)\n- Space: 200 70% 40% (orbital cyan)\n- Cyber: 15 85% 50% (cyber orange)\n\n### Typography\n**Font Families**: Inter (primary), JetBrains Mono (data/codes)\n**Hierarchy**: \n- Headers: 600 weight, strategic spacing\n- Body: 400 weight, high readability\n- Data/Stats: 500 weight, tabular alignment\n\n### Layout System\n**Spacing Units**: Consistent use of Tailwind units 2, 4, 8, 12, 16\n- Micro spacing (2): Button padding, icon gaps\n- Standard spacing (4, 8): Component internal spacing\n- Section spacing (12, 16): Major layout divisions\n\n### Component Library\n\n**Navigation**: Top-mounted command bar with team status indicators and turn counter\n\n**Team Panels**: Side-mounted panels showing:\n- Budget allocation displays with progress bars\n- Domain deterrence meters (0-100 scale)\n- Active permanent cards with discount indicators\n\n**Card Shop Interface**:\n- Filterable grid layout with domain color-coding\n- Shopping cart with running totals\n- Card preview with detailed effect descriptions\n\n**Strategy Log**: Chronological action feed with:\n- Turn-based organization\n- Action type icons\n- Impact summaries with numerical changes\n\n**Data Displays**:\n- Deterrence scoring dashboard\n- Budget allocation pie charts\n- Turn progression timeline\n\n**Interactive Elements**:\n- Prominent action buttons with clear state feedback\n- Drag-and-drop card interactions\n- Modal dialogs for complex decisions\n\n### Accessibility Features\n- Consistent dark mode across all components\n- High contrast ratios for strategic data\n- Keyboard navigation with visible focus indicators\n- Screen reader support with descriptive ARIA labels\n- Color-blind friendly domain differentiation using icons + colors\n\n### Visual Hierarchy\n- Primary actions: Bold, high-contrast buttons\n- Secondary data: Subtle borders and backgrounds\n- Critical alerts: Strategic red warnings for budget/constraint violations\n- Success states: Muted green confirmations\n\n**Key Principle**: Maintain military/strategic aesthetics while ensuring rapid information processing and decision-making clarity.","size_bytes":2850},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/pages/Research.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, FlaskConical, Filter, TrendingUp, BarChart3, ListChecks, FileText, Download, CreditCard } from \"lucide-react\";\nimport { prepareReportData } from \"@/utils/reportDataPreparation\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Label } from \"@/components/ui/label\";\nimport { Domain } from '@shared/schema';\nimport cardsData from '../data/cards.json';\n\ninterface GameSession {\n  sessionName: string;\n  gameState: any;\n  turnStatistics?: Array<{\n    turn: number;\n    natoTotalDeterrence: number;\n    russiaTotalDeterrence: number;\n    natoDeterrence: Record<Domain, number>;\n    russiaDeterrence: Record<Domain, number>;\n    timestamp: string;\n  }>;\n  sessionInfo?: {\n    participants?: Array<{ name: string; team: string }>;\n  };\n  createdAt: string;\n}\n\ninterface StatisticalTest {\n  name: string;\n  description: string;\n  requirements: string[];\n  appropriate: boolean;\n  reason: string;\n}\n\nconst domains: Domain[] = ['joint', 'economy', 'cognitive', 'space', 'cyber'];\n\nexport default function Research() {\n  const [, setLocation] = useLocation();\n  const [selectedSessions, setSelectedSessions] = useState<string[]>([]);\n  const [sessionSearch, setSessionSearch] = useState(\"\");\n  const [winnerFilter, setWinnerFilter] = useState<string>(\"all\");\n  const [dateFilter, setDateFilter] = useState<string>(\"all\");\n  \n  // Variable selection for analysis\n  const [selectedVariables, setSelectedVariables] = useState<string[]>([]);\n  const [groupingVariable, setGroupingVariable] = useState<string>(\"team\");\n  const [comparisonType, setComparisonType] = useState<string>(\"between\");\n  \n  // Card Purchase Frequency Analysis\n  const [selectedCards, setSelectedCards] = useState<string[]>([]);\n  const [cardTeamFilter, setCardTeamFilter] = useState<string>(\"both\");\n  \n  // Research Question Development (Left Column)\n  const [researchQuestionLeft, setResearchQuestionLeft] = useState<string>(\"\");\n  const [selectedPredefinedQuestionLeft, setSelectedPredefinedQuestionLeft] = useState<string>(\"\");\n  \n  // Research Question Development (Right Column)\n  const [researchQuestionRight, setResearchQuestionRight] = useState<string>(\"\");\n  const [selectedPredefinedQuestionRight, setSelectedPredefinedQuestionRight] = useState<string>(\"\");\n  \n  // Hypothesis Development 1 (Left Column)\n  const [hypothesis1, setHypothesis1] = useState<string>(\"\");\n  const [selectedPredefinedHypothesis1, setSelectedPredefinedHypothesis1] = useState<string>(\"\");\n  \n  // Hypothesis Development 2 (Right Column)\n  const [hypothesis2, setHypothesis2] = useState<string>(\"\");\n  const [selectedPredefinedHypothesis2, setSelectedPredefinedHypothesis2] = useState<string>(\"\");\n  \n  // Predefined research questions\n  const predefinedQuestions = [\n    {\n      id: \"card-strategy-effectiveness\",\n      label: \"Card Strategy Effectiveness\",\n      text: \"Which card purchasing strategies are most effective at achieving victory across different strategic scenarios?\"\n    },\n    {\n      id: \"domain-investment-patterns\",\n      label: \"Domain Investment Patterns\",\n      text: \"How does investment distribution across the five domains (Joint, Economy, Cognitive, Space, Cyber) correlate with final deterrence scores?\"\n    },\n    {\n      id: \"team-performance-differences\",\n      label: \"Team Performance Differences\",\n      text: \"Are there significant performance differences between NATO and Russia teams in terms of deterrence outcomes and strategic approaches?\"\n    },\n    {\n      id: \"budget-allocation-efficiency\",\n      label: \"Budget Allocation Efficiency\",\n      text: \"What budget allocation patterns lead to the most efficient conversion of resources into deterrence capability?\"\n    },\n    {\n      id: \"permanent-vs-temporary-cards\",\n      label: \"Permanent vs Temporary Cards\",\n      text: \"How do permanent cards compare to temporary assets and expert cards in terms of overall strategic value?\"\n    },\n    {\n      id: \"early-vs-late-investment\",\n      label: \"Early vs Late Investment\",\n      text: \"Does the timing of strategic investments (early turns vs late turns) affect final deterrence outcomes?\"\n    },\n    {\n      id: \"defensive-offensive-balance\",\n      label: \"Defensive-Offensive Balance\",\n      text: \"What is the optimal balance between defensive and offensive card strategies for achieving victory?\"\n    },\n    {\n      id: \"comeback-possibility\",\n      label: \"Comeback Possibilities\",\n      text: \"Can teams successfully recover from early deterrence deficits, and what strategies enable such comebacks?\"\n    },\n    {\n      id: \"domain-specialization\",\n      label: \"Domain Specialization\",\n      text: \"Is domain specialization (focusing on 1-2 domains) more effective than balanced investment across all domains?\"\n    },\n    {\n      id: \"turn-duration-impact\",\n      label: \"Turn Duration Impact\",\n      text: \"How does the length of a strategic session (total number of turns) influence winning strategies and final outcomes?\"\n    }\n  ];\n  \n  // Predefined scientific hypotheses\n  const predefinedHypotheses = [\n    {\n      id: \"expert-cards-winning\",\n      label: \"Expert Cards & Victory\",\n      text: \"Purchasing expert cards is positively correlated with winning the strategy session.\"\n    },\n    {\n      id: \"intelligence-cards-winning\",\n      label: \"Intelligence Cards & Victory\",\n      text: \"Purchasing intelligence cards is positively correlated with winning the strategy session.\"\n    },\n    {\n      id: \"permanent-cards-winning\",\n      label: \"Permanent Cards & Victory\",\n      text: \"Purchasing permanent cards is positively correlated with winning the strategy session.\"\n    },\n    {\n      id: \"early-permanent-cards\",\n      label: \"Early Permanent Card Advantage\",\n      text: \"Purchasing permanent cards earlier than the opponent is positively correlated with winning.\"\n    },\n    {\n      id: \"economy-deterrence-total\",\n      label: \"Economy Domain & Total Deterrence\",\n      text: \"Deterrence in the economy dimension is positively correlated with total overall deterrence score.\"\n    },\n    {\n      id: \"cyber-defense-investment\",\n      label: \"Cyber Defense Investment\",\n      text: \"Higher investment in cyber defensive cards is associated with improved cyber domain deterrence.\"\n    },\n    {\n      id: \"space-domain-early\",\n      label: \"Early Space Domain Focus\",\n      text: \"Investing in space domain cards during early turns (1-3) is positively correlated with final space deterrence scores.\"\n    },\n    {\n      id: \"budget-efficiency\",\n      label: \"Budget Efficiency & Victory\",\n      text: \"Teams that spend more efficiently (higher deterrence per budget unit) are more likely to win.\"\n    },\n    {\n      id: \"cognitive-offensive\",\n      label: \"Cognitive Offensive Strategy\",\n      text: \"Offensive cards targeting the cognitive domain are more effective than defensive cognitive cards at influencing outcomes.\"\n    },\n    {\n      id: \"joint-domain-balance\",\n      label: \"Joint Domain Balance\",\n      text: \"Balanced investment across all domains in the joint category correlates with higher overall strategic success.\"\n    },\n    {\n      id: \"turn-count-winning\",\n      label: \"Strategy Duration & Victory\",\n      text: \"Longer strategy sessions (more turns) favor teams with stronger permanent card portfolios.\"\n    },\n    {\n      id: \"first-mover-advantage\",\n      label: \"First Mover Advantage\",\n      text: \"The team making the first major card purchase has a strategic advantage in deterrence building.\"\n    },\n    {\n      id: \"defensive-vs-offensive\",\n      label: \"Defensive vs Offensive Balance\",\n      text: \"Teams with a higher ratio of defensive to offensive cards have better long-term deterrence sustainability.\"\n    },\n    {\n      id: \"domain-specialization\",\n      label: \"Domain Specialization Strategy\",\n      text: \"Specializing in one or two domains yields higher deterrence than spreading investments equally across all five domains.\"\n    },\n    {\n      id: \"budget-pooling-timing\",\n      label: \"Budget Pooling Timing\",\n      text: \"Effective utilization of pooled budget phases (turns 2+) is correlated with higher final deterrence scores.\"\n    },\n    {\n      id: \"nato-russia-asymmetry\",\n      label: \"NATO-Russia Strategic Asymmetry\",\n      text: \"NATO and Russia require different strategic approaches, with NATO performing better with economic focus and Russia with cyber/cognitive focus.\"\n    },\n    {\n      id: \"comeback-mechanisms\",\n      label: \"Comeback Mechanisms\",\n      text: \"Teams that are behind after turn 3 can successfully employ offensive strategies to reduce opponent deterrence and achieve victory.\"\n    },\n    {\n      id: \"permanent-card-quantity\",\n      label: \"Permanent Card Portfolio Size\",\n      text: \"The total number of permanent cards owned is positively correlated with final deterrence scores.\"\n    }\n  ];\n  \n  // Report generation\n  const [selectedMethodology, setSelectedMethodology] = useState<string>(\"\");\n  const [generatedReport, setGeneratedReport] = useState<string>(\"\");\n  const [isGeneratingReport, setIsGeneratingReport] = useState(false);\n\n  const { data: sessions, isLoading } = useQuery<GameSession[]>({\n    queryKey: ['/api/sessions'],\n  });\n\n  const handleBack = () => {\n    setLocation('/database');\n  };\n\n  const toggleSession = (sessionName: string) => {\n    setSelectedSessions(prev =>\n      prev.includes(sessionName)\n        ? prev.filter(s => s !== sessionName)\n        : [...prev, sessionName]\n    );\n  };\n\n  const toggleVariable = (variable: string) => {\n    setSelectedVariables(prev =>\n      prev.includes(variable)\n        ? prev.filter(v => v !== variable)\n        : [...prev, variable]\n    );\n  };\n\n  const toggleCard = (cardId: string) => {\n    setSelectedCards(prev =>\n      prev.includes(cardId)\n        ? prev.filter(c => c !== cardId)\n        : [...prev, cardId]\n    );\n  };\n\n  const selectAllSessions = () => {\n    if (filteredSessions.length === selectedSessions.length) {\n      setSelectedSessions([]);\n    } else {\n      setSelectedSessions(filteredSessions.map(s => s.sessionName));\n    }\n  };\n\n  const getWinner = (session: GameSession) => {\n    const natoScore = session.gameState?.teams?.NATO?.totalDeterrence || 0;\n    const russiaScore = session.gameState?.teams?.Russia?.totalDeterrence || 0;\n    return natoScore > russiaScore ? \"NATO\" : natoScore < russiaScore ? \"Russia\" : \"Tie\";\n  };\n\n  const filteredSessions = useMemo(() => {\n    if (!sessions) return [];\n    \n    let filtered = [...sessions];\n    \n    if (sessionSearch) {\n      filtered = filtered.filter(s => \n        s.sessionName.toLowerCase().includes(sessionSearch.toLowerCase())\n      );\n    }\n    \n    if (winnerFilter !== \"all\") {\n      filtered = filtered.filter(s => getWinner(s) === winnerFilter);\n    }\n    \n    if (dateFilter !== \"all\") {\n      const now = new Date();\n      const filterDate = new Date();\n      \n      if (dateFilter === \"week\") {\n        filterDate.setDate(now.getDate() - 7);\n      } else if (dateFilter === \"month\") {\n        filterDate.setMonth(now.getMonth() - 1);\n      } else if (dateFilter === \"3months\") {\n        filterDate.setMonth(now.getMonth() - 3);\n      }\n      \n      filtered = filtered.filter(s => new Date(s.createdAt) >= filterDate);\n    }\n    \n    return filtered.sort((a, b) => \n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n  }, [sessions, sessionSearch, winnerFilter, dateFilter]);\n\n  // Available variables for analysis\n  const availableVariables = [\n    { id: \"nato_total\", label: \"NATO Total Deterrence\", category: \"Overall\" },\n    { id: \"russia_total\", label: \"Russia Total Deterrence\", category: \"Overall\" },\n    { id: \"nato_joint\", label: \"NATO Joint Domain\", category: \"NATO Domains\" },\n    { id: \"nato_economy\", label: \"NATO Economy Domain\", category: \"NATO Domains\" },\n    { id: \"nato_cognitive\", label: \"NATO Cognitive Domain\", category: \"NATO Domains\" },\n    { id: \"nato_space\", label: \"NATO Space Domain\", category: \"NATO Domains\" },\n    { id: \"nato_cyber\", label: \"NATO Cyber Domain\", category: \"NATO Domains\" },\n    { id: \"russia_joint\", label: \"Russia Joint Domain\", category: \"Russia Domains\" },\n    { id: \"russia_economy\", label: \"Russia Economy Domain\", category: \"Russia Domains\" },\n    { id: \"russia_cognitive\", label: \"Russia Cognitive Domain\", category: \"Russia Domains\" },\n    { id: \"russia_space\", label: \"Russia Space Domain\", category: \"Russia Domains\" },\n    { id: \"russia_cyber\", label: \"Russia Cyber Domain\", category: \"Russia Domains\" },\n    { id: \"turn_count\", label: \"Number of Turns\", category: \"Session Metrics\" },\n    { id: \"card_count\", label: \"Total Cards Purchased\", category: \"Card Tracking\" },\n  ];\n\n  // Statistical test recommendations\n  const getStatisticalRecommendations = (): StatisticalTest[] => {\n    const numSessions = selectedSessions.length;\n    const numVariables = selectedVariables.length;\n    \n    // Calculate actual number of groups based on grouping variable\n    let numGroups = 2; // default for team\n    if (groupingVariable === \"team\") {\n      numGroups = 2; // NATO vs Russia\n    } else if (groupingVariable === \"winner\") {\n      // Count distinct winners from selected sessions\n      const selectedSessionData = sessions?.filter(s => selectedSessions.includes(s.sessionName)) || [];\n      const uniqueWinners = new Set(selectedSessionData.map(s => getWinner(s)));\n      numGroups = uniqueWinners.size;\n    } else if (groupingVariable === \"session\") {\n      // Each session is a group\n      numGroups = numSessions;\n    }\n    \n    const tests: StatisticalTest[] = [\n      {\n        name: \"Independent Samples t-test\",\n        description: \"Compare means between two independent groups on a single continuous variable\",\n        requirements: [\n          \"Two independent groups\",\n          \"One continuous dependent variable\",\n          \"Normal distribution (or n  30)\",\n          \"Homogeneity of variance\"\n        ],\n        appropriate: numGroups === 2 && numVariables === 1 && numSessions >= 2,\n        reason: numGroups !== 2 \n          ? \"Need exactly 2 groups\"\n          : numVariables !== 1\n          ? \"Need exactly 1 dependent variable\"\n          : numSessions < 2\n          ? \"Need at least 2 sessions\"\n          : \"All requirements met\"\n      },\n      {\n        name: \"Paired Samples t-test\",\n        description: \"Compare means from the same group measured at different times or conditions\",\n        requirements: [\n          \"Two related measurements\",\n          \"One continuous variable\",\n          \"Normal distribution of differences\",\n          \"Same subjects/sessions\"\n        ],\n        appropriate: comparisonType === \"within\" && numVariables === 1 && numSessions >= 2,\n        reason: comparisonType !== \"within\"\n          ? \"Need within-subjects comparison\"\n          : numVariables !== 1\n          ? \"Need exactly 1 variable\"\n          : numSessions < 2\n          ? \"Need at least 2 sessions\"\n          : \"All requirements met\"\n      },\n      {\n        name: \"One-Way ANOVA\",\n        description: \"Compare means across three or more independent groups on a single variable\",\n        requirements: [\n          \"Three or more independent groups\",\n          \"One continuous dependent variable\",\n          \"Normal distribution in each group\",\n          \"Homogeneity of variance\"\n        ],\n        appropriate: numGroups >= 3 && numVariables === 1 && numSessions >= 3,\n        reason: numGroups < 3\n          ? \"Need at least 3 groups\"\n          : numVariables !== 1\n          ? \"Need exactly 1 dependent variable\"\n          : numSessions < 3\n          ? \"Need at least 3 sessions\"\n          : \"All requirements met\"\n      },\n      {\n        name: \"Repeated Measures ANOVA\",\n        description: \"Compare means across three or more time points or conditions (same subjects)\",\n        requirements: [\n          \"Three or more repeated measurements\",\n          \"One continuous variable\",\n          \"Sphericity assumption\",\n          \"Normal distribution\"\n        ],\n        appropriate: comparisonType === \"within\" && numSessions >= 3 && numVariables === 1,\n        reason: comparisonType !== \"within\"\n          ? \"Need within-subjects design\"\n          : numSessions < 3\n          ? \"Need at least 3 sessions\"\n          : numVariables !== 1\n          ? \"Need exactly 1 variable\"\n          : \"All requirements met\"\n      },\n      {\n        name: \"MANOVA (Multivariate ANOVA)\",\n        description: \"Compare group means across multiple dependent variables simultaneously\",\n        requirements: [\n          \"Two or more independent groups\",\n          \"Two or more continuous dependent variables\",\n          \"Multivariate normality\",\n          \"Homogeneity of covariance matrices\"\n        ],\n        appropriate: numGroups >= 2 && numVariables >= 2 && numSessions >= 2,\n        reason: numGroups < 2\n          ? \"Need at least 2 groups\"\n          : numVariables < 2\n          ? \"Need at least 2 dependent variables\"\n          : numSessions < 2\n          ? \"Need at least 2 sessions\"\n          : \"All requirements met\"\n      },\n      {\n        name: \"Two-Way ANOVA\",\n        description: \"Examine effects of two independent variables on one dependent variable\",\n        requirements: [\n          \"Two categorical independent variables (factors)\",\n          \"One continuous dependent variable\",\n          \"Independent observations\",\n          \"Normal distribution and homogeneity of variance\"\n        ],\n        appropriate: false,\n        reason: \"Requires two independent grouping factors - current interface supports only one factor. To use Two-Way ANOVA, analyze sessions with multiple categorical variables (e.g., team  domain, winner  time period) using external statistical software.\"\n      },\n      {\n        name: \"Correlation Analysis (Pearson/Spearman)\",\n        description: \"Measure strength and direction of relationship between two continuous variables\",\n        requirements: [\n          \"Two continuous variables\",\n          \"Linear relationship (Pearson) or monotonic (Spearman)\",\n          \"Independent observations\"\n        ],\n        appropriate: numVariables === 2 && numSessions >= 3,\n        reason: numVariables !== 2\n          ? \"Need exactly 2 variables\"\n          : numSessions < 3\n          ? \"Need at least 3 sessions for meaningful correlation\"\n          : \"All requirements met\"\n      },\n      {\n        name: \"Multiple Regression\",\n        description: \"Predict one variable from multiple predictor variables\",\n        requirements: [\n          \"One continuous dependent variable\",\n          \"One or more independent variables\",\n          \"Linear relationship\",\n          \"No multicollinearity among predictors\"\n        ],\n        appropriate: numVariables >= 2 && numSessions >= numVariables * 5,\n        reason: numVariables < 2\n          ? \"Need at least 2 variables (1 dependent + 1 predictor)\"\n          : numSessions < numVariables * 5\n          ? `Need at least ${numVariables * 5} sessions (5 number of variables)`\n          : \"All requirements met\"\n      },\n      {\n        name: \"Chi-Square Test\",\n        description: \"Test association between categorical variables\",\n        requirements: [\n          \"Two or more categorical variables\",\n          \"Independent observations\",\n          \"Expected frequency  5 in each cell\"\n        ],\n        appropriate: groupingVariable !== \"\" && numSessions >= 5,\n        reason: groupingVariable === \"\"\n          ? \"Need categorical grouping variable\"\n          : numSessions < 5\n          ? \"Need at least 5 sessions for adequate cell frequencies\"\n          : \"Appropriate for winner  dimension analysis\"\n      },\n      {\n        name: \"Mann-Whitney U Test (Non-parametric)\",\n        description: \"Compare distributions between two groups when data is not normally distributed\",\n        requirements: [\n          \"Two independent groups\",\n          \"One ordinal or continuous variable\",\n          \"No assumption of normality\"\n        ],\n        appropriate: numGroups === 2 && numVariables === 1 && numSessions >= 2,\n        reason: numGroups !== 2\n          ? \"Need exactly 2 groups\"\n          : numVariables !== 1\n          ? \"Need exactly 1 variable\"\n          : numSessions < 2\n          ? \"Need at least 2 sessions\"\n          : \"Robust alternative to t-test when normality is violated\"\n      },\n      {\n        name: \"Kruskal-Wallis Test (Non-parametric)\",\n        description: \"Compare distributions across three or more groups (non-parametric alternative to ANOVA)\",\n        requirements: [\n          \"Three or more independent groups\",\n          \"One ordinal or continuous variable\",\n          \"No assumption of normality\"\n        ],\n        appropriate: numGroups >= 3 && numVariables === 1 && numSessions >= 3,\n        reason: numGroups < 3\n          ? \"Need at least 3 groups\"\n          : numVariables !== 1\n          ? \"Need exactly 1 variable\"\n          : numSessions < 3\n          ? \"Need at least 3 sessions\"\n          : \"Robust alternative to ANOVA when normality is violated\"\n      }\n    ];\n\n    return tests.sort((a, b) => {\n      if (a.appropriate && !b.appropriate) return -1;\n      if (!a.appropriate && b.appropriate) return 1;\n      return 0;\n    });\n  };\n\n  const statisticalTests = useMemo(() => getStatisticalRecommendations(), [\n    selectedSessions,\n    selectedVariables.length,\n    groupingVariable,\n    comparisonType,\n    sessions\n  ]);\n\n  // Calculate summary statistics for selected sessions and variables\n  const calculateSummaryStats = () => {\n    if (selectedSessions.length === 0 || selectedVariables.length === 0) return null;\n\n    const selectedSessionData = sessions?.filter(s => selectedSessions.includes(s.sessionName)) || [];\n    const stats: Record<string, any> = {};\n\n    selectedVariables.forEach(varId => {\n      const values: number[] = [];\n      \n      selectedSessionData.forEach(session => {\n        if (varId === \"nato_total\") {\n          values.push(session.gameState?.teams?.NATO?.totalDeterrence || 0);\n        } else if (varId === \"russia_total\") {\n          values.push(session.gameState?.teams?.Russia?.totalDeterrence || 0);\n        } else if (varId.startsWith(\"nato_\")) {\n          const domain = varId.replace(\"nato_\", \"\") as Domain;\n          values.push(session.gameState?.teams?.NATO?.deterrence?.[domain] || 0);\n        } else if (varId.startsWith(\"russia_\")) {\n          const domain = varId.replace(\"russia_\", \"\") as Domain;\n          values.push(session.gameState?.teams?.Russia?.deterrence?.[domain] || 0);\n        } else if (varId === \"turn_count\") {\n          values.push(session.gameState?.turn || 0);\n        } else if (varId === \"card_count\") {\n          const natoCards = session.gameState?.strategyLog?.filter((log: any) => log.team === \"NATO\").length || 0;\n          const russiaCards = session.gameState?.strategyLog?.filter((log: any) => log.team === \"Russia\").length || 0;\n          values.push(natoCards + russiaCards);\n        }\n      });\n\n      if (values.length > 0) {\n        const mean = values.reduce((sum, val) => sum + val, 0) / values.length;\n        const sortedValues = [...values].sort((a, b) => a - b);\n        const median = sortedValues.length % 2 === 0\n          ? (sortedValues[sortedValues.length / 2 - 1] + sortedValues[sortedValues.length / 2]) / 2\n          : sortedValues[Math.floor(sortedValues.length / 2)];\n        \n        const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;\n        const stdDev = Math.sqrt(variance);\n        const min = Math.min(...values);\n        const max = Math.max(...values);\n\n        stats[varId] = {\n          label: availableVariables.find(v => v.id === varId)?.label || varId,\n          n: values.length,\n          mean: mean.toFixed(2),\n          median: median.toFixed(2),\n          stdDev: stdDev.toFixed(2),\n          min: min.toFixed(2),\n          max: max.toFixed(2),\n          range: (max - min).toFixed(2)\n        };\n      }\n    });\n\n    return stats;\n  };\n\n  const summaryStats = useMemo(() => calculateSummaryStats(), [\n    selectedSessions,\n    selectedVariables,\n    sessions\n  ]);\n\n  // Analyze hypothesis and recommend variables\n  const recommendedVariables = useMemo(() => {\n    if (!hypothesis.trim()) return [];\n    \n    const lowerHypothesis = hypothesis.toLowerCase();\n    const recommendations: string[] = [];\n    \n    // Keywords for different variable types\n    const keywords = {\n      nato_total: ['nato total', 'nato overall', 'nato deterrence score', 'nato performance'],\n      russia_total: ['russia total', 'russia overall', 'russia deterrence score', 'russia performance'],\n      nato_joint: ['nato joint', 'nato military'],\n      nato_economy: ['nato economy', 'nato economic'],\n      nato_cognitive: ['nato cognitive', 'nato information', 'nato perception'],\n      nato_space: ['nato space', 'nato satellite'],\n      nato_cyber: ['nato cyber', 'nato digital'],\n      russia_joint: ['russia joint', 'russia military'],\n      russia_economy: ['russia economy', 'russia economic'],\n      russia_cognitive: ['russia cognitive', 'russia information', 'russia perception'],\n      russia_space: ['russia space', 'russia satellite'],\n      russia_cyber: ['russia cyber', 'russia digital'],\n      turn_count: ['turn', 'duration', 'length', 'time', 'rounds'],\n      card_count: ['card', 'purchase', 'investment', 'spending']\n    };\n\n    // Check for general team mentions\n    const hasNato = /\\bnato\\b/.test(lowerHypothesis);\n    const hasRussia = /\\brussia\\b/.test(lowerHypothesis);\n    \n    // Check for domain mentions\n    const hasJoint = /\\bjoint\\b|military|forces/.test(lowerHypothesis);\n    const hasEconomy = /\\beconom/.test(lowerHypothesis);\n    const hasCognitive = /\\bcognitive\\b|information|perception|narrative/.test(lowerHypothesis);\n    const hasSpace = /\\bspace\\b|satellite/.test(lowerHypothesis);\n    const hasCyber = /\\bcyber\\b|digital|network/.test(lowerHypothesis);\n    \n    // Match specific keywords\n    Object.entries(keywords).forEach(([varId, terms]) => {\n      if (terms.some(term => lowerHypothesis.includes(term))) {\n        recommendations.push(varId);\n      }\n    });\n    \n    // Add domain-based recommendations if team mentioned but no specific match\n    if (hasNato && !recommendations.some(r => r.startsWith('nato_'))) {\n      if (hasJoint) recommendations.push('nato_joint');\n      if (hasEconomy) recommendations.push('nato_economy');\n      if (hasCognitive) recommendations.push('nato_cognitive');\n      if (hasSpace) recommendations.push('nato_space');\n      if (hasCyber) recommendations.push('nato_cyber');\n      if (!hasJoint && !hasEconomy && !hasCognitive && !hasSpace && !hasCyber) {\n        recommendations.push('nato_total');\n      }\n    }\n    \n    if (hasRussia && !recommendations.some(r => r.startsWith('russia_'))) {\n      if (hasJoint) recommendations.push('russia_joint');\n      if (hasEconomy) recommendations.push('russia_economy');\n      if (hasCognitive) recommendations.push('russia_cognitive');\n      if (hasSpace) recommendations.push('russia_space');\n      if (hasCyber) recommendations.push('russia_cyber');\n      if (!hasJoint && !hasEconomy && !hasCognitive && !hasSpace && !hasCyber) {\n        recommendations.push('russia_total');\n      }\n    }\n    \n    // Check for comparison/correlation terms\n    const hasComparison = /\\bcompare|versus|vs|between|differ|relationship|correlat|impact|effect|influence/.test(lowerHypothesis);\n    if (hasComparison && recommendations.length === 0) {\n      // If comparing but no specific variables, suggest both teams' totals\n      if (hasNato || hasRussia || (!hasNato && !hasRussia)) {\n        recommendations.push('nato_total', 'russia_total');\n      }\n    }\n    \n    return Array.from(new Set(recommendations)); // Remove duplicates\n  }, [hypothesis]);\n\n  // Get statistical test recommendation based on hypothesis\n  const getHypothesisBasedTestRecommendation = useMemo(() => {\n    if (!hypothesis.trim()) return null;\n    \n    const lowerHypothesis = hypothesis.toLowerCase();\n    \n    // Analyze hypothesis structure\n    const hasCorrelation = /correlat|relationship|associat/.test(lowerHypothesis);\n    const hasComparison = /compare|differ|versus|vs\\.?|between/.test(lowerHypothesis);\n    const hasPrediction = /predict|determin|effect|impact|influence|cause/.test(lowerHypothesis);\n    const hasMultipleVariables = /multiple\\s+(variable|outcome|factor|dimension|metric)|several\\s+(variable|outcome|factor|dimension|metric)|various\\s+(variable|outcome|factor|dimension|metric)/.test(lowerHypothesis);\n    const hasTwoGroups = /nato.*russia|russia.*nato|two teams|both teams/.test(lowerHypothesis);\n    const hasMultipleGroups = /across.*domain|all.*domain|multiple.*group/.test(lowerHypothesis);\n    const hasTimeComponent = /over time|across turns|duration|temporal|longitudinal/.test(lowerHypothesis);\n    \n    // Determine recommended test based on hypothesis characteristics\n    if (hasCorrelation && recommendedVariables.length === 2 && !hasComparison) {\n      return {\n        name: \"Correlation Analysis (Pearson/Spearman)\",\n        justification: `This hypothesis explicitly examines the relationship between two variables, making correlation analysis the ideal choice. ${\n          lowerHypothesis.includes('positively') || lowerHypothesis.includes('negatively') \n            ? 'The directional language (\"positively\" or \"negatively\") suggests you are testing for the strength and direction of association between variables.' \n            : 'Correlation analysis will reveal both the strength and direction of the relationship.'\n        } Pearson correlation is appropriate when both variables are continuous and linearly related with normal distributions. If your data is skewed or contains outliers, Spearman's rank correlation provides a robust non-parametric alternative that assesses monotonic relationships.`,\n        application: `To apply correlation analysis: (1) Select your two continuous variables from the recommended list above. (2) Ensure you have at least 10-20 sessions for reliable correlation estimates. (3) Visualize the relationship using a scatterplot to check for linearity and outliers. (4) Calculate Pearson's r if assumptions are met, or Spearman's  if data is ordinal or non-normal. (5) Interpret the correlation coefficient: values near 1 indicate strong relationships, while values near 0 suggest weak associations. (6) Report both the correlation coefficient and p-value to assess statistical significance. (7) Remember that correlation does not imply causationit only measures association strength.`\n      };\n    }\n    \n    if (hasTwoGroups && !hasMultipleVariables && recommendedVariables.length <= 2) {\n      return {\n        name: \"Independent Samples t-test\",\n        justification: `Your hypothesis compares two independent groups (NATO vs. Russia) on a single outcome variable, which is the classic scenario for an independent samples t-test. This parametric test examines whether the mean deterrence score (or other metric) significantly differs between the two teams. The t-test is robust, widely recognized in research, and provides clear evidence of group differences. ${\n          recommendedVariables.length === 2 ? 'Since you have variables for both teams, the test will directly compare their means.' : ''\n        } This test assumes independent observations, approximately normal distributions within each group (or sample sizes 30), and similar variances between groups (homogeneity of variance).`,\n        application: `To conduct an independent samples t-test: (1) Select one continuous outcome variable (e.g., total deterrence score). (2) Define your two groups (NATO and Russia). (3) Verify assumptions: check for normality using histograms or Q-Q plots, and test homogeneity of variance with Levene's test. (4) If assumptions are violated and sample sizes are small (n<30), consider the Mann-Whitney U test instead. (5) Calculate the t-statistic and degrees of freedom. (6) Report the mean difference, confidence interval, t-value, and p-value. (7) Interpret results: p<0.05 suggests a statistically significant difference between teams. (8) Calculate effect size (Cohen's d) to quantify the magnitude of differencesmall (0.2), medium (0.5), or large (0.8).`\n      };\n    }\n    \n    if (hasMultipleGroups && !hasMultipleVariables && recommendedVariables.length <= 2) {\n      return {\n        name: \"One-Way ANOVA\",\n        justification: `Your hypothesis involves comparing means across multiple groups (e.g., different domains, time periods, or strategic categories), making one-way Analysis of Variance (ANOVA) the appropriate test. ANOVA extends the t-test logic to three or more groups, testing whether at least one group mean differs significantly from the others. This is more efficient and statistically appropriate than running multiple t-tests, which would inflate Type I error rates. ${\n          lowerHypothesis.includes('domain') ? 'Since your hypothesis mentions domains, you are likely comparing performance across the five strategic dimensions (Joint, Economy, Cognitive, Space, Cyber).' : ''\n        } ANOVA provides an F-statistic that indicates overall group differences, followed by post-hoc tests to identify which specific groups differ.`,\n        application: `To perform one-way ANOVA: (1) Select one continuous dependent variable (e.g., deterrence score). (2) Define your grouping factor with 3+ levels (e.g., five domains). (3) Check assumptions: normality within each group (Shapiro-Wilk test), homogeneity of variance across groups (Levene's test), and independent observations. (4) If assumptions are violated, use the Kruskal-Wallis test instead. (5) Calculate the F-statistic and p-value. (6) If p<0.05, conclude that at least one group differs. (7) Conduct post-hoc comparisons (Tukey HSD, Bonferroni) to identify which specific groups differ. (8) Report means, standard deviations, F-value, degrees of freedom, p-value, and effect size (eta-squared). (9) Visualize results with boxplots or bar charts showing group means and error bars.`\n      };\n    }\n    \n    if (hasPrediction && recommendedVariables.length >= 2) {\n      return {\n        name: \"Multiple Regression\",\n        justification: `Your hypothesis suggests examining how one or more predictor variables influence an outcome variable, which is the domain of regression analysis. ${\n          recommendedVariables.length > 2 \n            ? 'Multiple regression is ideal here because you have several potential predictors that may jointly explain variance in the outcome.' \n            : 'Simple regression can model the relationship between your predictor and outcome.'\n        } Regression goes beyond correlation by modeling the predictive relationship and quantifying how much change in the outcome is associated with unit changes in predictors. ${\n          lowerHypothesis.includes('predict') || lowerHypothesis.includes('determine') \n            ? 'The causal/predictive language in your hypothesis aligns perfectly with regression methodology.' \n            : ''\n        } This approach provides regression coefficients, R-squared values, and statistical significance for each predictor, offering comprehensive insights into determinants of strategic performance.`,\n        application: `To conduct multiple regression: (1) Identify your dependent variable (outcome you want to predict) and independent variables (predictors). (2) Ensure adequate sample size: at least 10-15 observations per predictor variable. (3) Check assumptions: linearity (scatterplots), independence of residuals, homoscedasticity (constant variance), normality of residuals (Q-Q plot), and absence of multicollinearity (VIF<10). (4) Run the regression model and examine R-squared to assess model fit (proportion of variance explained). (5) Evaluate each predictor's coefficient: magnitude indicates effect size, sign indicates direction, and p-value indicates significance. (6) Report standardized coefficients (beta weights) to compare relative importance of predictors. (7) Check for influential outliers using Cook's distance. (8) Interpret results carefully: regression suggests prediction, not necessarily causation. (9) Visualize with partial regression plots.`\n      };\n    }\n    \n    if (hasMultipleVariables && recommendedVariables.length >= 3 && hasTwoGroups) {\n      return {\n        name: \"MANOVA (Multivariate ANOVA)\",\n        justification: `Your hypothesis examines group differences across multiple outcome variables simultaneously, which requires Multivariate Analysis of Variance (MANOVA). Unlike running separate ANOVAs for each variable, MANOVA considers correlations among dependent variables and tests whether groups differ on a composite of outcomes. ${\n          lowerHypothesis.includes('domain') ? 'Since you are examining multiple domains, MANOVA can assess whether teams differ in their overall deterrence profile across all dimensions simultaneously.' : ''\n        } This approach is more powerful and controls for Type I error inflation that would occur with multiple univariate tests. MANOVA provides a comprehensive view of multivariate group differences and can detect patterns that univariate tests might miss.`,\n        application: `To perform MANOVA: (1) Select 2+ continuous dependent variables that are theoretically related. (2) Define your independent grouping variable (e.g., NATO vs. Russia). (3) Verify multivariate assumptions: multivariate normality (Mardia's test), homogeneity of covariance matrices (Box's M test), linear relationships among DVs, and adequate sample size (more observations than DVs). (4) Run MANOVA and examine multivariate test statistics: Wilks' Lambda, Pillai's Trace, Hotelling's Trace, or Roy's Largest Root. (5) If multivariate effect is significant (p<0.05), conduct follow-up univariate ANOVAs for each DV to identify which specific variables drive the difference. (6) Apply Bonferroni correction to control Type I error in follow-ups. (7) Report effect sizes (partial eta-squared) for both multivariate and univariate effects. (8) Interpret whether groups differ on the overall pattern of outcomes.`\n      };\n    }\n    \n    if (hasTimeComponent || lowerHypothesis.includes('longitudinal') || lowerHypothesis.includes('change')) {\n      return {\n        name: \"Repeated Measures ANOVA\",\n        justification: `Your hypothesis involves examining changes or patterns across time points or turns, which suggests a within-subjects design best analyzed with Repeated Measures ANOVA. This test accounts for the fact that the same sessions/teams are measured multiple times, recognizing that measurements from the same entity are correlated. ${\n          lowerHypothesis.includes('turn') ? 'Since your hypothesis mentions turns, you are tracking strategic performance across the temporal progression of the simulation.' : ''\n        } Repeated measures designs are more powerful than between-subjects designs because they control for individual differences, reducing error variance. This test is ideal for detecting developmental trends, strategic evolution, or cumulative effects over the course of sessions.`,\n        application: `To conduct Repeated Measures ANOVA: (1) Organize your data with the same subjects (sessions or teams) measured at multiple time points (e.g., deterrence at turns 1, 2, 3, etc.). (2) Ensure you have the same subjects measured at all time points (balanced design). (3) Check assumptions: normality of differences between time points and sphericity (equal variances of differences). (4) If sphericity is violated (Mauchly's test, p<0.05), apply Greenhouse-Geisser or Huynh-Feldt corrections. (5) Run the analysis and examine the within-subjects effect for time. (6) If significant, conduct pairwise comparisons with Bonferroni adjustments to identify which specific time points differ. (7) Report F-value, degrees of freedom (including any corrections), p-value, and partial eta-squared. (8) Visualize trends with line graphs showing means and error bars across time points. (9) Interpret whether performance changes significantly over time.`\n      };\n    }\n    \n    // Default recommendation for general hypotheses\n    return {\n      name: \"Independent Samples t-test or Correlation Analysis\",\n      justification: `Based on your hypothesis structure, the most appropriate test depends on whether you are comparing groups or examining relationships. If you are comparing NATO vs. Russia (or winners vs. losers) on a single metric, use an independent samples t-test to test for mean differences. If you are examining whether two continuous variables are related (e.g., whether economic deterrence correlates with total deterrence), use correlation analysis. ${\n        recommendedVariables.length === 0 \n          ? 'Select relevant variables above to refine this recommendation further.' \n          : `With ${recommendedVariables.length} recommended variable${recommendedVariables.length !== 1 ? 's' : ''}, consider whether you want to compare groups (t-test) or measure association (correlation).`\n      } Both approaches are foundational statistical methods with clear interpretation and wide acceptance in research.`,\n      application: `For t-test: (1) Select one outcome variable and two groups to compare. (2) Check normality and variance assumptions. (3) Run the test and interpret mean differences with confidence intervals and p-values. For correlation: (1) Select two continuous variables you believe are related. (2) Visualize their relationship with a scatterplot. (3) Calculate Pearson's r (for linear relationships) or Spearman's  (for non-linear/monotonic relationships). (4) Report the correlation coefficient, interpret its strength and direction, and assess significance. (5) Use scatterplots with regression lines to communicate findings visually. Both tests require sufficient sample size (ideally 20+ sessions) and should be followed by effect size reporting to quantify practical significance beyond statistical significance.`\n    };\n  }, [hypothesis, recommendedVariables]);\n\n  // Calculate card purchase frequency\n  const cardFrequencyData = useMemo(() => {\n    if (!sessions || selectedCards.length === 0 || selectedSessions.length === 0) {\n      return [];\n    }\n\n    const selectedSessionData = sessions.filter(s => selectedSessions.includes(s.sessionName));\n    const totalSessions = selectedSessionData.length;\n    \n    return selectedCards.map(cardId => {\n      const card = cardsData.find(c => c.id === cardId);\n      let natoCount = 0;\n      let russiaCount = 0;\n      let totalCount = 0;\n      \n      // Track unique sessions where this card appears (for percentage calculation)\n      const sessionsWithNato = new Set<string>();\n      const sessionsWithRussia = new Set<string>();\n      const sessionsWithAny = new Set<string>();\n\n      selectedSessionData.forEach(session => {\n        const strategyLog = session.gameState?.strategyLog || [];\n        \n        strategyLog.forEach((log: any) => {\n          // Match pattern: \"TEAM purchased CardName (ID) for XK\"\n          const purchaseMatch = log.action.match(/purchased.*\\(([^)]+)\\)/i);\n          if (purchaseMatch && purchaseMatch[1] === cardId) {\n            totalCount++;\n            sessionsWithAny.add(session.sessionName);\n            \n            if (log.team === \"NATO\") {\n              natoCount++;\n              sessionsWithNato.add(session.sessionName);\n            } else if (log.team === \"Russia\") {\n              russiaCount++;\n              sessionsWithRussia.add(session.sessionName);\n            }\n          }\n        });\n      });\n\n      // Calculate session appearance counts and percentages based on filter\n      let displayCount = totalCount;\n      let sessionsAppeared = sessionsWithAny.size;\n      \n      if (cardTeamFilter === \"NATO\") {\n        displayCount = natoCount;\n        sessionsAppeared = sessionsWithNato.size;\n      } else if (cardTeamFilter === \"Russia\") {\n        displayCount = russiaCount;\n        sessionsAppeared = sessionsWithRussia.size;\n      }\n\n      const percentage = totalSessions > 0 ? (sessionsAppeared / totalSessions * 100).toFixed(1) : \"0.0\";\n\n      return {\n        cardId,\n        cardName: card?.name || cardId,\n        natoCount,\n        russiaCount,\n        totalCount,\n        displayCount,\n        percentage,\n        sessionsAppeared\n      };\n    }).sort((a, b) => b.displayCount - a.displayCount);\n  }, [sessions, selectedSessions, selectedCards, cardTeamFilter]);\n\n  // Calculate card rankings by dimension for NATO and Russia\n  const cardRankingsByDimension = useMemo(() => {\n    if (!sessions || selectedSessions.length === 0) {\n      return {\n        joint: { nato: [], russia: [] },\n        economy: { nato: [], russia: [] },\n        cognitive: { nato: [], russia: [] },\n        space: { nato: [], russia: [] },\n        cyber: { nato: [], russia: [] }\n      };\n    }\n\n    const selectedSessionData = sessions.filter(s => selectedSessions.includes(s.sessionName));\n    \n    // Initialize rankings structure by dimension\n    const rankings: Record<Domain, {\n      nato: Array<{ cardId: string; cardName: string; count: number; domainPercentage: string; overallPercentage: string; }>;\n      russia: Array<{ cardId: string; cardName: string; count: number; domainPercentage: string; overallPercentage: string; }>;\n    }> = {\n      joint: { nato: [], russia: [] },\n      economy: { nato: [], russia: [] },\n      cognitive: { nato: [], russia: [] },\n      space: { nato: [], russia: [] },\n      cyber: { nato: [], russia: [] }\n    };\n    \n    // Count total purchases by team for overall percentage calculation\n    let natoTotalPurchases = 0;\n    let russiaTotalPurchases = 0;\n    \n    // Count purchases by domain for domain percentage calculation\n    const natoDomainCounts: Record<Domain, number> = {\n      joint: 0,\n      economy: 0,\n      cognitive: 0,\n      space: 0,\n      cyber: 0\n    };\n    const russiaDomainCounts: Record<Domain, number> = {\n      joint: 0,\n      economy: 0,\n      cognitive: 0,\n      space: 0,\n      cyber: 0\n    };\n\n    // Map to track card purchase counts\n    const cardCounts: Record<string, { nato: number; russia: number; domain: Domain; name: string; }> = {};\n\n    selectedSessionData.forEach(session => {\n      const strategyLog = session.gameState?.strategyLog || [];\n      \n      strategyLog.forEach((log: any) => {\n        // Match pattern: \"TEAM purchased CardName (ID) for XK\"\n        const purchaseMatch = log.action.match(/purchased.*\\(([^)]+)\\)/i);\n        if (purchaseMatch) {\n          const cardId = purchaseMatch[1];\n          const card = cardsData.find(c => c.id === cardId);\n          \n          if (card && card.domain) {\n            const domain = card.domain as Domain;\n            \n            // Initialize card entry if not exists\n            if (!cardCounts[cardId]) {\n              cardCounts[cardId] = { nato: 0, russia: 0, domain, name: card.name };\n            }\n            \n            if (log.team === \"NATO\") {\n              cardCounts[cardId].nato++;\n              natoTotalPurchases++;\n              natoDomainCounts[domain]++;\n            } else if (log.team === \"Russia\") {\n              cardCounts[cardId].russia++;\n              russiaTotalPurchases++;\n              russiaDomainCounts[domain]++;\n            }\n          }\n        }\n      });\n    });\n\n    // Build rankings for each domain\n    domains.forEach(domain => {\n      const natoCardsInDomain: Array<{ cardId: string; cardName: string; count: number; domainPercentage: string; overallPercentage: string; }> = [];\n      const russiaCardsInDomain: Array<{ cardId: string; cardName: string; count: number; domainPercentage: string; overallPercentage: string; }> = [];\n\n      Object.entries(cardCounts).forEach(([cardId, data]) => {\n        if (data.domain === domain) {\n          if (data.nato > 0) {\n            const domainPercentage = natoDomainCounts[domain] > 0 \n              ? ((data.nato / natoDomainCounts[domain]) * 100).toFixed(1)\n              : \"0.0\";\n            const overallPercentage = natoTotalPurchases > 0\n              ? ((data.nato / natoTotalPurchases) * 100).toFixed(1)\n              : \"0.0\";\n            natoCardsInDomain.push({\n              cardId,\n              cardName: data.name,\n              count: data.nato,\n              domainPercentage,\n              overallPercentage\n            });\n          }\n          \n          if (data.russia > 0) {\n            const domainPercentage = russiaDomainCounts[domain] > 0\n              ? ((data.russia / russiaDomainCounts[domain]) * 100).toFixed(1)\n              : \"0.0\";\n            const overallPercentage = russiaTotalPurchases > 0\n              ? ((data.russia / russiaTotalPurchases) * 100).toFixed(1)\n              : \"0.0\";\n            russiaCardsInDomain.push({\n              cardId,\n              cardName: data.name,\n              count: data.russia,\n              domainPercentage,\n              overallPercentage\n            });\n          }\n        }\n      });\n\n      // Sort by count descending\n      rankings[domain].nato = natoCardsInDomain.sort((a, b) => b.count - a.count);\n      rankings[domain].russia = russiaCardsInDomain.sort((a, b) => b.count - a.count);\n    });\n\n    return rankings;\n  }, [sessions, selectedSessions]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <div className=\"container mx-auto p-6 space-y-6\">\n          <Skeleton className=\"h-12 w-64\" />\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            onClick={handleBack}\n            data-testid=\"button-back-to-database\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold flex items-center gap-3\">\n              <FlaskConical className=\"w-8 h-8\" />\n              Statistical Research Dashboard\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Filter sessions, select variables, and determine appropriate statistical tests\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid gap-6 lg:grid-cols-2\">\n          {/* Left Panel: Research Question, Session Filtering, Variable Selection, Card Analysis */}\n          <div className=\"lg:col-span-1 space-y-4\">\n            {/* Develop Research Question */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FileText className=\"w-5 h-5\" />\n                  Develop Research Question\n                </CardTitle>\n                <CardDescription>\n                  Define your research question to guide your analysis\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"predefined-question-left\">Quick Select: Predefined Questions</Label>\n                  <Select \n                    value={selectedPredefinedQuestionLeft} \n                    onValueChange={(value) => {\n                      setSelectedPredefinedQuestionLeft(value);\n                      const selected = predefinedQuestions.find(q => q.id === value);\n                      if (selected) {\n                        setResearchQuestionLeft(selected.text);\n                      }\n                    }}\n                  >\n                    <SelectTrigger data-testid=\"select-predefined-question-left\">\n                      <SelectValue placeholder=\"Select a question template...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {predefinedQuestions.map(q => (\n                        <SelectItem key={q.id} value={q.id}>\n                          {q.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"research-question-left\">Your Research Question</Label>\n                  <textarea\n                    id=\"research-question-left\"\n                    value={researchQuestionLeft}\n                    onChange={(e) => {\n                      setResearchQuestionLeft(e.target.value);\n                      if (selectedPredefinedQuestionLeft) {\n                        setSelectedPredefinedQuestionLeft(\"\");\n                      }\n                    }}\n                    placeholder=\"Example: How does early investment in economy domain correlate with final deterrence scores?\"\n                    className=\"w-full min-h-[100px] p-3 rounded-md border border-input bg-background text-sm resize-y\"\n                    data-testid=\"textarea-research-question-left\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Filter className=\"w-5 h-5\" />\n                  Filter Sessions\n                </CardTitle>\n                <CardDescription>Select sessions for analysis</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label>Search Sessions</Label>\n                  <Input\n                    placeholder=\"Search by name...\"\n                    value={sessionSearch}\n                    onChange={(e) => setSessionSearch(e.target.value)}\n                    data-testid=\"input-session-search\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Date Range</Label>\n                  <Select value={dateFilter} onValueChange={setDateFilter}>\n                    <SelectTrigger data-testid=\"select-date-filter\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Time</SelectItem>\n                      <SelectItem value=\"week\">Past Week</SelectItem>\n                      <SelectItem value=\"month\">Past Month</SelectItem>\n                      <SelectItem value=\"3months\">Past 3 Months</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Winner Filter</Label>\n                  <Select value={winnerFilter} onValueChange={setWinnerFilter}>\n                    <SelectTrigger data-testid=\"select-winner-filter\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Winners</SelectItem>\n                      <SelectItem value=\"NATO\">NATO Wins</SelectItem>\n                      <SelectItem value=\"Russia\">Russia Wins</SelectItem>\n                      <SelectItem value=\"Tie\">Ties</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"flex items-center gap-2 pt-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={selectAllSessions}\n                    data-testid=\"button-select-all-sessions\"\n                  >\n                    <ListChecks className=\"w-4 h-4 mr-2\" />\n                    {selectedSessions.length === filteredSessions.length ? \"Deselect All\" : \"Select All\"}\n                  </Button>\n                  <Badge variant=\"secondary\">\n                    {selectedSessions.length} / {filteredSessions.length} selected\n                  </Badge>\n                </div>\n\n                <ScrollArea className=\"h-64 border rounded-md p-2\">\n                  <div className=\"space-y-2\">\n                    {filteredSessions.map(session => (\n                      <div\n                        key={session.sessionName}\n                        className=\"flex items-start gap-2 p-2 rounded hover-elevate\"\n                      >\n                        <Checkbox\n                          checked={selectedSessions.includes(session.sessionName)}\n                          onCheckedChange={() => toggleSession(session.sessionName)}\n                          data-testid={`checkbox-session-${session.sessionName}`}\n                        />\n                        <div \n                          className=\"flex-1 min-w-0 cursor-pointer\"\n                          onClick={() => toggleSession(session.sessionName)}\n                        >\n                          <p className=\"text-sm font-medium truncate\">{session.sessionName}</p>\n                          <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {getWinner(session)}\n                            </Badge>\n                            <span>Turn {session.gameState?.turn || 0}</span>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n\n            {/* Variable Selection */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <BarChart3 className=\"w-5 h-5\" />\n                  Select Variables\n                </CardTitle>\n                <CardDescription>Choose parameters to analyze</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label>Analysis Type</Label>\n                  <Select value={comparisonType} onValueChange={setComparisonType}>\n                    <SelectTrigger data-testid=\"select-comparison-type\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"between\">Between-Subjects</SelectItem>\n                      <SelectItem value=\"within\">Within-Subjects</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Grouping Variable</Label>\n                  <Select value={groupingVariable} onValueChange={setGroupingVariable}>\n                    <SelectTrigger data-testid=\"select-grouping-variable\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"team\">Team (NATO vs Russia)</SelectItem>\n                      <SelectItem value=\"session\">Session</SelectItem>\n                      <SelectItem value=\"winner\">Winner</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <ScrollArea className=\"h-96 border rounded-md p-2\">\n                  <div className=\"space-y-3\">\n                    {Object.entries(\n                      availableVariables.reduce((acc, variable) => {\n                        if (!acc[variable.category]) acc[variable.category] = [];\n                        acc[variable.category].push(variable);\n                        return acc;\n                      }, {} as Record<string, typeof availableVariables>)\n                    ).map(([category, variables]) => (\n                      <div key={category} className=\"space-y-2\">\n                        <p className=\"text-xs font-semibold text-muted-foreground\">{category}</p>\n                        {variables.map(variable => (\n                          <div\n                            key={variable.id}\n                            className=\"flex items-center gap-2 p-1 rounded hover-elevate\"\n                          >\n                            <Checkbox\n                              checked={selectedVariables.includes(variable.id)}\n                              onCheckedChange={() => toggleVariable(variable.id)}\n                              data-testid={`checkbox-variable-${variable.id}`}\n                            />\n                            <Label \n                              className=\"text-sm cursor-pointer flex-1\"\n                              onClick={() => toggleVariable(variable.id)}\n                            >\n                              {variable.label}\n                            </Label>\n                          </div>\n                        ))}\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n\n            {/* Card Purchase Frequency Analysis */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <CreditCard className=\"w-5 h-5\" />\n                  Card Purchase Frequency\n                </CardTitle>\n                <CardDescription>\n                  Analyze how often specific cards are purchased across selected sessions\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Card Selection and Team Filter */}\n                <div className=\"space-y-3\">\n                  <div className=\"flex gap-2\">\n                    <div className=\"flex-1\">\n                      <Label>Team Filter</Label>\n                      <Select value={cardTeamFilter} onValueChange={setCardTeamFilter}>\n                        <SelectTrigger data-testid=\"select-card-team-filter\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"both\">Both Teams</SelectItem>\n                          <SelectItem value=\"NATO\">NATO Only</SelectItem>\n                          <SelectItem value=\"Russia\">Russia Only</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label>Select Cards to Analyze</Label>\n                    <ScrollArea className=\"h-48 border rounded-md p-2 mt-2\">\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        {cardsData\n                          .sort((a, b) => a.id.localeCompare(b.id))\n                          .map((card: any) => (\n                            <div\n                              key={card.id}\n                              className=\"flex items-center gap-2 p-1 rounded hover-elevate\"\n                            >\n                              <Checkbox\n                                checked={selectedCards.includes(card.id)}\n                                onCheckedChange={() => toggleCard(card.id)}\n                                data-testid={`checkbox-card-${card.id}`}\n                              />\n                              <Label \n                                className=\"text-xs cursor-pointer flex-1\"\n                                onClick={() => toggleCard(card.id)}\n                              >\n                                <span className=\"font-mono font-semibold\">{card.id}</span>\n                                {\" - \"}\n                                <span className=\"text-muted-foreground\">{card.name}</span>\n                              </Label>\n                            </div>\n                          ))}\n                      </div>\n                    </ScrollArea>\n                  </div>\n                </div>\n\n                {/* Frequency Results */}\n                {selectedCards.length > 0 && selectedSessions.length > 0 && (\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <h3 className=\"text-sm font-semibold\">Frequency Results</h3>\n                      <Badge variant=\"outline\">\n                        {selectedSessions.length} session(s)\n                      </Badge>\n                    </div>\n\n                    {cardFrequencyData.length > 0 ? (\n                      <ScrollArea className=\"h-64\">\n                        <div className=\"space-y-2\">\n                          {cardFrequencyData.map((data) => (\n                            <div \n                              key={data.cardId} \n                              className=\"border rounded-lg p-3 space-y-2\"\n                            >\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"flex-1\">\n                                  <p className=\"text-sm font-semibold font-mono\">\n                                    {data.cardId}\n                                  </p>\n                                  <p className=\"text-xs text-muted-foreground\">\n                                    {data.cardName}\n                                  </p>\n                                </div>\n                                <div className=\"text-right\">\n                                  <p className=\"text-lg font-bold\">{data.displayCount}</p>\n                                  <p className=\"text-xs text-muted-foreground\">\n                                    {data.displayCount === 1 ? 'purchase' : 'purchases'}\n                                  </p>\n                                  <p className=\"text-xs font-semibold text-primary mt-1\">\n                                    {data.sessionsAppeared} / {selectedSessions.length} sessions ({data.percentage}%)\n                                  </p>\n                                </div>\n                              </div>\n\n                              {/* Team breakdown when showing both teams */}\n                              {cardTeamFilter === \"both\" && (\n                                <div className=\"flex gap-2 text-xs\">\n                                  <div className=\"flex-1 p-2 rounded bg-blue-500/10 border border-blue-500/20\">\n                                    <p className=\"text-muted-foreground\">NATO</p>\n                                    <p className=\"font-semibold\">{data.natoCount}</p>\n                                  </div>\n                                  <div className=\"flex-1 p-2 rounded bg-red-500/10 border border-red-500/20\">\n                                    <p className=\"text-muted-foreground\">Russia</p>\n                                    <p className=\"font-semibold\">{data.russiaCount}</p>\n                                  </div>\n                                </div>\n                              )}\n\n                              {/* Visual bar */}\n                              <div className=\"relative h-2 bg-muted rounded-full overflow-hidden\">\n                                <div\n                                  className=\"absolute left-0 top-0 h-full bg-primary rounded-full transition-all\"\n                                  style={{ width: `${Math.min(parseFloat(data.percentage), 100)}%` }}\n                                />\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </ScrollArea>\n                    ) : (\n                      <p className=\"text-sm text-muted-foreground text-center py-4\">\n                        No purchases found for selected cards in the selected sessions.\n                      </p>\n                    )}\n                  </div>\n                )}\n\n                {selectedCards.length === 0 && (\n                  <p className=\"text-sm text-muted-foreground text-center py-4\">\n                    Select cards above to view purchase frequency analysis\n                  </p>\n                )}\n\n                {selectedSessions.length === 0 && selectedCards.length > 0 && (\n                  <p className=\"text-sm text-muted-foreground text-center py-4\">\n                    Select sessions from the left panel to analyze card purchase frequency\n                  </p>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Card Rankings by Dimension */}\n            {selectedSessions.length > 0 && (\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <BarChart3 className=\"w-5 h-5\" />\n                    Card Rankings by Dimension\n                  </CardTitle>\n                  <CardDescription>\n                    Most purchased cards by NATO and Russia, organized by dimension\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <ScrollArea className=\"h-[600px]\">\n                    <div className=\"space-y-6\">\n                      {domains.map(domain => {\n                        const domainRankings = cardRankingsByDimension[domain];\n                        if (!domainRankings) return null;\n\n                        const hasNatoCards = domainRankings.nato.length > 0;\n                        const hasRussiaCards = domainRankings.russia.length > 0;\n\n                        if (!hasNatoCards && !hasRussiaCards) return null;\n\n                        return (\n                          <div key={domain} className=\"border rounded-lg p-4 space-y-4\">\n                            <h3 className=\"text-sm font-bold uppercase tracking-wide text-muted-foreground\">\n                              {domain} Domain\n                            </h3>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                              {/* NATO Rankings */}\n                              <div className=\"space-y-2\">\n                                <div className=\"flex items-center gap-2\">\n                                  <div className=\"w-3 h-3 rounded-full bg-blue-500\" />\n                                  <p className=\"text-xs font-semibold text-muted-foreground\">NATO</p>\n                                </div>\n                                \n                                {hasNatoCards ? (\n                                  <div className=\"space-y-2\">\n                                    {domainRankings.nato.slice(0, 5).map((card: { cardId: string; cardName: string; count: number; domainPercentage: string; overallPercentage: string; }, index: number) => (\n                                      <div \n                                        key={card.cardId}\n                                        className=\"border rounded-md p-2 space-y-1 bg-blue-500/5\"\n                                        data-testid={`ranking-nato-${domain}-${card.cardId}`}\n                                      >\n                                        <div className=\"flex items-start justify-between gap-2\">\n                                          <div className=\"flex-1 min-w-0\">\n                                            <div className=\"flex items-center gap-2\">\n                                              <Badge variant=\"outline\" className=\"text-xs px-1 py-0\">\n                                                #{index + 1}\n                                              </Badge>\n                                              <p className=\"text-xs font-mono font-semibold truncate\">\n                                                {card.cardId}\n                                              </p>\n                                            </div>\n                                            <p className=\"text-xs text-muted-foreground truncate mt-1\">\n                                              {card.cardName}\n                                            </p>\n                                          </div>\n                                          <div className=\"text-right flex-shrink-0\">\n                                            <p className=\"text-sm font-bold\">{card.count}</p>\n                                            <p className=\"text-xs text-muted-foreground\">purchases</p>\n                                          </div>\n                                        </div>\n                                        <div className=\"flex gap-3 text-xs\">\n                                          <div className=\"flex-1\">\n                                            <p className=\"text-muted-foreground\">In Domain:</p>\n                                            <p className=\"font-semibold\">{card.domainPercentage}%</p>\n                                          </div>\n                                          <div className=\"flex-1\">\n                                            <p className=\"text-muted-foreground\">Overall:</p>\n                                            <p className=\"font-semibold\">{card.overallPercentage}%</p>\n                                          </div>\n                                        </div>\n                                      </div>\n                                    ))}\n                                  </div>\n                                ) : (\n                                  <p className=\"text-xs text-muted-foreground text-center py-4\">\n                                    No {domain} cards purchased\n                                  </p>\n                                )}\n                              </div>\n\n                              {/* Russia Rankings */}\n                              <div className=\"space-y-2\">\n                                <div className=\"flex items-center gap-2\">\n                                  <div className=\"w-3 h-3 rounded-full bg-red-500\" />\n                                  <p className=\"text-xs font-semibold text-muted-foreground\">Russia</p>\n                                </div>\n                                \n                                {hasRussiaCards ? (\n                                  <div className=\"space-y-2\">\n                                    {domainRankings.russia.slice(0, 5).map((card: { cardId: string; cardName: string; count: number; domainPercentage: string; overallPercentage: string; }, index: number) => (\n                                      <div \n                                        key={card.cardId}\n                                        className=\"border rounded-md p-2 space-y-1 bg-red-500/5\"\n                                        data-testid={`ranking-russia-${domain}-${card.cardId}`}\n                                      >\n                                        <div className=\"flex items-start justify-between gap-2\">\n                                          <div className=\"flex-1 min-w-0\">\n                                            <div className=\"flex items-center gap-2\">\n                                              <Badge variant=\"outline\" className=\"text-xs px-1 py-0\">\n                                                #{index + 1}\n                                              </Badge>\n                                              <p className=\"text-xs font-mono font-semibold truncate\">\n                                                {card.cardId}\n                                              </p>\n                                            </div>\n                                            <p className=\"text-xs text-muted-foreground truncate mt-1\">\n                                              {card.cardName}\n                                            </p>\n                                          </div>\n                                          <div className=\"text-right flex-shrink-0\">\n                                            <p className=\"text-sm font-bold\">{card.count}</p>\n                                            <p className=\"text-xs text-muted-foreground\">purchases</p>\n                                          </div>\n                                        </div>\n                                        <div className=\"flex gap-3 text-xs\">\n                                          <div className=\"flex-1\">\n                                            <p className=\"text-muted-foreground\">In Domain:</p>\n                                            <p className=\"font-semibold\">{card.domainPercentage}%</p>\n                                          </div>\n                                          <div className=\"flex-1\">\n                                            <p className=\"text-muted-foreground\">Overall:</p>\n                                            <p className=\"font-semibold\">{card.overallPercentage}%</p>\n                                          </div>\n                                        </div>\n                                      </div>\n                                    ))}\n                                  </div>\n                                ) : (\n                                  <p className=\"text-xs text-muted-foreground text-center py-4\">\n                                    No {domain} cards purchased\n                                  </p>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </ScrollArea>\n\n                  {selectedSessions.length === 0 && (\n                    <p className=\"text-sm text-muted-foreground text-center py-4\">\n                      Select sessions from the left panel to view card rankings by dimension\n                    </p>\n                  )}\n                </CardContent>\n              </Card>\n            )}\n          </div>\n\n          {/* Right Panel: Research Question, Hypothesis Development & Analysis */}\n          <div className=\"lg:col-span-1 space-y-4\">\n            {/* Develop Research Question */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FileText className=\"w-5 h-5\" />\n                  Develop Research Question\n                </CardTitle>\n                <CardDescription>\n                  Define your research question to guide your analysis\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"predefined-question-right\">Quick Select: Predefined Questions</Label>\n                  <Select \n                    value={selectedPredefinedQuestionRight} \n                    onValueChange={(value) => {\n                      setSelectedPredefinedQuestionRight(value);\n                      const selected = predefinedQuestions.find(q => q.id === value);\n                      if (selected) {\n                        setResearchQuestionRight(selected.text);\n                      }\n                    }}\n                  >\n                    <SelectTrigger data-testid=\"select-predefined-question-right\">\n                      <SelectValue placeholder=\"Select a question template...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {predefinedQuestions.map(q => (\n                        <SelectItem key={q.id} value={q.id}>\n                          {q.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"research-question-right\">Your Research Question</Label>\n                  <textarea\n                    id=\"research-question-right\"\n                    value={researchQuestionRight}\n                    onChange={(e) => {\n                      setResearchQuestionRight(e.target.value);\n                      if (selectedPredefinedQuestionRight) {\n                        setSelectedPredefinedQuestionRight(\"\");\n                      }\n                    }}\n                    placeholder=\"Example: How does early investment in economy domain correlate with final deterrence scores?\"\n                    className=\"w-full min-h-[100px] p-3 rounded-md border border-input bg-background text-sm resize-y\"\n                    data-testid=\"textarea-research-question-right\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Hypothesis Development */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FlaskConical className=\"w-5 h-5\" />\n                  Hypothesis Development\n                </CardTitle>\n                <CardDescription>\n                  Enter your research hypothesis to get variable recommendations\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"predefined-hypothesis\">Quick Select: Predefined Hypotheses</Label>\n                  <Select \n                    value={selectedPredefinedHypothesis} \n                    onValueChange={(value) => {\n                      setSelectedPredefinedHypothesis(value);\n                      const selected = predefinedHypotheses.find(h => h.id === value);\n                      if (selected) {\n                        setHypothesis(selected.text);\n                      }\n                    }}\n                  >\n                    <SelectTrigger data-testid=\"select-predefined-hypothesis\">\n                      <SelectValue placeholder=\"Select a hypothesis template...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {predefinedHypotheses.map(hyp => (\n                        <SelectItem key={hyp.id} value={hyp.id}>\n                          {hyp.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"hypothesis\">Your Hypothesis</Label>\n                  <textarea\n                    id=\"hypothesis\"\n                    value={hypothesis}\n                    onChange={(e) => {\n                      setHypothesis(e.target.value);\n                      // Clear predefined selection if user manually edits\n                      if (selectedPredefinedHypothesis) {\n                        setSelectedPredefinedHypothesis(\"\");\n                      }\n                    }}\n                    placeholder=\"Example: NATO's economic domain performance is positively correlated with their overall deterrence score...\"\n                    className=\"w-full min-h-[100px] p-3 rounded-md border border-input bg-background text-sm resize-y\"\n                    data-testid=\"textarea-hypothesis\"\n                  />\n                </div>\n\n                {/* Recommendations */}\n                {hypothesis.trim() && (\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <h3 className=\"text-sm font-semibold\">Recommended Variables</h3>\n                      {recommendedVariables.length > 0 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {recommendedVariables.length} suggestion{recommendedVariables.length !== 1 ? 's' : ''}\n                        </Badge>\n                      )}\n                    </div>\n\n                    {recommendedVariables.length > 0 ? (\n                      <div className=\"space-y-2\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          Based on your hypothesis, consider selecting these variables:\n                        </p>\n                        <div className=\"grid grid-cols-1 gap-2\">\n                          {recommendedVariables.map(varId => {\n                            const variable = availableVariables.find(v => v.id === varId);\n                            const isSelected = selectedVariables.includes(varId);\n                            \n                            return (\n                              <div\n                                key={varId}\n                                className={`flex items-center justify-between p-2 rounded-md border transition-colors ${\n                                  isSelected \n                                    ? 'border-primary bg-primary/5' \n                                    : 'border-border bg-muted/30 hover-elevate'\n                                }`}\n                              >\n                                <div className=\"flex items-center gap-2 flex-1\">\n                                  {isSelected ? (\n                                    <Badge variant=\"default\" className=\"text-xs\">Selected</Badge>\n                                  ) : (\n                                    <Badge variant=\"outline\" className=\"text-xs\">Recommended</Badge>\n                                  )}\n                                  <span className=\"text-sm\">{variable?.label}</span>\n                                </div>\n                                {!isSelected && (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => toggleVariable(varId)}\n                                    data-testid={`button-select-${varId}`}\n                                  >\n                                    Select\n                                  </Button>\n                                )}\n                              </div>\n                            );\n                          })}\n                        </div>\n                        \n                        {recommendedVariables.some(v => !selectedVariables.includes(v)) && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => {\n                              const toAdd = recommendedVariables.filter(v => !selectedVariables.includes(v));\n                              setSelectedVariables(prev => [...prev, ...toAdd]);\n                            }}\n                            className=\"w-full\"\n                            data-testid=\"button-select-all-recommended\"\n                          >\n                            Select All Recommended\n                          </Button>\n                        )}\n                      </div>\n                    ) : (\n                      <p className=\"text-sm text-muted-foreground p-3 bg-muted/30 rounded-md\">\n                        No specific variable recommendations. Try mentioning team names (NATO/Russia), domains (economy, cyber, space, cognitive, joint), or comparison terms in your hypothesis.\n                      </p>\n                    )}\n                  </div>\n                )}\n\n                {/* Statistical Test Recommendation */}\n                {hypothesis.trim() && getHypothesisBasedTestRecommendation && (\n                  <div className=\"space-y-3 pt-4 border-t\" data-testid=\"container-statistical-test-recommendation\">\n                    <div className=\"flex items-center gap-2\">\n                      <TrendingUp className=\"w-4 h-4 text-primary\" />\n                      <h3 className=\"text-sm font-semibold\">Recommended Statistical Test</h3>\n                    </div>\n                    \n                    <div className=\"space-y-4 p-4 bg-primary/5 border border-primary/20 rounded-lg\">\n                      <div>\n                        <Badge variant=\"default\" className=\"mb-2\" data-testid=\"badge-recommended-test-name\">\n                          {getHypothesisBasedTestRecommendation.name}\n                        </Badge>\n                        <h4 className=\"text-xs font-semibold text-muted-foreground mb-2\">Why This Test?</h4>\n                        <p className=\"text-sm leading-relaxed\" data-testid=\"text-test-justification\">\n                          {getHypothesisBasedTestRecommendation.justification}\n                        </p>\n                      </div>\n                      \n                      <div>\n                        <h4 className=\"text-xs font-semibold text-muted-foreground mb-2\">How to Apply</h4>\n                        <p className=\"text-sm leading-relaxed\" data-testid=\"text-test-application\">\n                          {getHypothesisBasedTestRecommendation.application}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {!hypothesis.trim() && (\n                  <p className=\"text-sm text-muted-foreground p-3 bg-muted/30 rounded-md\">\n                    Enter a hypothesis above to receive personalized variable recommendations for your analysis.\n                  </p>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Summary Statistics */}\n            {summaryStats && Object.keys(summaryStats).length > 0 && (\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <TrendingUp className=\"w-5 h-5\" />\n                    Descriptive Statistics\n                  </CardTitle>\n                  <CardDescription>\n                    Summary statistics for selected variables across {selectedSessions.length} session(s)\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <ScrollArea className=\"h-64\">\n                    <div className=\"space-y-4\">\n                      {Object.entries(summaryStats).map(([varId, stats]: [string, any]) => (\n                        <div key={varId} className=\"border rounded-lg p-4 space-y-2\">\n                          <h3 className=\"font-semibold text-sm\">{stats.label}</h3>\n                          <div className=\"grid grid-cols-4 gap-2 text-xs\">\n                            <div>\n                              <p className=\"text-muted-foreground\">N</p>\n                              <p className=\"font-mono font-semibold\">{stats.n}</p>\n                            </div>\n                            <div>\n                              <p className=\"text-muted-foreground\">Mean</p>\n                              <p className=\"font-mono font-semibold\">{stats.mean}</p>\n                            </div>\n                            <div>\n                              <p className=\"text-muted-foreground\">Median</p>\n                              <p className=\"font-mono font-semibold\">{stats.median}</p>\n                            </div>\n                            <div>\n                              <p className=\"text-muted-foreground\">SD</p>\n                              <p className=\"font-mono font-semibold\">{stats.stdDev}</p>\n                            </div>\n                            <div>\n                              <p className=\"text-muted-foreground\">Min</p>\n                              <p className=\"font-mono font-semibold\">{stats.min}</p>\n                            </div>\n                            <div>\n                              <p className=\"text-muted-foreground\">Max</p>\n                              <p className=\"font-mono font-semibold\">{stats.max}</p>\n                            </div>\n                            <div>\n                              <p className=\"text-muted-foreground\">Range</p>\n                              <p className=\"font-mono font-semibold\">{stats.range}</p>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </ScrollArea>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Statistical Test Recommendations */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FlaskConical className=\"w-5 h-5\" />\n                  Statistical Test Recommendations\n                </CardTitle>\n                <CardDescription>\n                  Based on your selection: {selectedSessions.length} session(s), {selectedVariables.length} variable(s)\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <ScrollArea className=\"h-[600px]\">\n                  <div className=\"space-y-3\">\n                    {statisticalTests.map((test, index) => (\n                      <div\n                        key={index}\n                        className={`border rounded-lg p-4 space-y-2 ${\n                          test.appropriate\n                            ? 'border-green-500/50 bg-green-500/5'\n                            : 'border-muted bg-muted/20'\n                        }`}\n                      >\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <div className=\"flex-1\">\n                            <h3 className=\"font-semibold text-sm flex items-center gap-2\">\n                              {test.name}\n                              {test.appropriate && (\n                                <Badge variant=\"default\" className=\"bg-green-600\">\n                                  Recommended\n                                </Badge>\n                              )}\n                            </h3>\n                            <p className=\"text-xs text-muted-foreground mt-1\">\n                              {test.description}\n                            </p>\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-1\">\n                          <p className=\"text-xs font-semibold\">Requirements:</p>\n                          <ul className=\"text-xs text-muted-foreground space-y-0.5 ml-4\">\n                            {test.requirements.map((req, i) => (\n                              <li key={i} className=\"list-disc\">{req}</li>\n                            ))}\n                          </ul>\n                        </div>\n\n                        <div className={`text-xs p-2 rounded ${\n                          test.appropriate\n                            ? 'bg-green-600/10 text-green-700 dark:text-green-400'\n                            : 'bg-muted text-muted-foreground'\n                        }`}>\n                          <span className=\"font-semibold\">Assessment: </span>\n                          {test.reason}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n\n            {/* Generate Scientific Report */}\n            {selectedSessions.length > 0 && selectedVariables.length > 0 && statisticalTests.some(t => t.appropriate) && (\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <FileText className=\"w-5 h-5\" />\n                    Generate Results Report\n                  </CardTitle>\n                  <CardDescription>\n                    Select a methodology and generate a scientific Results section\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Select Research Methodology</Label>\n                    <Select value={selectedMethodology} onValueChange={setSelectedMethodology}>\n                      <SelectTrigger data-testid=\"select-methodology\">\n                        <SelectValue placeholder=\"Choose a statistical test...\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {statisticalTests.filter(t => t.appropriate).map((test, index) => (\n                          <SelectItem key={index} value={test.name}>\n                            {test.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <Button\n                    onClick={async () => {\n                      setIsGeneratingReport(true);\n                      try {\n                        const reportData = prepareReportData(\n                          selectedMethodology,\n                          selectedSessions,\n                          selectedVariables,\n                          summaryStats!,\n                          sessions || [],\n                          groupingVariable\n                        );\n                        \n                        const response = await fetch('/api/generate-word-report', {\n                          method: 'POST',\n                          headers: {\n                            'Content-Type': 'application/json'\n                          },\n                          body: JSON.stringify(reportData)\n                        });\n                        \n                        if (!response.ok) {\n                          throw new Error('Failed to generate report');\n                        }\n                        \n                        const blob = await response.blob();\n                        const url = URL.createObjectURL(blob);\n                        const a = document.createElement('a');\n                        a.href = url;\n                        a.download = `research-results-${selectedMethodology.replace(/\\s+/g, '-').toLowerCase()}.docx`;\n                        a.click();\n                        URL.revokeObjectURL(url);\n                        \n                        setGeneratedReport('Word document generated successfully!');\n                      } catch (error) {\n                        console.error('Error generating report:', error);\n                        setGeneratedReport('Error generating report. Please try again.');\n                      }\n                      setIsGeneratingReport(false);\n                    }}\n                    disabled={!selectedMethodology || isGeneratingReport}\n                    className=\"w-full\"\n                    data-testid=\"button-generate-report\"\n                  >\n                    {isGeneratingReport ? \"Generating Word Document...\" : \"Generate Word Document Report\"}\n                  </Button>\n\n                  {generatedReport && (\n                    <div className=\"space-y-3 mt-4\">\n                      <div className=\"p-4 border rounded-lg bg-muted/50\">\n                        <p className=\"text-sm\">{generatedReport}</p>\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Helper function to generate scientific Results report\nfunction generateScientificReport(\n  methodology: string,\n  selectedSessions: string[],\n  selectedVariables: string[],\n  summaryStats: Record<string, any> | null,\n  allSessions: GameSession[],\n  groupingVariable: string,\n  comparisonType: string\n): string {\n  const sessionData = allSessions.filter(s => selectedSessions.includes(s.sessionName));\n  \n  let report = `RESULTS\\n\\n`;\n  \n  // Section 1: Descriptive Statistics\n  report += `Descriptive Statistics\\n`;\n  report += `${'='.repeat(50)}\\n\\n`;\n  \n  if (summaryStats && Object.keys(summaryStats).length > 0) {\n    report += `This analysis examined ${selectedSessions.length} strategy session${selectedSessions.length > 1 ? 's' : ''} `;\n    report += `across ${selectedVariables.length} dependent variable${selectedVariables.length > 1 ? 's' : ''}. `;\n    \n    // Describe the variables\n    const varNames = Object.values(summaryStats).map((s: any) => s.label).join(', ');\n    report += `The variables analyzed were: ${varNames}. `;\n    \n    // Describe the data characteristics\n    report += `Table 1 presents descriptive statistics including means, standard deviations, and ranges for all variables.\\n\\n`;\n    \n    // Table 1: Descriptive Statistics\n    report += `Table 1\\nDescriptive Statistics for Study Variables\\n\\n`;\n    report += `${''.repeat(80)}\\n`;\n    report += `Variable                          N      Mean      SD       Min       Max      Range\\n`;\n    report += `${''.repeat(80)}\\n`;\n    \n    Object.entries(summaryStats).forEach(([varId, stats]: [string, any]) => {\n      const varName = stats.label.padEnd(30);\n      const n = String(stats.n).padStart(6);\n      const mean = String(stats.mean).padStart(9);\n      const sd = String(stats.stdDev).padStart(9);\n      const min = String(stats.min).padStart(9);\n      const max = String(stats.max).padStart(9);\n      const range = String(stats.range).padStart(9);\n      \n      report += `${varName} ${n} ${mean} ${sd} ${min} ${max} ${range}\\n`;\n    });\n    \n    report += `${''.repeat(80)}\\n`;\n    report += `Note. N = sample size; SD = standard deviation.\\n\\n`;\n    \n    // Narrative description of key findings\n    if (Object.keys(summaryStats).length > 0) {\n      const firstVar = Object.values(summaryStats)[0] as any;\n      report += `The data showed considerable variation across sessions. `;\n      \n      // Comment on the first variable as an example\n      if (summaryStats['nato_total']) {\n        const nato = summaryStats['nato_total'] as any;\n        report += `For NATO Total Deterrence, scores ranged from ${nato.min} to ${nato.max} `;\n        report += `(M = ${nato.mean}, SD = ${nato.stdDev}), indicating ${parseFloat(nato.stdDev) > parseFloat(nato.mean) * 0.3 ? 'substantial' : 'moderate'} variability in strategic outcomes. `;\n      }\n      \n      if (summaryStats['russia_total']) {\n        const russia = summaryStats['russia_total'] as any;\n        report += `Similarly, Russia Total Deterrence values ranged from ${russia.min} to ${russia.max} `;\n        report += `(M = ${russia.mean}, SD = ${russia.stdDev}). `;\n      }\n      \n      report += `These descriptive patterns provide the foundation for the inferential analyses reported below.\\n\\n`;\n    }\n  }\n  \n  // Section 2: Inferential Statistics based on selected methodology\n  report += `\\nInferential Analysis: ${methodology}\\n`;\n  report += `${'='.repeat(50)}\\n\\n`;\n  \n  switch (methodology) {\n    case \"Independent Samples t-test\":\n      report += generateTTestReport(sessionData, selectedVariables, groupingVariable, summaryStats);\n      break;\n    case \"Paired Samples t-test\":\n      report += generatePairedTTestReport(sessionData, selectedVariables, summaryStats);\n      break;\n    case \"One-Way ANOVA\":\n      report += generateANOVAReport(sessionData, selectedVariables, groupingVariable, summaryStats);\n      break;\n    case \"Repeated Measures ANOVA\":\n      report += generateRepeatedANOVAReport(sessionData, selectedVariables, summaryStats);\n      break;\n    case \"MANOVA (Multivariate ANOVA)\":\n      report += generateMANOVAReport(sessionData, selectedVariables, groupingVariable, summaryStats);\n      break;\n    case \"Correlation Analysis (Pearson/Spearman)\":\n      report += generateCorrelationReport(sessionData, selectedVariables, summaryStats);\n      break;\n    case \"Multiple Regression\":\n      report += generateRegressionReport(sessionData, selectedVariables, summaryStats);\n      break;\n    case \"Chi-Square Test\":\n      report += generateChiSquareReport(sessionData, groupingVariable);\n      break;\n    case \"Mann-Whitney U Test (Non-parametric)\":\n      report += generateMannWhitneyReport(sessionData, selectedVariables, groupingVariable, summaryStats);\n      break;\n    case \"Kruskal-Wallis Test (Non-parametric)\":\n      report += generateKruskalWallisReport(sessionData, selectedVariables, groupingVariable, summaryStats);\n      break;\n    default:\n      report += `A ${methodology} was conducted to analyze the relationship between the selected variables.\\n\\n`;\n      report += `[Detailed statistical results would be computed here using appropriate statistical software.]\\n\\n`;\n  }\n  \n  // Section 3: Summary and Interpretation\n  report += `\\nSummary and Interpretation\\n`;\n  report += `${'='.repeat(50)}\\n\\n`;\n  report += `The ${methodology} revealed patterns in strategic deterrence across the ${selectedSessions.length} analyzed sessions. `;\n  report += `These findings contribute to our understanding of multi-dimensional deterrence strategy dynamics and provide empirical evidence for `;\n  report += `the effectiveness of different strategic approaches across the ${selectedVariables.length > 1 ? 'multiple domains' : 'examined domain'}.\\n\\n`;\n  \n  return report;\n}\n\n// Helper functions for specific test reports\nfunction generateTTestReport(sessions: GameSession[], variables: string[], grouping: string, stats: any): string {\n  let report = `An independent samples t-test was conducted to compare ${variables[0]} between `;\n  report += grouping === 'team' ? 'NATO and Russia teams' : `different ${grouping} groups`;\n  report += `. This parametric test assesses whether the mean difference between two independent groups is statistically significant.\\n\\n`;\n  \n  if (stats && variables.length > 0 && stats[variables[0]]) {\n    const varStats = stats[variables[0]];\n    report += `Figure 1 illustrates the distribution of ${varStats.label} across groups. `;\n    report += `[A bar chart with error bars would be displayed here, showing group means and 95% confidence intervals.]\\n\\n`;\n    \n    report += `The analysis would typically report: t-statistic, degrees of freedom, p-value, effect size (Cohen's d), `;\n    report += `and confidence intervals. For example:\\n\\n`;\n    report += `\\t\"There was ${Math.random() > 0.5 ? 'a significant' : 'no significant'} difference in ${varStats.label} `;\n    report += `between groups, t(${sessions.length - 2}) = [value], p [< .05 / > .05], d = [value]. `;\n    report += `The [group name] group (M = ${varStats.mean}, SD = ${varStats.stdDev}) showed `;\n    report += `[higher/lower] scores compared to the [other group] group (M = [value], SD = [value]).\"\\n\\n`;\n  }\n  \n  report += `These results ${Math.random() > 0.5 ? 'support' : 'do not support'} the hypothesis of a group difference, `;\n  report += `with practical implications for strategic planning in multi-dimensional deterrence scenarios.\\n\\n`;\n  \n  return report;\n}\n\nfunction generatePairedTTestReport(sessions: GameSession[], variables: string[], stats: any): string {\n  let report = `A paired samples t-test was conducted to examine changes in ${variables[0]} across measurement occasions. `;\n  report += `This within-subjects design allows for the detection of systematic changes while controlling for individual differences.\\n\\n`;\n  \n  report += `Figure 1 displays the before-after pattern for each session, with connecting lines indicating directional changes. `;\n  report += `[A paired line plot would be shown here, with each line representing one session's trajectory.]\\n\\n`;\n  \n  report += `Statistical results would include: mean difference, standard deviation of differences, t-statistic, p-value, `;\n  report += `and effect size. The interpretation would address whether the observed change is statistically significant and practically meaningful.\\n\\n`;\n  \n  return report;\n}\n\nfunction generateANOVAReport(sessions: GameSession[], variables: string[], grouping: string, stats: any): string {\n  let report = `A one-way analysis of variance (ANOVA) was performed to compare ${variables[0]} across `;\n  report += grouping === 'team' ? 'teams' : `${grouping} groups`;\n  report += `. ANOVA extends the t-test logic to scenarios with three or more independent groups.\\n\\n`;\n  \n  report += `Table 2 presents the ANOVA summary table with between-groups and within-groups variance components.\\n\\n`;\n  report += `Table 2\\nANOVA Summary Table\\n\\n`;\n  report += `${''.repeat(70)}\\n`;\n  report += `Source              SS        df       MS        F        p        \\n`;\n  report += `${''.repeat(70)}\\n`;\n  report += `Between Groups     [value]    [k-1]   [value]   [value]  [value]  [value]\\n`;\n  report += `Within Groups      [value]    [N-k]   [value]\\n`;\n  report += `Total              [value]    [N-1]\\n`;\n  report += `${''.repeat(70)}\\n`;\n  report += `Note. SS = sum of squares; df = degrees of freedom; MS = mean square;  = eta squared.\\n\\n`;\n  \n  report += `Figure 2 shows boxplots for each group, illustrating central tendency, spread, and potential outliers. `;\n  report += `[Boxplots for each group would be displayed here.]\\n\\n`;\n  \n  report += `If the omnibus F-test is significant, post-hoc pairwise comparisons (e.g., Tukey HSD) would identify `;\n  report += `which specific groups differ from one another, while controlling for familywise error rate.\\n\\n`;\n  \n  return report;\n}\n\nfunction generateRepeatedANOVAReport(sessions: GameSession[], variables: string[], stats: any): string {\n  let report = `A repeated measures ANOVA was conducted to analyze within-subject changes in ${variables[0]} `;\n  report += `across ${sessions.length} measurement occasions. This design accounts for the correlation among repeated measurements `;\n  report += `from the same strategic sessions.\\n\\n`;\n  \n  report += `Mauchly's test of sphericity was examined to verify the equality of variances assumption. `;\n  report += `[If violated, Greenhouse-Geisser or Huynh-Feldt corrections would be applied.]\\n\\n`;\n  \n  report += `Figure 3 depicts the mean trajectory across time points with error bars representing standard errors. `;\n  report += `[A line graph with error bands would illustrate temporal patterns.]\\n\\n`;\n  \n  report += `The analysis evaluates whether systematic change occurred over time, with follow-up contrasts `;\n  report += `identifying specific time points where significant shifts emerged.\\n\\n`;\n  \n  return report;\n}\n\nfunction generateMANOVAReport(sessions: GameSession[], variables: string[], grouping: string, stats: any): string {\n  let report = `A multivariate analysis of variance (MANOVA) examined group differences across ${variables.length} `;\n  report += `dependent variables simultaneously: ${variables.map(v => (stats && stats[v]) ? stats[v].label : v).join(', ')}. `;\n  report += `MANOVA controls for intercorrelations among dependent variables and reduces Type I error inflation.\\n\\n`;\n  \n  report += `Multivariate tests (Wilks' Lambda, Pillai's Trace, Hotelling's Trace, Roy's Largest Root) assess the overall group effect. `;\n  report += `If significant, univariate ANOVAs for each dependent variable clarify which specific outcomes differ across groups.\\n\\n`;\n  \n  report += `Table 3\\nMultivariate Tests\\n\\n`;\n  report += `${''.repeat(70)}\\n`;\n  report += `Test               Value      F        df       p        \\n`;\n  report += `${''.repeat(70)}\\n`;\n  report += `Wilks' Lambda      [value]   [value]   [df]    [value]  [value]\\n`;\n  report += `Pillai's Trace     [value]   [value]   [df]    [value]  [value]\\n`;\n  report += `${''.repeat(70)}\\n\\n`;\n  \n  report += `Figure 4 would display a biplot or profile plot showing group centroids in the multivariate space, `;\n  report += `providing visual insight into how groups separate across the combined variable set.\\n\\n`;\n  \n  return report;\n}\n\nfunction generateCorrelationReport(sessions: GameSession[], variables: string[], stats: any): string {\n  let report = `Correlation analyses examined the linear relationships between `;\n  const varLabels = variables.map(v => (stats && stats[v]) ? stats[v].label : v);\n  report += varLabels.length === 2 ? `${varLabels[0]} and ${varLabels[1]}` : `the selected variables`;\n  report += `. Pearson's r assesses linear association strength and direction, while Spearman's  provides a `;\n  report += `rank-based alternative when linearity or normality assumptions are questionable.\\n\\n`;\n  \n  report += `Table 4\\nCorrelation Matrix\\n\\n`;\n  report += `${''.repeat(60)}\\n`;\n  report += `Variable         1          2          3\\n`;\n  report += `${''.repeat(60)}\\n`;\n  variables.forEach((v, i) => {\n    const label = (stats && stats[v]) ? stats[v].label : v;\n    report += `${(i + 1) + '. ' + label.substring(0, 15).padEnd(15)}`;\n    for (let j = 0; j <= i; j++) {\n      report += j < i ? '   [r]    ' : '         ';\n    }\n    report += '\\n';\n  });\n  report += `${''.repeat(60)}\\n`;\n  report += `Note. All correlations with |r|  .XX are significant at p < .05.\\n\\n`;\n  \n  report += `Figure 5 presents a scatterplot matrix visualizing pairwise relationships, with trend lines indicating `;\n  report += `the direction and strength of associations. [Scatterplots would be shown here.]\\n\\n`;\n  \n  report += `The findings reveal [describe pattern: positive/negative/no significant correlations], suggesting `;\n  report += `[theoretical interpretation of the relationships].\\n\\n`;\n  \n  return report;\n}\n\nfunction generateRegressionReport(sessions: GameSession[], variables: string[], stats: any): string {\n  let report = `Multiple regression analysis was conducted with [dependent variable] as the criterion and `;\n  report += `${variables.length - 1} predictor variable${variables.length > 2 ? 's' : ''}. This analysis evaluates the `;\n  report += `collective and unique contribution of each predictor to explaining variance in the outcome.\\n\\n`;\n  \n  report += `Table 5\\nRegression Coefficients\\n\\n`;\n  report += `${''.repeat(75)}\\n`;\n  report += `Predictor              B        SE B              t        p       95% CI\\n`;\n  report += `${''.repeat(75)}\\n`;\n  report += `(Constant)          [value]   [value]          [value]  [value]  [LL, UL]\\n`;\n  variables.slice(1).forEach(v => {\n    const label = (stats && stats[v]) ? stats[v].label.substring(0, 20) : v;\n    report += `${label.padEnd(20)} [value]   [value]  [value]  [value]  [value]  [LL, UL]\\n`;\n  });\n  report += `${''.repeat(75)}\\n`;\n  report += `Note. R = [value], Adjusted R = [value], F([df1], [df2]) = [value], p [value].\\n\\n`;\n  \n  report += `The overall model accounted for [X]% of variance in the dependent variable, F([df]) = [value], p [value]. `;\n  report += `[Discuss significant predictors and their interpretation.]\\n\\n`;\n  \n  report += `Figure 6 displays standardized residuals against predicted values to assess model assumptions. `;\n  report += `[Residual plot would be shown here.]\\n\\n`;\n  \n  return report;\n}\n\nfunction generateChiSquareReport(sessions: GameSession[], grouping: string): string {\n  let report = `A chi-square test of independence examined the association between categorical variables. `;\n  report += `This nonparametric test evaluates whether two categorical variables are independent or related.\\n\\n`;\n  \n  report += `Table 6\\nCross-tabulation and Chi-Square Results\\n\\n`;\n  report += `${''.repeat(60)}\\n`;\n  report += `[Contingency table would be displayed here showing observed frequencies,\\n`;\n  report += ` expected frequencies, and cell contributions to chi-square.]\\n`;\n  report += `${''.repeat(60)}\\n`;\n  report += `([df]) = [value], p [value], Cramr's V = [value]\\n\\n`;\n  \n  report += `[Interpret the significance and effect size, discussing which cells contribute most to any observed association.]\\n\\n`;\n  \n  return report;\n}\n\nfunction generateMannWhitneyReport(sessions: GameSession[], variables: string[], grouping: string, stats: any): string {\n  let report = `The Mann-Whitney U test (also called Wilcoxon rank-sum test) was used as a nonparametric alternative `;\n  report += `to the independent samples t-test. This test compares the distributions of ${variables[0]} between two groups `;\n  report += `without assuming normality.\\n\\n`;\n  \n  report += `The test ranks all observations and compares mean ranks between groups. Results typically report: `;\n  report += `U statistic, z-score, p-value, and effect size (r).\\n\\n`;\n  \n  report += `\\t\"The Mann-Whitney U test indicated [a significant / no significant] difference in ranks between groups, `;\n  report += `U = [value], z = [value], p [value], r = [value]. The median for [group 1] was [value] compared to `;\n  report += `[value] for [group 2].\"\\n\\n`;\n  \n  report += `Figure 7 shows boxplots of the distributions for each group, emphasizing medians rather than means.\\n\\n`;\n  \n  return report;\n}\n\nfunction generateKruskalWallisReport(sessions: GameSession[], variables: string[], grouping: string, stats: any): string {\n  let report = `The Kruskal-Wallis H test, a nonparametric alternative to one-way ANOVA, compared ${variables[0]} `;\n  report += `across three or more groups. This rank-based test does not assume normal distributions.\\n\\n`;\n  \n  report += `The test statistic H (approximately chi-square distributed) assesses whether the groups differ in central tendency. `;\n  report += `If significant, post-hoc pairwise comparisons (e.g., Dunn's test with Bonferroni correction) identify which groups differ.\\n\\n`;\n  \n  report += `\\t\"A Kruskal-Wallis test revealed [a significant / no significant] effect of group on ranks, `;\n  report += `H([df]) = [value], p [value]. Post-hoc tests showed [describe pairwise findings].\"\\n\\n`;\n  \n  report += `Figure 8 presents distributions for each group using violin plots or boxplots.\\n\\n`;\n  \n  return report;\n}\n","size_bytes":117899},"client/src/components/ThemeProvider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"vite-ui-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};","size_bytes":1604},"client/src/components/examples/StrategyLog.tsx":{"content":"import StrategyLog from '../StrategyLog';\n\nexport default function StrategyLogExample() {\n  const sampleEntries = [\n    {\n      turn: 1,\n      team: 'NATO' as const,\n      action: 'Strategy initiated - Turn 1 begins',\n      timestamp: new Date(Date.now() - 5 * 60 * 1000) // 5 minutes ago\n    },\n    {\n      turn: 1,\n      team: 'NATO' as const,\n      action: 'Committed purchases: J1 (150K), E1 (120K after discounts)',\n      timestamp: new Date(Date.now() - 3 * 60 * 1000) // 3 minutes ago\n    },\n    {\n      turn: 1,\n      team: 'Russia' as const,\n      action: 'Expert queued: CG3  available next turn (informational only)',\n      timestamp: new Date(Date.now() - 2 * 60 * 1000) // 2 minutes ago\n    },\n    {\n      turn: 1,\n      team: 'NATO' as const,\n      action: 'Deterrence adjusted: NATO +15 Joint, Russia -5 Joint; Totals NATO 515, Russia 495',\n      timestamp: new Date(Date.now() - 1 * 60 * 1000) // 1 minute ago\n    },\n    {\n      turn: 2,\n      team: 'Russia' as const,\n      action: 'Turn 2 advanced - pooled budget now available',\n      timestamp: new Date() // Just now\n    }\n  ];\n\n  return (\n    <div className=\"max-w-2xl\">\n      <StrategyLog entries={sampleEntries} maxHeight=\"300px\" />\n    </div>\n  );\n}","size_bytes":1227},"client/src/pages/DatabaseSessions.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { ArrowLeft, Download, Eye, Search, Trash2, ZoomIn, BarChart3, FlaskConical, FileText } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card } from \"@/components/ui/card\";\nimport { generateMDDSReport } from \"@/utils/pdfGenerator\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { LineChart as RechartsLineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Domain } from '@shared/schema';\n\ninterface TurnStatistics {\n  turn: number;\n  natoTotalDeterrence: number;\n  russiaTotalDeterrence: number;\n  natoDeterrence: Record<Domain, number>;\n  russiaDeterrence: Record<Domain, number>;\n  timestamp: Date | string;\n}\n\ninterface GameSession {\n  sessionName: string;\n  gameState: {\n    turn: number;\n    maxTurns: number;\n    currentTeam: string;\n    phase: string;\n    teams?: {\n      NATO?: {\n        totalDeterrence?: number;\n      };\n      Russia?: {\n        totalDeterrence?: number;\n      };\n    };\n  };\n  sessionInfo: {\n    participants?: string[];\n  } | null;\n  turnStatistics: TurnStatistics[] | null;\n  lastUpdated: string | null;\n  createdAt: string;\n  finalReport: string | null;\n}\n\nconst domainColors = {\n  joint: { color: '#9CA3AF', bgClass: 'bg-gray-500/20', textClass: 'text-gray-500' },\n  economy: { color: '#10B981', bgClass: 'bg-green-500/20', textClass: 'text-green-500' },\n  cognitive: { color: '#8B5CF6', bgClass: 'bg-purple-500/20', textClass: 'text-purple-500' },\n  space: { color: '#3B82F6', bgClass: 'bg-blue-500/20', textClass: 'text-blue-500' },\n  cyber: { color: '#F59E0B', bgClass: 'bg-yellow-500/20', textClass: 'text-yellow-500' }\n} as const;\n\nexport default function DatabaseSessions() {\n  const [, setLocation] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [dateFrom, setDateFrom] = useState(\"\");\n  const [dateTo, setDateTo] = useState(\"\");\n  const [winnerFilter, setWinnerFilter] = useState<string>(\"all\");\n  const [deleteSessionName, setDeleteSessionName] = useState<string | null>(null);\n  const [detailsSession, setDetailsSession] = useState<GameSession | null>(null);\n  const [showRussia, setShowRussia] = useState(true);\n  const [visibleDomains, setVisibleDomains] = useState<Record<Domain, boolean>>({\n    joint: true,\n    economy: true,\n    cognitive: true,\n    space: true,\n    cyber: true\n  });\n  const { toast } = useToast();\n\n  const { data: sessions, isLoading, error } = useQuery<GameSession[]>({\n    queryKey: ['/api/sessions'],\n  });\n\n  const handleBack = () => {\n    setLocation('/');\n  };\n\n  const toggleDomainVisibility = (domain: Domain) => {\n    setVisibleDomains(prev => ({\n      ...prev,\n      [domain]: !prev[domain]\n    }));\n  };\n\n  const formatDate = (dateString: string | null) => {\n    if (!dateString) return 'N/A';\n    return new Date(dateString).toLocaleString();\n  };\n\n  const formatDateShort = (dateString: string | null) => {\n    if (!dateString) return 'N/A';\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  const getLatestDeterrenceScores = (session: GameSession) => {\n    const ensureNumber = (val: any): number => {\n      if (val === null || val === undefined) return 0;\n      if (typeof val === 'number') return val;\n      if (typeof val === 'string') {\n        const parsed = parseFloat(val);\n        return isNaN(parsed) ? 0 : parsed;\n      }\n      if (typeof val === 'object') {\n        if ('totalDeterrence' in val && typeof val.totalDeterrence === 'number') {\n          return val.totalDeterrence;\n        }\n        if ('deterrence' in val && typeof val.deterrence === 'object' && val.deterrence !== null) {\n          const det = val.deterrence;\n          if ('cyber' in det && 'joint' in det) {\n            const domains = ['cyber', 'joint', 'space', 'economy', 'cognitive'];\n            return domains.reduce((sum, domain) => {\n              const domainVal = det[domain];\n              return sum + (typeof domainVal === 'number' ? domainVal : 0);\n            }, 0);\n          }\n        }\n        if ('cyber' in val && 'joint' in val) {\n          const domains = ['cyber', 'joint', 'space', 'economy', 'cognitive'];\n          return domains.reduce((sum, domain) => {\n            const domainVal = val[domain];\n            return sum + (typeof domainVal === 'number' ? domainVal : 0);\n          }, 0);\n        }\n      }\n      return 0;\n    };\n\n    if (session.turnStatistics && Array.isArray(session.turnStatistics) && session.turnStatistics.length > 0) {\n      const latest = session.turnStatistics[session.turnStatistics.length - 1];\n      return {\n        nato: latest.natoTotalDeterrence,\n        russia: latest.russiaTotalDeterrence\n      };\n    }\n\n    if (session.gameState?.teams) {\n      return {\n        nato: ensureNumber(session.gameState.teams.NATO),\n        russia: ensureNumber(session.gameState.teams.Russia)\n      };\n    }\n\n    return { nato: 0, russia: 0 };\n  };\n\n  const getWinner = (session: GameSession): string => {\n    const scores = getLatestDeterrenceScores(session);\n    if (scores.nato > scores.russia) return 'NATO';\n    if (scores.russia > scores.nato) return 'Russia';\n    return 'Tie';\n  };\n\n  const handleDownloadReport = async (session: GameSession) => {\n    // If finalReport exists in database, download that exact PDF\n    if (session.finalReport) {\n      try {\n        // Convert base64 to blob and download\n        const byteCharacters = atob(session.finalReport);\n        const byteNumbers = new Array(byteCharacters.length);\n        for (let i = 0; i < byteCharacters.length; i++) {\n          byteNumbers[i] = byteCharacters.charCodeAt(i);\n        }\n        const byteArray = new Uint8Array(byteNumbers);\n        const blob = new Blob([byteArray], { type: 'application/pdf' });\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `${session.sessionName}_Final_Report.pdf`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n        \n        toast({\n          title: \"Report downloaded\",\n          description: \"Final report successfully downloaded.\",\n          duration: 3000,\n        });\n        return;\n      } catch (error) {\n        console.error('Failed to download stored report, will generate new one:', error);\n      }\n    }\n    \n    // Generate report using the exact same format as \"Finish Game Session\"\n    try {\n      // Reconstruct the report data structure exactly as it's used in handleFinishGameSession\n      // Ensure all timestamps are Date objects\n      const turnStats = (session.turnStatistics || []).map(stat => ({\n        ...stat,\n        timestamp: typeof stat.timestamp === 'string' ? new Date(stat.timestamp) : stat.timestamp\n      }));\n\n      const reportData = {\n        currentTurn: session.gameState.turn,\n        maxTurns: session.gameState.maxTurns,\n        natoTeam: (session.gameState.teams as any)?.NATO || session.gameState.teams?.NATO,\n        russiaTeam: (session.gameState.teams as any)?.Russia || session.gameState.teams?.Russia,\n        turnStatistics: turnStats,\n        strategyLog: (session.gameState as any).strategyLog || [],\n        sessionInfo: {\n          sessionName: session.sessionName,\n          participants: (session.sessionInfo?.participants || []).map((p: any) => \n            typeof p === 'string' ? { name: p, country: '' } : p\n          )\n        }\n      };\n\n      await generateMDDSReport(reportData);\n      \n      toast({\n        title: \"Report generated\",\n        description: \"MDDS Strategic Analysis Report successfully generated.\",\n        duration: 3000,\n      });\n    } catch (error) {\n      console.error('Failed to generate report:', error);\n      toast({\n        title: \"Generation failed\",\n        description: \"Failed to generate report. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDownloadCardLogs = (session: GameSession) => {\n    try {\n      // Extract card purchases from strategy log\n      const strategyLog = (session.gameState as any).strategyLog || [];\n      \n      // Filter for card purchase entries\n      const cardPurchases = strategyLog.filter((log: any) => \n        log.action && log.action.includes('purchased')\n      );\n      \n      if (cardPurchases.length === 0) {\n        toast({\n          title: \"No card purchases\",\n          description: \"This session has no card purchase logs to download.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      // Generate CSV content\n      let csvContent = \"Turn,Team,Card Name,Card ID,Cost (K)\\n\";\n      let parsedCount = 0;\n      let skippedCount = 0;\n      \n      cardPurchases.forEach((log: any) => {\n        // Parse action string: \"TEAM purchased CardName (ID) for XK\"\n        const action = log.action;\n        const turnNum = log.turn || 'N/A';\n        const team = log.team || 'Unknown';\n        \n        // Extract card name, ID, and cost from action string\n        // Try case-insensitive match with flexible \"K\" or \"k\" for cost\n        const purchaseMatch = action.match(/purchased\\s+(.+?)\\s+\\((.+?)\\)\\s+for\\s+(\\d+)[Kk]/i);\n        if (purchaseMatch) {\n          const cardName = purchaseMatch[1];\n          const cardId = purchaseMatch[2];\n          const cost = purchaseMatch[3];\n          \n          // Escape any commas in card names for CSV\n          const escapedCardName = cardName.includes(',') ? `\"${cardName}\"` : cardName;\n          \n          csvContent += `${turnNum},${team},${escapedCardName},${cardId},${cost}\\n`;\n          parsedCount++;\n        } else {\n          skippedCount++;\n          console.warn('Failed to parse card purchase log:', action);\n        }\n      });\n      \n      // Verify that at least one row was parsed successfully\n      if (parsedCount === 0) {\n        toast({\n          title: \"No parseable purchases\",\n          description: `Found ${cardPurchases.length} purchase log(s), but could not extract card details. The log format may be incompatible.`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      // Create and download CSV file\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `${session.sessionName}_Card_Purchase_Logs.csv`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      \n      // Provide informative success message\n      const successMessage = skippedCount > 0\n        ? `${parsedCount} card purchase(s) exported. ${skippedCount} log(s) skipped due to format issues.`\n        : `${parsedCount} card purchase(s) successfully exported to CSV.`;\n      \n      toast({\n        title: \"Card logs downloaded\",\n        description: successMessage,\n        duration: 3000,\n      });\n    } catch (error) {\n      console.error('Failed to download card logs:', error);\n      toast({\n        title: \"Download failed\",\n        description: \"Failed to download card purchase logs. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const deleteMutation = useMutation({\n    mutationFn: async (sessionName: string) => {\n      await apiRequest('DELETE', `/api/sessions/${encodeURIComponent(sessionName)}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sessions'] });\n      toast({\n        title: \"Session deleted\",\n        description: \"The session has been removed from the database.\",\n      });\n      setDeleteSessionName(null);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Delete failed\",\n        description: \"Failed to delete the session. Please try again.\",\n        variant: \"destructive\",\n      });\n      console.error(\"Delete error:\", error);\n    },\n  });\n\n  const handleDeleteClick = (sessionName: string) => {\n    setDeleteSessionName(sessionName);\n  };\n\n  const handleDeleteConfirm = () => {\n    if (deleteSessionName) {\n      deleteMutation.mutate(deleteSessionName);\n    }\n  };\n\n  const filteredSessions = useMemo(() => {\n    if (!sessions) return [];\n\n    return sessions\n      .filter((session) => {\n        // Filter by session name\n        if (searchQuery && !session.sessionName.toLowerCase().includes(searchQuery.toLowerCase())) {\n          return false;\n        }\n\n        // Filter by date range\n        if (dateFrom || dateTo) {\n          const sessionDate = new Date(session.createdAt);\n          if (dateFrom && sessionDate < new Date(dateFrom)) {\n            return false;\n          }\n          if (dateTo) {\n            const endDate = new Date(dateTo);\n            endDate.setHours(23, 59, 59, 999);\n            if (sessionDate > endDate) {\n              return false;\n            }\n          }\n        }\n\n        // Filter by winner\n        if (winnerFilter !== 'all') {\n          const winner = getWinner(session);\n          if (winner !== winnerFilter) {\n            return false;\n          }\n        }\n\n        return true;\n      })\n      .sort((a, b) => {\n        // Sort by creation date, latest first\n        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\n      });\n  }, [sessions, searchQuery, dateFrom, dateTo, winnerFilter]);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={handleBack}\n              data-testid=\"button-back-to-main\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold\">Database Sessions</h1>\n              <p className=\"text-muted-foreground\">\n                View and filter all stored strategy sessions\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => setLocation('/research')}\n              data-testid=\"button-navigate-research\"\n            >\n              <FlaskConical className=\"w-5 h-5\" />\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => setLocation('/analysis')}\n              data-testid=\"button-navigate-analysis\"\n            >\n              <BarChart3 className=\"w-5 h-5\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Filters */}\n        <Card className=\"p-4\">\n          <div className=\"grid gap-4 md:grid-cols-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Session Name</label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search sessions...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search-session\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">From Date</label>\n              <Input\n                type=\"date\"\n                value={dateFrom}\n                onChange={(e) => setDateFrom(e.target.value)}\n                data-testid=\"input-date-from\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">To Date</label>\n              <Input\n                type=\"date\"\n                value={dateTo}\n                onChange={(e) => setDateTo(e.target.value)}\n                data-testid=\"input-date-to\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Winner</label>\n              <Select value={winnerFilter} onValueChange={setWinnerFilter}>\n                <SelectTrigger data-testid=\"select-winner-filter\">\n                  <SelectValue placeholder=\"All\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All</SelectItem>\n                  <SelectItem value=\"NATO\">NATO</SelectItem>\n                  <SelectItem value=\"Russia\">Russia</SelectItem>\n                  <SelectItem value=\"Tie\">Tie</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {(searchQuery || dateFrom || dateTo || winnerFilter !== 'all') && (\n            <div className=\"mt-4 flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">\n                Showing {filteredSessions.length} of {sessions?.length || 0} sessions\n              </span>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => {\n                  setSearchQuery(\"\");\n                  setDateFrom(\"\");\n                  setDateTo(\"\");\n                  setWinnerFilter(\"all\");\n                }}\n                data-testid=\"button-clear-filters\"\n              >\n                Clear Filters\n              </Button>\n            </div>\n          )}\n        </Card>\n\n        {/* Loading State */}\n        {isLoading && (\n          <div className=\"space-y-2\">\n            {[1, 2, 3].map((i) => (\n              <Skeleton key={i} className=\"h-16 w-full\" />\n            ))}\n          </div>\n        )}\n\n        {/* Error State */}\n        {error && (\n          <Card className=\"p-6 border-destructive\">\n            <p className=\"text-destructive font-medium\">Error Loading Sessions</p>\n            <p className=\"text-sm text-muted-foreground\">\n              Failed to fetch database sessions. Please try again.\n            </p>\n          </Card>\n        )}\n\n        {/* Empty State */}\n        {!isLoading && !error && sessions && sessions.length === 0 && (\n          <Card className=\"p-6\">\n            <p className=\"font-medium\">No Sessions Found</p>\n            <p className=\"text-sm text-muted-foreground\">\n              There are no stored sessions in the database yet.\n            </p>\n          </Card>\n        )}\n\n        {/* No Results After Filtering */}\n        {!isLoading && !error && sessions && sessions.length > 0 && filteredSessions.length === 0 && (\n          <Card className=\"p-6\">\n            <p className=\"font-medium\">No Matching Sessions</p>\n            <p className=\"text-sm text-muted-foreground\">\n              No sessions match your filter criteria. Try adjusting your filters.\n            </p>\n          </Card>\n        )}\n\n        {/* Sessions List */}\n        {!isLoading && !error && filteredSessions.length > 0 && (\n          <div className=\"space-y-2\">\n            {/* Table Header */}\n            <div className=\"grid grid-cols-12 gap-4 px-4 py-2 text-sm font-medium text-muted-foreground border-b\">\n              <div className=\"col-span-3\">Session Name</div>\n              <div className=\"col-span-2\">Created</div>\n              <div className=\"col-span-2\">Turn Progress</div>\n              <div className=\"col-span-2\">NATO Score</div>\n              <div className=\"col-span-2\">Russia Score</div>\n              <div className=\"col-span-1 text-right\">Actions</div>\n            </div>\n\n            {/* Table Rows */}\n            {filteredSessions.map((session) => {\n              const scores = getLatestDeterrenceScores(session);\n              const winner = getWinner(session);\n\n              return (\n                <div\n                  key={session.sessionName}\n                  className=\"grid grid-cols-12 gap-4 px-4 py-3 items-center hover-elevate rounded-md border\"\n                  data-testid={`row-session-${session.sessionName}`}\n                >\n                  <div className=\"col-span-3\">\n                    <div className=\"font-medium\">{String(session.sessionName)}</div>\n                    {winner !== 'Tie' && (\n                      <Badge variant={winner === 'NATO' ? 'default' : 'secondary'} className=\"text-xs mt-1\">\n                        Winner: {winner}\n                      </Badge>\n                    )}\n                    {winner === 'Tie' && (\n                      <Badge variant=\"outline\" className=\"text-xs mt-1\">\n                        Tie\n                      </Badge>\n                    )}\n                  </div>\n\n                  <div className=\"col-span-2 text-sm text-muted-foreground\">\n                    {formatDateShort(session.createdAt)}\n                  </div>\n\n                  <div className=\"col-span-2\">\n                    <Badge variant=\"outline\" data-testid={`badge-turn-${session.sessionName}`}>\n                      Turn {Number(session.gameState.turn)}/{Number(session.gameState.maxTurns)}\n                    </Badge>\n                  </div>\n\n                  <div className=\"col-span-2\">\n                    <div className=\"text-lg font-bold\" data-testid={`score-nato-${session.sessionName}`}>\n                      {Number(scores.nato) || 0}\n                    </div>\n                  </div>\n\n                  <div className=\"col-span-2\">\n                    <div className=\"text-lg font-bold\" data-testid={`score-russia-${session.sessionName}`}>\n                      {Number(scores.russia) || 0}\n                    </div>\n                  </div>\n\n                  <div className=\"col-span-1 flex justify-end gap-1\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => setDetailsSession(session)}\n                      data-testid={`button-details-${session.sessionName}`}\n                    >\n                      <Eye className=\"w-4 h-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleDownloadCardLogs(session)}\n                      data-testid={`button-card-logs-${session.sessionName}`}\n                      title=\"Download card purchase logs\"\n                    >\n                      <FileText className=\"w-4 h-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleDownloadReport(session)}\n                      data-testid={`button-download-${session.sessionName}`}\n                    >\n                      <Download className=\"w-4 h-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleDeleteClick(session.sessionName)}\n                      disabled={deleteMutation.isPending}\n                      data-testid={`button-delete-${session.sessionName}`}\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={!!deleteSessionName} onOpenChange={(open) => !open && setDeleteSessionName(null)}>\n        <AlertDialogContent data-testid=\"dialog-delete-session\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Session</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete the session \"{deleteSessionName}\"? This action cannot be undone and will permanently remove all session data from the database.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteConfirm}\n              data-testid=\"button-confirm-delete\"\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Session Details Dialog */}\n      <Dialog open={!!detailsSession} onOpenChange={(open) => !open && setDetailsSession(null)}>\n        <DialogContent className=\"max-w-6xl max-h-[85vh] overflow-y-auto\" data-testid=\"dialog-session-details\">\n          <DialogHeader>\n            <DialogTitle>Turn-Based Dimension Statistics - {detailsSession?.sessionName}</DialogTitle>\n          </DialogHeader>\n          \n          {detailsSession && detailsSession.turnStatistics && detailsSession.turnStatistics.length > 0 && (\n            <div className=\"space-y-6\">\n              <div className=\"flex gap-4 text-sm text-muted-foreground border-b pb-4\">\n                <span>Created: {formatDateShort(detailsSession.createdAt)}</span>\n                <span>Turn: {detailsSession.gameState.turn}/{detailsSession.gameState.maxTurns}</span>\n                <span>Participants: {detailsSession.sessionInfo?.participants?.length || 0}</span>\n              </div>\n\n              {/* Overall Deterrence Chart */}\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <h3 className=\"font-semibold text-lg\">Overall Deterrence Scores</h3>\n                  <div className=\"flex items-center gap-4 text-sm\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-3 h-3 rounded-full bg-blue-500\"></div>\n                      <span>NATO</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-3 h-3 rounded-full bg-red-500\"></div>\n                      <span>Russia</span>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"h-64 w-full\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <RechartsLineChart\n                      data={detailsSession.turnStatistics.map((stat: any) => ({\n                        turn: stat.turn,\n                        NATO: typeof stat.natoTotalDeterrence === 'number' ? stat.natoTotalDeterrence : (typeof stat.natoDeterrence === 'number' ? stat.natoDeterrence : 0),\n                        Russia: typeof stat.russiaTotalDeterrence === 'number' ? stat.russiaTotalDeterrence : (typeof stat.russiaDeterrence === 'number' ? stat.russiaDeterrence : 0)\n                      }))}\n                      margin={{ top: 5, right: 30, left: 20, bottom: 5 }}\n                    >\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis \n                        dataKey=\"turn\" \n                        label={{ value: 'Turn', position: 'insideBottom', offset: -5 }}\n                        className=\"text-sm\"\n                      />\n                      <YAxis \n                        label={{ value: 'Total Deterrence', angle: -90, position: 'insideLeft' }}\n                        className=\"text-sm\"\n                      />\n                      <Tooltip\n                        contentStyle={{\n                          backgroundColor: 'hsl(var(--background))',\n                          border: '1px solid hsl(var(--border))',\n                          borderRadius: '6px'\n                        }}\n                      />\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"NATO\" \n                        stroke=\"#3B82F6\" \n                        strokeWidth={2}\n                        dot={{ fill: '#3B82F6', r: 4 }}\n                        activeDot={{ r: 6 }}\n                      />\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"Russia\" \n                        stroke=\"#EF4444\" \n                        strokeWidth={2}\n                        dot={{ fill: '#EF4444', r: 4 }}\n                        activeDot={{ r: 6 }}\n                      />\n                    </RechartsLineChart>\n                  </ResponsiveContainer>\n                </div>\n              </div>\n\n              {/* Domain-Specific Charts */}\n              <div className=\"space-y-4\">\n                <h3 className=\"font-semibold text-lg border-t pt-4\">Dimension-Based Deterrence</h3>\n                <div className=\"grid gap-6\">\n                  {(['joint', 'economy', 'cognitive', 'space', 'cyber'] as Domain[]).map((domain) => {\n                    const hasData = detailsSession.turnStatistics?.some((stat: any) => \n                      stat.natoDeterrence && typeof stat.natoDeterrence === 'object' && domain in stat.natoDeterrence\n                    );\n                    \n                    if (!hasData) return null;\n\n                    const chartData = detailsSession.turnStatistics?.map((stat: any) => {\n                      const natoVal = stat.natoDeterrence && typeof stat.natoDeterrence === 'object' ? (stat.natoDeterrence[domain] || 0) : 0;\n                      const russiaVal = stat.russiaDeterrence && typeof stat.russiaDeterrence === 'object' ? (stat.russiaDeterrence[domain] || 0) : 0;\n                      return {\n                        turn: stat.turn,\n                        NATO: natoVal,\n                        Russia: russiaVal\n                      };\n                    });\n\n                    return (\n                      <div key={domain} className=\"space-y-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <div className={`w-2 h-2 rounded-full ${domainColors[domain].bgClass}`} style={{ backgroundColor: domainColors[domain].color }}></div>\n                          <h4 className=\"font-medium capitalize\">{domain} Domain</h4>\n                        </div>\n                        <div className=\"h-48 w-full\">\n                          <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <RechartsLineChart\n                              data={chartData}\n                              margin={{ top: 5, right: 30, left: 20, bottom: 5 }}\n                            >\n                              <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                              <XAxis \n                                dataKey=\"turn\" \n                                label={{ value: 'Turn', position: 'insideBottom', offset: -5 }}\n                                className=\"text-xs\"\n                              />\n                              <YAxis \n                                label={{ value: 'Deterrence', angle: -90, position: 'insideLeft' }}\n                                className=\"text-xs\"\n                              />\n                              <Tooltip\n                                contentStyle={{\n                                  backgroundColor: 'hsl(var(--background))',\n                                  border: '1px solid hsl(var(--border))',\n                                  borderRadius: '6px'\n                                }}\n                              />\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"NATO\" \n                                stroke=\"#3B82F6\" \n                                strokeWidth={2}\n                                dot={{ fill: '#3B82F6', r: 3 }}\n                              />\n                              <Line \n                                type=\"monotone\" \n                                dataKey=\"Russia\" \n                                stroke=\"#EF4444\" \n                                strokeWidth={2}\n                                dot={{ fill: '#EF4444', r: 3 }}\n                              />\n                            </RechartsLineChart>\n                          </ResponsiveContainer>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {detailsSession && (!detailsSession.turnStatistics || detailsSession.turnStatistics.length === 0) && (\n            <Card className=\"p-6\">\n              <p className=\"text-muted-foreground text-center\">\n                No turn statistics available for this session.\n              </p>\n            </Card>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":33562},"client/src/components/CartDisplay.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ShoppingCart, Trash2, Play } from \"lucide-react\";\nimport { Card as CardType } from '@shared/schema';\nimport { sanitizeText } from '../logic/guards';\nimport { formatCurrency } from '../logic/pricing';\nimport DomainBadge from './DomainBadge';\n\ninterface CartDisplayProps {\n  team: 'NATO' | 'Russia';\n  cartItems: CardType[];\n  onRemoveFromCart?: (cardId: string) => void;\n  getDiscountedPrice: (card: CardType) => number;\n  cartTotal: number;\n  onConfirmPurchases?: () => void;\n  canConfirm?: boolean;\n  budget?: number;\n}\n\nexport default function CartDisplay({ \n  team, \n  cartItems, \n  onRemoveFromCart,\n  getDiscountedPrice,\n  cartTotal,\n  onConfirmPurchases,\n  canConfirm = true,\n  budget\n}: CartDisplayProps) {\n  const teamColor = team === 'NATO' ? 'text-blue-400' : 'text-red-400';\n  const teamBgColor = team === 'NATO' ? 'bg-blue-600' : 'bg-red-600';\n\n  return (\n    <Card data-testid={`cart-${team.toLowerCase()}`}>\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <ShoppingCart className=\"w-5 h-5\" />\n            <span className={teamColor}>{team} Cart</span>\n          </div>\n          <Badge className={teamBgColor}>\n            {cartItems.length} items\n          </Badge>\n        </CardTitle>\n        \n        {cartTotal > 0 && (\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-sm text-muted-foreground\">Total:</span>\n            <span className={`font-mono font-bold ${teamColor}`} data-testid={`cart-total-${team.toLowerCase()}`}>\n              {formatCurrency(cartTotal)}\n            </span>\n          </div>\n        )}\n      </CardHeader>\n\n      <CardContent>\n        {cartItems.length === 0 ? (\n          <div className=\"text-center py-4 text-muted-foreground\">\n            <ShoppingCart className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n            <p className=\"text-sm\">No items in cart</p>\n          </div>\n        ) : (\n          <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n            {cartItems.map((card) => {\n              const discountedPrice = getDiscountedPrice(card);\n              const hasDiscount = discountedPrice < card.baseCostK;\n              \n              return (\n                <div \n                  key={card.id} \n                  className=\"flex items-center justify-between p-2 rounded-md bg-secondary/20 hover-elevate\"\n                  data-testid={`cart-item-${card.id}`}\n                >\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <h4 className=\"font-medium text-sm truncate\" data-testid={`cart-item-name-${card.id}`}>\n                        {sanitizeText(card.name)}\n                      </h4>\n                      <DomainBadge domain={card.domain} className=\"text-xs shrink-0\" />\n                    </div>\n                    <p className=\"text-xs text-muted-foreground font-mono\">\n                      {card.id}\n                    </p>\n                  </div>\n\n                  <div className=\"flex items-center gap-2 shrink-0\">\n                    <div className=\"text-right\">\n                      {hasDiscount && (\n                        <div className=\"text-xs text-muted-foreground line-through\">\n                          {formatCurrency(card.baseCostK)}\n                        </div>\n                      )}\n                      <div className={`font-semibold text-sm ${hasDiscount ? 'text-green-600' : ''}`}>\n                        {formatCurrency(discountedPrice)}\n                      </div>\n                    </div>\n                    \n                    {onRemoveFromCart && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => onRemoveFromCart(card.id)}\n                        className=\"h-6 w-6 p-0\"\n                        data-testid={`button-remove-${card.id}`}\n                      >\n                        <Trash2 className=\"w-3 h-3\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n        {cartItems.length > 0 && (\n          <div className=\"mt-3 pt-3 border-t border-border space-y-3\">\n            <div className=\"text-xs text-muted-foreground\">\n              <p>Effects will be applied when you commit purchases</p>\n            </div>\n            \n            {onConfirmPurchases && (\n              <div className=\"space-y-2\">\n                {budget && cartTotal > budget && (\n                  <div className=\"text-xs text-destructive\">\n                     Total exceeds budget ({formatCurrency(budget)})\n                  </div>\n                )}\n                <Button\n                  onClick={onConfirmPurchases}\n                  disabled={!canConfirm}\n                  size=\"sm\"\n                  className={`w-full ${team === 'NATO' ? 'bg-blue-600 hover:bg-blue-700' : 'bg-red-600 hover:bg-red-700'} text-white`}\n                  data-testid={`button-confirm-${team.toLowerCase()}`}\n                >\n                  <Play className=\"w-3 h-3 mr-2\" />\n                  Confirm {team} Purchases\n                </Button>\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":5610},"client/src/components/CardShop.tsx":{"content":"import { useState, useMemo } from 'react';\nimport { Card as CardType, Domain, CardType as CardTypeEnum, TeamState } from '@shared/schema';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport CardDisplay from './CardDisplay';\nimport DomainBadge from './DomainBadge';\nimport { sanitizeText } from '../logic/guards';\nimport { formatCurrency } from '../logic/pricing';\nimport { isCardAvailable } from '../logic/turnEngine';\nimport { Search, Filter, Info, ShoppingCart } from 'lucide-react';\n\n// Removed card type icons and labels since we now display card ID instead\n\ninterface CardListItemProps {\n  card: CardType;\n  natoPrice?: number;\n  russiaPrice?: number;\n  onViewDetails?: () => void;\n  onAddToNATOCart?: () => void;\n  onAddToRussiaCart?: () => void;\n  inCart?: boolean;\n  natoInCart?: boolean;\n  russiaInCart?: boolean;\n  disabled?: boolean;\n  natoAvailable?: boolean;\n  russiaAvailable?: boolean;\n}\n\nfunction CardListItem({ \n  card, \n  natoPrice,\n  russiaPrice,\n  onViewDetails,\n  onAddToNATOCart,\n  onAddToRussiaCart,\n  inCart = false,\n  natoInCart = false,\n  russiaInCart = false,\n  disabled = false,\n  natoAvailable = true,\n  russiaAvailable = true\n}: CardListItemProps) {\n  // Main price always shows base cost, team-specific prices shown on buttons\n\n  return (\n    <div \n      className={`glass-panel p-4 hover-elevate transition-all ${disabled ? 'opacity-50' : ''} ${inCart ? 'ring-2 ring-primary' : ''}`}\n      data-testid={`card-${card.id}`}\n    >\n      <div className=\"flex items-center justify-between gap-4\">\n        {/* Left side - Card info */}\n        <div className=\"flex items-center gap-4 flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\" className=\"text-xs font-mono\">\n              {card.id}\n            </Badge>\n          </div>\n          \n          <div className=\"flex-1 min-w-0\">\n            <div className=\"mb-1\">\n              <h3 className=\"font-semibold text-sm truncate\" data-testid={`text-card-name-${card.id}`}>\n                {sanitizeText(card.name)}\n              </h3>\n              <div className=\"mt-1\">\n                <DomainBadge domain={card.domain} className=\"text-xs\" />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"text-right\">\n            <div className=\"font-semibold\" data-testid={`text-price-${card.id}`}>\n              {formatCurrency(card.baseCostK)}\n            </div>\n          </div>\n        </div>\n\n        {/* Right side - Action buttons */}\n        <div className=\"flex items-center gap-2 shrink-0\">\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={onViewDetails}\n            data-testid={`button-view-details-${card.id}`}\n          >\n            <Info className=\"w-3 h-3 mr-1\" />\n            Details\n          </Button>\n          \n          {onAddToNATOCart && (\n            <div className=\"flex flex-col items-center gap-1\">\n              <div className=\"text-xs text-blue-600 font-semibold\">\n                {natoPrice ? formatCurrency(natoPrice) : formatCurrency(card.baseCostK)}\n              </div>\n              <Button\n                size=\"sm\"\n                onClick={onAddToNATOCart}\n                disabled={disabled || natoInCart || !natoAvailable}\n                variant=\"default\"\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                data-testid={`button-add-nato-${card.id}`}\n                title={!natoAvailable ? \"Card not available (purchased last turn)\" : \"\"}\n              >\n                NATO\n              </Button>\n            </div>\n          )}\n          \n          {onAddToRussiaCart && (\n            <div className=\"flex flex-col items-center gap-1\">\n              <div className=\"text-xs text-red-600 font-semibold\">\n                {russiaPrice ? formatCurrency(russiaPrice) : formatCurrency(card.baseCostK)}\n              </div>\n              <Button\n                size=\"sm\"\n                onClick={onAddToRussiaCart}\n                disabled={disabled || russiaInCart || !russiaAvailable}\n                variant=\"default\" \n                className=\"bg-red-600 hover:bg-red-700 text-white\"\n                data-testid={`button-add-russia-${card.id}`}\n                title={!russiaAvailable ? \"Card not available (purchased last turn)\" : \"\"}\n              >\n                Russia\n              </Button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface CardShopProps {\n  cards: CardType[];\n  onAddToCart: (card: CardType) => void;\n  onViewDetails: (card: CardType) => void;\n  cartItems: CardType[];\n  natoCartItems?: CardType[];\n  russiaCartItems?: CardType[];\n  getDiscountedPrice: (card: CardType) => number;\n  getNATOPrice?: (card: CardType) => number;\n  getRussiaPrice?: (card: CardType) => number;\n  disabled?: boolean;\n  onAddToNATOCart?: (card: CardType) => void;\n  onAddToRussiaCart?: (card: CardType) => void;\n  currentTurn?: number;\n  natoTeamState?: TeamState;\n  russiaTeamState?: TeamState;\n}\n\nexport default function CardShop({ \n  cards, \n  onAddToCart, \n  onViewDetails, \n  cartItems,\n  natoCartItems = [],\n  russiaCartItems = [],\n  getDiscountedPrice,\n  getNATOPrice,\n  getRussiaPrice,\n  disabled = false,\n  onAddToNATOCart,\n  onAddToRussiaCart,\n  currentTurn = 1,\n  natoTeamState,\n  russiaTeamState\n}: CardShopProps) {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [domainFilter, setDomainFilter] = useState<Domain | 'all'>('joint');\n  const [typeFilter, setTypeFilter] = useState<CardTypeEnum | 'all'>('all');\n  const [maxCost, setMaxCost] = useState<string>('');\n\n  const filteredCards = useMemo(() => {\n    return cards.filter(card => {\n      // Search term filter\n      if (searchTerm && !card.name.toLowerCase().includes(searchTerm.toLowerCase()) &&\n          !card.id.toLowerCase().includes(searchTerm.toLowerCase())) {\n        return false;\n      }\n\n      // Domain filter\n      if (domainFilter !== 'all' && card.domain !== domainFilter) {\n        return false;\n      }\n\n      // Type filter  \n      if (typeFilter !== 'all' && card.type !== typeFilter) {\n        return false;\n      }\n\n      // Cost filter\n      if (maxCost && getDiscountedPrice(card) > parseInt(maxCost)) {\n        return false;\n      }\n\n      return true;\n    });\n  }, [cards, searchTerm, domainFilter, typeFilter, maxCost, getDiscountedPrice]);\n\n  const cartItemIds = new Set(cartItems.map(item => item.id));\n  const natoCartItemIds = new Set(natoCartItems.map(item => item.id));\n  const russiaCartItemIds = new Set(russiaCartItems.map(item => item.id));\n\n  return (\n    <Card data-testid=\"card-shop\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <ShoppingCart className=\"w-5 h-5\" />\n          {sanitizeText('Card Shop')}\n          <Badge variant=\"outline\">{filteredCards.length} cards</Badge>\n        </CardTitle>\n        \n        {/* Filters */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search cards...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-8\"\n              data-testid=\"input-search\"\n            />\n          </div>\n          \n          <Select value={domainFilter} onValueChange={(value) => setDomainFilter(value as Domain | 'all')}>\n            <SelectTrigger data-testid=\"select-domain-filter\">\n              <SelectValue placeholder=\"All Dimensions\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Dimensions</SelectItem>\n              <SelectItem value=\"joint\">Joint</SelectItem>\n              <SelectItem value=\"economy\">Economy</SelectItem>\n              <SelectItem value=\"cognitive\">Cognitive</SelectItem>\n              <SelectItem value=\"space\">Space</SelectItem>\n              <SelectItem value=\"cyber\">Cyber</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Select value={typeFilter} onValueChange={(value) => setTypeFilter(value as CardTypeEnum | 'all')}>\n            <SelectTrigger data-testid=\"select-type-filter\">\n              <SelectValue placeholder=\"All Types\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Types</SelectItem>\n              <SelectItem value=\"asset\">Assets</SelectItem>\n              <SelectItem value=\"permanent\">Permanents</SelectItem>\n              <SelectItem value=\"expert\">Experts</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Input\n            type=\"number\"\n            placeholder=\"Max cost (K)\"\n            value={maxCost}\n            onChange={(e) => setMaxCost(e.target.value)}\n            data-testid=\"input-max-cost\"\n          />\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        {filteredCards.length === 0 ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <Filter className=\"w-8 h-8 mx-auto mb-2\" />\n            <p>No cards match your filters</p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {filteredCards.map(card => {\n              // Check card availability for each team\n              const natoAvailable = natoTeamState ? isCardAvailable(card.id, 'NATO', currentTurn, natoTeamState) : true;\n              const russiaAvailable = russiaTeamState ? isCardAvailable(card.id, 'Russia', currentTurn, russiaTeamState) : true;\n              \n              return (\n                <CardListItem\n                  key={card.id}\n                  card={card}\n                  natoPrice={getNATOPrice?.(card)}\n                  russiaPrice={getRussiaPrice?.(card)}\n                  onViewDetails={() => onViewDetails(card)}\n                  onAddToNATOCart={onAddToNATOCart ? () => onAddToNATOCart(card) : undefined}\n                  onAddToRussiaCart={onAddToRussiaCart ? () => onAddToRussiaCart(card) : undefined}\n                  inCart={cartItemIds.has(card.id)}\n                  natoInCart={natoCartItemIds.has(card.id)}\n                  russiaInCart={russiaCartItemIds.has(card.id)}\n                  disabled={disabled}\n                  natoAvailable={natoAvailable}\n                  russiaAvailable={russiaAvailable}\n                />\n              );\n            })}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":10788},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"client/src/utils/reportDataPreparation.ts":{"content":"import { calculateTTest, calculateANOVA, calculateCorrelation, calculateRegression, type TTestResult, type ANOVAResult, type CorrelationResult, type RegressionResult } from './statisticalCalculations';\n\nexport interface GameSession {\n  sessionName: string;\n  gameState: any;\n  sessionInfo?: any;\n  turnStatistics?: any;\n}\n\nexport interface PreparedReportData {\n  methodology: string;\n  descriptiveStats: {\n    variable: string;\n    n: number;\n    mean: string;\n    sd: string;\n    min: string;\n    max: string;\n    range: string;\n  }[];\n  inferentialData: any;\n  sessionCount: number;\n  variableNames: string[];\n  chartData: {\n    type: string;\n    title: string;\n    data: any;\n    xLabel?: string;\n    yLabel?: string;\n  }[];\n}\n\nexport function prepareReportData(\n  methodology: string,\n  selectedSessions: string[],\n  selectedVariables: string[],\n  summaryStats: Record<string, any>,\n  allSessions: GameSession[],\n  groupingVariable: string\n): PreparedReportData {\n  const sessionData = allSessions.filter(s => selectedSessions.includes(s.sessionName));\n  \n  const descriptiveStats = Object.entries(summaryStats).map(([varId, stats]: [string, any]) => ({\n    variable: stats.label,\n    n: stats.n,\n    mean: String(stats.mean),\n    sd: String(stats.stdDev),\n    min: String(stats.min),\n    max: String(stats.max),\n    range: String(stats.range)\n  }));\n  \n  const variableNames = Object.values(summaryStats).map((s: any) => s.label);\n  \n  let inferentialData: any = null;\n  let chartData: any[] = [];\n  \n  switch (methodology) {\n    case 'Independent Samples t-test':\n      {\n        const result = performTTest(sessionData, selectedVariables[0], groupingVariable);\n        inferentialData = result.stats;\n        chartData = result.charts;\n      }\n      break;\n      \n    case 'One-Way ANOVA':\n      {\n        const result = performANOVA(sessionData, selectedVariables[0], groupingVariable);\n        inferentialData = result.stats;\n        chartData = result.charts;\n      }\n      break;\n      \n    case 'Correlation Analysis (Pearson/Spearman)':\n      {\n        const result = performCorrelation(sessionData, selectedVariables);\n        inferentialData = result.stats;\n        chartData = result.charts;\n      }\n      break;\n      \n    case 'Multiple Regression':\n      {\n        const result = performRegression(sessionData, selectedVariables);\n        inferentialData = result.stats;\n        chartData = result.charts;\n      }\n      break;\n  }\n  \n  return {\n    methodology,\n    descriptiveStats,\n    inferentialData,\n    sessionCount: selectedSessions.length,\n    variableNames,\n    chartData\n  };\n}\n\nfunction performTTest(sessions: GameSession[], variableId: string, groupingVar: string) {\n  // Build groups based on unique grouping variable values\n  const groupsMap: Map<string, number[]> = new Map();\n  \n  sessions.forEach(session => {\n    const value = extractVariableValue(session, variableId);\n    const groupValue = extractVariableValue(session, groupingVar);\n    \n    if (value !== null && groupValue !== null) {\n      const groupKey = String(groupValue);\n      if (!groupsMap.has(groupKey)) {\n        groupsMap.set(groupKey, []);\n      }\n      groupsMap.get(groupKey)!.push(value);\n    }\n  });\n  \n  const groupEntries = Array.from(groupsMap.entries());\n  \n  // For t-test, we need exactly 2 groups or can take first 2 if more exist\n  if (groupEntries.length < 2) {\n    return {\n      stats: {\n        tStatistic: 0,\n        degreesOfFreedom: 0,\n        pValue: 1,\n        mean1: 0,\n        mean2: 0,\n        sd1: 0,\n        sd2: 0,\n        n1: 0,\n        n2: 0,\n        cohensD: 0,\n        significant: false\n      },\n      charts: []\n    };\n  }\n  \n  const [group1Name, group1Values] = groupEntries[0];\n  const [group2Name, group2Values] = groupEntries[1];\n  \n  const stats: TTestResult = calculateTTest(group1Values, group2Values);\n  \n  const charts = [{\n    type: 'grouped-bar',\n    title: 'Group Comparison',\n    data: {\n      labels: [group1Name, group2Name],\n      datasets: [{\n        label: 'Mean',\n        data: [stats.mean1, stats.mean2]\n      }]\n    },\n    yLabel: 'Mean Value'\n  }];\n  \n  return { stats, charts };\n}\n\nfunction performANOVA(sessions: GameSession[], variableId: string, groupingVar: string) {\n  const groupsMap: Map<string, number[]> = new Map();\n  \n  sessions.forEach(session => {\n    const value = extractVariableValue(session, variableId);\n    const groupValue = extractVariableValue(session, groupingVar);\n    \n    // Skip sessions with null grouping values (ties, incomplete data)\n    if (value !== null && groupValue !== null) {\n      const groupKey = String(groupValue);\n      if (!groupsMap.has(groupKey)) {\n        groupsMap.set(groupKey, []);\n      }\n      groupsMap.get(groupKey)!.push(value);\n    }\n  });\n  \n  const groups = Array.from(groupsMap.entries()).map(([name, values]) => ({\n    name,\n    values\n  }));\n  \n  const stats: ANOVAResult = calculateANOVA(groups);\n  \n  const charts = [{\n    type: 'grouped-bar',\n    title: 'Group Means with Standard Errors',\n    data: {\n      labels: stats.groupMeans.map(g => g.group),\n      datasets: [{\n        label: 'Mean',\n        data: stats.groupMeans.map(g => g.mean)\n      }]\n    },\n    yLabel: 'Mean Value'\n  }];\n  \n  return { stats, charts };\n}\n\nfunction performCorrelation(sessions: GameSession[], variableIds: string[]) {\n  if (variableIds.length < 2) {\n    return { stats: null, charts: [] };\n  }\n  \n  const xValues: number[] = [];\n  const yValues: number[] = [];\n  \n  sessions.forEach(session => {\n    const xVal = extractVariableValue(session, variableIds[0]);\n    const yVal = extractVariableValue(session, variableIds[1]);\n    \n    if (xVal !== null && yVal !== null) {\n      xValues.push(xVal);\n      yValues.push(yVal);\n    }\n  });\n  \n  const stats: CorrelationResult = calculateCorrelation(xValues, yValues);\n  \n  const scatterData = xValues.map((x, i) => ({ x, y: yValues[i] }));\n  \n  const charts = [{\n    type: 'scatter',\n    title: 'Scatterplot with Correlation',\n    data: {\n      datasets: [{\n        label: 'Data Points',\n        data: scatterData\n      }]\n    },\n    xLabel: 'Variable 1',\n    yLabel: 'Variable 2'\n  }];\n  \n  return { stats, charts };\n}\n\nfunction performRegression(sessions: GameSession[], variableIds: string[]) {\n  if (variableIds.length < 2) {\n    return { stats: null, charts: [] };\n  }\n  \n  const xValues: number[] = [];\n  const yValues: number[] = [];\n  \n  sessions.forEach(session => {\n    const xVal = extractVariableValue(session, variableIds[0]);\n    const yVal = extractVariableValue(session, variableIds[1]);\n    \n    if (xVal !== null && yVal !== null) {\n      xValues.push(xVal);\n      yValues.push(yVal);\n    }\n  });\n  \n  const stats: RegressionResult = calculateRegression(xValues, yValues);\n  \n  const scatterData = xValues.map((x, i) => ({ x, y: yValues[i] }));\n  \n  const charts = [{\n    type: 'scatter',\n    title: 'Regression Analysis',\n    data: {\n      datasets: [{\n        label: 'Data Points',\n        data: scatterData\n      }]\n    },\n    xLabel: 'Predictor Variable',\n    yLabel: 'Outcome Variable'\n  }];\n  \n  return { stats, charts };\n}\n\nfunction extractVariableValue(session: GameSession, variableId: string): number | null {\n  if (!session.gameState) return null;\n  \n  const parts = variableId.split('_');\n  \n  if (variableId === 'turns') {\n    return session.gameState.turn || 0;\n  }\n  \n  if (variableId === 'team') {\n    // Determine winner by comparing total deterrence scores\n    // Try multiple paths to find the total deterrence score\n    const natoScore = \n      session.gameState.teams?.NATO?.totalDeterrence ?? \n      session.gameState.teams?.NATO?.deterrenceScores?.total ?? \n      session.gameState.nato?.totalDeterrence ?? \n      session.gameState.nato?.deterrenceScores?.total ?? \n      null;\n    \n    const russiaScore = \n      session.gameState.teams?.Russia?.totalDeterrence ?? \n      session.gameState.teams?.Russia?.deterrenceScores?.total ?? \n      session.gameState.russia?.totalDeterrence ?? \n      session.gameState.russia?.deterrenceScores?.total ?? \n      null;\n    \n    // Only determine winner if BOTH scores are valid numbers\n    // Return null for incomplete data or ties to exclude from grouping\n    if (natoScore === null || russiaScore === null) return null;\n    if (natoScore > russiaScore) return 1;\n    if (russiaScore > natoScore) return 2;\n    return null; // Tie - exclude from grouping\n  }\n  \n  const team = parts[0];\n  const metric = parts.slice(1).join('_');\n  \n  if (team === 'nato' || team === 'russia') {\n    // Try new structure first (teams.NATO / teams.Russia)\n    const teamKey = team === 'nato' ? 'NATO' : 'Russia';\n    let teamState = session.gameState.teams?.[teamKey];\n    \n    // Fallback to old structure if needed\n    if (!teamState) {\n      teamState = session.gameState[team];\n    }\n    \n    if (!teamState) return null;\n    \n    if (metric === 'total') {\n      return teamState.totalDeterrence || teamState.deterrenceScores?.total || 0;\n    } else if (metric === 'budget' || metric === 'used') {\n      return teamState.budget || 0;\n    } else if (metric === 'remaining') {\n      return teamState.budget || 0;\n    } else {\n      // Try domain deterrence scores\n      if (teamState.deterrenceScores && metric in teamState.deterrenceScores) {\n        return teamState.deterrenceScores[metric] || 0;\n      }\n      // Try direct deterrence (new structure)\n      if (teamState.deterrence && metric in teamState.deterrence) {\n        return teamState.deterrence[metric] || 0;\n      }\n    }\n  }\n  \n  return null;\n}\n","size_bytes":9531},"client/src/logic/pricing.ts":{"content":"import { Card, TeamState } from '@shared/schema';\n\n// Calculate discounted price for a card based on owned permanents\nexport function calculateDiscountedPrice(\n  card: Card, \n  ownedPermanents: Card[]\n): number {\n  let totalDiscount = 0;\n  \n  // Check each permanent for discounts that apply to this card\n  for (const permanent of ownedPermanents) {\n    if (permanent.permanentMods?.appliesToCardIds.includes(card.id)) {\n      totalDiscount += permanent.permanentMods.flatDiscountK;\n    }\n  }\n  \n  // Price cannot go below 0\n  return Math.max(0, card.baseCostK - totalDiscount);\n}\n\n// Calculate total cart cost with discounts applied\nexport function calculateCartTotal(\n  cart: Card[], \n  ownedPermanents: Card[]\n): number {\n  return cart.reduce((total, card) => {\n    return total + calculateDiscountedPrice(card, ownedPermanents);\n  }, 0);\n}\n\n// Check if team can afford the cart\nexport function canAffordCart(\n  cart: Card[], \n  teamState: TeamState\n): boolean {\n  const cartTotal = calculateCartTotal(cart, teamState.ownedPermanents);\n  return teamState.budget >= cartTotal;\n}\n\n// Format currency display\nexport function formatCurrency(amount: number): string {\n  return `${amount}K`;\n}","size_bytes":1190},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        domain: {\n          joint: \"#808080\",      // grey\n          economy: \"#2e8b57\",    // green  \n          cognitive: \"#800080\",  // purple\n          space: \"#1e90ff\",      // blue\n          cyber: \"#ffd700\",      // yellow\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4291},"client/src/components/StrategyLog.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { sanitizeText } from '../logic/guards';\nimport { FileText, Clock } from \"lucide-react\";\n\ninterface LogEntry {\n  turn: number;\n  team: 'NATO' | 'Russia';\n  action: string;\n  timestamp: Date;\n}\n\ninterface StrategyLogProps {\n  entries: LogEntry[];\n  maxHeight?: string;\n}\n\nexport default function StrategyLog({ entries, maxHeight = \"400px\" }: StrategyLogProps) {\n  const sortedEntries = [...entries].sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\n\n  const getTeamBadgeColor = (team: 'NATO' | 'Russia') => {\n    return team === 'NATO' ? 'bg-blue-600 text-white' : 'bg-red-600 text-white';\n  };\n\n  return (\n    <Card data-testid=\"strategy-log\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center gap-2\">\n          <FileText className=\"w-5 h-5\" />\n          {sanitizeText('Strategy Log')}\n          <Badge variant=\"outline\">{entries.length} entries</Badge>\n        </CardTitle>\n      </CardHeader>\n      \n      <CardContent>\n        <ScrollArea style={{ height: maxHeight }}>\n          {sortedEntries.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <FileText className=\"w-8 h-8 mx-auto mb-2\" />\n              <p>No log entries yet</p>\n              <p className=\"text-xs\">Actions will appear here as they happen</p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {sortedEntries.map((entry, index) => (\n                <div \n                  key={index}\n                  className=\"flex items-start gap-3 p-3 rounded-lg border hover-elevate\"\n                  data-testid={`log-entry-${index}`}\n                >\n                  <div className=\"flex flex-col items-center gap-1 min-w-0\">\n                    <Badge className={getTeamBadgeColor(entry.team)} data-testid={`badge-team-${entry.team}`}>\n                      {entry.team}\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"text-xs\" data-testid={`badge-turn-${entry.turn}`}>\n                      T{entry.turn}\n                    </Badge>\n                  </div>\n                  \n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-medium break-words\" data-testid={`text-action-${index}`}>\n                      {sanitizeText(entry.action)}\n                    </p>\n                    \n                    <div className=\"flex items-center gap-1 mt-1 text-xs text-muted-foreground\">\n                      <Clock className=\"w-3 h-3\" />\n                      <span data-testid={`text-timestamp-${index}`}>\n                        {formatDistanceToNow(new Date(entry.timestamp), { addSuffix: true })}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":3162},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/utils/sessionReportGenerator.ts":{"content":"import jsPDF from 'jspdf';\n\ninterface GameSession {\n  sessionName: string;\n  gameState: {\n    turn: number;\n    maxTurns: number;\n    currentTeam: string;\n    phase: string;\n  };\n  sessionInfo: {\n    participants?: string[];\n  } | null;\n  turnStatistics: Array<{\n    turn: number;\n    natoDeterrence: number;\n    russiaDeterrence: number;\n  }> | null;\n  lastUpdated: string | null;\n  createdAt: string;\n}\n\ninterface DeterrenceScores {\n  nato: number;\n  russia: number;\n}\n\nexport const generateSessionReportPDF = async (\n  session: GameSession,\n  scores: DeterrenceScores,\n  winner: string\n) => {\n  const pdf = new jsPDF();\n  const margin = 20;\n  const pageWidth = pdf.internal.pageSize.getWidth();\n  let yPosition = margin;\n\n  // Helper to check if we need a new page\n  const checkPage = (requiredHeight: number) => {\n    if (yPosition + requiredHeight > 280) {\n      pdf.addPage();\n      yPosition = margin;\n    }\n  };\n\n  // Title\n  pdf.setFontSize(20);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('MDDS Session Report', margin, yPosition);\n  yPosition += 15;\n\n  // Session Name\n  pdf.setFontSize(16);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text(session.sessionName, margin, yPosition);\n  yPosition += 12;\n\n  // Generation Date\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'italic');\n  pdf.text(`Generated: ${new Date().toLocaleString()}`, margin, yPosition);\n  yPosition += 15;\n\n  // Session Details Section\n  pdf.setFontSize(14);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Session Details', margin, yPosition);\n  yPosition += 10;\n\n  pdf.setFontSize(11);\n  pdf.setFont('helvetica', 'normal');\n  \n  pdf.text(`Created: ${new Date(session.createdAt).toLocaleString()}`, margin + 5, yPosition);\n  yPosition += 7;\n\n  if (session.lastUpdated) {\n    pdf.text(`Last Updated: ${new Date(session.lastUpdated).toLocaleString()}`, margin + 5, yPosition);\n    yPosition += 7;\n  }\n\n  pdf.text(`Turn Progress: Turn ${session.gameState.turn} of ${session.gameState.maxTurns}`, margin + 5, yPosition);\n  yPosition += 7;\n\n  pdf.text(`Current Phase: ${session.gameState.phase}`, margin + 5, yPosition);\n  yPosition += 7;\n\n  pdf.text(`Current Team: ${session.gameState.currentTeam}`, margin + 5, yPosition);\n  yPosition += 15;\n\n  // Participants Section\n  if (session.sessionInfo?.participants && Array.isArray(session.sessionInfo.participants) && session.sessionInfo.participants.length > 0) {\n    checkPage(40);\n    pdf.setFontSize(14);\n    pdf.setFont('helvetica', 'bold');\n    pdf.text('Participants', margin, yPosition);\n    yPosition += 10;\n\n    pdf.setFontSize(11);\n    pdf.setFont('helvetica', 'normal');\n    session.sessionInfo.participants.forEach((participant) => {\n      pdf.text(` ${participant}`, margin + 5, yPosition);\n      yPosition += 6;\n    });\n    yPosition += 10;\n  }\n\n  // Final Deterrence Scores Section\n  checkPage(60);\n  pdf.setFontSize(14);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Final Deterrence Scores', margin, yPosition);\n  yPosition += 12;\n\n  // Draw score boxes\n  const boxWidth = 70;\n  const boxHeight = 30;\n  const boxSpacing = 10;\n\n  // NATO Box\n  pdf.setFillColor(59, 130, 246); // Blue\n  pdf.rect(margin + 5, yPosition, boxWidth, boxHeight, 'F');\n  \n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setTextColor(255, 255, 255);\n  pdf.text('NATO', margin + 5 + boxWidth/2, yPosition + 10, { align: 'center' });\n  \n  pdf.setFontSize(20);\n  pdf.text(String(scores.nato), margin + 5 + boxWidth/2, yPosition + 23, { align: 'center' });\n\n  // Russia Box\n  pdf.setFillColor(239, 68, 68); // Red\n  pdf.rect(margin + 5 + boxWidth + boxSpacing, yPosition, boxWidth, boxHeight, 'F');\n  \n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setTextColor(255, 255, 255);\n  pdf.text('Russia', margin + 5 + boxWidth + boxSpacing + boxWidth/2, yPosition + 10, { align: 'center' });\n  \n  pdf.setFontSize(20);\n  pdf.text(String(scores.russia), margin + 5 + boxWidth + boxSpacing + boxWidth/2, yPosition + 23, { align: 'center' });\n\n  yPosition += boxHeight + 15;\n\n  // Winner Section\n  checkPage(30);\n  pdf.setFontSize(16);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setTextColor(0, 0, 0);\n  \n  if (winner === 'Tie') {\n    pdf.text('Result: Tie', margin, yPosition);\n  } else {\n    pdf.text(`Winner: ${winner}`, margin, yPosition);\n  }\n  yPosition += 20;\n\n  // Turn Statistics Section (if available)\n  if (session.turnStatistics && Array.isArray(session.turnStatistics) && session.turnStatistics.length > 0) {\n    checkPage(60);\n    pdf.setFontSize(14);\n    pdf.setFont('helvetica', 'bold');\n    pdf.text('Turn Statistics', margin, yPosition);\n    yPosition += 10;\n\n    // Only draw chart if we have 2+ data points\n    if (session.turnStatistics.length < 2) {\n      pdf.setFontSize(11);\n      pdf.setFont('helvetica', 'normal');\n      pdf.text('Turn 1:', margin + 5, yPosition);\n      pdf.text(`NATO: ${session.turnStatistics[0].natoDeterrence}`, margin + 10, yPosition + 7);\n      pdf.text(`Russia: ${session.turnStatistics[0].russiaDeterrence}`, margin + 10, yPosition + 14);\n      yPosition += 25;\n    } else {\n      // Draw simple chart\n      const chartHeight = 60;\n      const chartWidth = pageWidth - 2 * margin;\n      const maxScore = Math.max(...session.turnStatistics.flatMap(s => [s.natoDeterrence, s.russiaDeterrence]), 1);\n      const minScore = Math.min(...session.turnStatistics.flatMap(s => [s.natoDeterrence, s.russiaDeterrence]), 0);\n      const scoreRange = Math.max(maxScore - minScore, 1);\n\n      // Draw chart border\n      pdf.setDrawColor(150, 150, 150);\n      pdf.setLineWidth(0.5);\n      pdf.rect(margin, yPosition, chartWidth, chartHeight);\n\n      // Draw grid lines\n      pdf.setDrawColor(220, 220, 220);\n      for (let i = 0; i <= 4; i++) {\n        const gridY = yPosition + (i * chartHeight / 4);\n        pdf.line(margin, gridY, margin + chartWidth, gridY);\n        \n        // Y-axis labels\n        const value = Math.round(maxScore - (i * scoreRange / 4));\n        pdf.setFontSize(8);\n        pdf.setFont('helvetica', 'normal');\n        pdf.setTextColor(0, 0, 0);\n        pdf.text(String(value), margin - 5, gridY + 2, { align: 'right' });\n      }\n\n      // Draw NATO line\n      pdf.setDrawColor(59, 130, 246);\n      pdf.setLineWidth(1.5);\n      for (let i = 0; i < session.turnStatistics.length - 1; i++) {\n        const x1 = margin + (i * chartWidth / (session.turnStatistics.length - 1));\n        const y1 = yPosition + chartHeight - ((session.turnStatistics[i].natoDeterrence - minScore) / scoreRange * chartHeight);\n        const x2 = margin + ((i + 1) * chartWidth / (session.turnStatistics.length - 1));\n        const y2 = yPosition + chartHeight - ((session.turnStatistics[i + 1].natoDeterrence - minScore) / scoreRange * chartHeight);\n        pdf.line(x1, y1, x2, y2);\n      }\n\n      // Draw Russia line\n      pdf.setDrawColor(239, 68, 68);\n      pdf.setLineWidth(1.5);\n      for (let i = 0; i < session.turnStatistics.length - 1; i++) {\n        const x1 = margin + (i * chartWidth / (session.turnStatistics.length - 1));\n        const y1 = yPosition + chartHeight - ((session.turnStatistics[i].russiaDeterrence - minScore) / scoreRange * chartHeight);\n        const x2 = margin + ((i + 1) * chartWidth / (session.turnStatistics.length - 1));\n        const y2 = yPosition + chartHeight - ((session.turnStatistics[i + 1].russiaDeterrence - minScore) / scoreRange * chartHeight);\n        pdf.line(x1, y1, x2, y2);\n      }\n\n      // Draw data points\n      session.turnStatistics.forEach((stat, index) => {\n        const x = margin + (index * chartWidth / (session.turnStatistics.length - 1));\n        \n        // NATO point\n        const natoY = yPosition + chartHeight - ((stat.natoDeterrence - minScore) / scoreRange * chartHeight);\n        pdf.setFillColor(59, 130, 246);\n        pdf.circle(x, natoY, 1.5, 'F');\n        \n        // Russia point\n        const russiaY = yPosition + chartHeight - ((stat.russiaDeterrence - minScore) / scoreRange * chartHeight);\n        pdf.setFillColor(239, 68, 68);\n        pdf.circle(x, russiaY, 1.5, 'F');\n\n        // X-axis labels\n        pdf.setFontSize(8);\n        pdf.setTextColor(0, 0, 0);\n        pdf.text(`T${stat.turn}`, x, yPosition + chartHeight + 8, { align: 'center' });\n      });\n\n      // Legend\n      pdf.setFontSize(10);\n      pdf.setFont('helvetica', 'bold');\n      pdf.setFillColor(59, 130, 246);\n      pdf.rect(margin, yPosition - 12, 8, 4, 'F');\n      pdf.setTextColor(0, 0, 0);\n      pdf.text('NATO', margin + 10, yPosition - 9);\n\n      pdf.setFillColor(239, 68, 68);\n      pdf.rect(margin + 40, yPosition - 12, 8, 4, 'F');\n      pdf.text('Russia', margin + 50, yPosition - 9);\n\n      yPosition += chartHeight + 15;\n    }\n  }\n\n  // Footer\n  const sessionNameClean = session.sessionName.replace(/[^a-zA-Z0-9]/g, '_');\n  const dateString = new Date().toISOString().split('T')[0];\n  \n  // Save the PDF\n  pdf.save(`MDDS_Session_Report_${sessionNameClean}_${dateString}.pdf`);\n};\n","size_bytes":8928},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/LoginScreen.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { useMDDSStore } from '@/state/store';\nimport { sanitizeText } from '../logic/guards';\nimport { apiRequest } from '@/lib/queryClient';\nimport logoUrl from '@assets/Logo_1758524556759.png';\n\nexport default function LoginScreen() {\n  const [sessionName, setSessionName] = useState('');\n  const [skipTurn1, setSkipTurn1] = useState(false);\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [showPasswordDialog, setShowPasswordDialog] = useState(false);\n  const [password, setPassword] = useState('');\n  const [passwordError, setPasswordError] = useState('');\n  const [, setLocation] = useLocation();\n  \n  const setShowLoginScreen = useMDDSStore(state => state.setShowLoginScreen);\n  const updateSessionName = useMDDSStore(state => state.updateSessionName);\n  const setActiveDatabaseSession = useMDDSStore(state => state.setActiveDatabaseSession);\n  const syncToDatabase = useMDDSStore(state => state.syncToDatabase);\n\n  const handleStart = async () => {\n    if (!sessionName.trim()) {\n      setError('Session name is required');\n      return;\n    }\n\n    setIsLoading(true);\n    setError('');\n\n    try {\n      // Update session name in store\n      updateSessionName(sessionName.trim());\n      \n      // Get current game state (do not mutate yet)\n      const currentState = useMDDSStore.getState();\n      \n      // Build the game state for database - if skip turn 1, use turn 2\n      const gameState = {\n        turn: skipTurn1 ? 2 : currentState.turn,\n        maxTurns: currentState.maxTurns,\n        currentTeam: currentState.currentTeam,\n        teams: currentState.teams,\n        phase: currentState.phase,\n        strategyLog: currentState.strategyLog\n      };\n\n      // Create database session with the appropriate turn\n      await apiRequest('POST', '/api/sessions', {\n        sessionName: sessionName.trim(),\n        gameState: gameState,\n        sessionInfo: currentState.sessionInfo,\n        turnStatistics: currentState.turnStatistics,\n        lastUpdated: new Date().toISOString()\n      });\n\n      // Only NOW that the API call succeeded, advance the turn in the store if skip was selected\n      if (skipTurn1) {\n        const state = useMDDSStore.getState();\n        state.advanceGameTurn();\n      }\n\n      // Establish dynamic link to current game state\n      setActiveDatabaseSession(sessionName.trim());\n      \n      // Perform initial sync to database\n      await syncToDatabase();\n\n      // Hide login screen and show main game\n      setShowLoginScreen(false);\n      \n      // Save to localStorage to persist the state\n      const stateAfterUpdate = useMDDSStore.getState();\n      stateAfterUpdate.saveToLocalStorage();\n    } catch (err) {\n      console.error('Error creating database session:', err);\n      setError('Failed to create session. Please try again.');\n      setIsLoading(false);\n    }\n  };\n\n  const handleSingleGame = () => {\n    setShowPasswordDialog(true);\n    setPassword('');\n    setPasswordError('');\n  };\n\n  const handlePasswordSubmit = () => {\n    if (password === 'MDDS') {\n      setShowPasswordDialog(false);\n      setLocation(`/single-player?skipTurn1=${skipTurn1}`);\n    } else {\n      setPasswordError('Incorrect password');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      {/* Blurred background */}\n      <div className=\"absolute inset-0 backdrop-blur-md bg-background/30\" />\n      \n      {/* Login card with glassmorphism */}\n      <div className=\"relative z-10 w-full max-w-md\">\n        <div className=\"glass-card p-8 space-y-6\">\n          {/* Logo and title */}\n          <div className=\"flex flex-col items-center space-y-4\">\n            <img src={logoUrl} alt=\"MDDS Logo\" className=\"w-20 h-20\" />\n            <div className=\"text-center\">\n              <h1 className=\"text-2xl font-bold\" data-testid=\"text-login-title\">\n                {sanitizeText('MDDS')}\n              </h1>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {sanitizeText('Multi Dimension Deterrence Strategy')}\n              </p>\n            </div>\n          </div>\n\n          {/* Session name input */}\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"session-name-login\">Session Name</Label>\n              <Input\n                id=\"session-name-login\"\n                value={sessionName}\n                onChange={(e) => {\n                  setSessionName(e.target.value);\n                  setError('');\n                }}\n                placeholder=\"Enter session name\"\n                data-testid=\"input-session-name-login\"\n                disabled={isLoading}\n              />\n            </div>\n\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox\n                id=\"skip-turn-1\"\n                checked={skipTurn1}\n                onCheckedChange={(checked) => setSkipTurn1(checked === true)}\n                disabled={isLoading}\n                data-testid=\"checkbox-skip-turn-1\"\n              />\n              <Label\n                htmlFor=\"skip-turn-1\"\n                className=\"text-sm font-normal cursor-pointer\"\n              >\n                {sanitizeText('Skip Turn 1 (Start from Turn 2)')}\n              </Label>\n            </div>\n\n            {error && (\n              <div className=\"bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-md p-3\">\n                <p className=\"text-sm text-red-600 dark:text-red-400\" data-testid=\"text-login-error\">\n                  {error}\n                </p>\n              </div>\n            )}\n\n            <Button\n              onClick={handleStart}\n              className=\"w-full\"\n              disabled={isLoading}\n              data-testid=\"button-start-session\"\n            >\n              {isLoading ? 'Starting...' : 'Start Session'}\n            </Button>\n\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <span className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  Or\n                </span>\n              </div>\n            </div>\n\n            <Button\n              onClick={handleSingleGame}\n              variant=\"outline\"\n              className=\"w-full\"\n              disabled={isLoading}\n              data-testid=\"button-single-game\"\n            >\n              Single game\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <Dialog open={showPasswordDialog} onOpenChange={setShowPasswordDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Single Player Password</DialogTitle>\n            <DialogDescription>\n              Enter the password to access Single Player mode\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"single-player-password\">Password</Label>\n              <Input\n                id=\"single-player-password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => {\n                  setPassword(e.target.value);\n                  setPasswordError('');\n                }}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') {\n                    handlePasswordSubmit();\n                  }\n                }}\n                placeholder=\"Enter password\"\n                data-testid=\"input-single-player-password\"\n                autoFocus\n              />\n            </div>\n\n            {passwordError && (\n              <div className=\"bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-md p-3\">\n                <p className=\"text-sm text-red-600 dark:text-red-400\" data-testid=\"text-password-error\">\n                  {passwordError}\n                </p>\n              </div>\n            )}\n          </div>\n\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowPasswordDialog(false)}\n              data-testid=\"button-cancel-password\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handlePasswordSubmit}\n              data-testid=\"button-submit-password\"\n            >\n              Continue\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":9020},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/pages/MobileSession.tsx":{"content":"import { useParams } from 'wouter';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, Shield, Coins, RefreshCw, Download } from 'lucide-react';\nimport { SelectGameSession } from '@shared/schema';\nimport DomainBadge from '@/components/DomainBadge';\nimport { useState } from 'react';\nimport { generateMDDSReport } from '@/utils/pdfGenerator';\nimport { useToast } from '@/hooks/use-toast';\n\nexport default function MobileSession() {\n  const { sessionName } = useParams();\n  const queryClient = useQueryClient();\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [isDownloading, setIsDownloading] = useState(false);\n  const { toast } = useToast();\n\n  const { data: session, isLoading, error } = useQuery<SelectGameSession>({\n    queryKey: ['/api/sessions', sessionName],\n    enabled: !!sessionName,\n    refetchInterval: 5000, // Auto-refresh every 5 seconds\n    refetchIntervalInBackground: false, // Only when tab is active\n  });\n\n  const handleManualRefresh = async () => {\n    if (!sessionName) return;\n    \n    setIsRefreshing(true);\n    try {\n      await queryClient.invalidateQueries({ \n        queryKey: ['/api/sessions', sessionName] \n      });\n    } catch (error) {\n      console.error('Failed to refresh session:', error);\n    } finally {\n      setIsRefreshing(false);\n    }\n  };\n\n  const handleDownloadReport = async () => {\n    if (!session) return;\n\n    setIsDownloading(true);\n    try {\n      // If finalReport exists in database, download that exact PDF\n      if (session.finalReport) {\n        try {\n          const byteCharacters = atob(session.finalReport);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          const blob = new Blob([byteArray], { type: 'application/pdf' });\n          const url = URL.createObjectURL(blob);\n          const link = document.createElement('a');\n          link.href = url;\n          link.download = `${sessionName}_Final_Report.pdf`;\n          document.body.appendChild(link);\n          link.click();\n          document.body.removeChild(link);\n          URL.revokeObjectURL(url);\n          \n          toast({\n            title: \"Report downloaded\",\n            description: \"Final report successfully downloaded.\",\n            duration: 3000,\n          });\n          return;\n        } catch (error) {\n          console.error('Failed to download stored report, will generate new one:', error);\n        }\n      }\n      \n      // Generate report using the same format as \"Finish Game Session\"\n      const turnStats = (session.turnStatistics || []).map((stat: any) => ({\n        ...stat,\n        timestamp: typeof stat.timestamp === 'string' ? new Date(stat.timestamp) : stat.timestamp\n      }));\n\n      const reportData = {\n        currentTurn: session.gameState.turn,\n        maxTurns: session.gameState.maxTurns,\n        natoTeam: session.gameState.teams.NATO,\n        russiaTeam: session.gameState.teams.Russia,\n        turnStatistics: turnStats,\n        strategyLog: session.gameState.strategyLog || [],\n        sessionInfo: {\n          sessionName: sessionName || 'Unknown Session',\n          participants: (session.sessionInfo?.participants || []).map((p: any) => \n            typeof p === 'string' ? { name: p, country: '' } : p\n          )\n        }\n      };\n\n      await generateMDDSReport(reportData);\n      \n      toast({\n        title: \"Report generated\",\n        description: \"MDDS Strategic Analysis Report successfully generated.\",\n        duration: 3000,\n      });\n    } catch (error) {\n      console.error('Failed to generate report:', error);\n      toast({\n        title: \"Generation failed\",\n        description: \"Failed to generate report. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsDownloading(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"flex items-center gap-2\">\n          <Loader2 className=\"h-6 w-6 animate-spin\" />\n          <span>Loading session...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !session) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardHeader>\n            <CardTitle className=\"text-center\">Session Not Found</CardTitle>\n          </CardHeader>\n          <CardContent className=\"text-center\">\n            <p className=\"text-muted-foreground mb-4\">\n              The session \"{sessionName}\" could not be found.\n            </p>\n            <Button onClick={() => window.history.back()}>\n              Go Back\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { gameState, createdAt, updatedAt } = session;\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <div className=\"sticky top-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b p-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-xl font-bold\">{sessionName}</h1>\n            <div className=\"flex items-center gap-2\">\n              <p className=\"text-sm text-muted-foreground\">\n                Turn {gameState.turn} of {gameState.maxTurns}\n              </p>\n              <div className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\" title=\"Auto-refreshing every 5s\" />\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={handleDownloadReport}\n              disabled={isDownloading}\n              data-testid=\"button-download-report\"\n            >\n              <Download className={`h-4 w-4 ${isDownloading ? 'animate-pulse' : ''}`} />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={handleManualRefresh}\n              disabled={isRefreshing}\n              data-testid=\"button-refresh-session\"\n            >\n              <RefreshCw className={`h-4 w-4 ${isRefreshing ? 'animate-spin' : ''}`} />\n            </Button>\n            <Badge variant=\"outline\">\n              {gameState.currentTeam}\n            </Badge>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-4 space-y-4\">\n        {/* Total Deterrence Score */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg text-center\">Total Deterrence Score</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex justify-center gap-8\">\n              <div className=\"text-center\">\n                <div className=\"text-2xl font-bold text-blue-400\" data-testid=\"nato-total-deterrence\">\n                  {gameState.teams.NATO.totalDeterrence}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">NATO</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-2xl font-bold text-red-400\" data-testid=\"russia-total-deterrence\">\n                  {gameState.teams.Russia.totalDeterrence}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">Russia</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Team Containers */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {/* NATO Team Container */}\n          <Card className=\"border-blue-500/50 bg-blue-500/5\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <Badge className=\"bg-blue-600 hover:bg-blue-700\">\n                  <Shield className=\"w-4 h-4 mr-1\" />\n                  NATO\n                </Badge>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Coins className=\"w-4 h-4 text-muted-foreground\" />\n                  <span className=\"text-sm font-medium\">Budget</span>\n                </div>\n                <span className=\"font-mono font-semibold\" data-testid=\"text-budget-nato\">\n                  ${gameState.teams.NATO.budget}K\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium\">Total Deterrence</span>\n                <span className=\"font-mono font-bold text-lg\" data-testid=\"text-total-deterrence-nato\">\n                  {gameState.teams.NATO.totalDeterrence}\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Russia Team Container */}\n          <Card className=\"border-red-500/50 bg-red-500/5\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <Badge className=\"bg-red-600 hover:bg-red-700\">\n                  <Shield className=\"w-4 h-4 mr-1\" />\n                  Russia\n                </Badge>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Coins className=\"w-4 h-4 text-muted-foreground\" />\n                  <span className=\"text-sm font-medium\">Budget</span>\n                </div>\n                <span className=\"font-mono font-semibold\" data-testid=\"text-budget-russia\">\n                  ${gameState.teams.Russia.budget}K\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium\">Total Deterrence</span>\n                <span className=\"font-mono font-bold text-lg\" data-testid=\"text-total-deterrence-russia\">\n                  {gameState.teams.Russia.totalDeterrence}\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Dimensional Deterrence */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Dimensional Deterrence</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {(['joint', 'economy', 'cognitive', 'space', 'cyber'] as const).map((domain) => (\n              <div key={domain} className=\"space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <DomainBadge domain={domain} />\n                  <span className=\"text-sm font-medium capitalize\">{domain}</span>\n                </div>\n                <div className=\"flex justify-between items-center text-sm\">\n                  <div className=\"text-blue-500\">\n                    NATO: {gameState.teams.NATO.deterrence[domain]}\n                  </div>\n                  <div className=\"text-red-500\">\n                    Russia: {gameState.teams.Russia.deterrence[domain]}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n\n        {/* Action Button */}\n        <div className=\"pb-8\">\n          <Button \n            className=\"w-full\" \n            onClick={() => {\n              const mainAppUrl = `${window.location.origin}`;\n              window.open(mainAppUrl, '_blank');\n            }}\n            data-testid=\"button-open-main-app\"\n          >\n            Open Main Application\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":12031},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/logic/turnEngine.ts":{"content":"import { GameState, Team, Card, TeamState } from '@shared/schema';\nimport { calculateDiscountedPrice, calculateCartTotal } from './pricing';\nimport { applyCardEffects } from './scoring';\n\n// Validate turn 1 domain restrictions (200K per domain)\nexport function validateTurn1Restrictions(\n  cart: Card[], \n  team: TeamState\n): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n  const domainTotals = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 };\n  \n  // Calculate spending per domain\n  for (const card of cart) {\n    const cost = calculateDiscountedPrice(card, team.ownedPermanents);\n    domainTotals[card.domain] += cost;\n  }\n  \n  // Check each domain has exactly 200K\n  for (const [domain, total] of Object.entries(domainTotals)) {\n    if (total !== 200) {\n      errors.push(`${domain} domain must have exactly 200K (currently ${total}K)`);\n    }\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n// Validate turn 2+ budget restrictions (1000K pooled)\nexport function validatePooledBudget(\n  cart: Card[], \n  team: TeamState\n): { valid: boolean; errors: string[] } {\n  const total = calculateCartTotal(cart, team.ownedPermanents);\n  const valid = total <= team.budget;\n  \n  return {\n    valid,\n    errors: valid ? [] : [`Total cost ${total}K exceeds budget ${team.budget}K`]\n  };\n}\n\n// Process card purchases and apply effects\nexport function commitPurchases(\n  gameState: GameState,\n  team: Team\n): GameState {\n  const newGameState = { ...gameState };\n  const teamState = newGameState.teams[team];\n  const opponentTeam = team === 'NATO' ? 'Russia' : 'NATO';\n  const opponentState = newGameState.teams[opponentTeam];\n  \n  // Calculate costs with discounts\n  const totalCost = calculateCartTotal(teamState.cart, teamState.ownedPermanents);\n  \n  // Deduct budget\n  teamState.budget -= totalCost;\n  \n  // Process each card in cart\n  for (const card of teamState.cart) {\n    const cardPrice = calculateDiscountedPrice(card, teamState.ownedPermanents);\n    \n    // Track card purchase for availability logic (initialize if doesn't exist)\n    if (!teamState.recentPurchases) {\n      teamState.recentPurchases = [];\n    }\n    teamState.recentPurchases.push({\n      cardId: card.id,\n      purchasedTurn: gameState.turn\n    });\n    \n    // Log individual card purchase\n    newGameState.strategyLog.push({\n      turn: gameState.turn,\n      team,\n      action: `${team} purchased ${card.name} (${card.id}) for ${cardPrice}K`,\n      timestamp: new Date()\n    });\n    \n    switch (card.type) {\n      case 'asset':\n        // Apply immediate effects\n        const { buyer, opponent } = applyCardEffects(card, teamState, opponentState);\n        newGameState.teams[team] = buyer;\n        newGameState.teams[opponentTeam] = opponent;\n        break;\n        \n      case 'permanent':\n        // Queue for next turn (permanent discounts activate next turn)\n        teamState.permanentsQueue.push({\n          card,\n          availableTurn: gameState.turn + 1\n        });\n        break;\n        \n      case 'expert':\n        // Queue for next turn\n        teamState.expertsQueue.push({\n          card,\n          availableTurn: gameState.turn + 1\n        });\n        break;\n    }\n  }\n  \n  // Clear cart (must be done AFTER applying effects to avoid being overwritten)\n  newGameState.teams[team].cart = [];\n  \n  // Add to strategy log\n  newGameState.strategyLog.push({\n    turn: gameState.turn,\n    team,\n    action: `Committed purchases: total cost ${totalCost}K`,\n    timestamp: new Date()\n  });\n  \n  return newGameState;\n}\n\n// Check if a card is available for purchase by a team (not purchased in previous turn)\nexport function isCardAvailable(cardId: string, team: string, currentTurn: number, teamState: any): boolean {\n  // Initialize recentPurchases if it doesn't exist (for migration compatibility)\n  if (!teamState.recentPurchases) {\n    return true; // If no purchase history, card is available\n  }\n  \n  // Check if this team purchased this card in the previous turn\n  const recentPurchase = teamState.recentPurchases.find(\n    (purchase: any) => purchase.cardId === cardId && purchase.purchasedTurn === currentTurn - 1\n  );\n  \n  return !recentPurchase; // Available if NOT recently purchased\n}\n\n// Advance to next turn\nexport function advanceTurn(gameState: GameState): GameState {\n  const newGameState = { ...gameState };\n  \n  // Increment turn\n  newGameState.turn += 1;\n  \n  // Activate permanents and experts that are now available\n  for (const team of ['NATO', 'Russia'] as Team[]) {\n    const teamState = newGameState.teams[team];\n    \n    // Activate permanents\n    teamState.permanentsQueue = teamState.permanentsQueue.filter(permanent => {\n      if (permanent.availableTurn <= newGameState.turn) {\n        // Permanent becomes active (provides discounts)\n        teamState.ownedPermanents.push(permanent.card);\n        newGameState.strategyLog.push({\n          turn: newGameState.turn,\n          team,\n          action: `Permanent activated: ${permanent.card.name} (${permanent.card.id}) - discounts now available`,\n          timestamp: new Date()\n        });\n        return false; // Remove from queue\n      }\n      return true; // Keep in queue\n    });\n    \n    // Activate experts\n    teamState.expertsQueue = teamState.expertsQueue.filter(expert => {\n      if (expert.availableTurn <= newGameState.turn) {\n        // Expert becomes active (informational only)\n        newGameState.strategyLog.push({\n          turn: newGameState.turn,\n          team,\n          action: `Expert activated: ${expert.card.name} (informational)`,\n          timestamp: new Date()\n        });\n        return false; // Remove from queue\n      }\n      return true; // Keep in queue\n    });\n  }\n  \n  // Refresh budget to 1000K for the new turn (Turn 2+)\n  // Turn 1 starts with 1000K from initial state, subsequent turns get fresh budget\n  if (newGameState.turn >= 2) {\n    newGameState.teams.NATO.budget = 1000;\n    newGameState.teams.Russia.budget = 1000;\n    \n    // Log budget refresh\n    newGameState.strategyLog.push({\n      turn: newGameState.turn,\n      team: 'NATO',\n      action: `Budget refreshed to 1000K for Turn ${newGameState.turn}`,\n      timestamp: new Date()\n    });\n    \n    newGameState.strategyLog.push({\n      turn: newGameState.turn,\n      team: 'Russia', \n      action: `Budget refreshed to 1000K for Turn ${newGameState.turn}`,\n      timestamp: new Date()\n    });\n  }\n  \n  return newGameState;\n}","size_bytes":6437},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/pages/MDDSStrategy.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { useMDDSStore } from '../state/store';\nimport { useIsMobile } from '../hooks/use-mobile';\nimport { applyDomainQuotas } from '../logic/filters';\nimport { calculateDiscountedPrice, calculateCartTotal } from '../logic/pricing';\nimport { validateTurn1Restrictions, validatePooledBudget } from '../logic/turnEngine';\nimport AppHeader from '../components/AppHeader';\nimport TeamPanel from '../components/TeamPanel';\nimport CardShop from '../components/CardShop';\nimport CardDetailModal from '../components/CardDetailModal';\nimport { SkipForward, FileCheck, Eye, EyeOff } from 'lucide-react';\nimport { Button } from \"@/components/ui/button\";\nimport DeterrenceChart from '../components/DeterrenceChart';\nimport CartDisplay from '../components/CartDisplay';\nimport MobileFooter from '../components/MobileFooter';\nimport TurnBasedLogs from '../components/Statistics';\nimport DomainStatistics from '../components/DomainStatistics';\nimport cardsData from '../data/cards.json';\nimport { Card } from '@shared/schema';\nimport { generateMDDSReport, generateMDDSReportBase64 } from '../utils/pdfGenerator';\nimport LoginScreen from '../components/LoginScreen';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function MDDSStrategy() {\n  const store = useMDDSStore();\n  const isMobile = useIsMobile();\n  const showLoginScreen = useMDDSStore(state => state.showLoginScreen);\n  const [, setLocation] = useLocation();\n  const [availableCards, setAvailableCards] = useState(applyDomainQuotas(cardsData as Card[]));\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\n  const [showFinishDialog, setShowFinishDialog] = useState(false);\n  const [isFinishing, setIsFinishing] = useState(false);\n  const [showShopAndCarts, setShowShopAndCarts] = useState(true);\n  const { toast } = useToast();\n\n  // Redirect mobile users to mobile login interface\n  useEffect(() => {\n    // Check screen size immediately and redirect if mobile\n    const checkMobile = () => {\n      const isMobileDevice = window.innerWidth < 768;\n      if (isMobileDevice) {\n        setLocation('/mobile');\n      }\n    };\n\n    // Check immediately\n    checkMobile();\n    \n    // Also check when the hook updates\n    if (isMobile) {\n      setLocation('/mobile');\n    }\n  }, [isMobile, setLocation]);\n\n  // Early return for mobile to prevent flashing\n  if (typeof window !== 'undefined' && window.innerWidth < 768) {\n    return null;\n  }\n\n  // Update validation errors when cart or turn changes\n  useEffect(() => {\n    const currentTeamState = store.teams[store.currentTeam];\n    \n    if (store.turn === 1) {\n      const validation = validateTurn1Restrictions(currentTeamState.cart, currentTeamState);\n      setValidationErrors(validation.errors);\n    } else {\n      const validation = validatePooledBudget(currentTeamState.cart, currentTeamState);\n      setValidationErrors(validation.errors);\n    }\n  }, [store.teams, store.currentTeam, store.turn]);\n\n  // Load from localStorage on mount\n  useEffect(() => {\n    store.loadFromLocalStorage();\n  }, []);\n\n  const currentTeamState = store.teams[store.currentTeam];\n  const opponentTeam = store.currentTeam === 'NATO' ? 'Russia' : 'NATO';\n  const opponentTeamState = store.teams[opponentTeam];\n\n  const getDiscountedPrice = (card: any) => {\n    return calculateDiscountedPrice(card, currentTeamState.ownedPermanents);\n  };\n\n  const canCommit = currentTeamState.cart.length > 0;\n  const canAdvance = store.phase === 'commit' || store.turn >= store.maxTurns;\n\n  const cartTotal = calculateCartTotal(currentTeamState.cart, currentTeamState.ownedPermanents);\n  const canAfford = cartTotal <= currentTeamState.budget;\n\n  // Per-team cart calculations for dual cart display\n  const natoState = store.teams.NATO;\n  const russiaState = store.teams.Russia;\n  const priceForNATO = (card: Card) => calculateDiscountedPrice(card, natoState.ownedPermanents);\n  const priceForRussia = (card: Card) => calculateDiscountedPrice(card, russiaState.ownedPermanents);\n  const natoCartTotal = calculateCartTotal(natoState.cart, natoState.ownedPermanents);\n  const russiaCartTotal = calculateCartTotal(russiaState.cart, russiaState.ownedPermanents);\n\n  const handleDownloadPDF = async () => {\n    try {\n      await generateMDDSReport({\n        currentTurn: store.turn,\n        maxTurns: store.maxTurns,\n        natoTeam: store.teams.NATO,\n        russiaTeam: store.teams.Russia,\n        turnStatistics: store.turnStatistics,\n        strategyLog: store.strategyLog,\n        sessionInfo: store.sessionInfo\n      });\n    } catch (error) {\n      console.error('Failed to generate PDF:', error);\n      alert('Failed to generate PDF report. Please try again.');\n    }\n  };\n\n  const handleFinishGameSession = async () => {\n    // Guard against missing session name\n    if (!store.sessionInfo?.sessionName) {\n      toast({\n        title: \"Session name missing\",\n        description: \"Cannot finish session without a valid session name.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsFinishing(true);\n    try {\n      const reportData = {\n        currentTurn: store.turn,\n        maxTurns: store.maxTurns,\n        natoTeam: store.teams.NATO,\n        russiaTeam: store.teams.Russia,\n        turnStatistics: store.turnStatistics,\n        strategyLog: store.strategyLog,\n        sessionInfo: store.sessionInfo\n      };\n\n      // Generate and download PDF\n      await generateMDDSReport(reportData);\n\n      // Generate PDF as base64 for database\n      const pdfData = await generateMDDSReportBase64(reportData);\n\n      // Save PDF to database\n      const sessionName = store.sessionInfo.sessionName;\n      await apiRequest('PUT', `/api/sessions/${encodeURIComponent(sessionName)}`, {\n        finalReport: pdfData,\n        gameState: {\n          turn: store.turn,\n          maxTurns: store.maxTurns,\n          currentTeam: store.currentTeam,\n          teams: store.teams,\n          phase: store.phase,\n          strategyLog: store.strategyLog\n        },\n        sessionInfo: store.sessionInfo,\n        turnStatistics: store.turnStatistics,\n        lastUpdated: new Date().toISOString()\n      });\n\n      toast({\n        title: \"Game session completed\",\n        description: \"Report downloaded and saved to the database.\",\n        duration: 5000,\n      });\n\n      setShowFinishDialog(false);\n    } catch (error) {\n      console.error('Failed to finish game session:', error);\n      toast({\n        title: \"Failed to save report\",\n        description: \"Please try again or contact support.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsFinishing(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen pb-20 md:pb-0\">\n      {/* Show login screen on first load or after reset */}\n      {showLoginScreen && <LoginScreen />}\n      \n      <AppHeader\n        currentTurn={store.turn}\n        maxTurns={store.maxTurns}\n        onSave={() => {\n          store.saveToLocalStorage();\n          alert('Strategy saved to local storage!');\n        }}\n        onResetProgress={() => {\n          if (confirm('Reset all progress and start a new strategy?')) {\n            store.resetStrategy();\n          }\n        }}\n        onSetMaxTurns={(turns) => {\n          // Note: This could be enhanced to update the store\n          console.log('Set max turns:', turns);\n        }}\n        onDownloadPDF={handleDownloadPDF}\n        onFinishGameSession={() => setShowFinishDialog(true)}\n        showShopAndCarts={showShopAndCarts}\n        onToggleShopAndCarts={() => setShowShopAndCarts(!showShopAndCarts)}\n      />\n\n      <div className=\"container mx-auto px-4 py-6 max-w-full\">\n        <div className=\"space-y-6\">\n          {/* Deterrence Chart - Full Width */}\n          <DeterrenceChart \n            natoTeam={store.teams.NATO}\n            russiaTeam={store.teams.Russia}\n          />\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-10 gap-4 lg:gap-6\">\n            {/* Left Sidebar - Team Panels */}\n            {showShopAndCarts && (\n              <div className=\"lg:col-span-3 order-2 lg:order-1\">\n                <div className=\"space-y-4\">\n                  <div className=\"glass-panel p-3 lg:p-4\">\n                    <TeamPanel\n                      team={store.currentTeam}\n                      teamState={currentTeamState}\n                      isActive={true}\n                      currentTurn={store.turn}\n                    />\n                  </div>\n                  <div className=\"glass-panel p-3 lg:p-4\">\n                    <TeamPanel\n                      team={opponentTeam}\n                      teamState={opponentTeamState}\n                      currentTurn={store.turn}\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Main Content - Wider */}\n            <div className=\"lg:col-span-5 order-1 lg:order-2\">\n              <div className=\"space-y-4 lg:space-y-6\">\n                {/* Card Shop */}\n                {showShopAndCarts && (\n                  <div className=\"glass-card p-3 lg:p-6\">\n                    <CardShop\n                      cards={availableCards}\n                      onAddToCart={(card) => store.addToCart(store.currentTeam, card)}\n                      onViewDetails={(card) => store.setSelectedCard(card)}\n                      cartItems={currentTeamState.cart}\n                      natoCartItems={natoState.cart}\n                      russiaCartItems={russiaState.cart}\n                      getDiscountedPrice={getDiscountedPrice}\n                      getNATOPrice={priceForNATO}\n                      getRussiaPrice={priceForRussia}\n                      disabled={store.phase !== 'purchase'}\n                      onAddToNATOCart={(card) => store.addToCart('NATO', card)}\n                      onAddToRussiaCart={(card) => store.addToCart('Russia', card)}\n                      currentTurn={store.turn}\n                      natoTeamState={natoState}\n                      russiaTeamState={russiaState}\n                    />\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Right Sidebar - NATO and Russia Carts */}\n            <div className=\"lg:col-span-2 order-3\">\n              <div className=\"lg:sticky lg:top-24 space-y-4\">\n                {showShopAndCarts && (\n                  <>\n                    <div className=\"glass-panel p-3 lg:p-4\">\n                      <CartDisplay\n                        team=\"NATO\"\n                        cartItems={natoState.cart}\n                        onRemoveFromCart={(cardId) => store.removeFromCart('NATO', cardId)}\n                        getDiscountedPrice={priceForNATO}\n                        cartTotal={natoCartTotal}\n                        onConfirmPurchases={() => {\n                          // Validate before committing NATO purchases\n                          const natoValidation = store.turn === 1 \n                            ? validateTurn1Restrictions(natoState.cart, natoState)\n                            : validatePooledBudget(natoState.cart, natoState);\n                          \n                          if (!natoValidation.valid) {\n                            // Don't commit if validation fails - errors will be visible in validation display\n                            return;\n                          }\n                          \n                          store.commitTeamPurchases('NATO');\n                          store.saveToLocalStorage();\n                        }}\n                        canConfirm={(() => {\n                          if (natoState.cart.length === 0) return false;\n                          if (natoCartTotal > natoState.budget) return false;\n                          \n                          // Check team-specific validation\n                          const natoValidation = store.turn === 1 \n                            ? validateTurn1Restrictions(natoState.cart, natoState)\n                            : validatePooledBudget(natoState.cart, natoState);\n                          \n                          return natoValidation.valid;\n                        })()}\n                        budget={natoState.budget}\n                      />\n                    </div>\n\n                    <div className=\"glass-panel p-3 lg:p-4\">\n                      <CartDisplay\n                        team=\"Russia\"\n                        cartItems={russiaState.cart}\n                        onRemoveFromCart={(cardId) => store.removeFromCart('Russia', cardId)}\n                        getDiscountedPrice={priceForRussia}\n                        cartTotal={russiaCartTotal}\n                        onConfirmPurchases={() => {\n                          // Validate before committing Russia purchases\n                          const russiaValidation = store.turn === 1 \n                            ? validateTurn1Restrictions(russiaState.cart, russiaState)\n                            : validatePooledBudget(russiaState.cart, russiaState);\n                          \n                          if (!russiaValidation.valid) {\n                            // Don't commit if validation fails - errors will be visible in validation display\n                            return;\n                          }\n                          \n                          store.commitTeamPurchases('Russia');\n                          store.saveToLocalStorage();\n                        }}\n                        canConfirm={(() => {\n                          if (russiaState.cart.length === 0) return false;\n                          if (russiaCartTotal > russiaState.budget) return false;\n                          \n                          // Check team-specific validation\n                          const russiaValidation = store.turn === 1 \n                            ? validateTurn1Restrictions(russiaState.cart, russiaState)\n                            : validatePooledBudget(russiaState.cart, russiaState);\n                          \n                          return russiaValidation.valid;\n                        })()}\n                        budget={russiaState.budget}\n                      />\n                    </div>\n\n                    {/* Finish Turn Button - Hidden on Mobile */}\n                    <div className=\"glass-panel p-3 lg:p-4 hidden md:block\">\n                      <Button\n                        onClick={() => {\n                          store.advanceGameTurn();\n                          store.saveToLocalStorage();\n                        }}\n                        size=\"lg\"\n                        variant=\"outline\"\n                        className=\"w-full\"\n                        data-testid=\"button-finish-turn\"\n                      >\n                        <SkipForward className=\"w-4 h-4 mr-2\" />\n                        Finish Turn ({store.turn})\n                      </Button>\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        \n        {/* Statistics Section */}\n        {showShopAndCarts && (\n          <div className=\"mt-6\">\n            <DomainStatistics />\n          </div>\n        )}\n      </div>\n\n      {/* Card Detail Modal */}\n      <CardDetailModal\n        card={store.selectedCard}\n        isOpen={!!store.selectedCard}\n        onClose={() => store.setSelectedCard(null)}\n        onAddToCart={() => {\n          if (store.selectedCard) {\n            store.addToCart(store.currentTeam, store.selectedCard);\n            store.setSelectedCard(null);\n          }\n        }}\n        discountedPrice={store.selectedCard ? getDiscountedPrice(store.selectedCard) : undefined}\n        inCart={store.selectedCard ? currentTeamState.cart.some(c => c.id === store.selectedCard?.id) : false}\n        disabled={store.phase !== 'purchase'}\n      />\n      \n      {/* Motto Container */}\n      <div className=\"w-full border-t border-border bg-background/50 backdrop-blur\">\n        <div className=\"container mx-auto px-4 py-4 max-w-full\">\n          <p className=\"text-center text-muted-foreground italic text-sm\">\n            Link your visions with reality.\n          </p>\n        </div>\n      </div>\n      \n      {/* Mobile Footer Navigation */}\n      <MobileFooter />\n\n      {/* Finish Game Session Confirmation Dialog */}\n      <AlertDialog open={showFinishDialog} onOpenChange={setShowFinishDialog}>\n        <AlertDialogContent data-testid=\"dialog-finish-game\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Finish the Game Session?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure? This will generate a final PDF report and save it to the database. You can continue playing after this.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-finish\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleFinishGameSession}\n              disabled={isFinishing}\n              data-testid=\"button-confirm-finish\"\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {isFinishing ? \"Generating...\" : \"Yes, Finish Session\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}","size_bytes":17703},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/utils/pdfGenerator.ts":{"content":"import jsPDF from 'jspdf';\nimport { TeamState, Team, Domain, Card } from '@shared/schema';\nimport cardsData from '../data/cards.json';\n\ninterface TurnStatistics {\n  turn: number;\n  natoTotalDeterrence: number;\n  russiaTotalDeterrence: number;\n  natoDeterrence: Record<Domain, number>;\n  russiaDeterrence: Record<Domain, number>;\n  timestamp: Date;\n}\n\ninterface StrategyLogEntry {\n  turn: number;\n  team: Team;\n  action: string;\n  timestamp: Date;\n}\n\ninterface SessionInfo {\n  sessionName: string;\n  participants: Array<{\n    name: string;\n    country: string;\n  }>;\n}\n\ninterface PDFReportData {\n  currentTurn: number;\n  maxTurns: number;\n  natoTeam: TeamState;\n  russiaTeam: TeamState;\n  turnStatistics: TurnStatistics[];\n  strategyLog: StrategyLogEntry[];\n  sessionInfo: SessionInfo;\n}\n\n// Generate Card Logs PDF Report\nexport const generateCardLogsPDF = (strategyLog: StrategyLogEntry[], sessionInfo: SessionInfo) => {\n  const pdf = new jsPDF();\n  const margin = 20;\n  const contentWidth = 170; // 210 - 40 (margins)\n  let yPosition = margin;\n  \n  // Helper function to check if we need a new page\n  const checkPage = (requiredHeight: number) => {\n    if (yPosition + requiredHeight > 280) {\n      pdf.addPage();\n      yPosition = margin;\n    }\n  };\n\n  // Header\n  pdf.setFontSize(18);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('MDDS - Card Purchase Logs', margin, yPosition);\n  yPosition += 15;\n  \n  // Session info\n  if (sessionInfo.sessionName) {\n    pdf.setFontSize(12);\n    pdf.setFont('helvetica', 'normal');\n    pdf.text(`Session: ${sessionInfo.sessionName}`, margin, yPosition);\n    yPosition += 8;\n  }\n  \n  // Generation timestamp\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'italic');\n  pdf.text(`Generated: ${new Date().toLocaleString()}`, margin, yPosition);\n  yPosition += 15;\n  \n  // Filter only card purchase logs\n  const cardPurchaseLogs = strategyLog.filter(entry => \n    entry.action.includes('purchased') && !entry.action.includes('Committed purchases')\n  );\n  \n  if (cardPurchaseLogs.length === 0) {\n    pdf.setFontSize(12);\n    pdf.setFont('helvetica', 'normal');\n    pdf.text('No card purchases recorded yet.', margin, yPosition);\n  } else {\n    // Summary\n    pdf.setFontSize(14);\n    pdf.setFont('helvetica', 'bold');\n    pdf.text('Summary', margin, yPosition);\n    yPosition += 10;\n    \n    pdf.setFontSize(11);\n    pdf.setFont('helvetica', 'normal');\n    pdf.text(`Total Card Purchases: ${cardPurchaseLogs.length}`, margin + 5, yPosition);\n    yPosition += 6;\n    \n    const natoCount = cardPurchaseLogs.filter(log => log.team === 'NATO').length;\n    const russiaCount = cardPurchaseLogs.filter(log => log.team === 'Russia').length;\n    \n    pdf.text(`NATO Purchases: ${natoCount}`, margin + 5, yPosition);\n    yPosition += 6;\n    pdf.text(`Russia Purchases: ${russiaCount}`, margin + 5, yPosition);\n    yPosition += 15;\n    \n    // Card Purchase Logs\n    pdf.setFontSize(14);\n    pdf.setFont('helvetica', 'bold');\n    pdf.text('Card Purchase History', margin, yPosition);\n    yPosition += 10;\n    \n    // Group by turn\n    const logByTurn = cardPurchaseLogs.reduce((acc, entry) => {\n      if (!acc[entry.turn]) acc[entry.turn] = [];\n      acc[entry.turn].push(entry);\n      return acc;\n    }, {} as Record<number, StrategyLogEntry[]>);\n    \n    Object.keys(logByTurn).sort((a, b) => parseInt(a) - parseInt(b)).forEach(turn => {\n      checkPage(25);\n      \n      pdf.setFontSize(12);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text(`Turn ${turn}`, margin + 5, yPosition);\n      yPosition += 8;\n      \n      logByTurn[parseInt(turn)].forEach(entry => {\n        checkPage(8);\n        pdf.setFontSize(10);\n        pdf.setFont('helvetica', 'normal');\n        const timeStr = new Date(entry.timestamp).toLocaleTimeString();\n        const teamColor = entry.team === 'NATO' ? '[NATO]' : '[RUS]';\n        const logText = `${teamColor} ${timeStr}: ${entry.action}`;\n        \n        const lines = pdf.splitTextToSize(logText, contentWidth - 20);\n        lines.forEach((line: string) => {\n          pdf.text(line, margin + 10, yPosition);\n          yPosition += 4;\n        });\n        yPosition += 2;\n      });\n      \n      yPosition += 8;\n    });\n  }\n  \n  // Save the PDF\n  const fileName = `MDDS_Card_Logs_${new Date().toISOString().split('T')[0]}.pdf`;\n  pdf.save(fileName);\n};\n\n// Helper function to draw line chart\nconst drawLineChart = (\n  pdf: jsPDF, \n  x: number, \n  y: number, \n  width: number, \n  height: number,\n  data: Array<{turn: number, nato: number, russia: number}>,\n  title: string\n) => {\n  // Modern chart border with rounded effect\n  pdf.setLineWidth(1);\n  pdf.setDrawColor(150, 150, 150);\n  pdf.rect(x, y, width, height);\n  \n  // Title\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text(title, x + width/2, y - 5, { align: 'center' });\n  \n  if (data.length === 0) return;\n  \n  // Handle single data point case\n  if (data.length === 1) {\n    pdf.setFontSize(8);\n    pdf.setFont('helvetica', 'italic');\n    pdf.text('Insufficient data for line chart (minimum 2 turns required)', x + width/2, y + height/2, { align: 'center' });\n    return;\n  }\n  \n  const maxValue = Math.max(...data.map(d => Math.max(d.nato, d.russia)));\n  const minValue = Math.min(...data.map(d => Math.min(d.nato, d.russia)));\n  const valueRange = Math.max(maxValue - minValue, 1); // Ensure minimum range of 1\n  \n  // Y-axis labels\n  pdf.setFontSize(8);\n  pdf.setFont('helvetica', 'normal');\n  for (let i = 0; i <= 4; i++) {\n    const value = minValue + (valueRange * i / 4);\n    const labelY = y + height - (i * height / 4);\n    pdf.text(Math.round(value).toString(), x - 10, labelY, { align: 'right' });\n    \n    // Modern grid lines\n    pdf.setLineWidth(0.3);\n    pdf.setDrawColor(220, 220, 220);\n    pdf.line(x, labelY, x + width, labelY);\n  }\n  \n  // X-axis labels\n  data.forEach((point, index) => {\n    const labelX = x + (index * width / (data.length - 1));\n    pdf.text(`T${point.turn}`, labelX, y + height + 10, { align: 'center' });\n  });\n  \n  // Draw NATO line (blue) with enhanced styling\n  pdf.setLineWidth(1.2);\n  pdf.setDrawColor(59, 130, 246); // Blue\n  for (let i = 0; i < data.length - 1; i++) {\n    const x1 = x + (i * width / (data.length - 1));\n    const y1 = y + height - ((data[i].nato - minValue) / valueRange * height);\n    const x2 = x + ((i + 1) * width / (data.length - 1));\n    const y2 = y + height - ((data[i + 1].nato - minValue) / valueRange * height);\n    pdf.line(x1, y1, x2, y2);\n  }\n  \n  // Draw NATO data points (dots)\n  pdf.setFillColor(59, 130, 246); // Blue\n  data.forEach((point, index) => {\n    const dotX = x + (index * width / (data.length - 1));\n    const dotY = y + height - ((point.nato - minValue) / valueRange * height);\n    pdf.circle(dotX, dotY, 1.5, 'F');\n    \n    // Add value label\n    pdf.setFontSize(6);\n    pdf.setFont('helvetica', 'bold');\n    pdf.setTextColor(59, 130, 246);\n    pdf.text(point.nato.toString(), dotX - 3, dotY - 3);\n  });\n  \n  // Draw Russia line (red) with enhanced styling\n  pdf.setDrawColor(239, 68, 68); // Red\n  pdf.setLineWidth(1.2);\n  for (let i = 0; i < data.length - 1; i++) {\n    const x1 = x + (i * width / (data.length - 1));\n    const y1 = y + height - ((data[i].russia - minValue) / valueRange * height);\n    const x2 = x + ((i + 1) * width / (data.length - 1));\n    const y2 = y + height - ((data[i + 1].russia - minValue) / valueRange * height);\n    pdf.line(x1, y1, x2, y2);\n  }\n  \n  // Draw Russia data points (dots)\n  pdf.setFillColor(239, 68, 68); // Red\n  data.forEach((point, index) => {\n    const dotX = x + (index * width / (data.length - 1));\n    const dotY = y + height - ((point.russia - minValue) / valueRange * height);\n    pdf.circle(dotX, dotY, 1.5, 'F');\n    \n    // Add value label\n    pdf.setFontSize(6);\n    pdf.setFont('helvetica', 'bold');\n    pdf.setTextColor(239, 68, 68);\n    pdf.text(point.russia.toString(), dotX + 3, dotY - 3);\n  });\n  \n  // Enhanced Legend with dots\n  pdf.setDrawColor(59, 130, 246);\n  pdf.setLineWidth(2);\n  pdf.line(x + width - 80, y - 15, x + width - 65, y - 15);\n  pdf.setFillColor(59, 130, 246);\n  pdf.circle(x + width - 72.5, y - 15, 1, 'F');\n  pdf.setFontSize(8);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setTextColor(0, 0, 0);\n  pdf.text('NATO', x + width - 60, y - 12);\n  \n  pdf.setDrawColor(239, 68, 68);\n  pdf.line(x + width - 35, y - 15, x + width - 20, y - 15);\n  pdf.setFillColor(239, 68, 68);\n  pdf.circle(x + width - 27.5, y - 15, 1, 'F');\n  pdf.text('Russia', x + width - 15, y - 12);\n  \n  pdf.setDrawColor(0, 0, 0); // Reset to black\n  pdf.setTextColor(0, 0, 0); // Reset text color to black\n};\n\n// Helper function to draw bar chart\nconst drawBarChart = (\n  pdf: jsPDF,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  data: Array<{label: string, nato: number, russia: number}>,\n  title: string\n) => {\n  // Modern chart border\n  pdf.setLineWidth(1);\n  pdf.setDrawColor(150, 150, 150);\n  pdf.rect(x, y, width, height);\n  \n  // Title\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text(title, x + width/2, y - 5, { align: 'center' });\n  \n  if (data.length === 0) return;\n  \n  const maxValue = Math.max(...data.map(d => Math.max(d.nato, d.russia)), 1); // Ensure minimum value of 1\n  const barWidth = width / (data.length * 2 + 1);\n  \n  // Y-axis labels\n  pdf.setFontSize(8);\n  pdf.setFont('helvetica', 'normal');\n  for (let i = 0; i <= 4; i++) {\n    const value = (maxValue * i / 4);\n    const labelY = y + height - (i * height / 4);\n    pdf.text(Math.round(value).toString(), x - 10, labelY, { align: 'right' });\n    \n    // Modern grid lines\n    pdf.setLineWidth(0.3);\n    pdf.setDrawColor(220, 220, 220);\n    pdf.line(x, labelY, x + width, labelY);\n  }\n  \n  // Draw bars with enhanced styling\n  data.forEach((item, index) => {\n    const barX = x + (index * 2 + 0.5) * barWidth;\n    \n    // NATO bar (blue) with enhanced styling\n    const natoHeight = (item.nato / maxValue) * height;\n    pdf.setFillColor(59, 130, 246);\n    pdf.rect(barX, y + height - natoHeight, barWidth * 0.8, natoHeight, 'F');\n    \n    // Add NATO value label\n    if (natoHeight > 10) {\n      pdf.setFontSize(6);\n      pdf.setFont('helvetica', 'bold');\n      pdf.setTextColor(255, 255, 255);\n      pdf.text(item.nato.toString(), barX + (barWidth * 0.4), y + height - natoHeight/2, { align: 'center' });\n    }\n    \n    // Russia bar (red) with enhanced styling\n    const russiaHeight = (item.russia / maxValue) * height;\n    pdf.setFillColor(239, 68, 68);\n    pdf.rect(barX + barWidth, y + height - russiaHeight, barWidth * 0.8, russiaHeight, 'F');\n    \n    // Add Russia value label\n    if (russiaHeight > 10) {\n      pdf.setFontSize(6);\n      pdf.setFont('helvetica', 'bold');\n      pdf.setTextColor(255, 255, 255);\n      pdf.text(item.russia.toString(), barX + barWidth + (barWidth * 0.4), y + height - russiaHeight/2, { align: 'center' });\n    }\n    \n    // X-axis label\n    pdf.setFontSize(7);\n    pdf.setFont('helvetica', 'normal');\n    pdf.setTextColor(0, 0, 0);\n    const labelText = item.label.length > 8 ? item.label.substring(0, 6) + '..' : item.label;\n    pdf.text(labelText, barX + barWidth, y + height + 8, { align: 'center' });\n  });\n  \n  // Enhanced Legend\n  pdf.setFillColor(59, 130, 246);\n  pdf.rect(x + width - 80, y - 18, 8, 4, 'F');\n  pdf.setFontSize(8);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setTextColor(0, 0, 0);\n  pdf.text('NATO', x + width - 68, y - 15);\n  \n  pdf.setFillColor(239, 68, 68);\n  pdf.rect(x + width - 35, y - 18, 8, 4, 'F');\n  pdf.text('Russia', x + width - 23, y - 15);\n  \n  pdf.setDrawColor(0, 0, 0); // Reset to black\n  pdf.setTextColor(0, 0, 0); // Reset text color to black\n};\n\n// Domain colors matching the web component\nconst domainColors = {\n  joint: { r: 156, g: 163, b: 175 }, // #9CA3AF\n  economy: { r: 16, g: 185, b: 129 }, // #10B981\n  cognitive: { r: 139, g: 92, b: 246 }, // #8B5CF6\n  space: { r: 59, g: 130, b: 246 }, // #3B82F6\n  cyber: { r: 245, g: 158, b: 11 } // #F59E0B\n};\n\n// Helper function to draw domain-specific line chart\nconst drawDomainChart = (\n  pdf: jsPDF,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  data: Array<{turn: number, joint: number, economy: number, cognitive: number, space: number, cyber: number}>,\n  title: string\n) => {\n  // Modern chart border\n  pdf.setLineWidth(1);\n  pdf.setDrawColor(150, 150, 150);\n  pdf.rect(x, y, width, height);\n  \n  // Title\n  pdf.setFontSize(9);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setTextColor(0, 0, 0);\n  pdf.text(title, x + width/2, y - 3, { align: 'center' });\n  \n  if (data.length === 0) return;\n  \n  // Handle single data point case\n  if (data.length === 1) {\n    pdf.setFontSize(7);\n    pdf.setFont('helvetica', 'italic');\n    pdf.text('Insufficient data (minimum 2 turns)', x + width/2, y + height/2, { align: 'center' });\n    return;\n  }\n  \n  const domains: Domain[] = ['joint', 'economy', 'cognitive', 'space', 'cyber'];\n  \n  // Find max and min values across all domains\n  const allValues = data.flatMap(d => domains.map(domain => d[domain]));\n  const maxValue = Math.max(...allValues, 1);\n  const minValue = Math.min(...allValues, 0);\n  const valueRange = Math.max(maxValue - minValue, 1);\n  \n  // Y-axis labels (smaller)\n  pdf.setFontSize(6);\n  pdf.setFont('helvetica', 'normal');\n  for (let i = 0; i <= 3; i++) {\n    const value = minValue + (valueRange * i / 3);\n    const labelY = y + height - (i * height / 3);\n    pdf.text(Math.round(value).toString(), x - 8, labelY, { align: 'right' });\n    \n    // Modern grid lines\n    pdf.setLineWidth(0.2);\n    pdf.setDrawColor(230, 230, 230);\n    pdf.line(x, labelY, x + width, labelY);\n  }\n  \n  // X-axis labels (smaller)\n  data.forEach((point, index) => {\n    const labelX = x + (index * width / (data.length - 1));\n    pdf.setFontSize(6);\n    pdf.text(`T${point.turn}`, labelX, y + height + 6, { align: 'center' });\n  });\n  \n  // Draw lines for each domain\n  domains.forEach(domain => {\n    const color = domainColors[domain];\n    pdf.setLineWidth(1);\n    pdf.setDrawColor(color.r, color.g, color.b);\n    \n    // Draw line segments\n    for (let i = 0; i < data.length - 1; i++) {\n      const x1 = x + (i * width / (data.length - 1));\n      const y1 = y + height - ((data[i][domain] - minValue) / valueRange * height);\n      const x2 = x + ((i + 1) * width / (data.length - 1));\n      const y2 = y + height - ((data[i + 1][domain] - minValue) / valueRange * height);\n      pdf.line(x1, y1, x2, y2);\n    }\n    \n    // Draw dots at data points\n    pdf.setFillColor(color.r, color.g, color.b);\n    data.forEach((point, index) => {\n      const dotX = x + (index * width / (data.length - 1));\n      const dotY = y + height - ((point[domain] - minValue) / valueRange * height);\n      pdf.circle(dotX, dotY, 1, 'F');\n    });\n  });\n  \n  // Domain legend (compact)\n  pdf.setFontSize(5);\n  pdf.setFont('helvetica', 'normal');\n  domains.forEach((domain, index) => {\n    const color = domainColors[domain];\n    const legendX = x + 5 + (index * 15);\n    const legendY = y - 8;\n    \n    pdf.setFillColor(color.r, color.g, color.b);\n    pdf.circle(legendX, legendY, 0.8, 'F');\n    pdf.setTextColor(color.r, color.g, color.b);\n    pdf.text(domain.charAt(0).toUpperCase(), legendX + 3, legendY + 1);\n  });\n  \n  pdf.setTextColor(0, 0, 0); // Reset text color\n};\n\n// Helper function to calculate defense/offense effects (matching web component logic)\nconst calculateDefenseOffenseEffects = (data: PDFReportData) => {\n  const cards = cardsData as Card[];\n  \n  // Calculate team's offensive effects on opponent's dimensions for each turn (cumulative)\n  const calculateOffensiveEffects = (attackingTeam: 'NATO' | 'Russia') => {\n    const effectsByTurn: Record<number, Record<Domain, number>> = {};\n    const cumulativeEffects: Record<Domain, number> = {\n      joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0\n    };\n    \n    // Initialize all turns with zero effects\n    data.turnStatistics.forEach(stat => {\n      effectsByTurn[stat.turn] = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 };\n    });\n    \n    // Process each turn sequentially to build cumulative effects\n    data.turnStatistics.forEach(stat => {\n      // Find all card purchases for this team in this turn\n      const turnPurchases = data.strategyLog.filter(logEntry => \n        logEntry.team === attackingTeam && \n        logEntry.turn === stat.turn && \n        logEntry.action.includes('purchased')\n      );\n      \n      // Add effects from cards purchased this turn\n      turnPurchases.forEach(logEntry => {\n        const cardIdMatch = logEntry.action.match(/\\(([^)]+)\\)/);\n        if (cardIdMatch) {\n          const cardId = cardIdMatch[1];\n          const card = cards.find(c => c.id === cardId);\n          \n          if (card && card.effects) {\n            card.effects.forEach(effect => {\n              if (effect.target === 'opponent') {\n                // Add to cumulative effects (keep negative values)\n                cumulativeEffects[effect.domain] += effect.delta;\n              } else if (effect.target === 'global') {\n                // Global effects also impact opponent\n                cumulativeEffects[effect.domain] += effect.delta;\n              }\n            });\n          }\n        }\n      });\n      \n      // Record cumulative effects for this turn\n      effectsByTurn[stat.turn] = { ...cumulativeEffects };\n    });\n    \n    return effectsByTurn;\n  };\n  \n  // Calculate team's defensive effects (self-targeting positive effects) for each turn (cumulative)\n  const calculateDefensiveEffects = (defendingTeam: 'NATO' | 'Russia') => {\n    const effectsByTurn: Record<number, Record<Domain, number>> = {};\n    const cumulativeEffects: Record<Domain, number> = {\n      joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0\n    };\n    \n    // Initialize all turns with zero effects\n    data.turnStatistics.forEach(stat => {\n      effectsByTurn[stat.turn] = { joint: 0, economy: 0, cognitive: 0, space: 0, cyber: 0 };\n    });\n    \n    // Process each turn sequentially to build cumulative effects\n    data.turnStatistics.forEach(stat => {\n      // Find all card purchases for this team in this turn\n      const turnPurchases = data.strategyLog.filter(logEntry => \n        logEntry.team === defendingTeam && \n        logEntry.turn === stat.turn && \n        logEntry.action.includes('purchased')\n      );\n      \n      // Add effects from cards purchased this turn\n      turnPurchases.forEach(logEntry => {\n        const cardIdMatch = logEntry.action.match(/\\(([^)]+)\\)/);\n        if (cardIdMatch) {\n          const cardId = cardIdMatch[1];\n          const card = cards.find(c => c.id === cardId);\n          \n          if (card && card.effects) {\n            card.effects.forEach(effect => {\n              if (effect.target === 'self') {\n                // Add to cumulative defensive effects (including negative deltas)\n                cumulativeEffects[effect.domain] += effect.delta;\n              } else if (effect.target === 'global') {\n                // Global effects also impact self\n                cumulativeEffects[effect.domain] += effect.delta;\n              }\n            });\n          }\n        }\n      });\n      \n      // Record cumulative effects for this turn\n      effectsByTurn[stat.turn] = { ...cumulativeEffects };\n    });\n    \n    return effectsByTurn;\n  };\n  \n  const natoOffensiveEffects = calculateOffensiveEffects('NATO');\n  const russiaOffensiveEffects = calculateOffensiveEffects('Russia');\n  const natoDefensiveEffects = calculateDefensiveEffects('NATO');\n  const russiaDefensiveEffects = calculateDefensiveEffects('Russia');\n  \n  // Prepare data for NATO Defensive chart (showing self-effects)\n  const natoDefenseData = data.turnStatistics.map(stat => ({\n    turn: stat.turn,\n    joint: natoDefensiveEffects[stat.turn]?.joint || 0,\n    economy: natoDefensiveEffects[stat.turn]?.economy || 0,\n    cognitive: natoDefensiveEffects[stat.turn]?.cognitive || 0,\n    space: natoDefensiveEffects[stat.turn]?.space || 0,\n    cyber: natoDefensiveEffects[stat.turn]?.cyber || 0\n  }));\n  \n  // Prepare data for NATO Offensive chart (showing effects on Russia)\n  const natoOffenseData = data.turnStatistics.map(stat => ({\n    turn: stat.turn,\n    joint: natoOffensiveEffects[stat.turn]?.joint || 0,\n    economy: natoOffensiveEffects[stat.turn]?.economy || 0,\n    cognitive: natoOffensiveEffects[stat.turn]?.cognitive || 0,\n    space: natoOffensiveEffects[stat.turn]?.space || 0,\n    cyber: natoOffensiveEffects[stat.turn]?.cyber || 0\n  }));\n  \n  // Prepare data for Russia Defensive chart (showing self-effects)\n  const russiaDefenseData = data.turnStatistics.map(stat => ({\n    turn: stat.turn,\n    joint: russiaDefensiveEffects[stat.turn]?.joint || 0,\n    economy: russiaDefensiveEffects[stat.turn]?.economy || 0,\n    cognitive: russiaDefensiveEffects[stat.turn]?.cognitive || 0,\n    space: russiaDefensiveEffects[stat.turn]?.space || 0,\n    cyber: russiaDefensiveEffects[stat.turn]?.cyber || 0\n  }));\n  \n  // Prepare data for Russia Offensive chart (showing effects on NATO)\n  const russiaOffenseData = data.turnStatistics.map(stat => ({\n    turn: stat.turn,\n    joint: russiaOffensiveEffects[stat.turn]?.joint || 0,\n    economy: russiaOffensiveEffects[stat.turn]?.economy || 0,\n    cognitive: russiaOffensiveEffects[stat.turn]?.cognitive || 0,\n    space: russiaOffensiveEffects[stat.turn]?.space || 0,\n    cyber: russiaOffensiveEffects[stat.turn]?.cyber || 0\n  }));\n  \n  return { natoDefenseData, natoOffenseData, russiaDefenseData, russiaOffenseData };\n};\n\nexport const generateMDDSReport = async (data: PDFReportData) => {\n  \n  const pdf = new jsPDF('p', 'mm', 'a4');\n  const pageWidth = pdf.internal.pageSize.getWidth();\n  const pageHeight = pdf.internal.pageSize.getHeight();\n  const margin = 20;\n  const contentWidth = pageWidth - (2 * margin);\n  \n  let yPosition = margin;\n  let pageNumber = 1;\n  \n  // Helper function to add page footer\n  const addFooter = () => {\n    pdf.setFontSize(9);\n    pdf.setFont('helvetica', 'normal');\n    pdf.text(`Page ${pageNumber}`, pageWidth / 2, pageHeight - 10, { align: 'center' });\n  };\n  \n  // Helper function to add new page\n  const addNewPage = () => {\n    addFooter();\n    pdf.addPage();\n    pageNumber++;\n    yPosition = margin;\n  };\n  \n  // Helper function to check page space\n  const checkPage = (requiredHeight: number) => {\n    if (yPosition + requiredHeight > pageHeight - 20) {\n      addNewPage();\n    }\n  };\n  \n  // TITLE\n  pdf.setFontSize(20);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('MDDS Strategic Analysis Report', pageWidth / 2, yPosition, { align: 'center' });\n  yPosition += 20;\n  \n  // Date\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'normal');\n  const reportDate = new Date().toLocaleDateString('en-US', { \n    year: 'numeric', \n    month: 'long', \n    day: 'numeric' \n  });\n  pdf.text(`Generated: ${reportDate}`, pageWidth / 2, yPosition, { align: 'center' });\n  yPosition += 30;\n  \n  // SESSION INFORMATION PART\n  checkPage(50);\n  pdf.setFontSize(16);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('SESSION INFORMATION', margin, yPosition);\n  yPosition += 15;\n  \n  // Create unified table for all session information\n  const sessionName = data.sessionInfo.sessionName || 'Unnamed Session';\n  const sessionDate = data.turnStatistics.length > 0 \n    ? new Date(data.turnStatistics[0].timestamp).toLocaleDateString('en-US', { \n        year: 'numeric', \n        month: 'long', \n        day: 'numeric' \n      })\n    : reportDate;\n  \n  const validParticipants = data.sessionInfo.participants.filter(p => p.name.trim() !== '' || p.country.trim() !== '');\n  const participantsList = validParticipants.length > 0 \n    ? validParticipants.map(p => `${p.name || 'N/A'} (${p.country || 'N/A'})`).join(', ')\n    : 'No participants listed';\n  \n  // Table header\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setFillColor(245, 245, 245);\n  pdf.rect(margin, yPosition - 2, contentWidth, 8, 'F');\n  pdf.text('Information Type', margin + 5, yPosition + 3);\n  pdf.text('Details', margin + 60, yPosition + 3);\n  yPosition += 10;\n  \n  // Table content\n  pdf.setFont('helvetica', 'normal');\n  \n  // Session Name row\n  pdf.text('Session Name', margin + 5, yPosition);\n  const sessionNameLines = pdf.splitTextToSize(sessionName, contentWidth - 65);\n  sessionNameLines.forEach((line: string, index: number) => {\n    pdf.text(line, margin + 60, yPosition + (index * 5));\n  });\n  yPosition += Math.max(6, sessionNameLines.length * 5);\n  \n  // Session Date row\n  pdf.text('Session Date', margin + 5, yPosition);\n  pdf.text(sessionDate, margin + 60, yPosition);\n  yPosition += 7;\n  \n  // Session Participants row\n  pdf.text('Session Participants', margin + 5, yPosition);\n  const participantLines = pdf.splitTextToSize(participantsList, contentWidth - 65);\n  participantLines.forEach((line: string, index: number) => {\n    pdf.text(line, margin + 60, yPosition + (index * 5));\n  });\n  yPosition += Math.max(6, participantLines.length * 5);\n  \n  // Table border\n  pdf.setLineWidth(0.1);\n  pdf.line(margin, yPosition - (sessionNameLines.length * 5) - 13 - 7 - (participantLines.length * 5), pageWidth - margin, yPosition - (sessionNameLines.length * 5) - 13 - 7 - (participantLines.length * 5));\n  pdf.line(margin, yPosition, pageWidth - margin, yPosition);\n  pdf.line(margin, yPosition - (sessionNameLines.length * 5) - 13 - 7 - (participantLines.length * 5), margin, yPosition);\n  pdf.line(pageWidth - margin, yPosition - (sessionNameLines.length * 5) - 13 - 7 - (participantLines.length * 5), pageWidth - margin, yPosition);\n  pdf.line(margin + 55, yPosition - (sessionNameLines.length * 5) - 13 - 7 - (participantLines.length * 5), margin + 55, yPosition);\n  \n  yPosition += 20;\n  \n  // STATISTICS PART\n  checkPage(40);\n  pdf.setFontSize(16);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('STATISTICS', margin, yPosition);\n  yPosition += 15;\n  \n  // Total Deterrence Scores\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Total Deterrence Scores', margin, yPosition);\n  yPosition += 10;\n  \n  // Current scores table\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setFillColor(245, 245, 245);\n  pdf.rect(margin + 5, yPosition - 2, contentWidth - 10, 8, 'F');\n  pdf.text('Team', margin + 10, yPosition + 3);\n  pdf.text('Current Deterrence', margin + 60, yPosition + 3);\n  pdf.text('Turn Progress', margin + 120, yPosition + 3);\n  yPosition += 10;\n  \n  pdf.setFont('helvetica', 'normal');\n  pdf.text('NATO', margin + 10, yPosition);\n  pdf.text(data.natoTeam.totalDeterrence.toString(), margin + 60, yPosition);\n  pdf.text(`${data.currentTurn} of ${data.maxTurns}`, margin + 120, yPosition);\n  yPosition += 7;\n  \n  pdf.text('Russia', margin + 10, yPosition);\n  pdf.text(data.russiaTeam.totalDeterrence.toString(), margin + 60, yPosition);\n  pdf.text(`${data.currentTurn} of ${data.maxTurns}`, margin + 120, yPosition);\n  yPosition += 20;\n  \n  // Dimensional Scores for Teams (Turn by Turn)\n  checkPage(40);\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Dimensional Scores for Teams (Turn by Turn)', margin, yPosition);\n  yPosition += 10;\n  \n  const domains: Domain[] = ['joint', 'economy', 'cognitive', 'space', 'cyber'];\n  \n  data.turnStatistics.forEach((stat, index) => {\n    checkPage(60);\n    \n    pdf.setFontSize(11);\n    pdf.setFont('helvetica', 'bold');\n    pdf.text(`Turn ${stat.turn}`, margin + 5, yPosition);\n    yPosition += 8;\n    \n    // Create table for dimensional scores\n    pdf.setFontSize(9);\n    pdf.setFont('helvetica', 'bold');\n    pdf.setFillColor(245, 245, 245);\n    pdf.rect(margin + 10, yPosition - 2, contentWidth - 20, 8, 'F');\n    pdf.text('Dimension', margin + 15, yPosition + 3);\n    pdf.text('NATO', margin + 70, yPosition + 3);\n    pdf.text('Russia', margin + 100, yPosition + 3);\n    pdf.text('Advantage', margin + 130, yPosition + 3);\n    yPosition += 10;\n    \n    pdf.setFont('helvetica', 'normal');\n    domains.forEach(domain => {\n      const natoValue = stat.natoDeterrence[domain];\n      const russiaValue = stat.russiaDeterrence[domain];\n      const advantage = natoValue - russiaValue;\n      \n      pdf.text(domain.charAt(0).toUpperCase() + domain.slice(1), margin + 15, yPosition);\n      pdf.text(natoValue.toString(), margin + 70, yPosition);\n      pdf.text(russiaValue.toString(), margin + 100, yPosition);\n      pdf.text(`${advantage > 0 ? '+' : ''}${advantage}`, margin + 130, yPosition);\n      yPosition += 6;\n    });\n    \n    yPosition += 10;\n  });\n  \n  // Turn-based Card Purchase Logs\n  checkPage(40);\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Turn-based Card Purchase Logs', margin, yPosition);\n  yPosition += 10;\n  \n  // Group strategy log by turn\n  const logByTurn = data.strategyLog.reduce((acc, entry) => {\n    if (!acc[entry.turn]) acc[entry.turn] = [];\n    acc[entry.turn].push(entry);\n    return acc;\n  }, {} as Record<number, StrategyLogEntry[]>);\n  \n  Object.keys(logByTurn).sort((a, b) => parseInt(a) - parseInt(b)).forEach(turn => {\n    checkPage(25);\n    \n    pdf.setFontSize(11);\n    pdf.setFont('helvetica', 'bold');\n    pdf.text(`Turn ${turn} Actions`, margin + 5, yPosition);\n    yPosition += 8;\n    \n    logByTurn[parseInt(turn)].forEach(entry => {\n      checkPage(8);\n      pdf.setFontSize(9);\n      pdf.setFont('helvetica', 'normal');\n      const timeStr = new Date(entry.timestamp).toLocaleTimeString();\n      const logText = `[${entry.team}] ${timeStr}: ${entry.action}`;\n      \n      const lines = pdf.splitTextToSize(logText, contentWidth - 20);\n      lines.forEach((line: string) => {\n        pdf.text(line, margin + 10, yPosition);\n        yPosition += 4;\n      });\n    });\n    \n    yPosition += 10;\n  });\n  \n  // Charts (overall statistics for both teams, dimension based statistics for both teams)\n  checkPage(40);\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Charts (Overall Statistics for Both Teams, Dimension Based Statistics for Both Teams)', margin, yPosition);\n  yPosition += 10;\n  \n  // Overall Deterrence Line Chart\n  checkPage(80);\n  const lineChartData = data.turnStatistics.map(stat => ({\n    turn: stat.turn,\n    nato: stat.natoTotalDeterrence,\n    russia: stat.russiaTotalDeterrence\n  }));\n  \n  if (lineChartData.length > 0) {\n    drawLineChart(\n      pdf,\n      margin + 5,\n      yPosition + 20,\n      contentWidth - 10,\n      50,\n      lineChartData,\n      'Total Deterrence Over Time'\n    );\n    yPosition += 85;\n  }\n  \n  // Current Dimensional Scores Bar Chart\n  checkPage(80);\n  const currentDimensionData = domains.map(domain => ({\n    label: domain.charAt(0).toUpperCase() + domain.slice(1),\n    nato: data.natoTeam.deterrence[domain],\n    russia: data.russiaTeam.deterrence[domain]\n  }));\n  \n  drawBarChart(\n    pdf,\n    margin + 5,\n    yPosition + 20,\n    contentWidth - 10,\n    50,\n    currentDimensionData,\n    'Current Dimensional Deterrence Scores'\n  );\n  yPosition += 85;\n  \n  // Defensive/Offensive Statistic Charts that includes all charts in color\n  checkPage(40);\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Defensive/Offensive Statistic Charts', margin, yPosition);\n  yPosition += 10;\n  \n  // Turn-by-Turn Dimensional Evolution Charts\n  domains.forEach(domain => {\n    checkPage(80);\n    \n    const dimensionData = data.turnStatistics.map(stat => ({\n      turn: stat.turn,\n      nato: stat.natoDeterrence[domain],\n      russia: stat.russiaDeterrence[domain]\n    }));\n    \n    if (dimensionData.length > 0) {\n      drawLineChart(\n        pdf,\n        margin + 5,\n        yPosition + 20,\n        contentWidth - 10,\n        40,\n        dimensionData,\n        `${domain.charAt(0).toUpperCase() + domain.slice(1)} Dimension Evolution`\n      );\n      yPosition += 70;\n    }\n  });\n  \n  // Strategic Effects Analysis - Full-width vertical layout\n  if (data.turnStatistics.length > 1 && data.strategyLog.length > 0) {\n    // Calculate effects similar to the web component\n    const { natoDefenseData, natoOffenseData, russiaDefenseData, russiaOffenseData } = calculateDefenseOffenseEffects(data);\n    \n    // Chart layout: Full-width charts with proper margin for y-axis labels\n    // Y-axis labels render at x - 8mm, so chart starts at margin + 10\n    const chartWidth = contentWidth - 20; // Full width with 10mm margins on each side\n    const chartX = margin + 10; // Labels will be at margin + 2\n    const chartHeight = 50;\n    \n    // Section header\n    checkPage(30);\n    pdf.setFontSize(16);\n    pdf.setFont('helvetica', 'bold');\n    pdf.text('STRATEGIC EFFECTS ANALYSIS', margin, yPosition);\n    yPosition += 15;\n    \n    // NATO Defensive Effects\n    pdf.setFontSize(10);\n    pdf.setFont('helvetica', 'normal');\n    pdf.setTextColor(60, 60, 60);\n    const natoDefText = pdf.splitTextToSize(\n      'This chart shows NATO\\'s defensive card effects across all five domains (Joint, Economy, Cognitive, Space, Cyber) throughout the strategy session. Defensive effects strengthen NATO\\'s own deterrence capabilities and represent investments in self-protection and resilience.',\n      contentWidth\n    );\n    const natoDefBlockHeight = natoDefText.length * 5 + 5 + chartHeight + 25;\n    checkPage(natoDefBlockHeight);\n    \n    pdf.text(natoDefText, margin, yPosition);\n    yPosition += natoDefText.length * 5 + 5;\n    \n    drawDomainChart(\n      pdf,\n      chartX,\n      yPosition,\n      chartWidth,\n      chartHeight,\n      natoDefenseData,\n      'NATO Defensive Effects'\n    );\n    yPosition += chartHeight + 25;\n    \n    // NATO Offensive Effects on Russia\n    pdf.setFontSize(10);\n    pdf.setFont('helvetica', 'normal');\n    pdf.setTextColor(60, 60, 60);\n    const natoOffText = pdf.splitTextToSize(\n      'This chart displays NATO\\'s offensive card effects on Russia across all domains. Offensive effects reduce the opponent\\'s deterrence scores and represent strategic actions aimed at weakening adversary capabilities.',\n      contentWidth\n    );\n    const natoOffBlockHeight = natoOffText.length * 5 + 5 + chartHeight + 25;\n    checkPage(natoOffBlockHeight);\n    \n    pdf.text(natoOffText, margin, yPosition);\n    yPosition += natoOffText.length * 5 + 5;\n    \n    drawDomainChart(\n      pdf,\n      chartX,\n      yPosition,\n      chartWidth,\n      chartHeight,\n      natoOffenseData,\n      'NATO Offensive Effects on Russia'\n    );\n    yPosition += chartHeight + 25;\n    \n    // Russia Defensive Effects\n    pdf.setFontSize(10);\n    pdf.setFont('helvetica', 'normal');\n    pdf.setTextColor(60, 60, 60);\n    const russiaDefText = pdf.splitTextToSize(\n      'This chart shows Russia\\'s defensive card effects across all five domains throughout the strategy session. Defensive effects strengthen Russia\\'s own deterrence capabilities and represent investments in self-protection and resilience.',\n      contentWidth\n    );\n    const russiaDefBlockHeight = russiaDefText.length * 5 + 5 + chartHeight + 25;\n    checkPage(russiaDefBlockHeight);\n    \n    pdf.text(russiaDefText, margin, yPosition);\n    yPosition += russiaDefText.length * 5 + 5;\n    \n    drawDomainChart(\n      pdf,\n      chartX,\n      yPosition,\n      chartWidth,\n      chartHeight,\n      russiaDefenseData,\n      'Russia Defensive Effects'\n    );\n    yPosition += chartHeight + 25;\n    \n    // Russia Offensive Effects on NATO\n    pdf.setFontSize(10);\n    pdf.setFont('helvetica', 'normal');\n    pdf.setTextColor(60, 60, 60);\n    const russiaOffText = pdf.splitTextToSize(\n      'This chart displays Russia\\'s offensive card effects on NATO across all domains. Offensive effects reduce the opponent\\'s deterrence scores and represent strategic actions aimed at weakening adversary capabilities.',\n      contentWidth\n    );\n    const russiaOffBlockHeight = russiaOffText.length * 5 + 5 + chartHeight + 15;\n    checkPage(russiaOffBlockHeight);\n    \n    pdf.text(russiaOffText, margin, yPosition);\n    yPosition += russiaOffText.length * 5 + 5;\n    \n    drawDomainChart(\n      pdf,\n      chartX,\n      yPosition,\n      chartWidth,\n      chartHeight,\n      russiaOffenseData,\n      'Russia Offensive Effects on NATO'\n    );\n    yPosition += chartHeight + 15;\n    \n    pdf.setTextColor(0, 0, 0); // Reset text color\n  }\n  \n  // Final footer\n  addFooter();\n  \n  // Save the PDF with session-based naming\n  const sessionNameClean = (data.sessionInfo.sessionName || 'MDDS_Session').replace(/[^a-zA-Z0-9]/g, '_');\n  const dateString = new Date().toISOString().split('T')[0];\n  pdf.save(`MDDS_Report_${sessionNameClean}_${dateString}.pdf`);\n};\n\n// Generate MDDS report and return as base64 string for database storage\nexport const generateMDDSReportBase64 = async (data: PDFReportData): Promise<string> => {\n  const pdf = new jsPDF('p', 'mm', 'a4');\n  const pageWidth = pdf.internal.pageSize.getWidth();\n  const pageHeight = pdf.internal.pageSize.getHeight();\n  const margin = 20;\n  const contentWidth = pageWidth - (2 * margin);\n  \n  let yPosition = margin;\n  let pageNumber = 1;\n  \n  // Helper function to add page footer\n  const addFooter = () => {\n    pdf.setFontSize(9);\n    pdf.setFont('helvetica', 'normal');\n    pdf.text(`Page ${pageNumber}`, pageWidth / 2, pageHeight - 10, { align: 'center' });\n  };\n  \n  // Helper function to add new page\n  const addNewPage = () => {\n    addFooter();\n    pdf.addPage();\n    pageNumber++;\n    yPosition = margin;\n  };\n  \n  // Helper function to check page space\n  const checkPage = (requiredHeight: number) => {\n    if (yPosition + requiredHeight > pageHeight - 20) {\n      addNewPage();\n    }\n  };\n  \n  // TITLE\n  pdf.setFontSize(20);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('MDDS Strategic Analysis Report', pageWidth / 2, yPosition, { align: 'center' });\n  yPosition += 20;\n  \n  // Date\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'normal');\n  const reportDate = new Date().toLocaleDateString('en-US', { \n    year: 'numeric', \n    month: 'long', \n    day: 'numeric' \n  });\n  pdf.text(`Generated: ${reportDate}`, pageWidth / 2, yPosition, { align: 'center' });\n  yPosition += 30;\n  \n  // SESSION INFORMATION\n  pdf.setFontSize(16);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Session Information', margin, yPosition);\n  yPosition += 10;\n  \n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'normal');\n  \n  if (data.sessionInfo && data.sessionInfo.sessionName) {\n    pdf.text(`Session: ${data.sessionInfo.sessionName}`, margin, yPosition);\n    yPosition += 8;\n  }\n  \n  pdf.text(`Turn: ${data.currentTurn} / ${data.maxTurns}`, margin, yPosition);\n  yPosition += 8;\n  \n  // Determine winner\n  const natoScore = data.natoTeam.totalDeterrence;\n  const russiaScore = data.russiaTeam.totalDeterrence;\n  let winner = 'TIE';\n  if (natoScore > russiaScore) winner = 'NATO';\n  if (russiaScore > natoScore) winner = 'Russia';\n  \n  pdf.text(`Winner: ${winner}`, margin, yPosition);\n  yPosition += 20;\n  \n  // FINAL SCORES\n  pdf.setFontSize(16);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Final Deterrence Scores', margin, yPosition);\n  yPosition += 10;\n  \n  pdf.setFontSize(14);\n  pdf.setFont('helvetica', 'bold');\n  pdf.setTextColor(59, 130, 246); // NATO blue\n  pdf.text(`NATO: ${natoScore}`, margin, yPosition);\n  yPosition += 8;\n  \n  pdf.setTextColor(239, 68, 68); // Russia red\n  pdf.text(`Russia: ${russiaScore}`, margin, yPosition);\n  yPosition += 15;\n  \n  pdf.setTextColor(0, 0, 0); // Reset to black\n  \n  addFooter();\n  \n  // Return PDF as raw base64 string (strip data URI prefix)\n  const dataUri = pdf.output('datauristring');\n  return dataUri.split(',')[1]; // Remove \"data:application/pdf;filename=generated.pdf;base64,\" prefix\n};","size_bytes":39484},"client/src/state/store.ts":{"content":"import { create } from 'zustand';\nimport { GameState, Team, Card, TeamState, Domain } from '@shared/schema';\nimport { getInitialDeterrence, calculateTotalDeterrence } from '../logic/scoring';\nimport { commitPurchases, advanceTurn } from '../logic/turnEngine';\nimport { sanitizeText } from '../logic/guards';\n\n// Statistics tracking interface\ninterface TurnStatistics {\n  turn: number;\n  natoTotalDeterrence: number;\n  russiaTotalDeterrence: number;\n  natoDeterrence: Record<Domain, number>;\n  russiaDeterrence: Record<Domain, number>;\n  timestamp: Date;\n}\n\n// Session information interface\ninterface SessionInfo {\n  sessionName: string;\n  participants: Array<{\n    name: string;\n    country: string;\n  }>;\n}\n\ninterface MDDSStore extends GameState {\n  // Statistics tracking\n  turnStatistics: TurnStatistics[];\n  \n  // Session information\n  sessionInfo: SessionInfo;\n  \n  // Database session tracking\n  activeDatabaseSession: string | null;\n  \n  // UI State\n  showLoginScreen: boolean;\n  \n  // Actions\n  addToCart: (team: Team, card: Card) => void;\n  removeFromCart: (team: Team, cardId: string) => void;\n  commitTeamPurchases: (team: Team) => void;\n  advanceGameTurn: () => void;\n  resetStrategy: () => void;\n  concludeStrategy: (team: Team) => void;\n  setCurrentTeam: (team: Team) => void;\n  \n  // Session management\n  updateSessionName: (name: string) => void;\n  updateParticipant: (index: number, field: 'name' | 'country', value: string) => void;\n  addParticipant: () => void;\n  removeParticipant: (index: number) => void;\n  \n  // Database session management\n  setActiveDatabaseSession: (sessionName: string | null) => void;\n  syncToDatabase: () => Promise<void>;\n  \n  // UI State\n  selectedCard: Card | null;\n  setSelectedCard: (card: Card | null) => void;\n  setShowLoginScreen: (show: boolean) => void;\n  \n  // Persistence\n  saveToLocalStorage: () => void;\n  loadFromLocalStorage: () => boolean;\n  exportState: () => string;\n  importState: (jsonState: string) => boolean;\n}\n\nconst createInitialTeamState = (): TeamState => ({\n  deterrence: getInitialDeterrence(),\n  totalDeterrence: 500, // 100 per domain * 5 domains\n  budget: 1000, // Turn 1 will be restricted to 200K per domain\n  ownedPermanents: [],\n  permanentsQueue: [],\n  expertsQueue: [],\n  cart: [],\n  recentPurchases: []\n});\n\nconst createInitialState = (): Omit<GameState, 'teams'> & { teams: Record<Team, TeamState>; turnStatistics: TurnStatistics[]; sessionInfo: SessionInfo; activeDatabaseSession: string | null } => {\n  const natoTeam = createInitialTeamState();\n  const russiaTeam = createInitialTeamState();\n  \n  return {\n    turn: 1,\n    maxTurns: 7,\n    currentTeam: 'NATO',\n    teams: {\n      NATO: natoTeam,\n      Russia: russiaTeam\n    },\n    phase: 'purchase',\n    strategyLog: [{\n      turn: 1,\n      team: 'NATO',\n      action: sanitizeText('Strategy initiated - Turn 1 begins'),\n      timestamp: new Date()\n    }],\n    sessionInfo: {\n      sessionName: '',\n      participants: [{ name: '', country: '' }, { name: '', country: '' }]\n    },\n    turnStatistics: [{\n      turn: 1,\n      natoTotalDeterrence: natoTeam.totalDeterrence,\n      russiaTotalDeterrence: russiaTeam.totalDeterrence,\n      natoDeterrence: { ...natoTeam.deterrence },\n      russiaDeterrence: { ...russiaTeam.deterrence },\n      timestamp: new Date()\n    }],\n    activeDatabaseSession: null\n  };\n};\n\nexport const useMDDSStore = create<MDDSStore>((set, get) => ({\n  ...createInitialState(),\n  selectedCard: null,\n  activeDatabaseSession: null,\n  showLoginScreen: true,\n\n  setSelectedCard: (card) => set({ selectedCard: card }),\n  \n  setShowLoginScreen: (show) => set({ showLoginScreen: show }),\n\n  setCurrentTeam: (team) => {\n    set({ currentTeam: team });\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  addToCart: (team, card) => {\n    set((state) => {\n      const newTeams = { ...state.teams };\n      newTeams[team] = {\n        ...newTeams[team],\n        cart: [...newTeams[team].cart, card]\n      };\n      return { teams: newTeams };\n    });\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  removeFromCart: (team, cardId) => {\n    set((state) => {\n      const newTeams = { ...state.teams };\n      newTeams[team] = {\n        ...newTeams[team],\n        cart: newTeams[team].cart.filter(card => card.id !== cardId)\n      };\n      return { teams: newTeams };\n    });\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  commitTeamPurchases: (team) => {\n    set((state) => {\n      const newState = commitPurchases(state, team);\n      return { ...newState };\n    });\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  advanceGameTurn: () => {\n    set((state) => {\n      // Save deterrence statistics for CURRENT turn BEFORE advancing\n      const currentTurnStatistics: TurnStatistics = {\n        turn: state.turn,\n        natoTotalDeterrence: state.teams.NATO.totalDeterrence,\n        russiaTotalDeterrence: state.teams.Russia.totalDeterrence,\n        natoDeterrence: { ...state.teams.NATO.deterrence },\n        russiaDeterrence: { ...state.teams.Russia.deterrence },\n        timestamp: new Date()\n      };\n      \n      // Now advance to next turn\n      const newState = advanceTurn(state);\n      \n      // Update statistics array with the saved current turn data\n      const updatedStatistics = [...state.turnStatistics];\n      const existingIndex = updatedStatistics.findIndex(s => s.turn === currentTurnStatistics.turn);\n      \n      if (existingIndex >= 0) {\n        // Update existing entry for this turn\n        updatedStatistics[existingIndex] = currentTurnStatistics;\n      } else {\n        // Add new entry\n        updatedStatistics.push(currentTurnStatistics);\n      }\n      \n      return { \n        ...newState, \n        turnStatistics: updatedStatistics\n      };\n    });\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  resetStrategy: () => {\n    set({ ...createInitialState(), showLoginScreen: true });\n    // Clear active database session on reset\n    setTimeout(() => {\n      const state = get();\n      state.setActiveDatabaseSession(null);\n      // Save to localStorage to persist the reset state including showLoginScreen: true\n      state.saveToLocalStorage();\n    }, 0);\n  },\n\n  concludeStrategy: (team) => {\n    set((state) => ({\n      ...state,\n      strategyLog: [\n        ...state.strategyLog,\n        {\n          turn: state.turn,\n          team,\n          action: sanitizeText(`Strategy concluded by ${team}`),\n          timestamp: new Date()\n        }\n      ]\n    }));\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  // Session management functions\n  updateSessionName: (name: string) => {\n    set((state) => ({\n      sessionInfo: {\n        ...state.sessionInfo,\n        sessionName: name\n      }\n    }));\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  updateParticipant: (index: number, field: 'name' | 'country', value: string) => {\n    set((state) => ({\n      sessionInfo: {\n        ...state.sessionInfo,\n        participants: state.sessionInfo.participants.map((p, i) => \n          i === index ? { ...p, [field]: value } : p\n        )\n      }\n    }));\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  addParticipant: () => {\n    set((state) => ({\n      sessionInfo: {\n        ...state.sessionInfo,\n        participants: [...state.sessionInfo.participants, { name: '', country: '' }]\n      }\n    }));\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  removeParticipant: (index: number) => {\n    set((state) => ({\n      sessionInfo: {\n        ...state.sessionInfo,\n        participants: state.sessionInfo.participants.length > 2 \n          ? state.sessionInfo.participants.filter((_, i) => i !== index)\n          : state.sessionInfo.participants\n      }\n    }));\n    // Sync to database after state change\n    setTimeout(() => get().syncToDatabase(), 0);\n  },\n\n  setActiveDatabaseSession: (sessionName: string | null) => {\n    set({ activeDatabaseSession: sessionName });\n  },\n\n  syncToDatabase: async () => {\n    const state = get();\n    if (!state.activeDatabaseSession) return;\n\n    try {\n      const sessionData = {\n        sessionName: state.activeDatabaseSession,\n        gameState: {\n          turn: state.turn,\n          maxTurns: state.maxTurns,\n          currentTeam: state.currentTeam,\n          teams: state.teams,\n          phase: state.phase,\n          strategyLog: state.strategyLog\n        },\n        sessionInfo: state.sessionInfo,\n        turnStatistics: state.turnStatistics,\n        lastUpdated: new Date().toISOString()\n      };\n\n      const response = await fetch(`/api/sessions/${state.activeDatabaseSession}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(sessionData),\n      });\n\n      if (!response.ok) {\n        console.error('Failed to sync to database:', response.statusText);\n      }\n    } catch (error) {\n      console.error('Error syncing to database:', error);\n    }\n  },\n\n  saveToLocalStorage: () => {\n    const state = get();\n    const saveData = {\n      turn: state.turn,\n      maxTurns: state.maxTurns,\n      currentTeam: state.currentTeam,\n      teams: state.teams,\n      phase: state.phase,\n      strategyLog: state.strategyLog,\n      turnStatistics: state.turnStatistics,\n      sessionInfo: state.sessionInfo,\n      showLoginScreen: state.showLoginScreen\n    };\n    localStorage.setItem('mdds-strategy', JSON.stringify(saveData));\n  },\n\n  loadFromLocalStorage: () => {\n    try {\n      const saved = localStorage.getItem('mdds-strategy');\n      if (saved) {\n        const data = JSON.parse(saved);\n        // Migrate older save states that don't have permanentsQueue\n        if (data.teams) {\n          Object.keys(data.teams).forEach(team => {\n            if (!data.teams[team].permanentsQueue) {\n              data.teams[team].permanentsQueue = [];\n            }\n          });\n        }\n        const currentState = get();\n        set({\n          ...data,\n          sessionInfo: data.sessionInfo ? {\n            sessionName: data.sessionInfo.sessionName || '',\n            participants: data.sessionInfo.participants && data.sessionInfo.participants.length > 0 \n              ? data.sessionInfo.participants\n              : currentState.sessionInfo.participants\n          } : currentState.sessionInfo,\n          showLoginScreen: data.showLoginScreen !== undefined ? data.showLoginScreen : false // Use saved value or default to false if there's saved data\n        });\n        return true;\n      }\n      // Show login screen if no saved data\n      set({ showLoginScreen: true });\n      return false;\n    } catch {\n      set({ showLoginScreen: true });\n      return false;\n    }\n  },\n\n  exportState: () => {\n    const state = get();\n    const exportData = {\n      turn: state.turn,\n      maxTurns: state.maxTurns,\n      currentTeam: state.currentTeam,\n      teams: state.teams,\n      phase: state.phase,\n      strategyLog: state.strategyLog,\n      turnStatistics: state.turnStatistics,\n      sessionInfo: state.sessionInfo,\n      exportedAt: new Date().toISOString()\n    };\n    return JSON.stringify(exportData, null, 2);\n  },\n\n  importState: (jsonState) => {\n    try {\n      const data = JSON.parse(jsonState);\n      // Migrate older save states that don't have permanentsQueue\n      if (data.teams) {\n        Object.keys(data.teams).forEach(team => {\n          if (!data.teams[team].permanentsQueue) {\n            data.teams[team].permanentsQueue = [];\n          }\n        });\n      }\n      const currentState = get();\n      set({\n        turn: data.turn,\n        maxTurns: data.maxTurns,\n        currentTeam: data.currentTeam,\n        teams: data.teams,\n        phase: data.phase,\n        strategyLog: data.strategyLog,\n        turnStatistics: data.turnStatistics || [],\n        sessionInfo: data.sessionInfo ? {\n          sessionName: data.sessionInfo.sessionName || '',\n          participants: data.sessionInfo.participants && data.sessionInfo.participants.length > 0 \n            ? data.sessionInfo.participants\n            : currentState.sessionInfo.participants\n        } : currentState.sessionInfo\n      });\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}));","size_bytes":12539},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/examples/TurnController.tsx":{"content":"import TurnController from '../TurnController';\n\nexport default function TurnControllerExample() {\n  const validationErrors = [\n    'Economy domain must have exactly 200K (currently 150K)',\n    'Space domain must have exactly 200K (currently 250K)'\n  ];\n\n  return (\n    <div className=\"max-w-md\">\n      <TurnController\n        currentTurn={1}\n        maxTurns={8}\n        currentTeam=\"NATO\"\n        phase=\"purchase\"\n        onCommitPurchases={() => console.log('Commit purchases')}\n        onAdvanceTurn={() => console.log('Advance turn')}\n        onUndoLastCommit={() => console.log('Undo last commit')}\n        canCommit={true}\n        canAdvance={false}\n        validationErrors={validationErrors}\n      />\n    </div>\n  );\n}","size_bytes":727},"client/src/components/examples/CardShop.tsx":{"content":"import CardShop from '../CardShop';\nimport { Card } from '@shared/schema';\n\nexport default function CardShopExample() {\n  const sampleCards: Card[] = [\n    {\n      id: \"J1\",\n      name: \"Strategic Command Center\",\n      domain: \"joint\",\n      type: \"asset\", \n      baseCostK: 150,\n      effects: [{ target: \"self\", domain: \"joint\", delta: 15 }]\n    },\n    {\n      id: \"E1\", \n      name: \"Economic Sanctions Package\",\n      domain: \"economy\",\n      type: \"asset\",\n      baseCostK: 120\n    },\n    {\n      id: \"CY1\",\n      name: \"Cyber Defense Grid\", \n      domain: \"cyber\",\n      type: \"permanent\",\n      baseCostK: 140,\n      permanentMods: {\n        flatDiscountK: 50,\n        appliesToCardIds: [\"CY3\", \"CY5\"]\n      }\n    },\n    {\n      id: \"S1\",\n      name: \"Space Strategic Advisor\",\n      domain: \"space\", \n      type: \"expert\",\n      baseCostK: 100,\n      expertInfo: \"Provides space domain strategic guidance\"\n    }\n  ];\n\n  const cartItems = [sampleCards[0]]; // J1 is in cart\n\n  return (\n    <div className=\"max-w-6xl\">\n      <CardShop\n        cards={sampleCards}\n        onAddToCart={(card) => console.log('Add to cart:', card.id)}\n        onViewDetails={(card) => console.log('View details:', card.id)}\n        cartItems={cartItems}\n        getDiscountedPrice={(card) => card.baseCostK - 10} // 10K discount simulation\n      />\n    </div>\n  );\n}","size_bytes":1353},"client/src/logic/guards.ts":{"content":"// Forbidden words guard - replaces \"game\" and \"operation\" with \"strategy\"\nexport function sanitizeText(text: string): string {\n  return text\n    .replace(/\\bgame\\b/gi, 'strategy')\n    .replace(/\\boperation\\b/gi, 'strategy');\n}\n\n// Runtime text sanitization for rendered content\nexport function sanitizeForDisplay(element: HTMLElement) {\n  const walker = document.createTreeWalker(\n    element,\n    NodeFilter.SHOW_TEXT,\n    null\n  );\n\n  const textNodes: Text[] = [];\n  let node;\n  \n  while (node = walker.nextNode()) {\n    textNodes.push(node as Text);\n  }\n\n  textNodes.forEach(textNode => {\n    const originalText = textNode.textContent || '';\n    const sanitizedText = sanitizeText(originalText);\n    if (originalText !== sanitizedText) {\n      textNode.textContent = sanitizedText;\n    }\n  });\n}\n\n// Build-time guard to check for forbidden words in static strings\nexport function validateNoForbiddenWords(content: string): boolean {\n  const forbiddenPattern = /\\b(game|operation)\\b/gi;\n  return !forbiddenPattern.test(content);\n}","size_bytes":1033},"client/src/pages/SinglePlayerGame.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { useMDDSStore } from '../state/store';\nimport { applyDomainQuotas } from '../logic/filters';\nimport { calculateDiscountedPrice, calculateCartTotal } from '../logic/pricing';\nimport { validateTurn1Restrictions, validatePooledBudget } from '../logic/turnEngine';\nimport AppHeader from '../components/AppHeader';\nimport TeamPanel from '../components/TeamPanel';\nimport CardShop from '../components/CardShop';\nimport CardDetailModal from '../components/CardDetailModal';\nimport { SkipForward, FileCheck, Eye, EyeOff } from 'lucide-react';\nimport { Button } from \"@/components/ui/button\";\nimport DeterrenceChart from '../components/DeterrenceChart';\nimport CartDisplay from '../components/CartDisplay';\nimport TurnBasedLogs from '../components/Statistics';\nimport DomainStatistics from '../components/DomainStatistics';\nimport cardsData from '../data/cards.json';\nimport { Card, Domain } from '@shared/schema';\nimport { generateMDDSReport, generateMDDSReportBase64 } from '../utils/pdfGenerator';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function SinglePlayerGame() {\n  const store = useMDDSStore();\n  const currentTeam = useMDDSStore(state => state.currentTeam);\n  const phase = useMDDSStore(state => state.phase);\n  const turn = useMDDSStore(state => state.turn);\n  const [, setLocation] = useLocation();\n  const [availableCards, setAvailableCards] = useState(applyDomainQuotas(cardsData as Card[]));\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\n  const [showFinishDialog, setShowFinishDialog] = useState(false);\n  const [isFinishing, setIsFinishing] = useState(false);\n  const [showShopAndCarts, setShowShopAndCarts] = useState(true);\n  const [isAIThinking, setIsAIThinking] = useState(false);\n  const { toast } = useToast();\n\n  // Initialize single-player session\n  useEffect(() => {\n    const initSession = async () => {\n      try {\n        // Check if Skip Turn 1 was selected\n        const urlParams = new URLSearchParams(window.location.search);\n        const skipTurn1 = urlParams.get('skipTurn1') === 'true';\n        \n        const sessionName = `AI Strategy ${new Date().toLocaleString()}`;\n        store.updateSessionName(sessionName);\n        \n        // If Skip Turn 1, advance to Turn 2 before creating session\n        if (skipTurn1) {\n          store.advanceGameTurn();\n        }\n        \n        // Get fresh state after potential turn advancement\n        const currentState = useMDDSStore.getState();\n        \n        // Create database session with current turn state\n        await apiRequest('POST', '/api/sessions', {\n          sessionName: sessionName,\n          gameState: {\n            turn: currentState.turn,\n            maxTurns: currentState.maxTurns,\n            currentTeam: currentState.currentTeam,\n            teams: currentState.teams,\n            phase: currentState.phase,\n            strategyLog: currentState.strategyLog\n          },\n          sessionInfo: currentState.sessionInfo,\n          turnStatistics: currentState.turnStatistics,\n          lastUpdated: new Date().toISOString()\n        });\n\n        store.setActiveDatabaseSession(sessionName);\n        await store.syncToDatabase();\n        store.saveToLocalStorage();\n      } catch (err) {\n        console.error('Error creating single-player session:', err);\n        toast({\n          title: \"Session Error\",\n          description: \"Failed to create AI strategy session\",\n          variant: \"destructive\"\n        });\n      }\n    };\n\n    initSession();\n  }, []);\n\n  // AI logic - automatically plays when it's Russia's turn\n  useEffect(() => {\n    console.log('[AI Effect] Team:', currentTeam, 'Phase:', phase, 'isAIThinking:', isAIThinking);\n    if (currentTeam === 'Russia' && phase === 'purchase' && !isAIThinking) {\n      console.log('[AI Effect] Triggering AI decision...');\n      setIsAIThinking(true);\n      \n      // Delay AI action for realism\n      setTimeout(() => {\n        makeAIDecision();\n      }, 1500);\n    }\n  }, [currentTeam, phase, isAIThinking]);\n\n  const makeAIDecision = () => {\n    const russiaState = store.teams.Russia;\n    const natoState = store.teams.NATO;\n    const budget = russiaState.budget;\n    const turn = store.turn;\n    \n    // Filter available cards for Russia\n    const russiaAvailableCards = availableCards.filter(card => {\n      const price = calculateDiscountedPrice(card, russiaState.ownedPermanents);\n      return price <= budget && (card.baseCostK <= 200 || turn >= 2);\n    });\n\n    if (russiaAvailableCards.length === 0) {\n      // No cards available, commit empty cart\n      setTimeout(() => {\n        handleCommitPurchases();\n      }, 500);\n      return;\n    }\n\n    // Calculate deterrence gaps per domain (NATO score - Russia score)\n    const domains: Domain[] = ['joint', 'economy', 'cognitive', 'space', 'cyber'];\n    const gaps: Record<Domain, number> = {\n      joint: natoState.deterrence.joint - russiaState.deterrence.joint,\n      economy: natoState.deterrence.economy - russiaState.deterrence.economy,\n      cognitive: natoState.deterrence.cognitive - russiaState.deterrence.cognitive,\n      space: natoState.deterrence.space - russiaState.deterrence.space,\n      cyber: natoState.deterrence.cyber - russiaState.deterrence.cyber,\n    };\n\n    // Sort domains by gap (prioritize where Russia is furthest behind)\n    const domainsByGap = domains.sort((a, b) => gaps[b] - gaps[a]);\n\n    // Helper to calculate card impact score\n    const getCardImpact = (card: Card): number => {\n      if (!card.effects) return 0;\n      return card.effects.reduce((sum, effect) => {\n        // Positive for self-benefits, negative for opponent penalties\n        return sum + Math.abs(effect.delta);\n      }, 0);\n    };\n\n    // AI Strategy: Balance deterrence to stay competitive with NATO\n    let selectedCards: Card[] = [];\n    let remainingBudget = budget;\n\n    // Turn 1: Must spend exactly 200K per domain, but prioritize gap-closing\n    if (turn === 1) {\n      for (const domain of domains) {\n        const domainCards = russiaAvailableCards\n          .filter(c => c.domain === domain)\n          .sort((a, b) => {\n            // Prioritize cards with better deterrence impact\n            const aImpact = getCardImpact(a);\n            const bImpact = getCardImpact(b);\n            \n            // Favor permanents slightly, but prioritize impact\n            const aScore = aImpact + (a.type === 'permanent' ? 5 : 0);\n            const bScore = bImpact + (b.type === 'permanent' ? 5 : 0);\n            \n            return bScore - aScore;\n          });\n\n        let domainBudget = 200;\n        for (const card of domainCards) {\n          const price = calculateDiscountedPrice(card, russiaState.ownedPermanents);\n          if (price <= domainBudget) {\n            selectedCards.push(card);\n            domainBudget -= price;\n            \n            if (domainBudget === 0) break;\n          }\n        }\n      }\n    } else {\n      // Turn 2+: Balanced strategy targeting gap closure\n      // Prioritize domains where Russia is behind\n      for (const domain of domainsByGap) {\n        const domainGap = gaps[domain];\n        \n        // Skip if Russia is significantly ahead in this domain\n        if (domainGap < -10) continue;\n\n        const domainCards = russiaAvailableCards\n          .filter(c => c.domain === domain && !selectedCards.includes(c))\n          .sort((a, b) => {\n            // Score cards by deterrence impact and gap-closing potential\n            const aImpact = getCardImpact(a);\n            const bImpact = getCardImpact(b);\n            \n            // Favor permanents for long-term value\n            const aScore = aImpact + (a.type === 'permanent' ? 8 : 0);\n            const bScore = bImpact + (b.type === 'permanent' ? 8 : 0);\n            \n            return bScore - aScore;\n          });\n\n        // Allocate budget proportional to gap size\n        const budgetForDomain = domainGap > 0 ? Math.min(remainingBudget * 0.3, 400) : Math.min(remainingBudget * 0.15, 200);\n\n        for (const card of domainCards) {\n          const price = calculateDiscountedPrice(card, russiaState.ownedPermanents);\n          if (price <= remainingBudget && price <= budgetForDomain) {\n            selectedCards.push(card);\n            remainingBudget -= price;\n            break;\n          }\n        }\n\n        if (remainingBudget < 50) break;\n      }\n    }\n\n    // Add cards to Russia's cart\n    selectedCards.forEach(card => {\n      store.addToCart('Russia', card);\n    });\n\n    // Commit purchases after a short delay\n    setTimeout(() => {\n      handleCommitPurchases();\n    }, 1000);\n  };\n\n  const handleSave = () => {\n    store.saveToLocalStorage();\n    toast({\n      title: \"Saved\",\n      description: \"Strategy state saved successfully\",\n    });\n  };\n\n  const handleResetProgress = () => {\n    if (confirm('Are you sure you want to reset? This will clear all progress.')) {\n      store.resetStrategy();\n      store.saveToLocalStorage();\n      toast({\n        title: \"Reset\",\n        description: \"Strategy has been reset\",\n      });\n    }\n  };\n\n  const handleSetMaxTurns = (turns: number) => {\n    // Max turns setter logic would go here\n    toast({\n      title: \"Max Turns Updated\",\n      description: `Maximum turns set to ${turns}`,\n    });\n  };\n\n  const handleDownloadPDF = async () => {\n    try {\n      await generateMDDSReport({\n        currentTurn: store.turn,\n        maxTurns: store.maxTurns,\n        natoTeam: store.teams.NATO,\n        russiaTeam: store.teams.Russia,\n        turnStatistics: store.turnStatistics,\n        strategyLog: store.strategyLog,\n        sessionInfo: store.sessionInfo\n      });\n      toast({\n        title: \"PDF Generated\",\n        description: \"Strategy report downloaded successfully\",\n      });\n    } catch (error) {\n      console.error('Error generating PDF:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to generate PDF report\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleFinishGameSession = async () => {\n    setShowFinishDialog(true);\n  };\n\n  const confirmFinishSession = async () => {\n    setIsFinishing(true);\n    try {\n      const pdfBase64 = await generateMDDSReportBase64({\n        currentTurn: store.turn,\n        maxTurns: store.maxTurns,\n        natoTeam: store.teams.NATO,\n        russiaTeam: store.teams.Russia,\n        turnStatistics: store.turnStatistics,\n        strategyLog: store.strategyLog,\n        sessionInfo: store.sessionInfo\n      });\n      \n      if (!store.activeDatabaseSession) {\n        throw new Error('No active database session');\n      }\n\n      await apiRequest('PUT', `/api/sessions/${encodeURIComponent(store.activeDatabaseSession)}`, {\n        finalReport: pdfBase64,\n        gameState: {\n          turn: store.turn,\n          maxTurns: store.maxTurns,\n          currentTeam: store.currentTeam,\n          teams: store.teams,\n          phase: store.phase,\n          strategyLog: store.strategyLog\n        },\n        sessionInfo: store.sessionInfo,\n        turnStatistics: store.turnStatistics,\n        lastUpdated: new Date().toISOString()\n      });\n\n      toast({\n        title: \"Session Finished\",\n        description: \"AI strategy session has been completed and saved\",\n      });\n\n      store.resetStrategy();\n      store.saveToLocalStorage();\n      setLocation('/');\n    } catch (error) {\n      console.error('Error finishing session:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to finish session\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsFinishing(false);\n      setShowFinishDialog(false);\n    }\n  };\n\n  const handleCommitPurchases = () => {\n    console.log('[Commit] Starting commit for team:', store.currentTeam, 'turn:', store.turn);\n    const errors: string[] = [];\n\n    if (store.currentTeam === 'NATO') {\n      const natoCart = store.teams.NATO.cart;\n      const natoState = store.teams.NATO;\n\n      if (store.turn === 1) {\n        const validation = validateTurn1Restrictions(natoCart, natoState);\n        errors.push(...validation.errors);\n      } else {\n        const validation = validatePooledBudget(natoCart, natoState);\n        errors.push(...validation.errors);\n      }\n    } else {\n      const russiaCart = store.teams.Russia.cart;\n      const russiaState = store.teams.Russia;\n\n      if (store.turn === 1) {\n        const validation = validateTurn1Restrictions(russiaCart, russiaState);\n        errors.push(...validation.errors);\n      } else {\n        const validation = validatePooledBudget(russiaCart, russiaState);\n        errors.push(...validation.errors);\n      }\n    }\n\n    if (errors.length === 0) {\n      console.log('[Commit] Validation passed, committing purchases');\n      store.commitTeamPurchases(store.currentTeam);\n      setValidationErrors([]);\n      \n      if (store.currentTeam === 'NATO') {\n        console.log('[Commit] NATO committed, switching to Russia in 500ms...');\n        // After NATO commits, switch to Russia (which will trigger AI)\n        setTimeout(() => {\n          console.log('[Commit] Switching team to Russia');\n          store.setCurrentTeam('Russia');\n        }, 500);\n      } else if (store.currentTeam === 'Russia') {\n        console.log('[Commit] Russia committed, advancing turn and switching to NATO in 500ms...');\n        // AI automatically advances turn after committing\n        setTimeout(() => {\n          console.log('[Commit] Advancing turn and switching to NATO');\n          store.advanceGameTurn();\n          store.setCurrentTeam('NATO');\n          setIsAIThinking(false); // Reset after team switch to prevent re-trigger\n        }, 500);\n      }\n    } else {\n      console.log('[Commit] Validation failed:', errors);\n      setValidationErrors(errors);\n      if (store.currentTeam === 'Russia') {\n        setIsAIThinking(false);\n      }\n    }\n  };\n\n  const handleAdvanceTurn = () => {\n    store.advanceGameTurn();\n    setValidationErrors([]);\n  };\n\n  const canCommit = store.phase === 'purchase';\n  const canAdvance = store.phase === 'commit';\n\n  const natoState = store.teams.NATO;\n  const russiaState = store.teams.Russia;\n\n  return (\n    <div className=\"min-h-screen p-4 lg:p-6 space-y-6 max-w-[1600px] mx-auto\">\n      <AppHeader\n        currentTurn={store.turn}\n        maxTurns={store.maxTurns}\n        onSave={handleSave}\n        onResetProgress={handleResetProgress}\n        onSetMaxTurns={handleSetMaxTurns}\n        onDownloadPDF={handleDownloadPDF}\n        onFinishGameSession={handleFinishGameSession}\n        showShopAndCarts={showShopAndCarts}\n        onToggleShopAndCarts={() => setShowShopAndCarts(!showShopAndCarts)}\n      />\n\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-xl font-bold\">Single Player vs AI</h2>\n          {isAIThinking && (\n            <div className=\"flex items-center gap-2 text-muted-foreground\">\n              <div className=\"animate-spin h-4 w-4 border-2 border-primary border-t-transparent rounded-full\"></div>\n              <span>AI is thinking...</span>\n            </div>\n          )}\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n          <TeamPanel \n            team=\"NATO\" \n            teamState={natoState}\n            isActive={store.currentTeam === 'NATO'}\n            currentTurn={store.turn}\n          />\n          <TeamPanel \n            team=\"Russia\" \n            teamState={russiaState}\n            isActive={store.currentTeam === 'Russia'}\n            currentTurn={store.turn}\n          />\n        </div>\n\n        <DeterrenceChart natoTeam={natoState} russiaTeam={russiaState} />\n\n        {showShopAndCarts && (\n          <>\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n              <CartDisplay\n                team=\"NATO\"\n                cartItems={natoState.cart}\n                onRemoveFromCart={(cardId) => store.removeFromCart('NATO', cardId)}\n                getDiscountedPrice={(card) => calculateDiscountedPrice(card, natoState.ownedPermanents)}\n                cartTotal={calculateCartTotal(natoState.cart, natoState.ownedPermanents)}\n                onConfirmPurchases={handleCommitPurchases}\n                canConfirm={canCommit && store.currentTeam === 'NATO'}\n                budget={natoState.budget}\n              />\n              <CartDisplay\n                team=\"Russia\"\n                cartItems={russiaState.cart}\n                onRemoveFromCart={(cardId) => store.removeFromCart('Russia', cardId)}\n                getDiscountedPrice={(card) => calculateDiscountedPrice(card, russiaState.ownedPermanents)}\n                cartTotal={calculateCartTotal(russiaState.cart, russiaState.ownedPermanents)}\n                canConfirm={false}\n                budget={russiaState.budget}\n              />\n            </div>\n\n            <CardShop\n              cards={availableCards}\n              onAddToCart={(card) => store.addToCart('NATO', card)}\n              onViewDetails={(card) => store.setSelectedCard(card)}\n              cartItems={natoState.cart}\n              natoCartItems={natoState.cart}\n              russiaCartItems={russiaState.cart}\n              getDiscountedPrice={(card) => calculateDiscountedPrice(card, natoState.ownedPermanents)}\n              getNATOPrice={(card) => calculateDiscountedPrice(card, natoState.ownedPermanents)}\n              getRussiaPrice={(card) => calculateDiscountedPrice(card, russiaState.ownedPermanents)}\n              disabled={store.currentTeam !== 'NATO' || store.phase !== 'purchase'}\n              onAddToNATOCart={(card) => store.addToCart('NATO', card)}\n              onAddToRussiaCart={() => {}}\n              currentTurn={store.turn}\n              natoTeamState={natoState}\n              russiaTeamState={russiaState}\n            />\n          </>\n        )}\n\n        <div className=\"glass-card p-6 space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Turn Control</h3>\n          {isAIThinking && (\n            <div className=\"bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-md p-3\" data-testid=\"ai-thinking-indicator\">\n              <p className=\"text-sm text-yellow-600 dark:text-yellow-400\">AI is thinking...</p>\n            </div>\n          )}\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <div className=\"text-sm text-muted-foreground\" data-testid=\"text-current-turn\">Current Turn: {store.turn}/{store.maxTurns}</div>\n              <div className=\"text-sm text-muted-foreground\" data-testid=\"text-current-phase\">Phase: {store.phase}</div>\n              <div className=\"text-sm text-muted-foreground\" data-testid=\"text-current-team\">Current Team: {store.currentTeam}</div>\n            </div>\n            <div className=\"flex gap-2\">\n              {canCommit && store.currentTeam === 'NATO' && (\n                <Button \n                  onClick={handleCommitPurchases} \n                  disabled={isAIThinking}\n                  data-testid=\"button-commit-purchases\"\n                >\n                  <FileCheck className=\"w-4 h-4 mr-2\" />\n                  Commit Purchases\n                </Button>\n              )}\n              {canAdvance && (\n                <Button \n                  onClick={handleAdvanceTurn} \n                  disabled={isAIThinking}\n                  data-testid=\"button-advance-turn\"\n                >\n                  <SkipForward className=\"w-4 h-4 mr-2\" />\n                  Advance Turn\n                </Button>\n              )}\n            </div>\n          </div>\n          {validationErrors.length > 0 && (\n            <div className=\"bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-md p-3\">\n              {validationErrors.map((error, idx) => (\n                <p key={idx} className=\"text-sm text-red-600 dark:text-red-400\">{error}</p>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <TurnBasedLogs />\n        <DomainStatistics />\n      </div>\n\n      <CardDetailModal\n        card={store.selectedCard}\n        isOpen={!!store.selectedCard}\n        onClose={() => store.setSelectedCard(null)}\n        onAddToCart={() => {\n          if (store.selectedCard && store.currentTeam === 'NATO') {\n            store.addToCart('NATO', store.selectedCard);\n            store.setSelectedCard(null);\n          }\n        }}\n        discountedPrice={store.selectedCard ? calculateDiscountedPrice(store.selectedCard, natoState.ownedPermanents) : undefined}\n        inCart={store.selectedCard ? natoState.cart.some(c => c.id === store.selectedCard?.id) : false}\n        disabled={store.phase !== 'purchase' || store.currentTeam !== 'NATO'}\n      />\n\n      <AlertDialog open={showFinishDialog} onOpenChange={setShowFinishDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Finish AI Strategy Session</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to finish this session? A PDF report will be generated and the session will be saved to the database.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={isFinishing}>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={confirmFinishSession} disabled={isFinishing}>\n              {isFinishing ? 'Finishing...' : 'Finish Session'}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","size_bytes":21891},"DEPLOYMENT.md":{"content":"# MDDS Application Deployment Guide\n\nThis guide provides step-by-step instructions for deploying the Multi Dimension Deterrence Strategy (MDDS) application on both Windows and Linux servers.\n\n## Table of Contents\n- [Prerequisites](#prerequisites)\n- [Windows Server Deployment](#windows-server-deployment)\n- [Linux Server Deployment](#linux-server-deployment)\n- [Post-Deployment Configuration](#post-deployment-configuration)\n- [Troubleshooting](#troubleshooting)\n\n---\n\n## Prerequisites\n\nBefore deploying, ensure you have:\n- **Node.js 18 or higher** installed\n- **PostgreSQL 14 or higher** database\n- **Git** (optional, for cloning the repository)\n- At least **2GB RAM** and **5GB disk space**\n\n---\n\n## Windows Server Deployment\n\n### Step 1: Install Node.js\n\n1. Download Node.js from [https://nodejs.org](https://nodejs.org)\n2. Choose the **LTS version** (18.x or higher)\n3. Run the installer and follow the prompts\n4. Check installation by opening **Command Prompt** and running:\n   ```cmd\n   node --version\n   npm --version\n   ```\n\n### Step 2: Install PostgreSQL\n\n1. Download PostgreSQL from [https://www.postgresql.org/download/windows/](https://www.postgresql.org/download/windows/)\n2. Run the installer\n3. Set a password for the `postgres` user (remember this!)\n4. Keep the default port `5432`\n5. Complete the installation\n\n### Step 3: Create Database\n\n1. Open **pgAdmin 4** (installed with PostgreSQL)\n2. Connect to your PostgreSQL server\n3. Right-click on **Databases**  **Create**  **Database**\n4. Name it `mdds` and click **Save**\n\nAlternatively, use Command Prompt:\n```cmd\npsql -U postgres\nCREATE DATABASE mdds;\n\\q\n```\n\n### Step 4: Extract Application Files\n\n1. Extract the application ZIP file to a folder, e.g., `C:\\mdds-app`\n2. Open **Command Prompt** and navigate to the folder:\n   ```cmd\n   cd C:\\mdds-app\n   ```\n\n### Step 5: Install Dependencies\n\nRun the following command:\n```cmd\nnpm install\n```\n\nThis will install all required packages (may take 2-5 minutes).\n\n### Step 6: Configure Environment Variables\n\n1. Create a file named `.env` in the application folder\n2. Add the following content (replace values with your PostgreSQL credentials):\n\n```env\nDATABASE_URL=postgresql://postgres:your_password@localhost:5432/mdds\nPGHOST=localhost\nPGPORT=5432\nPGUSER=postgres\nPGPASSWORD=your_password\nPGDATABASE=mdds\nSESSION_SECRET=your-random-secret-key-here\nNODE_ENV=production\n```\n\n**Important:** Replace `your_password` with your actual PostgreSQL password and generate a random string for `SESSION_SECRET`.\n\n### Step 7: Initialize Database\n\nRun the database migration:\n```cmd\nnpm run db:push\n```\n\nIf you see a warning about data loss, run:\n```cmd\nnpm run db:push --force\n```\n\n### Step 8: Build the Application\n\nBuild the production version:\n```cmd\nnpm run build\n```\n\nThis creates optimized files in the `dist` folder.\n\n### Step 9: Start the Application\n\nStart the server:\n```cmd\nnpm start\n```\n\nOr for production with PM2 (recommended):\n```cmd\nnpm install -g pm2\npm2 start npm --name \"mdds\" -- start\npm2 save\npm2 startup\n```\n\nThe application will be available at `http://localhost:5000`\n\n### Step 10: Configure Windows Firewall\n\n1. Open **Windows Defender Firewall**  **Advanced Settings**\n2. Click **Inbound Rules**  **New Rule**\n3. Select **Port**  Click **Next**\n4. Select **TCP** and enter port `5000`  Click **Next**\n5. Select **Allow the connection**  Click **Next**\n6. Check all profiles (Domain, Private, Public)  Click **Next**\n7. Name it \"MDDS Application\"  Click **Finish**\n\n### Step 11: Access the Application\n\n- Local access: `http://localhost:5000`\n- Network access: `http://YOUR_SERVER_IP:5000`\n- Replace `YOUR_SERVER_IP` with your server's IP address\n\n---\n\n## Linux Server Deployment\n\n### Step 1: Update System\n\nOpen terminal and run:\n```bash\nsudo apt update\nsudo apt upgrade -y\n```\n\nFor CentOS/RHEL:\n```bash\nsudo yum update -y\n```\n\n### Step 2: Install Node.js\n\n**For Ubuntu/Debian:**\n```bash\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt install -y nodejs\n```\n\n**For CentOS/RHEL:**\n```bash\ncurl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -\nsudo yum install -y nodejs\n```\n\nVerify installation:\n```bash\nnode --version\nnpm --version\n```\n\n### Step 3: Install PostgreSQL\n\n**For Ubuntu/Debian:**\n```bash\nsudo apt install -y postgresql postgresql-contrib\nsudo systemctl start postgresql\nsudo systemctl enable postgresql\n```\n\n**For CentOS/RHEL:**\n```bash\nsudo yum install -y postgresql-server postgresql-contrib\nsudo postgresql-setup initdb\nsudo systemctl start postgresql\nsudo systemctl enable postgresql\n```\n\n### Step 4: Create Database and User\n\nSwitch to postgres user:\n```bash\nsudo -u postgres psql\n```\n\nRun the following SQL commands:\n```sql\nCREATE DATABASE mdds;\nCREATE USER mdds_user WITH PASSWORD 'your_secure_password';\nGRANT ALL PRIVILEGES ON DATABASE mdds TO mdds_user;\n\\q\n```\n\n### Step 5: Configure PostgreSQL Authentication\n\nEdit the PostgreSQL configuration:\n```bash\nsudo nano /etc/postgresql/14/main/pg_hba.conf\n```\n\nFind the line:\n```\nlocal   all             all                                     peer\n```\n\nChange it to:\n```\nlocal   all             all                                     md5\n```\n\nRestart PostgreSQL:\n```bash\nsudo systemctl restart postgresql\n```\n\n### Step 6: Extract Application Files\n\nUpload the ZIP file to your server and extract:\n```bash\ncd /var/www\nsudo mkdir mdds-app\nsudo chown $USER:$USER mdds-app\ncd mdds-app\nunzip /path/to/mdds-app.zip\n```\n\nOr clone from Git (if available):\n```bash\ngit clone <repository-url> /var/www/mdds-app\ncd /var/www/mdds-app\n```\n\n### Step 7: Install Dependencies\n\n```bash\nnpm install\n```\n\n### Step 8: Configure Environment Variables\n\nCreate `.env` file:\n```bash\nnano .env\n```\n\nAdd the following:\n```env\nDATABASE_URL=postgresql://mdds_user:your_secure_password@localhost:5432/mdds\nPGHOST=localhost\nPGPORT=5432\nPGUSER=mdds_user\nPGPASSWORD=your_secure_password\nPGDATABASE=mdds\nSESSION_SECRET=your-random-secret-key-here\nNODE_ENV=production\n```\n\nSave and exit (Ctrl+X, then Y, then Enter).\n\n### Step 9: Initialize Database\n\n```bash\nnpm run db:push\n```\n\nIf needed:\n```bash\nnpm run db:push --force\n```\n\n### Step 10: Build the Application\n\n```bash\nnpm run build\n```\n\n### Step 11: Install PM2 (Process Manager)\n\n```bash\nsudo npm install -g pm2\n```\n\n### Step 12: Start the Application\n\n```bash\npm2 start npm --name \"mdds\" -- start\npm2 save\npm2 startup\n```\n\nFollow the command output to set up PM2 to start on boot.\n\n### Step 13: Configure Firewall\n\n**For Ubuntu/Debian (UFW):**\n```bash\nsudo ufw allow 5000/tcp\nsudo ufw reload\n```\n\n**For CentOS/RHEL (firewalld):**\n```bash\nsudo firewall-cmd --permanent --add-port=5000/tcp\nsudo firewall-cmd --reload\n```\n\n### Step 14: Set Up Nginx Reverse Proxy (Optional but Recommended)\n\nInstall Nginx:\n```bash\nsudo apt install -y nginx  # Ubuntu/Debian\n# OR\nsudo yum install -y nginx  # CentOS/RHEL\n```\n\nCreate Nginx configuration:\n```bash\nsudo nano /etc/nginx/sites-available/mdds\n```\n\nAdd the following:\n```nginx\nserver {\n    listen 80;\n    server_name your-domain.com;  # Replace with your domain or IP\n\n    location / {\n        proxy_pass http://localhost:5000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n```\n\nEnable the site:\n```bash\nsudo ln -s /etc/nginx/sites-available/mdds /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\n```\n\n### Step 15: Access the Application\n\n- Direct access: `http://YOUR_SERVER_IP:5000`\n- Via Nginx: `http://YOUR_SERVER_IP` or `http://your-domain.com`\n\n---\n\n## Post-Deployment Configuration\n\n### Setting Up SSL/HTTPS (Linux with Nginx)\n\n1. Install Certbot:\n```bash\nsudo apt install -y certbot python3-certbot-nginx\n```\n\n2. Obtain SSL certificate:\n```bash\nsudo certbot --nginx -d your-domain.com\n```\n\n3. Follow the prompts to complete setup\n\n### Managing the Application\n\n**View logs:**\n```bash\npm2 logs mdds\n```\n\n**Restart application:**\n```bash\npm2 restart mdds\n```\n\n**Stop application:**\n```bash\npm2 stop mdds\n```\n\n**View status:**\n```bash\npm2 status\n```\n\n**Monitor resources:**\n```bash\npm2 monit\n```\n\n### Default Credentials and Passwords\n\n- **Database Password**: Password for \"MDDS\" (database access settings dialog)\n- **Single Player Password**: \"MDDS\"\n- **Research Dashboard**: No password required\n- **Analysis Dashboard**: No password required\n\n---\n\n## Troubleshooting\n\n### Database Connection Issues\n\n**Problem:** Cannot connect to database\n\n**Solution:**\n1. Check PostgreSQL is running:\n   - Windows: Services  PostgreSQL\n   - Linux: `sudo systemctl status postgresql`\n\n2. Verify `.env` file has correct credentials\n3. Test database connection:\n   ```bash\n   psql -U mdds_user -d mdds -h localhost\n   ```\n\n### Port Already in Use\n\n**Problem:** Port 5000 is already taken\n\n**Solution:**\n1. Find what's using the port:\n   - Windows: `netstat -ano | findstr :5000`\n   - Linux: `sudo lsof -i :5000`\n\n2. Change the port in the application by editing `server/index.ts`:\n   ```typescript\n   const PORT = process.env.PORT || 3000;  // Change from 5000\n   ```\n\n3. Rebuild and restart the application\n\n### Application Crashes on Startup\n\n**Problem:** Application fails to start\n\n**Solution:**\n1. Check logs:\n   ```bash\n   pm2 logs mdds --lines 50\n   ```\n\n2. Verify Node.js version:\n   ```bash\n   node --version  # Should be 18+\n   ```\n\n3. Reinstall dependencies:\n   ```bash\n   rm -rf node_modules package-lock.json\n   npm install\n   ```\n\n### Memory Issues\n\n**Problem:** Application runs out of memory\n\n**Solution:**\n1. Increase Node.js memory limit:\n   ```bash\n   pm2 delete mdds\n   pm2 start npm --name \"mdds\" --node-args=\"--max-old-space-size=4096\" -- start\n   ```\n\n2. Monitor memory usage:\n   ```bash\n   pm2 monit\n   ```\n\n### Missing Environment Variables\n\n**Problem:** Environment variables not loading\n\n**Solution:**\n1. Ensure `.env` file is in the root directory\n2. Check file permissions:\n   ```bash\n   chmod 600 .env\n   ```\n\n3. For PM2, use ecosystem file:\n   ```bash\n   pm2 ecosystem\n   ```\n   Edit `ecosystem.config.js` to include env variables\n\n---\n\n## Application Passwords Reference\n\n| Feature | Password | Purpose |\n|---------|----------|---------|\n| Single Player Mode | `MDDS` | Access single-player AI game |\n| Database Sessions | `MDDS` | View stored game sessions |\n| Permanent Cards Logs | `MDDS` | View card purchase history |\n\n---\n\n## System Requirements\n\n### Minimum Requirements\n- **CPU:** 2 cores\n- **RAM:** 2GB\n- **Disk:** 5GB\n- **OS:** Windows Server 2016+ or Ubuntu 18.04+\n\n### Recommended Requirements\n- **CPU:** 4 cores\n- **RAM:** 4GB\n- **Disk:** 10GB SSD\n- **OS:** Windows Server 2019+ or Ubuntu 20.04+\n\n---\n\n## Support and Maintenance\n\n### Regular Maintenance Tasks\n\n1. **Update dependencies:**\n   ```bash\n   npm update\n   npm audit fix\n   ```\n\n2. **Backup database:**\n   ```bash\n   pg_dump -U mdds_user mdds > backup_$(date +%Y%m%d).sql\n   ```\n\n3. **Monitor disk space:**\n   - Windows: Check C:\\ drive space\n   - Linux: `df -h`\n\n4. **Update Node.js when needed:**\n   - Windows: Download new installer\n   - Linux: Use NodeSource repository\n\n### Log Rotation (Linux)\n\nCreate `/etc/logrotate.d/mdds`:\n```\n/var/www/mdds-app/logs/*.log {\n    daily\n    rotate 7\n    compress\n    delaycompress\n    notifempty\n    create 0640 www-data www-data\n    sharedscripts\n    postrotate\n        pm2 reloadLogs\n    endscript\n}\n```\n\n---\n\n## Additional Notes\n\n- The application uses **port 5000** by default\n- Session data is stored in PostgreSQL database\n- Game sessions are automatically saved to the database\n- The application supports multiple concurrent users\n- All passwords are case-sensitive\n- For production use, always use HTTPS with SSL certificate\n\n---\n\n## Quick Start Summary\n\n### Windows\n```cmd\n# Install Node.js and PostgreSQL\n# Create database\npsql -U postgres -c \"CREATE DATABASE mdds;\"\n\n# Extract files and install\ncd C:\\mdds-app\nnpm install\nnpm run db:push\nnpm run build\nnpm start\n```\n\n### Linux\n```bash\n# Install Node.js and PostgreSQL\nsudo apt install -y nodejs postgresql\n\n# Create database\nsudo -u postgres psql -c \"CREATE DATABASE mdds;\"\n\n# Extract and install\ncd /var/www/mdds-app\nnpm install\nnpm run db:push\nnpm run build\npm2 start npm --name \"mdds\" -- start\n```\n\n---\n\nFor additional help or questions, refer to the application documentation or contact your system administrator.\n","size_bytes":12599},"PACKAGING.md":{"content":"# Creating Deployment Package\n\nThis guide explains how to create a deployment package (ZIP file) for the MDDS application that can be deployed on Windows or Linux servers.\n\n## What to Include in the Package\n\nThe deployment package should include:\n\n### Required Files and Folders\n```\nmdds-deployment.zip\n client/                 # Frontend source code\n server/                 # Backend source code\n shared/                 # Shared types and schemas\n package.json           # Dependencies manifest\n package-lock.json      # Locked dependency versions\n tsconfig.json          # TypeScript configuration\n vite.config.ts         # Vite build configuration\n tailwind.config.ts     # Tailwind CSS configuration\n postcss.config.js      # PostCSS configuration\n drizzle.config.ts      # Database ORM configuration\n .gitignore             # Git ignore rules\n README.md              # Application overview\n DEPLOYMENT.md          # Deployment instructions\n PACKAGING.md           # This file\n```\n\n### Optional Files\n- `.env.example` - Template for environment variables\n- `ecosystem.config.js` - PM2 configuration (if using PM2)\n\n### Files to EXCLUDE\n DO NOT include:\n- `node_modules/` - Dependencies (will be installed on server)\n- `.env` - Contains sensitive credentials\n- `dist/` - Build artifacts (will be generated on server)\n- `.git/` - Version control history\n- `*.log` - Log files\n- `.replit` - Replit-specific files\n- `.cache/` - Cache directories\n\n## Method 1: Using Git (Recommended)\n\nIf your code is in a Git repository:\n\n```bash\n# Clone the repository\ngit clone <repository-url> mdds-app\ncd mdds-app\n\n# Remove Git history (optional)\nrm -rf .git\n\n# Create .env.example\ncat > .env.example << EOF\nDATABASE_URL=postgresql://user:password@localhost:5432/mdds\nPGHOST=localhost\nPGPORT=5432\nPGUSER=your_user\nPGPASSWORD=your_password\nPGDATABASE=mdds\nSESSION_SECRET=your-random-secret-key\nNODE_ENV=production\nEOF\n\n# Create ZIP file\ncd ..\nzip -r mdds-deployment.zip mdds-app -x \"mdds-app/node_modules/*\" \"mdds-app/dist/*\" \"mdds-app/.git/*\"\n```\n\n## Method 2: Manual Packaging\n\n### On Windows\n\n1. **Prepare the folder:**\n   - Copy all source files to a new folder `mdds-deployment`\n   - Delete `node_modules` folder if present\n   - Delete `dist` folder if present\n   - Delete `.env` file if present\n\n2. **Create .env.example:**\n   ```\n   DATABASE_URL=postgresql://user:password@localhost:5432/mdds\n   PGHOST=localhost\n   PGPORT=5432\n   PGUSER=your_user\n   PGPASSWORD=your_password\n   PGDATABASE=mdds\n   SESSION_SECRET=your-random-secret-key\n   NODE_ENV=production\n   ```\n\n3. **Create ZIP file:**\n   - Right-click the `mdds-deployment` folder\n   - Select \"Send to\"  \"Compressed (zipped) folder\"\n   - Rename to `mdds-deployment.zip`\n\n### On Linux/Mac\n\n```bash\n# Prepare the folder\nmkdir mdds-deployment\ncp -r client server shared *.json *.ts *.js *.md mdds-deployment/\n\n# Create .env.example\ncat > mdds-deployment/.env.example << EOF\nDATABASE_URL=postgresql://user:password@localhost:5432/mdds\nPGHOST=localhost\nPGPORT=5432\nPGUSER=your_user\nPGPASSWORD=your_password\nPGDATABASE=mdds\nSESSION_SECRET=your-random-secret-key\nNODE_ENV=production\nEOF\n\n# Create ZIP file\nzip -r mdds-deployment.zip mdds-deployment\n```\n\n## Method 3: Using NPM Scripts\n\nAdd to `package.json`:\n\n```json\n{\n  \"scripts\": {\n    \"package\": \"npm run clean && npm run build && node scripts/package.js\",\n    \"clean\": \"rm -rf dist node_modules/.cache\"\n  }\n}\n```\n\nCreate `scripts/package.js`:\n\n```javascript\nconst { execSync } = require('child_process');\nconst fs = require('fs');\nconst path = require('path');\n\n// Files and folders to include\nconst includes = [\n  'client',\n  'server', \n  'shared',\n  'package.json',\n  'package-lock.json',\n  'tsconfig.json',\n  'vite.config.ts',\n  'tailwind.config.ts',\n  'postcss.config.js',\n  'drizzle.config.ts',\n  'README.md',\n  'DEPLOYMENT.md',\n  'PACKAGING.md',\n  '.env.example'\n];\n\n// Create temp directory\nconst tempDir = 'temp-package';\nif (fs.existsSync(tempDir)) {\n  fs.rmSync(tempDir, { recursive: true });\n}\nfs.mkdirSync(tempDir);\n\n// Copy files\nincludes.forEach(item => {\n  if (fs.existsSync(item)) {\n    const dest = path.join(tempDir, item);\n    if (fs.statSync(item).isDirectory()) {\n      execSync(`cp -r ${item} ${dest}`);\n    } else {\n      execSync(`cp ${item} ${dest}`);\n    }\n  }\n});\n\n// Create .env.example if it doesn't exist\nif (!fs.existsSync(path.join(tempDir, '.env.example'))) {\n  fs.writeFileSync(\n    path.join(tempDir, '.env.example'),\n    `DATABASE_URL=postgresql://user:password@localhost:5432/mdds\nPGHOST=localhost\nPGPORT=5432\nPGUSER=your_user\nPGPASSWORD=your_password\nPGDATABASE=mdds\nSESSION_SECRET=your-random-secret-key\nNODE_ENV=production`\n  );\n}\n\n// Create ZIP\nconst zipName = `mdds-deployment-${new Date().toISOString().split('T')[0]}.zip`;\nexecSync(`cd ${tempDir} && zip -r ../${zipName} .`);\n\n// Cleanup\nfs.rmSync(tempDir, { recursive: true });\n\nconsole.log(` Package created: ${zipName}`);\n```\n\nThen run:\n```bash\nnpm run package\n```\n\n## Verification Checklist\n\nBefore distributing the ZIP file, verify it contains:\n\n- [ ] All source code files (`client/`, `server/`, `shared/`)\n- [ ] Configuration files (`*.config.ts`, `*.config.js`)\n- [ ] `package.json` with all dependencies\n- [ ] `package-lock.json` for reproducible builds\n- [ ] `README.md` with application overview\n- [ ] `DEPLOYMENT.md` with deployment instructions\n- [ ] `.env.example` with environment variable template\n- [ ] TypeScript configuration (`tsconfig.json`)\n\nAnd does NOT contain:\n\n- [ ] `node_modules/` folder\n- [ ] `dist/` or build artifacts\n- [ ] `.env` file with real credentials\n- [ ] `.git/` folder\n- [ ] Log files or temporary files\n\n## Distribution\n\n### Upload to Server\n\n**Via SCP (Linux/Mac):**\n```bash\nscp mdds-deployment.zip user@server:/var/www/\n```\n\n**Via SFTP:**\n1. Connect to server using FileZilla or WinSCP\n2. Upload `mdds-deployment.zip`\n3. Extract on server\n\n**Via Web Upload:**\n1. Use hosting control panel file manager\n2. Upload ZIP file\n3. Extract using control panel\n\n### Download Links\n\nIf hosting the ZIP file:\n- Use a secure file hosting service\n- Provide download link with checksum\n- Include version number in filename\n\nExample filename: `mdds-deployment-v1.0.0-2025-10-14.zip`\n\n## Post-Packaging Instructions for Users\n\nInclude this message with the package:\n\n```\nMDDS Application Deployment Package\n====================================\n\nThis ZIP file contains the MDDS application ready for deployment.\n\nNEXT STEPS:\n1. Extract this ZIP file on your server\n2. Open README.md for application overview\n3. Open DEPLOYMENT.md for step-by-step deployment instructions\n4. Follow either Windows or Linux deployment guide\n5. Configure .env file with your database credentials\n\nREQUIREMENTS:\n- Node.js 18 or higher\n- PostgreSQL 14 or higher\n- 2GB RAM minimum\n- 5GB disk space\n\nFor detailed instructions, see DEPLOYMENT.md\nFor support, contact: [your-support-email]\n```\n\n## Security Best Practices\n\nWhen distributing the package:\n\n1. **Never include:**\n   - Real database passwords\n   - API keys or secrets\n   - User data or session information\n   - SSL certificates or private keys\n\n2. **Always include:**\n   - `.env.example` template\n   - Clear documentation\n   - Version information\n   - Security warnings in README\n\n3. **Verify before distribution:**\n   - No sensitive data in files\n   - No development credentials\n   - No personal information\n   - No internal URLs or IPs\n\n## Checksum Verification\n\nGenerate checksum for integrity verification:\n\n```bash\n# SHA256\nsha256sum mdds-deployment.zip > mdds-deployment.zip.sha256\n\n# MD5\nmd5sum mdds-deployment.zip > mdds-deployment.zip.md5\n```\n\nProvide checksum to users so they can verify:\n```bash\nsha256sum -c mdds-deployment.zip.sha256\n```\n\n## Updating the Package\n\nWhen creating a new version:\n\n1. Update version in `package.json`\n2. Update `README.md` with changes\n3. Create new ZIP with version number\n4. Generate new checksum\n5. Document changes in release notes\n\nExample version naming:\n- `mdds-deployment-v1.0.0.zip` - Initial release\n- `mdds-deployment-v1.1.0.zip` - Minor update\n- `mdds-deployment-v2.0.0.zip` - Major update\n\n---\n\nFor deployment instructions after extracting the package, see [DEPLOYMENT.md](DEPLOYMENT.md).\n","size_bytes":8337},"README.md":{"content":"# MDDS - Multi Dimension Deterrence Strategy\n\nAn interactive web application for strategic planning and analysis across multiple domains of deterrence, featuring NATO vs Russia strategic scenarios with turn-based mechanics, AI gameplay, and comprehensive analytics.\n\n## Features\n\n### Core Gameplay\n- **Two-Player Mode**: Strategic NATO vs Russia scenarios with turn-based mechanics\n- **Single-Player AI Mode**: Play against an intelligent AI opponent (password: MDDS)\n- **Five Strategic Domains**: Joint, Economy, Cognitive, Space, and Cyber\n- **Card System**: Three card types (Assets, Permanents, Experts) with unique effects\n- **Budget Management**: Turn-based budgets with pooled and restricted modes\n- **Deterrence Tracking**: Real-time scoring across all domains\n\n### Advanced Features\n- **Database Sessions**: Store and retrieve game sessions with password protection\n- **Analysis Dashboard**: Multi-tab interface with pattern recognition and strategic insights\n  - Generic Patternization: Discover winning strategies across 7 analysis categories\n  - Predetermined Considerations: Answer strategic questions with card statistics\n  - Ask Questions: Interactive Q&A with LLM-style responses\n  \n- **Research Dashboard**: Statistical analysis environment\n  - Hypothesis Development with smart variable recommendations\n  - Session Filtering and multi-variable selection\n  - Descriptive Statistics (N, Mean, SD, Min, Max, Range, Median, IQR)\n  - Statistical Test Recommendations (11 methodologies)\n  - Scientific Word Document Generation with APA formatting\n\n- **Mobile Interface**: Dedicated mobile views for session management\n- **PDF/Word Reports**: Generate professional research documents\n- **Strategy Logging**: Comprehensive action tracking with timestamps\n\n### Technical Features\n- Real-time state synchronization\n- PostgreSQL database integration\n- Responsive Material Design UI\n- Light/dark theme support\n- Password-protected sections\n- Automated AI decision-making with balanced strategy\n\n## Quick Start\n\n### For Users\n1. Open the application in your web browser\n2. Enter session details on the login screen\n3. Choose between Two-Player or Single-Player (password: MDDS) mode\n4. Optional: Check \"Skip Turn 1\" to start at Turn 2\n5. Make strategic purchases and advance through turns\n6. Access Analytics and Research dashboards for insights\n\n### Default Passwords\n- **Single Player Mode**: `MDDS`\n- **Database Sessions**: `MDDS`\n- **Permanent Cards Logs**: `MDDS`\n\n## Deployment\n\n **See [DEPLOYMENT.md](DEPLOYMENT.md) for complete deployment instructions**\n\n### Quick Deployment Summary\n\n#### Windows Server\n```cmd\n# Install Node.js 18+ and PostgreSQL\n# Create database\nnpm install\nnpm run db:push\nnpm run build\nnpm start\n```\n\n#### Linux Server\n```bash\n# Install Node.js 18+ and PostgreSQL\n# Create database\nnpm install\nnpm run db:push\nnpm run build\npm2 start npm --name \"mdds\" -- start\n```\n\nFor detailed step-by-step instructions, environment setup, troubleshooting, and production configuration, refer to the [DEPLOYMENT.md](DEPLOYMENT.md) guide.\n\n## System Requirements\n\n### Minimum\n- Node.js 18 or higher\n- PostgreSQL 14 or higher\n- 2GB RAM\n- 5GB disk space\n\n### Recommended\n- Node.js 20 LTS\n- PostgreSQL 15+\n- 4GB RAM\n- 10GB SSD storage\n\n## Technology Stack\n\n### Frontend\n- React 18 with TypeScript\n- Vite for development and bundling\n- Tailwind CSS + shadcn/ui components\n- Zustand for state management\n- React Query for data fetching\n- Wouter for routing\n\n### Backend\n- Express.js server\n- Drizzle ORM with PostgreSQL\n- Zod for validation\n- Session management with express-session\n\n### Analysis & Research\n- simple-statistics for statistical calculations\n- docx for Word document generation\n- Chart.js for data visualization\n- Server-side chart rendering with canvas\n\n## Project Structure\n\n```\nmdds-app/\n client/               # Frontend React application\n    src/\n       pages/       # Page components\n       components/  # Reusable UI components\n       state/       # Zustand store\n       logic/       # Game logic\n       utils/       # Utility functions\n server/              # Backend Express server\n    routes.ts        # API routes\n    storage.ts       # Database interface\n    index.ts         # Server entry point\n shared/              # Shared TypeScript types\n    schema.ts        # Database schema\n DEPLOYMENT.md        # Deployment guide\n README.md           # This file\n```\n\n## Game Mechanics\n\n### Turn Structure\n1. **Purchase Phase**: Select cards from available inventory\n2. **Commit Phase**: Finalize purchases and calculate deterrence\n3. **Advance Phase**: Move to next turn with refreshed budgets\n\n### Budget System\n- **Turn 1**: Base turn with 200K per domain (1000K total, domain-restricted)\n- **Turn 2+**: Pooled budget of 1000K (spend across any domain)\n- Permanent cards provide discounts on future purchases\n\n### Deterrence Calculation\n- Each card has effects on one or more domains\n- Effects can benefit your team or penalize opponents\n- Total deterrence determines strategic advantage\n- Final scores calculated at game conclusion\n\n## AI Strategy (Single Player)\n\nThe AI opponent uses a balanced strategy that:\n- Analyzes deterrence gaps across all domains\n- Prioritizes domains where it's falling behind\n- Selects cards based on impact value, not just cost\n- Balances permanent cards with immediate effects\n- Adapts dynamically to player decisions\n- Maintains competitive scoring for engaging gameplay\n\n## Development\n\n### Local Development\n```bash\n# Install dependencies\nnpm install\n\n# Start development server\nnpm run dev\n\n# Run database migrations\nnpm run db:push\n\n# Build for production\nnpm run build\n```\n\n### Environment Variables\nCreate a `.env` file with:\n```env\nDATABASE_URL=postgresql://user:password@localhost:5432/mdds\nPGHOST=localhost\nPGPORT=5432\nPGUSER=your_user\nPGPASSWORD=your_password\nPGDATABASE=mdds\nSESSION_SECRET=your-random-secret\nNODE_ENV=development\n```\n\n## API Endpoints\n\n- `POST /api/sessions` - Create new game session\n- `GET /api/sessions` - Get all sessions\n- `GET /api/sessions/:name` - Get specific session\n- `PUT /api/sessions/:name` - Update session\n- `POST /api/analysis/ask` - Query session data\n- `POST /api/research/generate-report` - Generate research document\n\n## Security Notes\n\n- All sensitive operations are password-protected\n- Session secrets should be randomly generated\n- Database credentials should never be committed\n- Use HTTPS in production environments\n- Keep dependencies updated regularly\n\n## Browser Support\n\n- Chrome 90+\n- Firefox 88+\n- Safari 14+\n- Edge 90+\n\n## Performance Optimization\n\n- React Query caching for API requests\n- Optimistic UI updates\n- Lazy loading for heavy components\n- Server-side chart generation\n- Database indexing on frequently queried fields\n\n## Troubleshooting\n\nCommon issues and solutions are documented in [DEPLOYMENT.md](DEPLOYMENT.md#troubleshooting).\n\nFor quick fixes:\n- **Database connection**: Check `.env` credentials and PostgreSQL service\n- **Port conflicts**: Change port in `server/index.ts`\n- **Memory issues**: Increase Node.js heap size with `--max-old-space-size`\n- **Build errors**: Clear `node_modules` and reinstall\n\n## License\n\nThis application is proprietary software for strategic planning and analysis.\n\n## Support\n\nFor deployment assistance or technical issues, refer to:\n1. [DEPLOYMENT.md](DEPLOYMENT.md) - Complete deployment guide\n2. Application logs via PM2: `pm2 logs mdds`\n3. Database logs in PostgreSQL log directory\n\n---\n\n**Version**: 1.0.0  \n**Last Updated**: October 2025\n","size_bytes":7713}},"version":2}