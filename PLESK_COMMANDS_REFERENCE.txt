# MDDS Plesk Deployment - Windows Commands Reference

Bu dosya, Plesk sunucusunda kullanƒ±lacak t√ºm deployment komutlarƒ±nƒ±n hƒ±zlƒ± referansidir.

---

## üöÄ HIZLI BA≈ûLANGA√á

### Tam Deployment (√ñnerilen)
```cmd
cd D:\httpdocs\yourdomain.com\httpdocs
npm install
npm run build
taskkill /F /IM node.exe
iisreset /restart
```

### Tek Komut ile Deployment
```cmd
cd D:\httpdocs\yourdomain.com\httpdocs && npm run plesk-deploy
```

### Interactive Menu ile
```cmd
D:\httpdocs\yourdomain.com\httpdocs\plesk-deploy.bat
```

### PowerShell ile (Daha G√º√ßl√º)
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.\plesk-deploy.ps1 -Scenario "full"
```

---

## üì¶ NPM COMMANDS

### Development
```cmd
npm run dev                    # Local geli≈ütirme (Hot reload)
```

### Build & Deployment
```cmd
npm run build                  # TypeScript'i derle, frontend build et
npm run plesk-build            # npm install + build (tam deployment)
npm run plesk-build-prod       # npm ci + build (production)
npm run plesk-start            # Production'da ba≈ülat
npm run plesk-deploy           # npm install + build + start
```

### Database
```cmd
npm run db:push                # Database schema'sƒ±nƒ± push et
```

### TypeScript Check
```cmd
npm run check                  # TypeScript syntax kontrol
```

---

## ‚öôÔ∏è IIS COMMANDS

### IIS Restart
```cmd
iisreset /restart              # IIS'i tamamen yeniden ba≈ülat
iisreset /stop                 # IIS'i durdur
iisreset /start                # IIS'i ba≈ülat
iisreset /status               # IIS durumu kontrol et
```

### Application Pool Y√∂netimi
```cmd
REM Application pool'larƒ± listele
%windir%\system32\inetsrv\appcmd list apppool

REM Belirli pool'u recycle et (yeniden ba≈ülat)
%windir%\system32\inetsrv\appcmd recycle apppool "yourdomain.com"

REM Pool'u ba≈ülat
%windir%\system32\inetsrv\appcmd start apppool "yourdomain.com"

REM Pool'u durdur
%windir%\system32\inetsrv\appcmd stop apppool "yourdomain.com"
```

### Website Y√∂netimi
```cmd
REM T√ºm websites'ƒ± listele
%windir%\system32\inetsrv\appcmd list site

REM Belirli website'ƒ± ba≈ülat
%windir%\system32\inetsrv\appcmd start site "yourdomain.com"

REM Belirli website'ƒ± durdur
%windir%\system32\inetsrv\appcmd stop site "yourdomain.com"
```

---

## üîÑ NODE.JS PROCESS MANAGEMENT

### Process Kontrol
```cmd
REM T√ºm Node.js processlerini listele
tasklist | findstr /I "node"

REM Node.js processini √∂ld√ºr (force)
taskkill /F /IM node.exe

REM Belirli port'u dinleyen process'i √∂ld√ºr (PowerShell)
Get-Process node | Stop-Process -Force
```

### Port Kontrol
```cmd
REM 3000 portunu dinleyen process'i bul
netstat -ano | findstr :3000

REM Belirli port'u dinleyen process'i √∂ld√ºr
taskkill /PID 1234 /F
```

---

## üìä MONITORING & LOGGING

### Node.js Process ƒ∞statistiƒüi
```cmd
REM Node.js process'in kullandƒ±ƒüƒ± memory ve CPU
wmic process where name="node.exe" get ProcessId, HandleCount, PageFileUsage

REM Real-time monitoring (PowerShell)
Get-Process node | Format-Table -AutoSize -Refresh
```

### IIS Logs
```cmd
REM Log dosya konumu
C:\inetpub\logs\LogFiles\

REM En son log'u a√ß
explorer C:\inetpub\logs\LogFiles\W3SVC1\
```

### iisnode Logs
```cmd
REM iisnode log konumu
explorer %SystemDrive%\iisnode\

REM Son hatalarƒ± kontrol et
dir %SystemDrive%\iisnode\*.txt /T:W /O:-D
```

### Application Logs
```cmd
REM Deployment log'u
type D:\httpdocs\yourdomain.com\httpdocs\deployment.log
```

---

## üõ†Ô∏è TROUBLESHOOTING

### 1. Node.js Processini Yeniden Ba≈ülat
```cmd
taskkill /F /IM node.exe /T
timeout /T 3 /NOBREAK
iisreset /restart
```

### 2. NPM Dependencies Sorunlarƒ±
```cmd
cd D:\httpdocs\yourdomain.com\httpdocs
npm cache clean --force
rmdir node_modules /s /q
del package-lock.json
npm install
npm run build
iisreset /restart
```

### 3. IIS Cache Temizle
```cmd
REM IIS cache'i temizle
%windir%\system32\inetsrv\appcmd recycle apppool "yourdomain.com"

REM T√ºm AppPool'larƒ± recycle et
%windir%\system32\inetsrv\appcmd list apppool | findstr /v "DefaultAppPool" | 
  for /f "tokens=2 delims= " %A in ('more') do @%windir%\system32\inetsrv\appcmd recycle apppool "%A"
```

### 4. Disk Space Kontrol
```cmd
REM Disk kullanƒ±mƒ±nƒ± kontrol et
dir D:\ /s
wmic logicaldisk get name, size, freespace

REM PowerShell'de
Get-Volume | Select-Object DriveLetter, Size, SizeRemaining | Format-Table
```

### 5. Port Conflict Kontrol
```cmd
netstat -ano | findstr :3000
netstat -ano | findstr :5050
```

---

## üîê ENVIRONMENT & CONFIG

### Environment Variables Kontrol
```cmd
REM T√ºm environment variables'ƒ± listele
set

REM Belirli variable'ƒ± kontrol et
echo %NODE_ENV%
echo %FRONTEND_URL%
echo %DATABASE_URL%
```

### .env Dosyasƒ±nƒ± Kontrol Et
```cmd
REM Dosyanƒ±n var olup olmadƒ±ƒüƒ±nƒ± kontrol et
if exist D:\httpdocs\yourdomain.com\httpdocs\.env (
  echo .env file exists
) else (
  echo .env file NOT found
)

REM ƒ∞√ßeriƒüini g√∂r√ºnt√ºle
type D:\httpdocs\yourdomain.com\httpdocs\.env
```

---

## üìù BATCH SCRIPT KULLANUMU

### plesk-deploy.bat √áalƒ±≈ütƒ±rma

```cmd
REM Men√º modunda (interaktif)
D:\httpdocs\yourdomain.com\httpdocs\plesk-deploy.bat

REM Se√ßim yapƒ±n:
REM 1 = Tam Deployment
REM 2 = Hƒ±zlƒ± Build
REM 3 = Production Build
REM 4 = Node.js Troubleshoot
REM 5 = NPM Troubleshoot
REM 6 = Logs G√∂r√ºnt√ºle
REM 7 = Disk Space Kontrol
REM 8 = Node Process Monitoring
REM 9 = IIS Status
REM 0 = √áƒ±k
```

---

## üîµ POWERSHELL SCRIPT KULLANUMU

### plesk-deploy.ps1 √áalƒ±≈ütƒ±rma

#### ƒ∞lk Kurulum (Tek Seferlik)
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### Tam Deployment
```powershell
.\plesk-deploy.ps1 -Scenario "full" -ProjectPath "D:\httpdocs\yourdomain.com\httpdocs"
```

#### Hƒ±zlƒ± Build (Development changes)
```powershell
.\plesk-deploy.ps1 -Scenario "quick"
```

#### Production Build
```powershell
.\plesk-deploy.ps1 -Scenario "production"
```

#### Troubleshooting
```powershell
.\plesk-deploy.ps1 -Scenario "troubleshoot-node"
.\plesk-deploy.ps1 -Scenario "troubleshoot-npm"
```

#### Logs G√∂r√ºnt√ºle
```powershell
.\plesk-deploy.ps1 -Scenario "logs"
```

#### Disk Space Kontrol
```powershell
.\plesk-deploy.ps1 -Scenario "disk"
```

#### Monitoring
```powershell
.\plesk-deploy.ps1 -Scenario "monitor"
```

---

## üìã PLESK "Additional Deployment Actions" Ayarƒ±

Eƒüer GitHub Push'ta otomatik deployment yapmak istiyorsanƒ±z, Plesk'te:

### Se√ßenek 1: PowerShell ile (√ñnerilen)
```powershell
powershell -NoProfile -ExecutionPolicy Bypass -File "D:\httpdocs\yourdomain.com\httpdocs\plesk-deploy.ps1" -Scenario "full"
```

### Se√ßenek 2: Batch Script ile
```cmd
call "D:\httpdocs\yourdomain.com\httpdocs\plesk-deploy.bat" 1
```

### Se√ßenek 3: npm Script ile
```cmd
cd D:\httpdocs\yourdomain.com\httpdocs && call npm run plesk-deploy
```

### Se√ßenek 4: Manuel Komutlar
```cmd
cd D:\httpdocs\yourdomain.com\httpdocs
call npm install
call npm run build
taskkill /F /IM node.exe /T 2>nul
call iisreset /restart
```

---

## ‚è∞ OTOMATIK DEPLOYMENT SCHEDULE

### Windows Task Scheduler'da Kurulum

1. **Task Scheduler'ƒ± a√ß:**
   ```cmd
   taskschd.msc
   ```

2. **New Task olu≈ütur:**
   - Name: "MDDS Plesk Deployment"
   - Run with highest privileges
   - Run whether user is logged in or not

3. **Trigger ekle:**
   - Schedule: Daily/Weekly
   - Time: 02:00 AM (off-peak)

4. **Action ekle:**
   ```
   Program: C:\Windows\System32\cmd.exe
   Arguments: /c "cd D:\httpdocs\yourdomain.com\httpdocs && npm run plesk-build"
   Start in: D:\httpdocs\yourdomain.com\httpdocs
   ```

5. **Conditions:**
   - Only run if network available
   - Start only if idle

---

## üîÑ GIT INTEGRATION

### Manual Git Pull + Build
```cmd
cd D:\httpdocs\yourdomain.com\httpdocs
git pull origin main
npm run plesk-build
taskkill /F /IM node.exe /T
iisreset /restart
```

### Git Pull Sonrasƒ± Build (PowerShell)
```powershell
$ProjectPath = "D:\httpdocs\yourdomain.com\httpdocs"
Set-Location $ProjectPath
git pull origin main
& .\plesk-deploy.ps1 -Scenario "production"
```

---

## üìû QUICK REFERENCE TABLE

| G√∂rev | Komut |
|-------|-------|
| Full Deployment | `npm run plesk-deploy` |
| Build Only | `npm run build` |
| Node Process √ñld√ºr | `taskkill /F /IM node.exe` |
| IIS Restart | `iisreset /restart` |
| NPM Cache Temizle | `npm cache clean --force` |
| node_modules Sil | `rmdir node_modules /s /q` |
| Dependencies Y√ºkle | `npm install` |
| Logs G√∂r√ºnt√ºle | `type deployment.log` |
| Process Listele | `tasklist \| findstr node` |
| Port Kontrol | `netstat -ano \| findstr :3000` |
| Disk Space | `wmic logicaldisk get name, freespace` |
| AppPool Recycle | `%windir%\system32\inetsrv\appcmd recycle apppool "yourdomain.com"` |

---

## üí° TIPS & BEST PRACTICES

1. **Build √∂ncesi environment check edin:**
   ```cmd
   npm run check
   ```

2. **Always use git before deploying:**
   ```cmd
   git status
   git pull origin main
   ```

3. **Create backups before major changes:**
   ```cmd
   xcopy dist dist.backup /E /I /Y
   ```

4. **Monitor logs during deployment:**
   - PowerShell'de: `Get-Content deployment.log -Tail 50 -Wait`

5. **Test locally before pushing:**
   ```cmd
   npm run dev
   ```

6. **Use production mode for testing:**
   ```cmd
   cross-env NODE_ENV=production npm run build
   ```

---

## üÜò EMERGENCY PROCEDURES

### Tam Rollback
```cmd
cd D:\httpdocs\yourdomain.com\httpdocs
git reset --hard HEAD~1
npm run plesk-build
taskkill /F /IM node.exe /T
iisreset /restart
```

### All Node.js Processes √ñld√ºr
```cmd
taskkill /F /IM node.exe /T /FI "MEMUSAGE gt 50000"
```

### IIS tamamen reset et
```cmd
iisreset /restart /force
```

---

Daha fazla bilgi i√ßin `PLESK_DEPLOYMENT.md` dosyasƒ±na bakƒ±n.
